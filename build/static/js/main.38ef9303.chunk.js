(this.webpackJsonpdrug_mlvis=this.webpackJsonpdrug_mlvis||[]).push([[0],{163:function(e,t,a){},238:function(e,t,a){e.exports=a(270)},243:function(e,t,a){},267:function(e,t,a){},268:function(e,t,a){},270:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(26),o=a.n(i),s=(a(243),a(27)),c=a(28),l=a(25),d=a(33),u=a(32),h=a(10),p=a(273),g=a(47),f=a(84),m=a(39),y=a(17),b=a.n(y),v=a(29),E=a(165),x=a.n(E).a.create({baseURL:"".concat("./","/"),withCredentials:!1,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,PATCH,OPTIONS"}}),k=new(function(){function e(){Object(s.a)(this,e),this.cache=new Map,this.pendingRequests=new Map,this.preloadProgress={total:0,completed:0,inProgress:!1,currentDrug:""},this.listeners=new Set}return Object(c.a)(e,[{key:"get",value:function(e){var t=this.cache.get(e);return t?Date.now()-t.timestamp>864e5?(this.cache.delete(e),null):t.data:null}},{key:"set",value:function(e,t){this.cache.set(e,{data:t,timestamp:Date.now()}),this.notifyListeners()}},{key:"has",value:function(e){return null!==this.get(e)}},{key:"clear",value:function(){this.cache.clear(),this.pendingRequests.clear(),this.preloadProgress={total:0,completed:0,inProgress:!1,currentDrug:""},this.notifyListeners()}},{key:"getOrFetch",value:function(){var e=Object(v.a)(b.a.mark((function e(t,a){var n,r,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=this.get(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(!this.pendingRequests.has(t)){e.next=5;break}return e.abrupt("return",this.pendingRequests.get(t));case 5:return r=a().then((function(e){return i.set(t,e),i.pendingRequests.delete(t),e})).catch((function(e){throw i.pendingRequests.delete(t),e})),this.pendingRequests.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getStats",value:function(){return{size:this.cache.size,preloadProgress:this.preloadProgress,keys:Array.from(this.cache.keys())}}},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),function(){return t.listeners.delete(e)}}},{key:"notifyListeners",value:function(){this.listeners.forEach((function(e){return e()}))}}]),e}()),w=k,D=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./txgnn_data/node_types.json",e.next=3,x.get("./txgnn_data/node_types.json");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./txgnn_data/edge_types.json",e.next=3,x.get("./txgnn_data/edge_types.json");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/node_name_dict",e.next=3,x.get("./api/node_name_dict");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(v.a)(b.a.mark((function e(t,a){var n,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="attention_pair:".concat(a,":").concat(t),!(r=w.get(n))){e.next=5;break}return console.log("[Cache HIT] attention_pair for ".concat(a,"-").concat(t)),e.abrupt("return",r);case 5:return console.log("[Cache MISS] fetching attention_pair for ".concat(a,"-").concat(t)),i="./api/attention_pair?disease=".concat(t,"&drug=").concat(a),e.next=9,x.get(i);case 9:return o=e.sent,w.set(n,o.data),e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),_=function(){var e=Object(v.a)(b.a.mark((function e(){var t,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/diseases",e.next=3,x.get("./api/diseases");case 3:return t=e.sent,a=t.data,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(v.a)(b.a.mark((function e(t){var a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="./api/drug_predictions?disease_id=".concat(t),e.next=3,x.get(a);case 3:return n=e.sent,r=n.data,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(v.a)(b.a.mark((function e(t){var a,n,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="disease_predictions:".concat(t),!(n=w.get(a))){e.next=5;break}return console.log("[Cache HIT] disease_predictions for ".concat(t)),e.abrupt("return",n);case 5:return console.log("[Cache MISS] fetching disease_predictions for ".concat(t)),r="./api/disease_predictions?drug_id=".concat(t,"&top_n=30"),e.next=9,x.get(r);case 9:return i=e.sent,o=i.data,w.set(a,o),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(v.a)(b.a.mark((function e(t){var a,n,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="embeddings:".concat(t||"default"),!(n=w.get(a))){e.next=5;break}return console.log("[Cache HIT] embeddings for ".concat(t||"default")),e.abrupt("return",n);case 5:return console.log("[Cache MISS] fetching embeddings for ".concat(t||"default")),r=t?"./api/disease_embeddings?drug_id=".concat(t):"./data/disease_tsne.json",e.next=9,x.get(r);case 9:return i=e.sent,w.set(a,i.data),e.abrupt("return",i.data);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/drug_list",e.next=3,x.get("./api/drug_list");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(v.a)(b.a.mark((function e(t,a){var n,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="subgraph:".concat(t,":").concat(a),!(r=w.get(n))){e.next=5;break}return console.log("[Cache HIT] subgraph for ".concat(t,"-").concat(a)),e.abrupt("return",r);case 5:return console.log("[Cache MISS] fetching subgraph for ".concat(t,"-").concat(a)),i="./api/subgraph?drug_id=".concat(t,"&disease_id=").concat(a),e.next=9,x.get(i);case 9:return o=e.sent,w.set(n,o.data),e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),A=new Set,G=function(e){A.forEach((function(t){return t(e)}))},H=function(){var e=Object(v.a)(b.a.mark((function e(t){var a,n,r,i,o,s,c,l,d,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.preloadProgress.inProgress||k.preloadProgress.currentDrug!==t){e.next=3;break}return console.log("[Preload] Already preloading ".concat(t,", skipping...")),e.abrupt("return");case 3:return console.log("[Preload] Starting AGGRESSIVE preload for drug ".concat(t,"...")),a=Date.now(),k.preloadProgress={total:0,completed:0,inProgress:!0,currentDrug:t},e.prev=6,e.next=9,T(t);case 9:for(n=e.sent,r=n.predictions||[],console.log("[Preload] Got ".concat(r.length," disease predictions for ").concat(t)),i=I(t),o=r.slice(0,30),k.preloadProgress.total=2*o.length+1,10,s=[],c=0;c<o.length;c+=10)l=o.slice(c,c+10),d=l.flatMap((function(e){var a=e.node_id||e.id;return[P(a,t).then((function(){k.preloadProgress.completed++,G({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t})})).catch((function(e){console.warn("Failed to preload attention for ".concat(a,":"),e),k.preloadProgress.completed++})),C(t,a).then((function(){k.preloadProgress.completed++,G({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t})})).catch((function(e){console.warn("Failed to preload subgraph for ".concat(a,":"),e),k.preloadProgress.completed++}))]})),s.push.apply(s,Object(m.a)(d));return e.next=20,i;case 20:return k.preloadProgress.completed++,G({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t}),e.next=24,Promise.all(s);case 24:u=Date.now()-a,console.log("[Preload] \u2713 Completed for drug ".concat(t," in ").concat(u,"ms - ").concat(k.getStats().size," items cached")),k.preloadProgress.inProgress=!1,G({total:k.preloadProgress.total,completed:k.preloadProgress.total,drugId:t}),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(6),console.error("[Preload] Error:",e.t0),k.preloadProgress.inProgress=!1;case 34:case"end":return e.stop()}}),e,null,[[6,30]])})));return function(t){return e.apply(this,arguments)}}(),M=function(e){return function(e){return A.add(e),function(){return A.delete(e)}}(e)},L="Load_Node_Types",R="Load_Edge_Types",z="Add_Attention_Paths",W="Del_Attention_Paths",U="Load_Node_Name_Dict",F="Load_Drug_Options",B="Load_Disease_Options",V="Load_Disease_Predictions",Y="Load_Drug_List",q="Set_Loading_Status",K="Change_Edge_THR",Z="Change_Drug",J="Change_Disease",X="Change_App_Mode",$="Change_Selected_Drug_Primary",Q="Select_Path_Nodes",ee="Toggle_Meta_Path_Hide",te="Toggle_Disease_Selection",ae=function(e,t,a,n){t&&(oe(e,t,a,n),se(e,n))},ne=function(e,t){return t({type:q,payload:{isDiseaseLoading:!0}}),t({type:$,payload:{selectedDrugPrimary:e}}),t({type:J,payload:{selectedDisease:void 0}}),T(e).then((function(a){var n=a.predictions.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{selected:!1})}));t({type:V,payload:{diseasePredictions:n}}),console.log("[Preload] Starting background preload for ".concat(e,"...")),H(e).then((function(){console.log("[Preload] Background preload complete for ".concat(e))}))})).then((function(){t({type:q,payload:{isDiseaseLoading:!1}})}))},re=function(e,t){t({type:X,payload:{appMode:e}}),"drug-to-disease"===e&&fetch("http://127.0.0.1:8002/api/drugs").then((function(e){return e.json()})).then((function(e){t({type:Y,payload:{drugOptions:e}})}))},ie=function(e,t,a,n,r){var i=r||e;n({type:te,payload:{diseaseId:e}}),n({type:J,payload:{selectedDisease:i}}),n({type:Z,payload:{selectedDrug:t}}),oe(t,i,a,n,e)},oe=function(e,t,a,n,r){var i=r||e;void 0!==e&&void 0!==t&&void 0!==i&&(a?(n({type:q,payload:{isAttentionLoading:!0}}),P(t,e).then((function(e){n({type:z,payload:{attention:e.attention,selectedDrug:i,metaPathGroups:Object(f.a)({},i,ce(e.metapaths))}})})).then((function(){n({type:q,payload:{isAttentionLoading:!1}})}))):n({type:W,payload:{selectedDrug:i}}))},se=function(e,t){t({type:Z,payload:{selectedDrug:e}})},ce=function(e){var t=[],a=[];return e.forEach((function(e){e.hide=!1;var n=e.nodes.map((function(e){return e.nodeType})).join("_"),r=a.indexOf(n);r>-1?t[r].paths.push(e):(a.push(n),t.push({nodeTypes:e.nodes.map((function(e){return e.nodeType})),paths:[e]}))})),t},le=function(e,t){return e.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{selected:t===e.id?!e.selected:e.selected})}))},de=function(e,t,a,n){var r=e.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{count:Object(h.a)({},e.count)})})),i=String(a);return n&&t?t.forEach((function(e){var t=e.paths.length,a=r.find((function(t){return t.nodeTypes.join()===e.nodeTypes.join()}));a?(a.count[i]=t,a.sum+=t):r.push({nodeTypes:e.nodeTypes,count:Object(f.a)({},i,t),sum:t,hide:!1,idx:r.length})})):n||(r.forEach((function(e){i in e.count&&(e.sum-=e.count[i],delete e.count[i])})),r=r.filter((function(e){return e.sum>0}))),r},ue=function(e,t){return!e.filter((function(e){return e.selected})).map((function(e){return e.id})).includes(t)},he=function(e,t){switch(t.type){case F:return Object(h.a)(Object(h.a)({},e),{},{drugPredictions:t.payload.drugPredictions});case B:return Object(h.a)(Object(h.a)({},e),{},{diseaseOptions:t.payload.diseaseOptions});case L:return Object(h.a)(Object(h.a)({},e),{},{nodeTypes:t.payload.nodeTypes});case R:return Object(h.a)(Object(h.a)({},e),{},{edgeTypes:t.payload.edgeTypes});case J:return Object(h.a)(Object(h.a)({},e),{},{selectedDisease:t.payload.selectedDisease,attention:{},metaPathGroups:{},metaPathSummary:[]});case Z:return Object(h.a)(Object(h.a)({},e),{},{drugPredictions:le(e.drugPredictions,t.payload.selectedDrug)});case U:return Object(h.a)(Object(h.a)({},e),{},{nodeNameDict:t.payload.nodeNameDict});case q:return Object(h.a)(Object(h.a)({},e),t.payload);case Q:return Object(h.a)(Object(h.a)({},e),{},{selectedPathNodes:t.payload.selectedPathNodes});case K:return Object(h.a)(Object(h.a)({},e),{},{edgeThreshold:t.payload.edgeThreshold});case ee:return Object(h.a)(Object(h.a)({},e),{},{metaPathSummary:t.payload.metaPathSummary});case z:return Object(h.a)(Object(h.a)({},e),{},{attention:Object(h.a)(Object(h.a)({},e.attention),t.payload.attention),metaPathGroups:Object(h.a)(Object(h.a)({},e.metaPathGroups),t.payload.metaPathGroups),metaPathSummary:de(e.metaPathSummary,t.payload.metaPathGroups[t.payload.selectedDrug],t.payload.selectedDrug,!0)});case W:var a=JSON.parse(JSON.stringify(e.attention)),n=JSON.parse(JSON.stringify(e.metaPathGroups)),r=t.payload.selectedDrug,i=n[r];delete a["disease:".concat(r)],delete a["drug:".concat(r)],delete n[r];var o=de(e.metaPathSummary,i,r,!1);return Object(h.a)(Object(h.a)({},e),{},{attention:a,metaPathGroups:n,metaPathSummary:o});case X:return Object(h.a)(Object(h.a)({},e),{},{appMode:t.payload.appMode});case $:return Object(h.a)(Object(h.a)({},e),{},{selectedDrugPrimary:t.payload.selectedDrugPrimary,diseasePredictions:[],attention:{},metaPathGroups:{},metaPathSummary:[]});case V:return Object(h.a)(Object(h.a)({},e),{},{diseasePredictions:t.payload.diseasePredictions});case te:var s=t.payload.diseaseId,c=e.diseasePredictions.map((function(e){return e.id===s?Object(h.a)(Object(h.a)({},e),{},{selected:!e.selected}):e}));return Object(h.a)(Object(h.a)({},e),{},{diseasePredictions:c});case Y:return Object(h.a)(Object(h.a)({},e),{},{drugOptions:t.payload.drugOptions});default:return e}},pe={diseaseOptions:[],drugPredictions:[],nodeTypes:[],edgeTypes:{},metaPathGroups:{},attention:{},selectedDisease:void 0,nodeNameDict:{},isInitializing:!0,isDrugLoading:!1,isAttentionLoading:!1,isDiseaseLoading:!1,edgeThreshold:0,metaPathSummary:[],selectedPathNodes:[],drugOptions:[],diseasePredictions:[],selectedDrugPrimary:void 0,appMode:"disease-to-drug"},ge=Object(n.createContext)({});function fe(e){var t=r.a.useReducer(he,pe),a=Object(g.a)(t,2),n=a[0],i=a[1],o=r.a.useCallback(function(e,t){return function(a){return"function"===typeof a?a(e,t):e(a)}}(i,n),[]);return r.a.createElement(ge.Provider,{value:{state:n,dispatch:o}},e.children)}function me(e){return function(t){return r.a.createElement(ge.Consumer,null,(function(a){return r.a.createElement(e,Object.assign({},t,{globalState:a.state,dispatch:a.dispatch}))}))}}var ye=a(12),be=a(178),ve=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:800,r=e,i=document.createElement("canvas").getContext("2d");i.font="".concat(n," ").concat(t,"px Arial");var o=i.measureText(e).width;if(o>a)for(var s=1;s<e.length;s+=1){var c=e.substr(0,s-1).concat("..."),l=e.substr(0,s).concat("..."),d=i.measureText(c).width,u=i.measureText(l).width;if(u>a&&d<a){r=c;break}}return r},Ee=function(e,t){var a=document.createElement("canvas").getContext("2d");return a.font="".concat(t,"px Arial"),a.measureText(e).width},xe=r.a.createElement("g",null,r.a.createElement("text",{textAnchor:"middle",x:"24"},"LOADING..."),r.a.createElement("rect",{x:"0",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0",dur:"0.6s",repeatCount:"indefinite"})),r.a.createElement("rect",{x:"20",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.2s",dur:"0.6s",repeatCount:"indefinite"})),r.a.createElement("rect",{x:"40",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.4s",dur:"0.6s",repeatCount:"indefinite"}))),ke=["#4e79a7","#edc949","#e15759","#f28e2c","#76b7b2","#59a14f","#af7aa1","#ff9da7","#9c755f","#bab0ab"],we={},De=function(e){return void 0===we[e]&&(we[e]=ke[Object.keys(we).length]),we[e]},Oe=function e(t,a){return t.children.length>0&&(t=Object(h.a)(Object(h.a)({},t),{},{children:t.children.filter((function(e){return e.score>=a})).map((function(t){return e(t,a)}))})),t},Se=function(e){return 1/(1+Math.pow(Math.E,-e))},Pe=["mendelian disease","disease of cell nucleous","hip region disease","acute disease","vector borne disease","cancer","sex-linked disease","movement disorder"],_e=["15783","7381","15896"],je=["DB12530"],Te=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).nodeHeight=20,e.fontSize=14,e.labelLength=150,e.midGap=60,e}return Object(c.a)(a,[{key:"drawNodeAttentionHorizontal",value:function(e,t,a){var n=this,i=this.props.width,o=this.props.globalState,s=o.nodeNameDict,c=o.edgeTypes,l=o.selectedPathNodes,d=Oe(e,a),u=ye.i(d),h=ye.n().nodeSize([this.nodeHeight+2,t])(u),p=ye.j().source((function(e){return{x:"drug"===h.data.nodeType?i/2-n.midGap/2-n.labelLength-e.source.y-n.labelLength/2:e.source.y+n.labelLength/2,y:e.source.x}})).target((function(e){return{x:"drug"===h.data.nodeType?i/2-n.midGap/2-n.labelLength-e.target.y+n.labelLength/2:e.target.y-n.labelLength/2,y:e.target.x}})).x((function(e){return e.x})).y((function(e){return e.y})),g=Math.max.apply(Math,Object(m.a)(h.links().map((function(e){return e.target.data.score})))),f=ye.k().domain([0,g]).range([1,5]),y=h.links().map((function(e,t){var a=e.target.data.edgeInfo.replace("rev_","");return c[a]&&(a=c[a].edgeInfo||a),r.a.createElement(be.a,{title:a,key:"".concat(e.source.data.nodeId,"=>").concat(e.target.data.nodeId,"_link").concat(t),destroyTooltipOnHide:!0},r.a.createElement("g",null,r.a.createElement("path",{d:p(e),className:"link ".concat(e.source.data.nodeId,"=>").concat(e.target.data.nodeId),fill:"none",stroke:"gray",strokeWidth:f(e.target.data.score),opacity:l.length>0?.5:1}),r.a.createElement("path",{d:p(e),className:"mask",fill:"none",stroke:"transparent",strokeWidth:"3"})))})),b=h.descendants().map((function(e){return e.x})),v=Math.min.apply(Math,Object(m.a)(b)),E=Math.max.apply(Math,Object(m.a)(b))-v+this.nodeHeight+4,x=h.descendants().map((function(e,t){var a=e.data,o=a.nodeId,c=a.nodeType,d=s[c][o];void 0===d&&(o=o.replace(/_/g,"")+".0",d=s[c][o]);var u=ve(d,12,n.labelLength-25-Ee("..(0.00)",14)),p=(null===u||void 0===u?void 0:u.includes(".."))?d:"";e.data.source&&(p=p?"".concat(p," (").concat(e.data.source,")"):"".concat(d," (").concat(e.data.source,")"));var g="";"disease"===c&&(g="M 483.55 227.55 H 462 c -50.68 0 -76.07 -61.27 -40.23 -97.11 L 437 115.19 A 28.44 28.44 0 0 0 396.8 75 L 381.56 90.22 c -35.84 35.83 -97.11 10.45 -97.11 -40.23 V 28.44 a 28.45 28.45 0 0 0 -56.9 0 V 50 c 0 50.68 -61.27 76.06 -97.11 40.23 L 115.2 75 A 28.44 28.44 0 0 0 75 115.19 l 15.25 15.25 c 35.84 35.84 10.45 97.11 -40.23 97.11 H 28.45 a 28.45 28.45 0 1 0 0 56.89 H 50 c 50.68 0 76.07 61.28 40.23 97.12 L 75 396.8 A 28.45 28.45 0 0 0 115.2 437 l 15.24 -15.25 c 35.84 -35.84 97.11 -10.45 97.11 40.23 v 21.54 a 28.45 28.45 0 0 0 56.9 0 V 462 c 0 -50.68 61.27 -76.07 97.11 -40.23 L 396.8 437 A 28.45 28.45 0 0 0 437 396.8 l -15.25 -15.24 c -35.84 -35.84 -10.45 -97.12 40.23 -97.12 h 21.54 a 28.45 28.45 0 1 0 0 -56.89 Z M 224 272 a 48 48 0 1 1 48 -48 A 48 48 0 0 1 224 272 Z m 80 56 a 24 24 0 1 1 24 -24 A 24 24 0 0 1 304 328 Z"),"drug"===c&&(g="M 555.3 300.1 L 424.2 112.8 C 401.9 81 366.4 64 330.4 64 c -22.6 0 -45.5 6.7 -65.5 20.7 c -19.7 13.8 -33.7 32.8 -41.5 53.8 C 220.5 79.2 172 32 112 32 C 50.1 32 0 82.1 0 144 v 224 c 0 61.9 50.1 112 112 112 s 112 -50.1 112 -112 V 218.9 c 3.3 8.6 7.3 17.1 12.8 25 L 368 431.2 c 22.2 31.8 57.7 48.8 93.8 48.8 c 22.7 0 45.5 -6.7 65.5 -20.7 c 51.7 -36.2 64.2 -107.5 28 -159.2 Z M 160 256 H 64 V 144 c 0 -26.5 21.5 -48 48 -48 s 48 21.5 48 48 v 112 Z m 194.8 44.9 l -65.6 -93.7 c -7.7 -11 -10.7 -24.4 -8.3 -37.6 c 2.3 -13.2 9.7 -24.8 20.7 -32.5 c 8.5 -6 18.5 -9.1 28.8 -9.1 c 16.5 0 31.9 8 41.3 21.5 l 65.6 93.7 l -82.5 57.7 Z");var f=0===l.length||l.map((function(e){return e.nodeType})).includes(c)&&l.map((function(e){return e.nodeId})).includes(o);return r.a.createElement(be.a,{title:p,key:"node".concat(t,"_").concat(d),destroyTooltipOnHide:!0,mouseEnterDelay:.3},r.a.createElement("g",{className:"".concat(o," node"),transform:"translate(".concat("drug"===h.data.nodeType?i/2-n.midGap/2-n.labelLength-e.y:e.y,", ").concat(e.x,")"),cursor:"pointer"},r.a.createElement("rect",{width:n.labelLength,height:n.nodeHeight,fill:De(c),x:-1*n.labelLength/2,y:-n.nodeHeight/2,opacity:f?1:.2}),r.a.createElement("path",{className:"virus_icon",d:g,transform:"translate(".concat(-1*n.labelLength/2+2,", ").concat(-n.nodeHeight/2,") scale(0.04)"),fill:"white"}),r.a.createElement("text",{fill:"white",fontSize:n.fontSize,transform:"translate(".concat(-1*n.labelLength/2+25,", ").concat((n.nodeHeight-n.fontSize)/2,")")},u),0===e.depth&&void 0===e.children&&r.a.createElement("text",{fill:"gray",fontSize:n.fontSize,transform:"translate(".concat("drug"===h.data.nodeType?-n.labelLength/2-10-Ee("No Attention Data",n.fontSize):n.labelLength/2+10,", ").concat((n.nodeHeight-n.fontSize)/2,")")},"No Attention Data")))}));return{content:[r.a.createElement("g",{key:"links",className:"links"},y),r.a.createElement("g",{key:"nodes",className:"nodes"},x)],height:E}}},{key:"drawSubgraph",value:function(){var e=this,t=this.props.globalState,a=t.attention,n=t.edgeThreshold,i=this.props.width,o=(i-2*this.labelLength-this.midGap)/4,s=[0];return{content:Object.keys(a).map((function(t,c){var l=e.drawNodeAttentionHorizontal(a[t],o,n),d=l.height,u=l.content;return s.push(d),r.a.createElement("g",{className:t,key:t,transform:"translate(".concat((i+e.midGap)/2*c+e.labelLength/2,", ").concat(d/2+2*e.nodeHeight,")")},u)})),height:Math.max.apply(Math,s)}}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height,n=e.globalState,i=n.isAttentionLoading,o=n.selectedDisease,s=n.drugPredictions,c=n.diseasePredictions,l=n.appMode,d=("drug-to-disease"===l?c:s).filter((function(e){return e.selected})),u=this.drawSubgraph(),h=u.content,p=u.height;return r.a.createElement("svg",{width:t,height:Math.max(p,a),className:"nodeLink"},d.length>0&&("drug-to-disease"===l||o)?h:r.a.createElement("text",{x:t/2,y:a/2,fill:"gray"},"Please select a disease and a drug first"),i?r.a.createElement("g",null,r.a.createElement("rect",{width:t,height:a,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(t/2,", ").concat(a/2,")"),textAnchor:"middle"},xe)):r.a.createElement("g",null))}}]),a}(r.a.Component),Ie=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).padding=10,n.RADIUS=7,n.prevNodes=[],n.prevLinks=[],n.simulation=void 0,n.simulation=ye.h().force("charge",ye.g().strength(-60)).force("link",ye.f().id((function(e){return e.id})).distance(35).strength(.6)).force("collision",ye.e().radius(n.RADIUS+2)).force("center",ye.d(e.width/2,e.height/2)).alphaDecay(.02).velocityDecay(.3),n}return Object(c.a)(a,[{key:"ticked",value:function(e,t){e.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")})),t.select("line.link").attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),t.select("line.mask").attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),t.select("text").attr("text-anchor","middle").attr("transform",(function(e){return"translate(".concat((e.target.x+e.source.x)/2,", ").concat((e.source.y+e.target.y)/2,")")}))}},{key:"dragstarted",value:function(e){ye.b.active||this.simulation.alpha(.3).restart(),e.fx=e.x,e.fy=e.y}},{key:"dragged",value:function(e){e.fx=ye.b.x,e.fy=ye.b.y}},{key:"dragended",value:function(e){ye.b.active||this.simulation.alpha(0),e.fx=ye.b.x,e.fy=ye.b.y}},{key:"isTargetNode",value:function(e){var t=this.props.globalState,a=t.drugPredictions,n=t.diseasePredictions,r=t.selectedDisease,i=t.selectedDrugPrimary,o=t.appMode,s=("drug-to-disease"===o?n:a).filter((function(e){return e.selected})).map((function(e){return e.id}));return"drug-to-disease"===o?s.includes(e.nodeId)||i===e.nodeId:s.includes(e.nodeId)||r===e.nodeId}},{key:"isHighlighted",value:function(e){var t=this.props.globalState.selectedPathNodes;return t.map((function(e){return e.nodeType})).includes(e.nodeType)&&t.map((function(e){return e.nodeId})).includes(e.nodeId)}},{key:"getNodeLinks",value:function(){var e=this,t=this.props.globalState,a=t.drugPredictions,n=t.diseasePredictions,r=t.attention,i=t.selectedDisease,o=t.selectedDrugPrimary,s=t.edgeTypes,c=t.appMode,l=this.props,d=l.width,u=l.height,p=("drug-to-disease"===c?n:a).filter((function(e){return e.selected})).map((function(e){return e.id})),g=[],f=[];Object.values(r).forEach((function(t){var a=ye.i(t),n=[];a.descendants().forEach((function(t){var a={id:"".concat(t.data.nodeType,":").concat(t.data.nodeId),nodeId:t.data.nodeId,nodeType:t.data.nodeType},r=e.prevNodes.find((function(e){return e.id===a.id}));n.push(Object(h.a)(Object(h.a)({},a),r))})),g=g.concat(n);var r=a.links().map((function(e){var t,a=e.source.data,n=e.target.data,r=n.edgeInfo.replace("rev_","");return r=(null===(t=s[r])||void 0===t?void 0:t.edgeInfo)||r,{source:"".concat(a.nodeType,":").concat(a.nodeId),target:"".concat(n.nodeType,":").concat(n.nodeId),score:n.score,edgeInfo:r}}));f=f.concat(r)}));for(var m=0;m<g.length;m++){var y=g[m],b=p.indexOf(y.nodeId);"drug-to-disease"===c?y.nodeId===o?(y.fy=u/2,y.fx=.2*d):b>-1&&(y.fy=u/(p.length+1)*(b+1),y.fx=.8*d):y.nodeId===i?(y.fy=u/2,y.fx=.2*d):b>-1&&(y.fy=u/(p.length+1)*(b+1),y.fx=.8*d)}return this.prevNodes=g,this.prevLinks=f,{nodes:g,links:f}}},{key:"drawGraph",value:function(){var e=this,t=this.props.globalState.nodeNameDict,a=this.getNodeLinks(),n=a.nodes,r=a.links,i=this.props,o=i.width,s=i.height,c=ye.k().range([2,6]).domain(ye.c(r.map((function(e){return e.score})))),l=ye.l("svg.graph").select("g.links").selectAll("g.link").data(r).join((function(e){return e.append("g").attr("class","link")})).on("mouseover",(function(){ye.l(this).select("text.edgeLabel").transition().delay(500).attr("class","edgeLabel")})).on("mouseout",(function(){ye.l(this).select("text.edgeLabel").transition().delay(500).attr("class","edgeLabel hidden")}));l.append("line").attr("x1",(function(e){return e.target.x})).attr("y1",(function(e){return e.target.y})).attr("x2",(function(e){return e.source.x})).attr("y2",(function(e){return e.source.y})).attr("class","link").attr("stroke","#aaa").attr("stroke-width",(function(e){return c(e.score)})).attr("id",(function(e){return e.id})),l.append("line").attr("x1",(function(e){return e.target.x})).attr("y1",(function(e){return e.target.y})).attr("x2",(function(e){return e.source.x})).attr("y2",(function(e){return e.source.y})).attr("class","mask").attr("stroke-width",4).attr("stroke","transparent"),l.append("text").attr("class","edgeLabel hidden").attr("transform",(function(e){return"translate(".concat((e.target.x+e.source.x)/2,", ").concat((e.source.y+e.target.y)/2,")")})).text((function(e){return e.edgeInfo}));var d=ye.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").data(n,(function(e){return e.id})).join((function(t){return t.append("g").attr("class","nodeGroup").attr("transform",(function(e){return"translate(".concat(e.x||o/2,", ").concat(e.y||s/2,")")})).attr("cursor","pointer").call(ye.a().on("start",e.dragstarted.bind(e)).on("drag",e.dragged.bind(e)).on("end",e.dragended.bind(e)))}),(function(e){return e.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")}))}),(function(e){return e.remove()}));d.append("circle").attr("r",this.RADIUS).attr("class","node").attr("id",(function(e){return e.id})).attr("fill",(function(e){return De(e.nodeType)})).attr("stroke","white"),d.append("text").attr("class","nodeLabel").attr("transform","translate(".concat(-1*this.RADIUS,", ").concat(-2.5*this.RADIUS," )")).attr("font-size","13px").text((function(e){return t[e.nodeType][e.nodeId]})).classed("hidden",!0),d.filter((function(t){return e.isTargetNode(t)||e.isHighlighted(t)})).select("text.nodeLabel").classed("hidden",!1),d.on("click",(function(e){var t=ye.l(this).select("text.nodeLabel"),a=t.classed("hidden");t.classed("hidden",!a)})),this.simulation.nodes(n),this.simulation.force("link").links(r),this.simulation.on("tick",(function(){return e.ticked(d,l)})),this.updateVisibility()}},{key:"updateNodeLabel",value:function(){var e=this;ye.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").filter((function(t){return e.isTargetNode(t)||e.isHighlighted(t)})).select("text.nodeLabel").classed("hidden",!1)}},{key:"updateVisibility",value:function(){var e=this.props.globalState,t=e.attention,a=e.edgeThreshold;ye.l("svg.graph").selectAll("g.link").style("opacity",(function(e){return e.score>a?1:0}));var n=[];Object.values(t).forEach((function(e){n=n.concat(function e(t){var a,n=[t.nodeId];t.children.length>0&&(n=(a=n).concat.apply(a,Object(m.a)(t.children.map((function(t){return e(t)})))));return n}(Oe(e,a)))})),ye.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").select("circle").style("opacity",(function(e){return n.includes(e.nodeId)?1:0}))}},{key:"componentDidMount",value:function(){this.drawGraph()}},{key:"componentDidUpdate",value:function(e){var t=e.globalState,a=t.metaPathGroups,n=t.selectedPathNodes,r=t.edgeThreshold,i=t.attention,o=this.props.globalState,s=o.metaPathGroups,c=o.selectedPathNodes,l=o.edgeThreshold,d=o.attention,u=Object.keys(a).sort().join(","),h=Object.keys(s).sort().join(","),p=Object.keys(i).sort().join(","),g=Object.keys(d).sort().join(",");return u===h&&p===g||(this.drawGraph(),this.simulation.alpha(1).restart()),n.map((function(e){return e.nodeId})).join()!==c.map((function(e){return e.nodeId})).join()&&this.updateNodeLabel(),r!==l&&this.updateVisibility(),!1}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height,r=this.props.globalState.isAttentionLoading,i=Object.keys(this.props.globalState.metaPathGroups),o=n.createElement("text",{transform:"translate(".concat(t/2,", ").concat(a/2,")"),fill:"gray",fontSize:20},"Please select a drug first");return n.createElement("svg",{className:"graph",width:t,height:a},n.createElement("g",{className:"links"}),n.createElement("g",{className:"nodes"}),n.createElement("text",{x:0,y:a-25,fill:"gray",fontSize:12},"Drag & Drop to move nodes."),n.createElement("text",{x:0,y:a-10,fill:"gray",fontSize:12},"Click on nodes to show/hide labels."),0===i.length?o:n.createElement(n.Fragment,null),r?n.createElement("g",{className:"loading"},n.createElement("rect",{className:"loading__background",width:t,height:a,fill:"white",opacity:.5}),n.createElement("g",{transform:"translate(".concat(t/2,", ").concat(a/2,")")},xe)):n.createElement(n.Fragment,null))}}]),a}(n.Component),Ne=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={subgraph:null,loading:!1,error:null,lastCacheKey:""},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.loadSubgraph()}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,a=t.selectedDrugPrimary,n=t.diseasePredictions,r=e.globalState.selectedDrugPrimary,i=e.globalState.diseasePredictions,o=n.find((function(e){return e.selected})),s=i.find((function(e){return e.selected}));a===r&&(null===o||void 0===o?void 0:o.id)===(null===s||void 0===s?void 0:s.id)||this.loadSubgraph()}},{key:"loadSubgraph",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,a,n,r,i,o,s,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState,a=t.selectedDrugPrimary,n=t.diseasePredictions,r=n.find((function(e){return e.selected})),a&&r){e.next=5;break}return this.setState({subgraph:null,loading:!1}),e.abrupt("return");case 5:if(i=r.node_id||r.id,(o="subgraph:".concat(a,":").concat(i))!==this.state.lastCacheKey||!this.state.subgraph){e.next=9;break}return e.abrupt("return");case 9:if(!(s=k.get(o))){e.next=14;break}return console.log("[V1AttentionTable] \u26a1 Global cache hit for ".concat(o)),this.setState({subgraph:s,loading:!1,lastCacheKey:o}),e.abrupt("return");case 14:return this.setState({loading:!0,error:null}),e.prev=15,e.next=18,C(a,i);case 18:c=e.sent,this.setState({subgraph:c,loading:!1,lastCacheKey:o}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(15),console.error("Failed to load subgraph:",e.t0),this.setState({loading:!1,error:"Failed to load attention data"});case 26:case"end":return e.stop()}}),e,this,[[15,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"formatType",value:function(e){return e?"gene/protein"===e?"Protein":e.replace(/_/g," ").replace(/\b\w/g,(function(e){return e.toUpperCase()})):"Unknown"}},{key:"renderAttentionBar",value:function(e){var t=Math.min(100*e,100),a=e>.7?"#28a745":e>.4?"#ffc107":"#dc3545";return n.createElement("div",{style:{width:"100%",height:"20px",backgroundColor:"#e9ecef",borderRadius:"10px",overflow:"hidden"}},n.createElement("div",{style:{width:"".concat(t,"%"),height:"100%",background:"linear-gradient(90deg, ".concat(a," 0%, ").concat(a,"88 100%)"),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"5px"}},n.createElement("span",{style:{fontSize:"11px",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.5)"}},e.toFixed(3))))}},{key:"render",value:function(){var e,t=this,a=this.props,r=a.width,i=a.height,o=this.state,s=o.subgraph,c=o.loading,l=o.error,d=this.props.globalState,u=d.selectedDrugPrimary,h=d.diseasePredictions,p=d.nodeNameDict,f=h.find((function(e){return e.selected}));if(c)return n.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center"}},n.createElement("svg",{width:100,height:100},xe));if(!u||!f)return n.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d",fontSize:"16px"}},"Please select a drug and disease to see attention scores");if(l)return n.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545",fontSize:"16px"}},l);if(!s||!s.edges||0===s.edges.length)return n.createElement("div",{style:{width:r,height:i,padding:"20px"}},n.createElement("div",{style:{background:"#e7f3ff",borderLeft:"4px solid #3a7bd5",padding:"15px",borderRadius:"5px"}},"No attention data found for this drug-disease pair."));var m={};s.nodes.forEach((function(e){m[e.id]=e}));var y={};s.edges.forEach((function(e){var t=e.relation||"unknown";y[t]||(y[t]=[]),y[t].push(e)})),Object.values(y).forEach((function(e){e.sort((function(e,t){return t.attention-e.attention}))}));var b=(null===(e=p.drug)||void 0===e?void 0:e[u])||u,v=f.name||f.id;return n.createElement("div",{style:{width:r,height:i,overflow:"auto",padding:"10px"}},n.createElement("div",{style:{background:"#e7f3ff",borderLeft:"4px solid #3a7bd5",padding:"15px",marginBottom:"15px",borderRadius:"5px"}},n.createElement("strong",null,"Total Edges:")," ",s.edges.length," |"," ",n.createElement("strong",null,"Relation Types:")," ",Object.keys(y).length,n.createElement("br",null),n.createElement("small",null,"Showing attention scores for: ",n.createElement("strong",null,b)," \u2192 ",n.createElement("strong",null,v))),Object.entries(y).map((function(e){var a=Object(g.a)(e,2),r=a[0],i=a[1];return n.createElement("div",{key:r,style:{marginBottom:"20px"}},n.createElement("h4",{style:{color:"#3a7bd5",marginTop:"15px",marginBottom:"10px",fontSize:"14px",fontWeight:600}},r.replace(/_/g," \u2192 ")," (",i.length,")"),n.createElement("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"}},n.createElement("thead",null,n.createElement("tr",{style:{background:"#f8f9fa"}},n.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057"}},"Source"),n.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057"}},"Target"),n.createElement("th",{style:{padding:"10px",textAlign:"center",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"80px"}},"Layer 1"),n.createElement("th",{style:{padding:"10px",textAlign:"center",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"80px"}},"Layer 2"),n.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"150px"}},"Max Attention"))),n.createElement("tbody",null,i.slice(0,20).map((function(e,a){var r=m[e.source],i=m[e.target],o=Math.max(e.layer1_att||0,e.layer2_att||0);return n.createElement("tr",{key:a,style:{borderBottom:"1px solid #e9ecef"},onMouseEnter:function(e){e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseLeave:function(e){e.currentTarget.style.backgroundColor="transparent"}},n.createElement("td",{style:{padding:"10px"}},n.createElement("strong",null,(null===r||void 0===r?void 0:r.label)||e.source),n.createElement("br",null),n.createElement("small",{style:{color:"#6c757d"}},"(",t.formatType((null===r||void 0===r?void 0:r.type)||"unknown"),")")),n.createElement("td",{style:{padding:"10px"}},n.createElement("strong",null,(null===i||void 0===i?void 0:i.label)||e.target),n.createElement("br",null),n.createElement("small",{style:{color:"#6c757d"}},"(",t.formatType((null===i||void 0===i?void 0:i.type)||"unknown"),")")),n.createElement("td",{style:{padding:"10px",textAlign:"center"}},(e.layer1_att||0).toFixed(4)),n.createElement("td",{style:{padding:"10px",textAlign:"center"}},(e.layer2_att||0).toFixed(4)),n.createElement("td",{style:{padding:"10px"}},t.renderAttentionBar(o)))})))),i.length>20&&n.createElement("div",{style:{textAlign:"center",padding:"10px",color:"#6c757d",fontSize:"12px"}},"Showing top 20 of ",i.length," edges"))})))}}]),a}(n.Component),Ce={drug:"#3a7bd5",disease:"#dc3545","gene/protein":"#28a745",protein:"#28a745",pathway:"#fd7e14",biological_process:"#6f42c1",molecular_function:"#20c997",cellular_component:"#e83e8c",anatomy:"#17a2b8",effect_phenotype:"#ffc107",exposure:"#795548",unknown:"#6c757d"},Ae=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).svgRef=n.createRef(),r.simulation=null,r.selectedDrugPrimary="",r.diseaseNodeId="",r.state={subgraph:null,loading:!1,error:null,lastCacheKey:""},r.dragstarted=r.dragstarted.bind(Object(l.a)(r)),r.dragged=r.dragged.bind(Object(l.a)(r)),r.dragended=r.dragended.bind(Object(l.a)(r)),r}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.loadSubgraph()}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,a=t.selectedDrugPrimary,n=t.diseasePredictions,r=e.globalState.selectedDrugPrimary,i=e.globalState.diseasePredictions,o=n.find((function(e){return e.selected})),s=i.find((function(e){return e.selected}));a===r&&(null===o||void 0===o?void 0:o.id)===(null===s||void 0===s?void 0:s.id)||this.loadSubgraph()}},{key:"componentWillUnmount",value:function(){this.simulation&&this.simulation.stop()}},{key:"loadSubgraph",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,a,n,r,i,o,s,c,l=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState,a=t.selectedDrugPrimary,n=t.diseasePredictions,r=n.find((function(e){return e.selected})),a&&r){e.next=5;break}return this.setState({subgraph:null,loading:!1}),e.abrupt("return");case 5:if(i=r.node_id||r.id,o="subgraph:".concat(a,":").concat(i),this.selectedDrugPrimary=a,this.diseaseNodeId=i,o!==this.state.lastCacheKey||!this.state.subgraph){e.next=11;break}return e.abrupt("return");case 11:if(!(s=k.get(o))){e.next=16;break}return console.log("[V1SubGraph] \u26a1 Global cache hit for ".concat(o)),this.setState({subgraph:s,loading:!1,lastCacheKey:o},(function(){l.drawGraph()})),e.abrupt("return");case 16:return this.setState({loading:!0,error:null}),e.prev=17,e.next=20,C(a,i);case 20:c=e.sent,this.setState({subgraph:c,loading:!1,lastCacheKey:o},(function(){l.drawGraph()})),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(17),console.error("Failed to load subgraph:",e.t0),this.setState({loading:!1,error:"Failed to load subgraph data"});case 28:case"end":return e.stop()}}),e,this,[[17,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNodeColor",value:function(e){return Ce[e]||Ce.unknown}},{key:"dragstarted",value:function(e){var t;ye.b.active||null===(t=this.simulation)||void 0===t||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}},{key:"dragged",value:function(e){e.fx=ye.b.x,e.fy=ye.b.y}},{key:"dragended",value:function(e){var t;ye.b.active||null===(t=this.simulation)||void 0===t||t.alphaTarget(0),e.fx=null,e.fy=null}},{key:"drawGraph",value:function(){var e=this,t=this.state.subgraph,a=this.props,n=a.width,r=a.height;if(t&&this.svgRef.current){var i=this.selectedDrugPrimary,o=this.diseaseNodeId,s=ye.l(this.svgRef.current);s.selectAll("*").remove();var c=t.nodes.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{x:void 0,y:void 0})})),l=t.edges.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{source:e.source,target:e.target})})),d=s.append("g").attr("class","zoom-container"),u=ye.o().scaleExtent([.1,4]).on("zoom",(function(){d.attr("transform",ye.b.transform)}));s.call(u),this.simulation&&this.simulation.stop(),this.simulation=ye.h(c).force("link",ye.f(l).id((function(e){return e.id})).distance(120)).force("charge",ye.g().strength(-250)).force("center",ye.d(n/2,r/2)).force("collision",ye.e().radius(40));var p=d.append("g").selectAll("line").data(l).enter().append("line").attr("stroke",(function(e){return e.on_path?"#ff5722":"#999"})).attr("stroke-opacity",(function(e){return e.on_path?1:.6})).attr("stroke-width",(function(e){return e.on_path?4:Math.max(2,8*(e.attention||.1))})).attr("stroke-dasharray",(function(e){return e.on_path?"8,4":"none"})),g=d.append("g").selectAll("circle").data(c).enter().append("circle").attr("r",(function(e){return e.id===i||e.id===o?25:e.on_path?18:15})).attr("fill",(function(t){return e.getNodeColor(t.type)})).attr("stroke",(function(e){return e.id===i||e.id===o?"#ffc107":e.on_path?"#ff5722":"white"})).attr("stroke-width",(function(e){return e.id===i||e.id===o?4:e.on_path?3:1.5})).attr("cursor","pointer").call(ye.a().on("start",this.dragstarted).on("drag",this.dragged).on("end",this.dragended)),f=d.append("g").selectAll("text").data(c).enter().append("text").attr("font-size",(function(e){return e.id===i||e.id===o?"14px":"11px"})).attr("font-weight",(function(e){return e.id===i||e.id===o?"bold":"normal"})).attr("text-anchor","middle").attr("dy",(function(e){return e.id===i||e.id===o?-30:-20})).attr("pointer-events","none").text((function(e){var t=e.id===i||e.id===o?40:25;return e.label&&e.label.length>t?e.label.substring(0,t)+"...":e.label||e.id}));g.on("mouseover",(function(){ye.l(this).attr("stroke","#ffc107").attr("stroke-width",3)})).on("mouseout",(function(e){ye.l(this).attr("stroke",e.id===i||e.id===o?"#ffc107":"white").attr("stroke-width",e.id===i||e.id===o?3:1.5)})),g.append("title").text((function(e){return"".concat(e.label,"\nType: ").concat(e.type,"\nID: ").concat(e.id)})),this.simulation.on("tick",(function(){p.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),g.attr("cx",(function(e){return e.x||0})).attr("cy",(function(e){return e.y||0})),f.attr("x",(function(e){return e.x||0})).attr("y",(function(e){return e.y||0}))})),setTimeout((function(){var e,t=null===(e=d.node())||void 0===e?void 0:e.getBBox();if(t){var a=t.width,i=t.height,o=t.x+a/2,c=t.y+i/2,l=Math.min(.9,.9/Math.max(a/n,i/r)),h=[n/2-l*o,r/2-l*c];s.transition().duration(750).call(u.transform,ye.p.translate(h[0],h[1]).scale(l))}}),500)}}},{key:"render",value:function(){var e,t=this.props,a=t.width,r=t.height,i=this.state,o=i.subgraph,s=i.loading,c=i.error,l=this.props.globalState,d=l.selectedDrugPrimary,u=l.diseasePredictions,h=l.nodeNameDict,p=u.find((function(e){return e.selected}));if(s)return n.createElement("div",{style:{width:a,height:r,display:"flex",alignItems:"center",justifyContent:"center"}},n.createElement("svg",{width:100,height:100},xe));if(!d||!p)return n.createElement("div",{style:{width:a,height:r,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d",fontSize:"16px"}},"Please select a drug and disease to see the knowledge subgraph");if(c)return n.createElement("div",{style:{width:a,height:r,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545",fontSize:"16px"}},c);var f=(null===(e=h.drug)||void 0===e?void 0:e[d])||d,m=p.name||p.id;return n.createElement("div",{style:{width:a,height:r,position:"relative"}},n.createElement("div",{style:{position:"absolute",top:10,left:10,background:"rgba(255,255,255,0.95)",padding:"10px 15px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"13px"}},n.createElement("div",{style:{fontWeight:"bold",color:"#3a7bd5",marginBottom:"5px"}},"Knowledge Sub-Graph"),n.createElement("div",null,n.createElement("strong",null,"Drug:")," ",f),n.createElement("div",null,n.createElement("strong",null,"Disease:")," ",m),o&&n.createElement("div",{style:{color:"#6c757d",marginTop:"5px"}},o.nodes.length," nodes, ",o.edges.length," edges")),n.createElement("div",{style:{position:"absolute",bottom:10,left:10,background:"rgba(255,255,255,0.95)",padding:"10px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"11px"}},n.createElement("div",{style:{fontWeight:"bold",marginBottom:"5px"}},"Node Types"),n.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"}},Object.entries(Ce).slice(0,8).map((function(e){var t=Object(g.a)(e,2),a=t[0],r=t[1];return n.createElement("div",{key:a,style:{display:"flex",alignItems:"center",gap:"4px"}},n.createElement("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:r}}),n.createElement("span",null,a.replace("_"," ")))}))),n.createElement("div",{style:{fontWeight:"bold",marginTop:"10px",marginBottom:"5px"}},"Path Highlighting"),n.createElement("div",{style:{display:"flex",gap:"10px"}},n.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},n.createElement("div",{style:{width:20,height:3,backgroundColor:"#ff5722",borderRadius:"2px"}}),n.createElement("span",null,"Shortest path")),n.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},n.createElement("div",{style:{width:12,height:12,borderRadius:"50%",border:"3px solid #ff5722",backgroundColor:"transparent"}}),n.createElement("span",null,"Path node")))),n.createElement("div",{style:{position:"absolute",bottom:10,right:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"11px",color:"#6c757d"}},n.createElement("div",null,"\ud83d\uddb1\ufe0f Drag nodes to move"),n.createElement("div",null,"\ud83d\udd0d Scroll to zoom"),n.createElement("div",null,"\u270b Drag background to pan")),n.createElement("svg",{ref:this.svgRef,width:a,height:r,style:{background:"#f8f9fa",borderRadius:"8px",border:"2px solid #e9ecef"}}))}}]),a}(n.Component),Ge=a(49),He=a(161),Me=a(164),Le=a(169),Re=a.n(Le),ze={cancer:"#e53935",neurological:"#8e24aa",cardiovascular:"#d81b60",autoimmune:"#f4511e",infectious:"#43a047",metabolic:"#1e88e5",respiratory:"#00acc1",gastrointestinal:"#fb8c00",genetic:"#5e35b1",other:"#90a4ae"},We=me(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).circleRadius=3,n.hoverTimeout=0,n.WAIT=500,n.state={embedding:{},tooltip:{visible:!1,info:"",position:[0,0]},showCategoryColors:!0,lastDrugId:""},n.onChangeDrug=n.onChangeDrug.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"getCoords",value:function(e){return Array.isArray(e)?e:e.coords}},{key:"getCategory",value:function(e){return Array.isArray(e)?"other":e.category||"other"}},{key:"getName",value:function(e){return Array.isArray(e)?"":e.name||""}},{key:"loadEmbedding",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState.selectedDrugPrimary,!((a="embeddings:".concat(t||"default"))==="embeddings:".concat(this.state.lastDrugId)&&Object.keys(this.state.embedding).length>0)){e.next=4;break}return e.abrupt("return");case 4:if(!(n=k.get(a))){e.next=9;break}return console.log("[Scatter] \u26a1 Global cache hit for ".concat(a)),this.setState({embedding:n,lastDrugId:t||"default"}),e.abrupt("return");case 9:return e.next=11,I(t);case 11:r=e.sent,this.setState({embedding:r,lastDrugId:t||"default"});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.loadEmbedding()}},{key:"componentDidUpdate",value:function(e){this.props.globalState.selectedDrugPrimary!==e.globalState.selectedDrugPrimary&&this.loadEmbedding()}},{key:"addLasso",value:function(e,t){var a=this,n=this.props.globalState.drugPredictions.filter((function(e){return e.selected})).map((function(e){return e.id}));ye.m("g.lasso").remove();var r=ye.l("svg.scatter"),i=ye.l("rect.lasso"),o=function(){var e,t=[],a=75,n=!0,r=!1,i=!0,o={start:function(){},draw:function(){},end:function(){}};function s(s){var c,l,d,u,h=s.append("g").attr("class","lasso"),p=h.append("path").attr("class","drawn"),g=h.append("path").attr("class","loop_close"),f=h.append("circle").attr("class","origin"),m=Me.a().on("start",(function(){u=[],c="",p.attr("d",null),g.attr("d",null),t.nodes().forEach((function(e){e.__lasso.possible=!1,e.__lasso.selected=!1,e.__lasso.hoverSelect=!1,e.__lasso.loopSelect=!1;var t=e.getBoundingClientRect();e.__lasso.lassoPoint=[Math.round(t.left+t.width/2),Math.round(t.top+t.height/2)]})),i&&t.on("mouseover.lasso",(function(){this.__lasso.hoverSelect=!0}));o.start()})).on("drag",(function(){var e,i;"touchmove"===Ge.c.sourceEvent.type?(e=Ge.c.sourceEvent.touches[0].clientX,i=Ge.c.sourceEvent.touches[0].clientY):(e=Ge.c.sourceEvent.clientX,i=Ge.c.sourceEvent.clientY);var s=He.a(this)[0],h=He.a(this)[1];""===c?(c=c+"M "+s+" "+h,l=[e,i],d=[s,h],f.attr("cx",s).attr("cy",h).attr("r",7).attr("display",null)):c=c+" L "+s+" "+h;u.push([e,i]);var m=Math.sqrt(Math.pow(e-l[0],2)+Math.pow(i-l[1],2)),y="M "+s+" "+h+" L "+d[0]+" "+d[1];p.attr("d",c),g.attr("d",y),(r=m<=a)&&n?g.attr("display",null):g.attr("display","none");t.nodes().forEach((function(e){e.__lasso.loopSelect=!!(r&&n&&e.__lasso.lassoPoint)&&Re()(u,e.__lasso.lassoPoint)<1,e.__lasso.possible=e.__lasso.hoverSelect||e.__lasso.loopSelect})),o.draw()})).on("end",(function(){t.on("mouseover.lasso",null),t.nodes().forEach((function(e){e.__lasso.selected=e.__lasso.possible,e.__lasso.possible=!1})),p.attr("d",null),g.attr("d",null),f.attr("display","none"),o.end()}));e.call(m)}return s.items=function(e){if(!arguments.length)return t;var a=(t=e).nodes();return a.forEach((function(e){e.__lasso={possible:!1,selected:!1}})),s},s.possibleItems=function(){return t.filter((function(){return this.__lasso.possible}))},s.selectedItems=function(){return t.filter((function(){return this.__lasso.selected}))},s.notPossibleItems=function(){return t.filter((function(){return!this.__lasso.possible}))},s.notSelectedItems=function(){return t.filter((function(){return!this.__lasso.selected}))},s.closePathDistance=function(e){return arguments.length?(a=e,s):a},s.closePathSelect=function(e){return arguments.length?(n=!0===e,s):n},s.isPathClosed=function(e){return arguments.length?(r=!0===e,s):r},s.hoverSelect=function(e){return arguments.length?(i=!0===e,s):i},s.on=function(e,t){if(!arguments.length)return o;if(1===arguments.length)return o[e];var a=["start","draw","end"];return a.indexOf(e)>-1&&(o[e]=t),s},s.targetArea=function(t){return arguments.length?(e=t,s):e},s}();o.items(r.selectAll("circle.highlighted")),o.targetArea(i).on("start",(function(){})).on("draw",(function(){})).on("end",(function(){o.selectedItems()._groups[0].forEach((function(e){var t=e.attributes.id.value;n.includes(t)||ae(t,a.props.globalState.selectedDisease,!0,a.props.dispatch)}))})),r.call(o)}},{key:"drawScatter",value:function(){var e=this,t=this.props.globalState,a=t.diseasePredictions,n=(t.appMode,this.props),i=n.width,o=n.height,s=this.state,c=s.embedding,l=s.showCategoryColors,d=Object.values(c).map((function(t){return e.getCoords(t)})),u=ye.c(d.map((function(e){return e[0]}))),h=ye.c(d.map((function(e){return e[1]}))),p=ye.k().domain(u).range([this.circleRadius,i-this.circleRadius]),f=ye.k().domain(h).range([this.circleRadius,o-this.circleRadius]),m=a.map((function(e){return e.node_id||e.id})),y=a.filter((function(e){return e.selected})).map((function(e){return e.node_id||e.id})),b=function(e){return m.indexOf(e)>-1?m.indexOf(e):m.length};return Object.keys(c).sort((function(e,t){return-b(e)+b(t)})).map((function(t){var a,n=c[t],i=e.getCoords(n),o=Object(g.a)(i,2),s=o[0],d=o[1],u=e.getCategory(n),h=e.getName(n),b=m.indexOf(t)>-1,v=y.includes(t);return a=v?"black":b?l&&ze[u]||"#1890ff":l&&ze[u]||"lightGray",r.a.createElement("circle",{cx:p(s),cy:f(d),key:t,className:b?"highlighted disease":"disease",id:t,fill:a,opacity:v?1:b?.85:.5,stroke:v?"#fff":"rgba(255,255,255,0.5)",strokeWidth:v?2:1,r:v?2*e.circleRadius:b?1.3*e.circleRadius:e.circleRadius,onDoubleClick:function(){b&&e.onChangeDisease(t)},onClick:function(){return e.showTooltip(t,[p(s),f(d)],u,h)}})}))}},{key:"onChangeDisease",value:function(e){var t=this.props.globalState,a=t.appMode,n=t.selectedDrugPrimary,r=t.diseasePredictions;if("drug-to-disease"===a&&n){var i=r.find((function(t){return(t.node_id||t.id)===e}));if(!i)return void console.warn("Disease prediction not found for node_id: ".concat(e));var o=i.id,s=i.node_id||i.id,c=function(e,t){return!e.filter((function(e){return e.selected})).map((function(e){return e.node_id||e.id})).includes(t)}(r,o);ie(o,n,c,this.props.dispatch,s)}}},{key:"onChangeDrug",value:function(e){if("drug-to-disease"===this.props.globalState.appMode)ne(e,this.props.dispatch);else{var t=ue(this.props.globalState.drugPredictions,e);ae(e,this.props.globalState.selectedDisease,t,this.props.dispatch)}}},{key:"showTooltip",value:function(e,t,a,n){var r=this,i=this.props.globalState.nodeNameDict;this.hoverTimeout=window.setTimeout((function(){var o,s=n||(null===(o=i.disease)||void 0===o?void 0:o[e])||e,c=a?" [".concat(a,"]"):"";r.setState({tooltip:{visible:!0,info:"".concat(s).concat(c),position:t}})}),this.WAIT)}},{key:"hideTooltip",value:function(){window.clearTimeout(this.hoverTimeout),this.setState({tooltip:{visible:!1,info:"",position:[0,0]}})}},{key:"render",value:function(){var e=this,t=this.props.globalState,a=t.isDrugLoading,n=t.isInitializing,i=this.props,o=i.width,s=i.height,c=this.state,l=c.tooltip,d=c.showCategoryColors;return r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("svg",{width:o,height:s,className:"scatter"},r.a.createElement("rect",{className:"lasso area",width:o,height:s,opacity:0}),r.a.createElement("g",{className:"scatter"},this.state.embedding?this.drawScatter():r.a.createElement("g",{transform:"translate(".concat(o/2,", ").concat(s/2,")"),textAnchor:"middle"},xe),a&&!n?r.a.createElement("g",{transform:"translate(".concat(o/2,", ").concat(s/2,")"),textAnchor:"middle"},xe):r.a.createElement("g",null))," ",r.a.createElement("text",{x:0,y:s-25,fontSize:12,fill:"gray"},"Click to reveal the disease name."),r.a.createElement("text",{x:0,y:s-10,fontSize:12,fill:"gray"},"Double click to select the disease.")),r.a.createElement("div",{style:{position:"absolute",top:5,right:5,background:"rgba(255,255,255,0.95)",padding:"8px",borderRadius:"6px",boxShadow:"0 1px 4px rgba(0,0,0,0.15)",fontSize:"10px",maxWidth:"140px"}},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"}},r.a.createElement("span",{style:{fontWeight:"bold",fontSize:"11px"}},"Categories"),r.a.createElement("button",{onClick:function(){return e.setState({showCategoryColors:!d})},style:{padding:"2px 6px",fontSize:"9px",border:"1px solid #ccc",borderRadius:"3px",background:d?"#e3f2fd":"#fff",cursor:"pointer"}},d?"ON":"OFF")),d&&r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"}},Object.entries(ze).slice(0,9).map((function(e){var t=Object(g.a)(e,2),a=t[0],n=t[1];return r.a.createElement("div",{key:a,style:{display:"flex",alignItems:"center",gap:"3px",width:"48%"}},r.a.createElement("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:n}}),r.a.createElement("span",{style:{textTransform:"capitalize",fontSize:"9px"}},a.substring(0,8)))})))),r.a.createElement("div",{className:"tooltip tooltip-".concat(l.visible?"show":"hide"),style:{left:l.position[0]+this.circleRadius,top:l.position[1]+this.circleRadius}},l.info))}}]),a}(r.a.Component)),Ue=(a(163),a(274)),Fe=me(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).TITLE_HEIGHT=36,n.MARGIN=10,n.PADDING=10,n.EDGE_LENGTH=120,n.NODE_WIDTH=130,n.NODE_HEIGHT=25,n.VERTICAL_GAP=2,n.GROUP_GAP=6,n.COUNT_GAP=5,n.RADIUS=n.NODE_HEIGHT/2,n.HEAD_HEIGHT=70,n.ICON_GAP=20,n.offsetY=0,n.state={expand:n.props.globalState.metaPathSummary.map((function(e){return!1})),isModalVisible:!1},n.showModal=n.showModal.bind(Object(l.a)(n)),n.hideModal=n.hideModal.bind(Object(l.a)(n)),n.filterMetaPathGroups=n.filterMetaPathGroups.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"toggleExpand",value:function(e,t){var a=this.state.expand;a[e]=void 0===t?!a[e]:t,this.setState({expand:a})}},{key:"isPathSelected",value:function(e){var t=this.props.globalState.selectedPathNodes;return t.map((function(e){return e.nodeId})).join()===e.map((function(e){return e.nodeId})).join()&&t.map((function(e){return e.nodeType})).join()===e.map((function(e){return e.nodeType})).join()}},{key:"togglePathNodes",value:function(e,t){t?this.props.dispatch({type:Q,payload:{selectedPathNodes:[]}}):this.props.dispatch({type:Q,payload:{selectedPathNodes:e}})}},{key:"getMetaIconGroup",value:function(e,t){return r.a.createElement("g",{className:"feedback",cursor:"pointer",style:{fill:"#777"},transform:"translate(5, 0)"},r.a.createElement("g",{className:"yes",transform:"translate(".concat(0*this.ICON_GAP,", 0)"),onClick:function(){return e(!t)}},r.a.createElement("rect",{width:this.ICON_GAP,height:this.ICON_GAP,fill:"white"}),r.a.createElement("path",{d:t?"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z":"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",transform:"scale(0.03)"})))}},{key:"getIconGroup",value:function(e){return r.a.createElement("g",{className:"feedback",cursor:"pointer",style:{fill:"#777"}})}},{key:"drawHeader",value:function(){var e=this,t=this.props.globalState,a=t.drugPredictions,n=t.diseasePredictions,i=t.nodeNameDict,o=t.appMode,s="drug-to-disease"===o?n:a,c="drug-to-disease"===o?"disease":"drug";return s.filter((function(e){return e.selected})).map((function(e){return e.name||i[c][e.id]||e.id})).map((function(t,a){return r.a.createElement("text",{key:t,className:t,fill:"gray",cursor:"pointer",transform:"translate(\n            ".concat(a*(2*e.RADIUS+e.COUNT_GAP)+e.RADIUS,", \n            ").concat(e.HEAD_HEIGHT,") \n            rotate(-45)"),onClick:function(){a<s.length&&e.onChangeDrug(s[a].id)}},t)}))}},{key:"getCountWidth",value:function(){var e=this.props.globalState,t=e.drugPredictions,a=e.diseasePredictions;return("drug-to-disease"===e.appMode?a:t).filter((function(e){return e.selected})).length*(2*this.RADIUS+this.COUNT_GAP)+this.COUNT_GAP}},{key:"drawSummary",value:function(){var e=this,t=this.EDGE_LENGTH,a=this.NODE_WIDTH,n=this.NODE_HEIGHT,i=this.VERTICAL_GAP,o=this.props.globalState,s=o.metaPathSummary,c=o.drugPredictions,l=o.diseasePredictions,d=o.appMode,u=o.nodeNameDict,h="drug-to-disease"===d?l:c,p=this.getCountWidth(),g=this.filterMetaPathGroups(),f=Math.max.apply(Math,Object(m.a)(s.map((function(e){return Object.values(e.count)})).flat())),y=ye.k().range([this.RADIUS/3,this.RADIUS]).domain([0,f]);this.offsetY=0;var b=Object(m.a)(s).sort((function(e,t){return(e.hide?1:0)-(t.hide?1:0)})).map((function(o){var c=o.nodeTypes.map((function(i,o){var s="translate(".concat((t+a)*o,", ",0,")");return r.a.createElement("g",{key:"node_".concat(o),transform:s},r.a.createElement("rect",{width:a,height:n,fill:"white",strokeWidth:"3",stroke:De(i),rx:e.NODE_HEIGHT/2}),r.a.createElement("text",{textAnchor:"middle",y:n/2+6,x:a/2,fill:"black"},i))})),l=Object(m.a)(Array(c.length-1)).map((function(e,i){var o="translate(".concat(a+(t+a)*i,", ").concat(+n/2,")");return r.a.createElement("g",{key:"edge_".concat(i),transform:o},r.a.createElement("line",{stroke:"lightgray",strokeWidth:2,x1:0,y1:0,x2:t,y2:0}))})),d=e.offsetY;e.offsetY+=n+i;var f=[],b=0,v=e.state.expand[o.idx],E=void 0,x=0;Object.keys(g).forEach((function(t){var a,s,c=(null===(a=g[t].filter((function(e){return e.nodeTypes.join("")===o.nodeTypes.join("")}))[0])||void 0===a?void 0:a.paths)||[],l=h.filter((function(e){return e.selected})).map((function(e){return e.id})).indexOf(t),d=h.find((function(e){return e.id===t})),p=(null===d||void 0===d?void 0:d.name)||(null===(s=u.disease)||void 0===s?void 0:s[t])||t,m=p.length>25?p.slice(0,22)+"...":p,y=e.drawChildrenPaths(c,l,E),k=y.children,w=y.numOfChildren;E=c[c.length-1];var D=(n+i)*w,O=w>0?r.a.createElement("g",{transform:"translate(0, ".concat(b,")")},r.a.createElement("text",{x:e.PADDING,y:e.NODE_HEIGHT/2+5,fill:"#333",fontSize:11,fontWeight:"bold"},"[",x+1,"] ",m)):null;w>0&&(x++,f.push(r.a.createElement("g",{key:"drugRank: ".concat(l),className:"drugRank_".concat(l),transform:"translate(0, ".concat(b,")")},O,r.a.createElement("g",{transform:"translate(0, ".concat(e.NODE_HEIGHT+5,")")},k))),b+=D+e.NODE_HEIGHT+5,v&&(e.offsetY+=D+e.NODE_HEIGHT+5)),e.offsetY+=e.GROUP_GAP}));return r.a.createElement("g",{key:"prototype_".concat(o.idx),transform:"translate(".concat(0,", ",d,")"),opacity:o.hide?.4:1},r.a.createElement("g",{className:"metaCount"},e.drawMetaCount(o,y)),r.a.createElement("g",{className:"icon"},r.a.createElement("path",{d:v?"M 6.414 9 h 11.172 a 1 1 0 0 1 0.707 1.707 l -5.586 5.586 a 1 1 0 0 1 -1.414 0 l -5.586 -5.586 A 1 1 0 0 1 6.414 9 Z":"M 9 17.879 V 6.707 A 1 1 0 0 1 10.707 6 l 5.586 5.586 a 1 1 0 0 1 0 1.414 l -5.586 5.586 A 1 1 0 0 1 9 17.879 Z",transform:"translate(".concat(p,", 0)"),fill:"gray",onClick:function(){o.hide||e.toggleExpand(o.idx,void 0)},cursor:"pointer"})),r.a.createElement("g",{className:"prototype",transform:"translate(".concat(p+e.ICON_GAP,", 0)")},c,l,r.a.createElement("g",{className:"iconGroup",transform:"translate(".concat(a*c.length+t*l.length,", 0)")},e.getMetaIconGroup((function(t){!function(e,t,a,n){e[t].hide=a,n({type:ee,payload:{metaPathSummary:e}})}(s,o.idx,t,e.props.dispatch),t&&e.toggleExpand(o.idx,!1)}),o.hide))),r.a.createElement("g",{className:"metapaths"},v?f:r.a.createElement("g",null)))})),v=this.drawHeader();return r.a.createElement("g",null,r.a.createElement("g",{className:"header",transform:"translate(".concat(this.PADDING,", ").concat(this.PADDING,")")},v),r.a.createElement("g",{className:"rows",transform:"translate(".concat(0,", ",this.PADDING+this.HEAD_HEIGHT,")")},b))}},{key:"onChangeDrug",value:function(e){var t=this.props.globalState,a=t.appMode,n=t.drugPredictions,r=t.diseasePredictions,i=t.selectedDisease,o=t.selectedDrugPrimary;if("drug-to-disease"===a){var s=ue(r,e);o&&ie(e,o,s,this.props.dispatch)}else{var c=ue(n,e);ae(e,i,c,this.props.dispatch)}}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,a=t.appMode,n=t.drugPredictions,r=t.diseasePredictions,i=t.selectedDisease,o=t.metaPathSummary,s="drug-to-disease"===e.globalState.appMode?e.globalState.diseasePredictions:e.globalState.drugPredictions,c="drug-to-disease"===a?r:n;if(e.globalState.selectedDisease!==i)this.setState({expand:o.map((function(e){return!1}))});else if(s.filter((function(e){return e.selected})).length!==c.filter((function(e){return e.selected})).length){var l=o.map((function(e){return!1}));this.setState({expand:l})}}},{key:"drawMetaCount",value:function(e,t){var a=this,n=this.props.globalState,i=n.drugPredictions,o=n.diseasePredictions,s=n.isAttentionLoading,c=n.metaPathGroups,l=n.edgeThreshold,d=n.appMode,u=(e.count,e.nodeTypes),h=("drug-to-disease"===d?o:i).filter((function(e){return e.selected})).map((function(e,t){var n,i=e.id,o=null===(n=c[i])||void 0===n?void 0:n.find((function(e){return e.nodeTypes.join(",")===u.join(",")})),d=o?o.paths.filter((function(e){return e.edges.every((function(e){return e.score>=l}))})).length:s?"...":0,h=r.a.createElement("text",{textAnchor:"middle",transform:"translate(".concat(a.RADIUS,", ").concat(a.RADIUS/2,")"),fontSize:15,fill:"gray"},d);return r.a.createElement("g",{key:t,className:"count",transform:"translate(".concat(t*(2*a.RADIUS+a.COUNT_GAP),", ").concat(a.NODE_HEIGHT/2,")"),cursor:"pointer",onClick:function(){return a.onChangeDrug(i)}},h)}));return r.a.createElement("g",{className:"metaCount",transform:"translate(".concat(this.PADDING,", 0)")},h)}},{key:"drawChildrenPaths",value:function(e,t,a){var n=this,i=this.props.globalState,o=i.nodeNameDict,s=i.edgeTypes,c=i.edgeThreshold,l=this.getCountWidth(),d=e.filter((function(e){return e.edges.every((function(e){return e.score>=c}))})),u=d.map((function(e,a){var i=e.edges.map((function(e){return e.score})).filter((function(e){return e>0})),c=i.length>0?(i.reduce((function(e,t){return e+t}),0)/i.length).toFixed(2):(a+1).toString(),d=e.nodes.map((function(e,t){var a,i=e.nodeId,s=e.nodeType,c=(null===(a=o[s])||void 0===a?void 0:a[i])||i,l=ve(c,14,n.NODE_WIDTH-10)||i||"unknown",d="translate(".concat(40+(n.EDGE_LENGTH+n.NODE_WIDTH)*t,", ",0,")");return r.a.createElement(be.a,{key:"node_".concat(t),title:(l.includes("."),c+(e.source?" (".concat(e.source,")"):""))},r.a.createElement("g",{transform:d,className:"node_".concat(i),style:{cursor:"pointer"},onClick:function(){return"drug"===s&&window.open("https://go.drugbank.com/drugs/".concat(i),"windowName","popup,right=10,top=10,width=320,height=600")}},r.a.createElement("rect",{width:n.NODE_WIDTH,height:n.NODE_HEIGHT,fill:De(s)}),r.a.createElement("text",{textAnchor:"middle",y:n.NODE_HEIGHT/2+6,x:n.NODE_WIDTH/2,fill:"white"},l)))})),u=r.a.createElement("g",{key:"weight",transform:"translate(0, ".concat(n.NODE_HEIGHT/2+5,")")},r.a.createElement("text",{textAnchor:"end",x:35,fill:"#666",fontSize:12,fontWeight:"bold"},c)),h=e.edges.map((function(e,t){var a,i="translate(".concat(40+n.NODE_WIDTH+(n.EDGE_LENGTH+n.NODE_WIDTH)*t,", ").concat(+n.NODE_HEIGHT/2,")"),o=e.edgeInfo.replace("rev_","");o=(null===(a=s[o])||void 0===a?void 0:a.edgeInfo)||o;var c=ve(o,14,n.EDGE_LENGTH);return r.a.createElement(be.a,{title:c===o?"":o,destroyTooltipOnHide:!0},r.a.createElement("g",{key:"edge_".concat(t),transform:i,style:{cursor:"pointer"}},r.a.createElement("line",{stroke:"gray",strokeWidth:1+2*e.score,x1:0,y1:n.NODE_HEIGHT/4,x2:n.EDGE_LENGTH,y2:n.NODE_HEIGHT/4}),r.a.createElement("text",{x:n.EDGE_LENGTH/2,y:0,textAnchor:"middle",fill:"gray"},c)))}));return r.a.createElement("g",{key:a,transform:"translate(0, ".concat((n.NODE_HEIGHT+n.VERTICAL_GAP)*(1+a),")")},r.a.createElement("circle",{cx:t*(2*n.RADIUS+n.COUNT_GAP)+n.RADIUS+n.PADDING,cy:n.NODE_HEIGHT/2,fill:"gray",r:n.RADIUS/4}),r.a.createElement("g",{transform:"translate(".concat(l+n.ICON_GAP,", 0)")},u,d,h,r.a.createElement("g",{className:"iconGroup",transform:"translate(".concat(40+n.NODE_WIDTH*d.length+n.EDGE_LENGTH*h.length,", 0)")},n.getIconGroup(e.nodes))))}));return{children:u,numOfChildren:d.length}}},{key:"showModal",value:function(){this.setState({isModalVisible:!0})}},{key:"hideModal",value:function(){this.setState({isModalVisible:!1})}},{key:"filterMetaPathGroups",value:function(){var e=this.props.globalState,t=e.metaPathGroups,a=e.edgeThreshold,n={};return Object.keys(t).forEach((function(e){n[e]=t[e].map((function(e){var t=e.paths.filter((function(e){return e.edges.every((function(e){return e.score>a}))}));return Object(h.a)(Object(h.a)({},e),{},{metaPaths:t})}))})),Object.keys(n).forEach((function(e){n[e]=n[e].filter((function(e){return e.paths.length>0}))})),n}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height,n=this.state,i=n.isModalVisible,o=n.expand,s=this.props.globalState,c=(s.isDrugLoading,s.isAttentionLoading),l=s.metaPathSummary,d=s.selectedDisease,u=s.drugPredictions,h=Math.max(t-2*this.PADDING-2*this.MARGIN,this.getCountWidth()+5*this.ICON_GAP+this.NODE_WIDTH+4*(this.EDGE_LENGTH+this.NODE_WIDTH)),p=Object.values(l).map((function(e,t){return o[t]?e.sum:0})).reduce((function(e,t){return e+t}),0),g=Object.keys(l).length,f=p*(this.NODE_HEIGHT+this.VERTICAL_GAP)+this.PADDING+g*(this.HEAD_HEIGHT+this.GROUP_GAP),m=a-2*this.PADDING-this.TITLE_HEIGHT,y=Math.max(f+this.HEAD_HEIGHT,m),b=r.a.createElement("text",{x:t/2,y:a/2,fill:"gray",textAnchor:"middle",fontSize:20},c?"":"string"==typeof d&&u.filter((function(e){return e.selected})).length>0?"Sorry, we find no meta path with current computational resources.":"Please select a disease and at least one drug"),v=this.drawSummary(),E=0===l.length?b:v;return r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{width:h,height:y},E,c?r.a.createElement("g",{className:"loading"},r.a.createElement("rect",{className:"loading__background",width:h,height:m,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(h/2,", ").concat(m/2,")")},xe)):r.a.createElement(r.a.Fragment,null)),r.a.createElement(Ue.a,{title:"Edit Explanation",visible:i,onOk:this.hideModal,onCancel:this.hideModal,okText:"Confirm",width:t,zIndex:1999},r.a.createElement("svg",{width:t})))}}]),a}(r.a.Component)),Be=p.a.TabPane,Ve=me(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).titleHeight=36,n.margin=10,n.padding=10,n.state={activeTab:"metapath"},n}return Object(c.a)(a,[{key:"changeActiveTab",value:function(e){this.setState({activeTab:e})}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height,n=t-2*this.margin-2*this.padding,i=a-2*this.padding-this.titleHeight-2*this.margin,o=Object(h.a)(Object(h.a)({},this.props),{},{height:i,width:n});return r.a.createElement(p.a,{size:"small",activeKey:this.state.activeTab,destroyInactiveTabPane:!1,style:{width:t-2*this.margin,height:a-this.margin,margin:this.margin,marginBottom:0,backgroundColor:"white"},tabBarStyle:{height:this.titleHeight,padding:"0px 10px",margin:"0px"},onChange:this.changeActiveTab.bind(this)},r.a.createElement(Be,{style:{padding:this.padding},key:"metapath",tab:"Meta-Path"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflowY:"scroll"}},r.a.createElement(Fe,o))),r.a.createElement(Be,{style:{padding:this.padding},key:"attention",tab:"Node Attention"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflowY:"scroll"}},r.a.createElement(Te,o))),r.a.createElement(Be,{style:{padding:this.padding},key:"graph",tab:"Sub-Graph"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflowY:"scroll"}},r.a.createElement(Ie,o))),r.a.createElement(Be,{style:{padding:this.padding},key:"v1attention",tab:"Node_Attention"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflowY:"scroll"}},r.a.createElement(Ne,o))),r.a.createElement(Be,{style:{padding:this.padding},key:"v1subgraph",tab:"Sub_Graph"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflow:"hidden"}},r.a.createElement(Ae,o))),r.a.createElement(Be,{style:{padding:this.padding},key:"embedding",tab:"Disease Embeddings"},r.a.createElement("div",{className:"nodelink",style:{width:n,height:i,overflowY:"scroll"}},r.a.createElement(We,{width:n,height:i}))))}}]),a}(r.a.Component)),Ye=(a(267),a(278)),qe=a(277),Ke=a(281),Ze=a(280),Je=a(279),Xe=a(282),$e=a(283),Qe=a(276),et=a(275),tt=a(284),at=a(132),nt=a(285),rt=a(75),it=Ye.a.Sider,ot=qe.a.Option,st=me(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).padding=10,n.listHeight=450,n.unsubscribePreload=null,n.state={preloadProgress:{total:0,completed:0,drugId:""},cacheSize:0},n.changeEdgeTHR=n.changeEdgeTHR.bind(Object(l.a)(n)),n.changeRevEdgeTHR=n.changeRevEdgeTHR.bind(Object(l.a)(n)),n.onChangeDisease=n.onChangeDisease.bind(Object(l.a)(n)),n.onChangeDrug=n.onChangeDrug.bind(Object(l.a)(n)),n.onChangeAppMode=n.onChangeAppMode.bind(Object(l.a)(n)),n.onChangeDrugPrimary=n.onChangeDrugPrimary.bind(Object(l.a)(n)),n.onChangeDiseaseSecondary=n.onChangeDiseaseSecondary.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribePreload=M((function(t){e.setState({preloadProgress:t,cacheSize:k.getStats().size})}))}},{key:"componentWillUnmount",value:function(){this.unsubscribePreload&&this.unsubscribePreload()}},{key:"onChangeAppMode",value:function(e){re(e.target.value,this.props.dispatch)}},{key:"onChangeDrugPrimary",value:function(e){ne(e,this.props.dispatch)}},{key:"onChangeDiseaseSecondary",value:function(e){var t=this.props.globalState.diseasePredictions.filter((function(e){return e.selected})).map((function(e){return e.id})),a=e.length>t.length,n=a?e[e.length-1]:t.filter((function(t){return!e.includes(t)}))[0];if(this.props.globalState.selectedDrugPrimary&&n){var r=this.props.globalState.selectedDrugPrimary,i=this.props.globalState.diseasePredictions.find((function(e){return e.id===n})),o=(null===i||void 0===i?void 0:i.node_id)||n;ie(n,r,a,this.props.dispatch,o)}}},{key:"onChangeDrug",value:function(e){var t=this.props.globalState.drugPredictions.filter((function(e){return e.selected})).map((function(e){return e.id})),a=e.length>t.length,n=a?e[e.length-1]:t.filter((function(t){return!e.includes(t)}))[0];ae(n,this.props.globalState.selectedDisease,a,this.props.dispatch)}},{key:"changeEdgeTHR",value:function(e){"number"==typeof e&&this.props.dispatch({type:K,payload:{edgeThreshold:e}})}},{key:"changeRevEdgeTHR",value:function(e){"number"==typeof e&&this.props.dispatch({type:K,payload:{edgeThreshold:Math.round(10-10*e)/10}})}},{key:"onChangeDisease",value:function(e){!function(e,t){t({type:q,payload:{isDrugLoading:!0}}),t({type:J,payload:{selectedDisease:e}}),t({type:Z,payload:{selectedDrug:void 0}}),j(e).then((function(e){var a=e.predictions.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{selected:!1})}));t({type:F,payload:{drugPredictions:a}})})).then((function(){t({type:q,payload:{isDrugLoading:!1}})}))}(e,this.props.dispatch)}},{key:"render",value:function(){var e=this.props.siderWidth,t=this.props.globalState,a=t.edgeThreshold,n=t.nodeTypes,i=t.diseaseOptions,o=t.drugOptions,s=t.drugPredictions,c=t.diseasePredictions,l=t.nodeNameDict,d=t.selectedDisease,u=t.selectedDrugPrimary,h=t.appMode||"disease-to-drug",p=s.filter((function(e){return e.selected})).map((function(e){return e.id})),f=c?c.filter((function(e){return e.selected})).map((function(e){return e.id})):[],y=r.a.createElement(be.a,{title:"Diseases with no known drug indications in the dataset"},r.a.createElement(tt.a,{style:{color:"#eb2f96"}})),b=r.a.createElement(be.a,{title:"US FDA-approved drug indication"},r.a.createElement(at.a,{style:{color:"#52c41a"}}));return r.a.createElement(it,{width:e,theme:"light",style:{padding:"".concat(this.padding,"px")}},r.a.createElement("div",{style:{marginBottom:10,textAlign:"center"}},r.a.createElement(Ke.a.Group,{value:h,onChange:this.onChangeAppMode},r.a.createElement(Ke.a.Button,{value:"disease-to-drug"},"Disease \u2192 Drug"),r.a.createElement(Ke.a.Button,{value:"drug-to-disease"},"Drug \u2192 Disease"))),"disease-to-drug"===h?r.a.createElement(r.a.Fragment,null,"Disease:",r.a.createElement(qe.a,{defaultValue:"15783",style:{width:e-2*this.padding},onChange:this.onChangeDisease,showSearch:!0,optionFilterProp:"label",value:d},i.length>0?i.filter((function(e){return!l.disease||!l.disease[e[0]]||!((t=l.disease[e[0]])&&Pe.includes(t.toLowerCase()));var t})).map((function(t){var a,n=Object(g.a)(t,2),i=n[0],o=n[1],s=l.disease&&l.disease[i]||i,c=10*s.length>.8*e?s.slice(0,40)+"...":s;return r.a.createElement(ot,{value:i,label:s,key:"diseaseID_".concat(t)},r.a.createElement("span",{title:s}," ",(a=c).charAt(0).toUpperCase()+a.slice(1)," "),!o&&y)})):r.a.createElement(ot,{value:"loading",label:"loading",key:"loading"},"data is loading..")),r.a.createElement("br",null),"Drug:",0===s.length?r.a.createElement(Ze.a,null):r.a.createElement(qe.a,{mode:"multiple",style:{width:e-2*this.padding},open:!0,showSearch:!0,optionFilterProp:"label",listHeight:this.listHeight,onChange:this.onChangeDrug,defaultValue:je,value:p,menuItemSelectedIcon:r.a.createElement(r.a.Fragment,null)},s.map((function(t,a){var n=t.id,i=t.score,o=t.known,s=l.drug&&l.drug[n]||n,c=10*s.length>.5*e?s.slice(0,20)+"...":s;return r.a.createElement(ot,{value:n,key:"disease_".concat(a),label:s},r.a.createElement("div",null,r.a.createElement("span",null,"[",a+1,"] ",r.a.createElement("span",{title:s},c)," ",o&&b),r.a.createElement("span",{style:{float:"right"}},"score: ",Se(i).toFixed(3))))})))):r.a.createElement(r.a.Fragment,null,"Drug:",r.a.createElement(qe.a,{style:{width:e-2*this.padding},onChange:this.onChangeDrugPrimary,showSearch:!0,optionFilterProp:"label",placeholder:"Click to select a drug",value:u,dropdownStyle:{maxHeight:400,overflow:"auto"},listHeight:350,virtual:!1},o&&o.length>0?Object(m.a)(o).map((function(e){return{id:e,name:l.drug?l.drug[e]:e}})).sort((function(e,t){return(e.name||e.id).localeCompare(t.name||t.id)})).map((function(e,t){var a=e.id,n=e.name||a;return r.a.createElement(ot,{value:a,label:n,key:"drugID_".concat(a)},r.a.createElement("div",{style:{padding:"4px 0"}},r.a.createElement("span",{style:{fontWeight:500}},"[",t+1,"]")," ",r.a.createElement("span",{title:n},n)))})):r.a.createElement(ot,{value:"loading",label:"loading",key:"loading",disabled:!0},"Loading drugs... (Please wait)")),r.a.createElement("br",null),"Disease Candidates:",c&&0!==c.length?r.a.createElement(qe.a,{mode:"multiple",style:{width:e-2*this.padding},open:!0,showSearch:!0,optionFilterProp:"label",listHeight:this.listHeight,onChange:this.onChangeDiseaseSecondary,value:f,menuItemSelectedIcon:r.a.createElement(r.a.Fragment,null)},c.map((function(t,a){var n=t.id,i=t.score,o=t.known,s=t.name,c=t.percentile,d=t.z_score,u=t.rank,h=s||(l.disease?l.disease[n]:n),p=h&&10*h.length>.5*e?h.slice(0,20)+"...":h,g=c?(100-c).toFixed(2):null,f=u||a+1,m="Raw score: ".concat((null===i||void 0===i?void 0:i.toFixed(6))||"N/A").concat(d?", Z-score: ".concat(d.toFixed(2)):"");return r.a.createElement(ot,{value:n,key:"disease_".concat(a),label:h},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}},r.a.createElement("span",{style:{color:"#666",marginRight:4}},"#",f),r.a.createElement("span",{title:h},p)," ",o&&b),r.a.createElement("span",{style:{fontSize:"11px",color:"#1890ff",marginLeft:8},title:m},g?"Top ".concat(g,"%"):"".concat(Se(i).toFixed(3)))))}))):this.props.globalState.isDiseaseLoading?r.a.createElement(Ze.a,null):r.a.createElement("div",null,"Select a drug to see candidates")),r.a.createElement("div",{className:"dummy",style:{height:this.listHeight+20}}),this.state.preloadProgress.total>0&&r.a.createElement("div",{style:{marginBottom:15,padding:"8px 12px",background:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"#f6ffed":"#e6f7ff",borderRadius:6,border:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"1px solid #b7eb8f":"1px solid #91d5ff"}},r.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:4}},this.state.preloadProgress.completed>=this.state.preloadProgress.total?r.a.createElement(r.a.Fragment,null,r.a.createElement(nt.a,{style:{color:"#52c41a",marginRight:6}}),r.a.createElement("span",{style:{fontSize:12,color:"#52c41a",fontWeight:500}},"\u26a1 Data Cached - Instant Response")):r.a.createElement(r.a.Fragment,null,r.a.createElement(rt.a,{style:{color:"#1890ff",marginRight:6}}),r.a.createElement("span",{style:{fontSize:12,color:"#1890ff"}},"Caching data for fast interactions..."))),r.a.createElement(Je.a,{percent:Math.round(this.state.preloadProgress.completed/this.state.preloadProgress.total*100),size:"small",status:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"success":"active",showInfo:!1}),r.a.createElement("div",{style:{fontSize:10,color:"#888",marginTop:2}},this.state.cacheSize," items cached")),"Minimum self-explaining edge score:",r.a.createElement(Xe.a,{gutter:20},r.a.createElement($e.a,{span:5},r.a.createElement(Qe.a,{value:a,onChange:this.changeEdgeTHR,style:{width:"100%"},step:.1,min:0,max:1})),r.a.createElement($e.a,{span:16},r.a.createElement(et.a,{step:.1,value:1-a,min:0,max:1,onChange:this.changeRevEdgeTHR,marks:{0:"1.0",1:"0.0"},reverse:!0,tipFormatter:function(e){return e&&(1-e).toFixed(1)}}))),r.a.createElement("div",{className:"nodeTypes"},"Node Types:",r.a.createElement("br",null),n.map((function(e){return r.a.createElement("div",{key:e,style:{marginLeft:"5px"}},r.a.createElement("span",{style:{background:De(e),color:"white",padding:"2px"}},e))}))),r.a.createElement("br",null),r.a.createElement("br",null))}}]),a}(r.a.Component)),ct=a(133),lt=(a(268),Ye.a.Header),dt=Ye.a.Footer,ut=Ye.a.Content,ht=me(function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).showModal=function(){n.setState({isModalVisible:!0})},n.hideModal=function(){n.setState({isModalVisible:!1})},n.state={width:window.innerWidth,height:window.innerHeight,isModalVisible:!1},n.updateSize=n.updateSize.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"updateSize",value:function(){this.setState({width:window.innerWidth,height:window.innerHeight})}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.updateSize),D().then((function(t){!function(e){we={},e.forEach((function(e,t){t>ke.length-1&&(t%=ke.length-1),we[e]=ke[t]}))}(t),e.props.dispatch({type:L,payload:{nodeTypes:t}})})).then((function(){return O()})).then((function(t){e.props.dispatch({type:R,payload:{edgeTypes:t}})})).then((function(){return S()})).then((function(t){e.props.dispatch({type:U,payload:{nodeNameDict:t}})})).then((function(){return _()})).then((function(t){e.props.dispatch({type:B,payload:{diseaseOptions:t}})})).then((function(){return N()})).then((function(t){var a=t.map((function(e){return e.id}));e.props.dispatch({type:Y,payload:{drugOptions:a}})})).then((function(){re("drug-to-disease",e.props.dispatch)})).then((function(){return ne("DB12530",e.props.dispatch)})).then((function(){_e.length>0&&ie(_e[0],"DB12530",!0,e.props.dispatch)})).then((function(){e.props.dispatch({type:q,payload:{isInitializing:!1}})}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize)}},{key:"render",value:function(){var e=Math.max(0,window.innerWidth-380),t=Math.max(0,window.innerHeight-64-20),a=this.props.globalState.isInitializing,n=r.a.createElement(lt,{className:"header",style:{height:64}},r.a.createElement("img",{src:"favicon.ico",style:{height:51.2,padding:"2px 10px"},alt:"logo"}),r.a.createElement("b",{style:{fontSize:"30px"}},"Amgen Drugs and candidate Diseases Explorer"),r.a.createElement("span",{style:{float:"right",cursor:"pointer"},onClick:this.showModal},r.a.createElement(ct.a,{style:{height:64,fontSize:"20px"}}),r.a.createElement("span",{style:{paddingLeft:"5px",fontSize:"18px",height:64}},"About")," "));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ye.a,null,n,r.a.createElement(Ye.a,null,r.a.createElement(st,{siderWidth:380}),r.a.createElement(ut,{className:"main",style:{height:t}},r.a.createElement(Ve,{width:e,height:t-20}),r.a.createElement(dt,{style:{textAlign:"center",color:"gray",height:20,padding:0}})))),a&&r.a.createElement("svg",{width:window.innerWidth,height:window.innerHeight,style:{position:"absolute",left:0,top:0}},r.a.createElement("g",{className:"loading"},r.a.createElement("rect",{className:"loading__background",width:window.innerWidth,height:window.innerHeight,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(window.innerWidth/2,", ").concat(window.innerHeight/2,")")},xe))),r.a.createElement(Ue.a,{title:"About Amgen Drugs and candidate Diseases Explorer",className:"about-modal",visible:this.state.isModalVisible,footer:null,onCancel:this.hideModal,zIndex:1099,width:.5*window.innerWidth},r.a.createElement("h3",null,"About"),r.a.createElement("p",null,"This Drug and Diseases Explorer provides a visual interface to interact with the predictions and explanations of an AI model that identify candidate diseases with limited treatment options and minimal molecular understanding for a given Drug."),r.a.createElement("p",null,"AI model is a graph neural network pre-trained on a comprehensive knowledge graph of 17,080 clinically-recognized diseases and 7,957 therapeutic candidates. The model can process various therapeutic tasks in a unified formulation. Once trained, the model can perform zero-shot inference on new diseases without the need for additional parameters or fine-tuning on ground truth labels."),r.a.createElement("h3",null,"Medical Advice Disclaimer"),r.a.createElement("p",null,"DISCLAIMER: THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE",r.a.createElement("br",null),"The information, including but not limited to, text, graphics, images and other material contained on this website are for informational purposes only. No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment. Always seek the advice of your physician or other qualified health care provider with any questions you may have regarding a medical condition or treatment and before undertaking a new health care regimen, and never disregard professional medical advice or delay in seeking it because of something you have read on this website.")))}}]),a}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(269);o.a.render(r.a.createElement(fe,null,r.a.createElement(r.a.StrictMode,null,r.a.createElement(ht,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[238,1,2]]]);
//# sourceMappingURL=main.38ef9303.chunk.js.map