{"version":3,"sources":["stores/DataService.ts","Const.ts","stores/actions.ts","stores/reducer.ts","stores/index.tsx","helpers/text.ts","helpers/icon.tsx","helpers/color.ts","helpers/index.ts","components/TabContainer/AttentionTree.tsx","components/TabContainer/Graph.tsx","components/TabContainer/V1AttentionTable.tsx","components/TabContainer/V1SubGraph.tsx","components/CardContainer/Scatter.tsx","components/CardContainer/lasso.js","components/TabContainer/PathMatrix.tsx","components/TabContainer/index.tsx","components/Sider/index.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["axiosInstance","axios","create","baseURL","withCredentials","headers","requestNodeTypes","a","get","response","data","requestEdgeTypes","requestNodeNameDict","requestAttentionPair","diseaseID","drugID","url","requestDiseaseOptions","diseaseOptions","requestDrugPredictions","predictions","requestDiseasePredictions","requestEmbedding","drugId","requestDrugList","requestSubgraph","diseaseId","ACTION_TYPES","selectDrug","selectedDrug","selectedDisease","isAdd","dispatch","modifyAttentionPaths","changeDrug","selectDrugPrimary","type","payload","isDiseaseLoading","selectedDrugPrimary","undefined","then","res","diseasePredictions","map","d","selected","changeAppMode","mode","appMode","fetch","json","drugs","drugOptions","selectDiseaseSecondary","diseaseNodeId","nodeIdForAttention","key","groupKey","isAttentionLoading","attention","metaPathGroups","groupMetaPaths","metapaths","paths","groups","groupDict","forEach","path","hide","nodeTypeString","nodes","nodeType","join","groupIdx","indexOf","push","nodeTypes","toggleDrugSelection","drugPredictions","id","updateMetaPathSummary","oldSummary","currentMetaPaths","newSummary","metaPath","count","length","sharedMeta","find","sum","idx","filter","isAddDrug","includes","rootReducer","state","action","edgeTypes","metaPathSummary","nodeNameDict","selectedPathNodes","edgeThreshold","JSON","parse","stringify","keyToDelete","updatedDiseasePredictions","initialState","isInitializing","isDrugLoading","GlobalStore","createContext","StateProvider","props","React","useReducer","dispatchBase","useCallback","asyncer","Provider","value","children","StateConsumer","Component","Consumer","context","globalState","cropText","text","fontSize","maxWidth","fontWeight","returnText","document","createElement","getContext","font","width","measureText","i","prevText","substr","concat","currText","prevWidth","currWidth","getTextWidth","LOADING_ICON","textAnchor","x","y","height","fill","attributeType","attributeName","values","begin","dur","repeatCount","COLORS","colorDict","getNodeColor","Object","keys","pruneEdge","node","threshold","score","sigmoid","t","Math","pow","E","removeDiseaseList","INIT_DISEASES","INIT_DRUGS","AttentionTree","nodeHeight","labelLength","midGap","nodeAttention","stepGap","this","nodeAttentionFiltered","rootNode","d3","root","nodeSize","d3Tree","linkGene","source","target","maxScore","max","links","link","widthScale","domain","range","edgeInfo","replace","title","nodeId","destroyTooltipOnHide","className","stroke","strokeWidth","opacity","allY","descendants","minY","min","nodeFullName","nodeShortName","tooltipTitle","icon_path","isHighlighted","mouseEnterDelay","transform","cursor","depth","content","heights","nodeKey","drawNodeAttentionHorizontal","selectedItems","drawSubgraph","graphHeight","ModelNodeForce","padding","RADIUS","prevNodes","prevLinks","simulation","force","strength","distance","radius","alphaDecay","velocityDecay","svgNodes","svgLinks","attr","select","active","alpha","restart","fx","fy","selectedIds","desNodes","prevNode","desLinks","sourceData","targetData","selectedIdx","getNodeLinks","selectAll","enter","append","on","transition","delay","call","dragstarted","bind","dragged","dragended","update","exit","remove","classed","isTargetNode","textlabel","isHidden","ticked","updateVisibility","style","visibleNodes","flatTree","drawGraph","prevProps","prevGroups","prevThreshold","prevAttention","currGroups","currNodes","currThreshold","currAttention","prevGroupKeys","sort","currGroupKeys","prevAttentionKeys","currAttentionKeys","updateNodeLabel","selectedDrugs","reminderText","V1AttentionTable","subgraph","loading","error","loadSubgraph","prevDrug","prevDiseases","prevSelectedDisease","setState","node_id","console","l","toUpperCase","percentage","color","backgroundColor","borderRadius","overflow","background","display","alignItems","justifyContent","paddingRight","textShadow","toFixed","edges","borderLeft","nodeMap","edgesByRelation","edge","relation","b","drugName","diseaseName","name","marginBottom","entries","marginTop","borderCollapse","textAlign","borderBottom","slice","sourceNode","targetNode","maxAtt","layer1_att","layer2_att","onMouseEnter","e","currentTarget","onMouseLeave","label","formatType","renderAttentionBar","NODE_COLORS","drug","disease","protein","pathway","biological_process","molecular_function","cellular_component","anatomy","effect_phenotype","exposure","unknown","V1SubGraph","svgRef","stop","alphaTarget","current","svg","n","container","zoom","scaleExtent","maxLen","substring","setTimeout","bounds","getBBox","dx","dy","scale","translate","duration","position","top","left","boxShadow","zIndex","bottom","flexWrap","gap","right","ref","border","circleRadius","hoverTimeout","WAIT","embedding","tooltip","visible","info","onChangeDrug","loadEmbedding","selectedDrugIds","lasso_area","mylasso","targetArea","items","closePathDistance","closePathSelect","isPathClosed","hoverSelect","start","draw","end","lasso","_this","tpath","origin","torigin","drawnCoords","g","dyn_path","close_path","origin_node","dragAction","drag","__lasso","possible","loopSelect","box","getBoundingClientRect","lassoPoint","round","selection","sourceEvent","touches","clientX","clientY","tx","ty","sqrt","close_draw_path","classifyPoint","_","arguments","possibleItems","notPossibleItems","notSelectedItems","types","_groups","attributes","xDomain","yDomain","xScale","yScale","diseaseIds","selectedDiseaseIds","getSortIndex","isSelected","cx","cy","r","onDoubleClick","onChangeDisease","onClick","showTooltip","selectedDiseaseNodeId","diseasePrediction","warn","isAddDisease","window","clearTimeout","drawScatter","prop","TITLE_HEIGHT","MARGIN","PADDING","EDGE_LENGTH","NODE_WIDTH","NODE_HEIGHT","VERTICAL_GAP","GROUP_GAP","COUNT_GAP","HEAD_HEIGHT","ICON_GAP","offsetY","expand","isModalVisible","showModal","hideModal","filterMetaPathGroups","flag","doesExist","toggleHideFunc","isHide","nameType","item","COUNT_WIDTH","getCountWidth","maxCount","flat","rScale","allRows","summary","nodeIdx","rx","Array","edgeIdx","x1","y1","x2","y2","currentY","differentChildren","childrenOffsetY","showChildren","lastMetaPath","diseaseIndex","metaPaths","drugRank","prediction","shortDiseaseName","drawChildrenPaths","numOfChildren","childrenHeight","diseaseLabel","drawMetaCount","toggleExpand","getMetaIconGroup","toggleMetaPathHide","header","drawHeader","selectedId","prevPredictions","currPredictions","expandStatus","vis","predictionId","num","every","prevPath","filteredMetaPaths","childIdx","edgeScores","s","pathWeight","reduce","toString","nodeName","shortNodeName","open","weightLabel","edgeName","edgeShortName","getIconGroup","filteredMetaGroups","k","metaPathGroup","svgWidth","matrixRowsCount","matrixGroupsCount","matrixHeight","svgOuterHeight","svgHeight","drawSummary","onOk","onCancel","okText","TabPane","Tabs","titleHeight","margin","activeTab","cardWidth","cardHeight","size","activeKey","tabBarStyle","onChange","changeActiveTab","tab","overflowY","Sider","Layout","Option","Select","listHeight","changeEdgeTHR","changeRevEdgeTHR","onChangeAppMode","onChangeDrugPrimary","onChangeDiseaseSecondary","selectedDiseases","prevSelectedDiseases","currentDisease","prevSelectedDrugs","currentDrug","selectDisease","siderWidth","currentMode","untreatable_disease_icon","QuestionCircleOutlined","known_drug_icon","CheckCircleOutlined","theme","Group","Button","defaultValue","showSearch","optionFilterProp","toLowerCase","str","treatable","cropName","charAt","menuItemSelectedIcon","drug_id","known","float","placeholder","dropdownStyle","maxHeight","virtual","localeCompare","displayName","disabled","disease_id","gutter","span","step","marks","0","1","reverse","tipFormatter","marginLeft","Header","Footer","Content","innerWidth","innerHeight","updateSize","addEventListener","setNodeColor","drugList","removeEventListener","mainViewWidth","mainViewHeight","src","headerHeight","alt","InfoCircleOutlined","paddingLeft","footer","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.f592dd2b.chunk.js","sourcesContent":["import axios from 'axios';\nimport { IAttentionTree, IEdgeTypes, IPath, IState } from 'types';\nimport { SERVER_URL } from 'Const';\n\nconst axiosInstance = axios.create({\n  baseURL: `${SERVER_URL}/`,\n  // timeout: 1000,\n  withCredentials: false,\n  headers: {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'GET,PUT,POST,DELETE,PATCH,OPTIONS',\n  },\n});\n\nconst requestNodeTypes = async (): Promise<string[]> => {\n  const url = './txgnn_data/node_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestEdgeTypes = async (): Promise<IEdgeTypes> => {\n  const url = './txgnn_data/edge_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestNodeNameDict = async () => {\n  const url = './api/node_name_dict';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttention = async (diseaseID: string, drugID: string) => {\n  const url = `./api/attention?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttentionPair = async (\n  diseaseID: string,\n  drugID: string\n): Promise<{ attention: { [k: string]: IAttentionTree }; metapaths: IPath[] }> => {\n  const url = `./api/attention_pair?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestDiseaseOptions = async () => {\n  // // // the ranking is too costy\n  const url = './api/diseases';\n  const response = await axiosInstance.get(url);\n  const diseaseOptions: IState['diseaseOptions'] = response.data;\n\n  // const urlRanking = './txgnn_data/disease_ranking.json';\n  // let rank = await axiosInstance.get(urlRanking);\n  // const ranking = rank.data;\n\n  // diseaseOptions.sort((a, b) => ranking.indexOf(a[0]) - ranking.indexOf(b[0]));\n  // const urlRanking = './txgnn_data/disease_options.json'; // ranking is too costy, use pre-processed data\n  // let res = await axiosInstance.get(urlRanking);\n\n  return diseaseOptions;\n};\n\nconst requestDrugPredictions = async (diseaseID: string) => {\n  const url = `./api/drug_predictions?disease_id=${diseaseID}`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  return predictions;\n};\n\nconst requestDiseasePredictions = async (drugID: string) => {\n  const url = `./api/disease_predictions?drug_id=${drugID}&top_n=30`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  return predictions;\n};\n\nconst requestEmbedding = async (drugId?: string) => {\n  // Request drug-specific disease embeddings from API\n  const url = drugId \n    ? `./api/disease_embeddings?drug_id=${drugId}`\n    : './data/disease_tsne.json';\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestDrugList = async (): Promise<{id: string, name: string}[]> => {\n  // Get list of available drugs from API\n  const url = './api/drug_list';\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface SubgraphEdge {\n  source: string;\n  target: string;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\nconst requestSubgraph = async (drugId: string, diseaseId: string): Promise<Subgraph> => {\n  // Get subgraph for a drug-disease pair from API\n  const url = `./api/subgraph?drug_id=${drugId}&disease_id=${diseaseId}`;\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\nexport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestAttention,\n  requestNodeNameDict,\n  requestDrugPredictions,\n  requestDiseaseOptions,\n  requestEmbedding,\n  requestAttentionPair,\n  requestDiseasePredictions,\n  requestDrugList,\n  requestSubgraph,\n};\n","const STATIC_URL =\n  process.env.NODE_ENV === 'development'\n    ? `http://localhost:${process.env.REACT_APP_PORT}`\n    : './';\n\nconst SERVER_URL =\n  process.env.NODE_ENV === 'development' ? `http://localhost:8002` : './';\n\nexport { STATIC_URL, SERVER_URL };\n","import {\n  DrugPrediction,\n  IDispatch,\n  IPath,\n  IMetaPath,\n  IMetaPathSummary,\n} from 'types';\nimport {\n  requestAttentionPair,\n  requestDrugPredictions,\n  requestDiseasePredictions,\n} from 'stores/DataService';\n\nexport const ACTION_TYPES = {\n  Load_Node_Types: 'Load_Node_Types',\n  Load_Edge_Types: 'Load_Edge_Types',\n  Load_Meta_Paths: 'Load_Meta_Paths',\n  Add_Attention_Paths: 'Add_Attention_Paths',\n  Del_Attention_Paths: 'Del_Attention_Paths',\n  Load_Node_Name_Dict: 'Load_Node_Name_Dict',\n  Load_Drug_Options: 'Load_Drug_Options',\n  Load_Disease_Options: 'Load_Disease_Options',\n  Load_Disease_Predictions: 'Load_Disease_Predictions',\n  Load_Drug_List: 'Load_Drug_List',\n\n  Set_Loading_Status: 'Set_Loading_Status',\n\n  Change_Edge_THR: 'Change_Edge_THR',\n  Change_Drug: 'Change_Drug',\n  Change_Disease: 'Change_Disease',\n  Change_App_Mode: 'Change_App_Mode',\n  Change_Selected_Drug_Primary: 'Change_Selected_Drug_Primary',\n  Select_Path_Noes: 'Select_Path_Nodes',\n\n  Toggle_Meta_Path_Hide: 'Toggle_Meta_Path_Hide',\n  Toggle_Disease_Selection: 'Toggle_Disease_Selection',\n};\n\nexport const selectDrug = (\n  selectedDrug: string,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch\n) => {\n  if (selectedDisease) {\n    modifyAttentionPaths(selectedDrug, selectedDisease, isAdd, dispatch);\n    changeDrug(selectedDrug, dispatch);\n  }\n};\n\nexport const selectDisease = (selectedDisease: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDrugLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: undefined },\n  });\n\n  return requestDrugPredictions(selectedDisease)\n    .then((res) => {\n      const predictions = res.predictions;\n      const drugPredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Drug_Options,\n        payload: { drugPredictions },\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDrugLoading: false },\n      });\n    });\n};\n\nexport const selectDrugPrimary = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDiseaseLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Selected_Drug_Primary,\n    payload: { selectedDrugPrimary: selectedDrug },\n  });\n\n  // Clear previous selections\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: undefined },\n  });\n\n  // Fetch disease predictions\n  return requestDiseasePredictions(selectedDrug)\n    .then((res) => {\n      const predictions = res.predictions;\n      const diseasePredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Disease_Predictions,\n        payload: { diseasePredictions },\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDiseaseLoading: false },\n      });\n    });\n};\n\nexport const changeAppMode = (mode: 'disease-to-drug' | 'drug-to-disease', dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_App_Mode,\n    payload: { appMode: mode },\n  });\n\n  // Load drug list if switching to drug-to-disease and list is empty\n  if (mode === 'drug-to-disease') {\n    fetch(`http://127.0.0.1:8002/api/drugs`)\n      .then((response) => response.json())\n      .then((drugs) => {\n        dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions: drugs },\n        });\n      });\n  }\n};\n\nexport const selectDiseaseSecondary = (\n  selectedDisease: string,  // disease_id for selection toggle\n  selectedDrugPrimary: string,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  diseaseNodeId?: string  // Optional: node_id for attention API (defaults to selectedDisease)\n) => {\n  const nodeIdForAttention = diseaseNodeId || selectedDisease;\n  \n  // Toggle disease selection state (uses disease_id)\n  dispatch({\n    type: ACTION_TYPES.Toggle_Disease_Selection,\n    payload: { diseaseId: selectedDisease },\n  });\n\n  // Update selected disease in state\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: nodeIdForAttention },\n  });\n\n  // Ensure primary drug is set as selectedDrug for attention paths\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: selectedDrugPrimary },\n  });\n\n  // Use node_id for attention API, disease_id as the groupKey\n  modifyAttentionPaths(selectedDrugPrimary, nodeIdForAttention, isAdd, dispatch, selectedDisease);\n};\n\nconst modifyAttentionPaths = (\n  selectedDrug: string | undefined,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  key?: string // Optional key to use for metaPathGroups (defaults to selectedDrug)\n) => {\n  const groupKey = key || selectedDrug;\n  if (selectedDrug !== undefined && selectedDisease !== undefined && groupKey !== undefined) {\n    if (isAdd) {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isAttentionLoading: true },\n      });\n\n      requestAttentionPair(selectedDisease, selectedDrug)\n        .then((res) => {\n          dispatch({\n            type: ACTION_TYPES.Add_Attention_Paths,\n            payload: {\n              attention: res.attention,\n              selectedDrug: groupKey, // Use groupKey as the identifier for adding/removing\n              metaPathGroups: { [groupKey]: groupMetaPaths(res.metapaths) },\n            },\n          });\n        })\n        .then(() => {\n          dispatch({\n            type: ACTION_TYPES.Set_Loading_Status,\n            payload: { isAttentionLoading: false },\n          });\n        });\n    } else {\n      dispatch({\n        type: ACTION_TYPES.Del_Attention_Paths,\n        payload: {\n          selectedDrug: groupKey,\n        },\n      });\n    }\n  }\n};\n\nconst changeDrug = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug },\n  });\n};\n\nconst groupMetaPaths = (paths: IPath[]): IMetaPath[] => {\n  let groups: IMetaPath[] = [];\n  let groupDict: string[] = [];\n  paths.forEach((path) => {\n    path.hide = false; // initi, show all metapaths\n    const nodeTypeString = path.nodes.map((d) => d.nodeType).join('_');\n    const groupIdx = groupDict.indexOf(nodeTypeString);\n    if (groupIdx > -1) {\n      groups[groupIdx].paths.push(path);\n    } else {\n      groupDict.push(nodeTypeString);\n      groups.push({\n        nodeTypes: path.nodes.map((d) => d.nodeType),\n        paths: [path],\n      });\n    }\n  });\n  return groups;\n};\n\nexport const toggleMetaPathHide = (\n  metaPathSummary: IMetaPathSummary[],\n  idx: number,\n  hide: boolean,\n  dispatch: IDispatch\n) => {\n  metaPathSummary[idx]['hide'] = hide;\n  dispatch({\n    type: ACTION_TYPES.Toggle_Meta_Path_Hide,\n    payload: { metaPathSummary },\n  });\n};\n","import { IState, IAction, IMetaPathSummary, IMetaPath } from 'types';\nimport { ACTION_TYPES } from 'stores/actions';\n\nconst rootReducer = (state: IState, action: IAction): IState => {\n  switch (action.type) {\n    case ACTION_TYPES.Load_Drug_Options:\n      return {\n        ...state,\n        drugPredictions: action.payload.drugPredictions,\n      };\n\n    case ACTION_TYPES.Load_Disease_Options:\n      return { ...state, diseaseOptions: action.payload.diseaseOptions };\n\n    case ACTION_TYPES.Load_Node_Types:\n      return { ...state, nodeTypes: action.payload.nodeTypes };\n\n    case ACTION_TYPES.Load_Edge_Types:\n      return { ...state, edgeTypes: action.payload.edgeTypes };\n\n    case ACTION_TYPES.Change_Disease:\n      return {\n        ...state,\n        selectedDisease: action.payload.selectedDisease,\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Change_Drug:\n      return {\n        ...state,\n        drugPredictions: toggleDrugSelection(\n          state.drugPredictions,\n          action.payload.selectedDrug\n        ),\n      };\n\n    case ACTION_TYPES.Load_Node_Name_Dict:\n      return { ...state, nodeNameDict: action.payload.nodeNameDict };\n\n    case ACTION_TYPES.Set_Loading_Status:\n      return { ...state, ...action.payload };\n\n    case ACTION_TYPES.Select_Path_Noes:\n      return { ...state, selectedPathNodes: action.payload.selectedPathNodes };\n\n    case ACTION_TYPES.Change_Edge_THR: {\n      return { ...state, edgeThreshold: action.payload.edgeThreshold };\n    }\n\n    case ACTION_TYPES.Toggle_Meta_Path_Hide: {\n      return { ...state, metaPathSummary: action.payload.metaPathSummary };\n    }\n\n    case ACTION_TYPES.Add_Attention_Paths: {\n      return {\n        ...state,\n        attention: { ...state.attention, ...action.payload.attention },\n        metaPathGroups: {\n          ...state.metaPathGroups,\n          ...action.payload.metaPathGroups,\n        },\n        metaPathSummary: updateMetaPathSummary(\n          state.metaPathSummary,\n          action.payload.metaPathGroups[action.payload.selectedDrug],\n          action.payload.selectedDrug,\n          true // whether add new drug\n        ),\n      };\n    }\n\n    case ACTION_TYPES.Del_Attention_Paths: {\n      // deep copy\n      let attention = JSON.parse(JSON.stringify(state.attention)),\n        metaPathGroups = JSON.parse(JSON.stringify(state.metaPathGroups));\n\n      const keyToDelete = action.payload.selectedDrug;\n      // In drug-to-disease mode, the key is a disease ID\n      // Delete both possible attention keys (disease:X and drug:X)\n      delete attention[`disease:${keyToDelete}`];\n      delete attention[`drug:${keyToDelete}`];\n      delete metaPathGroups[keyToDelete];\n      return {\n        ...state,\n        attention,\n        metaPathGroups,\n        metaPathSummary: updateMetaPathSummary(\n          state.metaPathSummary,\n          metaPathGroups[keyToDelete],\n          keyToDelete,\n          false // whether add new drug\n        ),\n      };\n    }\n\n    case ACTION_TYPES.Change_App_Mode:\n      return { ...state, appMode: action.payload.appMode };\n\n    case ACTION_TYPES.Change_Selected_Drug_Primary:\n      return {\n        ...state,\n        selectedDrugPrimary: action.payload.selectedDrugPrimary,\n        diseasePredictions: [], // Clear previous predictions\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Load_Disease_Predictions:\n      return { ...state, diseasePredictions: action.payload.diseasePredictions };\n\n    case ACTION_TYPES.Toggle_Disease_Selection: {\n      const diseaseId = action.payload.diseaseId;\n      const updatedDiseasePredictions = state.diseasePredictions.map((d) => {\n        // Match by d.id (the disease_id used in the Select component)\n        if (d.id === diseaseId) {\n          return { ...d, selected: !d.selected };\n        }\n        return d;\n      });\n      return { ...state, diseasePredictions: updatedDiseasePredictions };\n    }\n\n    case ACTION_TYPES.Load_Drug_List:\n      return { ...state, drugOptions: action.payload.drugOptions };\n\n    default:\n      return state;\n  }\n};\n\nconst toggleDrugSelection = (\n  drugPredictions: IState['drugPredictions'],\n  selectedDrug: string\n) => {\n  return drugPredictions.map((d) => {\n    return {\n      ...d,\n      selected: selectedDrug === d.id ? !d.selected : d.selected,\n    };\n  });\n};\n\nconst updateMetaPathSummary = (\n  oldSummary: IMetaPathSummary[],\n  currentMetaPaths: IMetaPath[],\n  drugId: number,\n  isAdd: boolean\n) => {\n  let newSummary = oldSummary.map((d) => d);\n\n  // if add new drug\n  if (isAdd) {\n    currentMetaPaths.forEach((metaPath) => {\n      let count = metaPath.paths.length;\n      let sharedMeta = newSummary.find(\n        (d) => d.nodeTypes.join() === metaPath.nodeTypes.join()\n      );\n      if (sharedMeta) {\n        // if shared meta path exists\n        sharedMeta.count[drugId] = count;\n        sharedMeta.sum += count;\n      } else {\n        // if shared meta path does not exist\n        newSummary.push({\n          nodeTypes: metaPath.nodeTypes,\n          count: { [drugId]: count },\n          sum: count,\n          hide: false,\n          idx: newSummary.length,\n        });\n      }\n    });\n  } else {\n    // if delete existing drug\n\n    newSummary.forEach((metaPath) => {\n      if (drugId in metaPath.count) {\n        metaPath.sum -= metaPath.count[drugId];\n        delete metaPath.count[drugId];\n      }\n    });\n\n    newSummary = newSummary.filter((d) => d.sum > 0);\n  }\n\n  return newSummary;\n};\n\nexport const isAddDrug = (\n  drugPredictions: IState['drugPredictions'],\n  drugID: string\n) => {\n  return !drugPredictions\n    .filter((d) => d.selected)\n    .map((d) => d.id)\n    .includes(drugID);\n};\n\nexport const isAddDisease = (\n  diseasePredictions: IState['diseasePredictions'],\n  diseaseID: string\n) => {\n  return !diseasePredictions\n    .filter((d) => d.selected)\n    .map((d) => d.node_id || d.id)\n    .includes(diseaseID);\n};\n\nexport default rootReducer;\n","import React, { createContext } from 'react';\nimport rootReducer from './reducer';\nimport { IState } from 'types';\n\nconst initialState: IState = {\n  diseaseOptions: [],\n  drugPredictions: [],\n  nodeTypes: [],\n  edgeTypes: {},\n  metaPathGroups: {},\n  attention: {},\n  selectedDisease: undefined,\n  nodeNameDict: {},\n  isInitializing: true,\n  isDrugLoading: false,\n  isAttentionLoading: false,\n  isDiseaseLoading: false,\n  edgeThreshold: 0,\n  metaPathSummary: [],\n  selectedPathNodes: [],\n  drugOptions: [],\n  diseasePredictions: [],\n  selectedDrugPrimary: undefined,\n  appMode: 'disease-to-drug',\n};\n\ninterface IStateContext {\n  state: IState;\n  dispatch: ({ type }: { type: string }) => void;\n}\n\nconst GlobalStore = createContext({} as IStateContext);\n\n// An wrapping function to handle thunks (dispatched actions which are wrapped in a function, needed for async callbacks)\nconst asyncer = (dispatch: any, state: IState) => (action: any) =>\n  typeof action === 'function' ? action(dispatch, state) : dispatch(action);\n\n// The StateProvider component to provide the global state to all child components\nexport function StateProvider(props: any) {\n  const [state, dispatchBase] = React.useReducer(rootReducer, initialState);\n\n  const dispatch = React.useCallback(asyncer(dispatchBase, state), []);\n\n  return (\n    <GlobalStore.Provider value={{ state, dispatch }}>\n      {props.children}\n    </GlobalStore.Provider>\n  );\n}\n\nexport function StateConsumer(Component: any) {\n  return function WrapperComponent(props: any) {\n    return (\n      <GlobalStore.Consumer>\n        {(context) => (\n          <Component\n            {...props}\n            globalState={context.state}\n            dispatch={context.dispatch}\n          />\n        )}\n      </GlobalStore.Consumer>\n    );\n  };\n}\n","const cropText = (\n  text: string,\n  fontSize: number,\n  maxWidth: number,\n  fontWeight: number = 800\n): string => {\n  let returnText = text;\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontWeight} ${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  if (width > maxWidth) {\n    for (let i = 1; i < text.length; i += 1) {\n      const prevText = text.substr(0, i - 1).concat('...');\n      const currText = text.substr(0, i).concat('...');\n      const prevWidth = context.measureText(prevText).width;\n      const currWidth = context.measureText(currText).width;\n      if (currWidth > maxWidth && prevWidth < maxWidth) {\n        returnText = prevText;\n        break;\n      }\n    }\n  }\n  return returnText;\n};\n\nconst getTextWidth = (text: string, fontSize: number): number => {\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  return width;\n};\n\nexport { cropText, getTextWidth };\n","import React from 'react';\n\nconst VIRUS_ICON =\n  'M 483.55 227.55 H 462 c -50.68 0 -76.07 -61.27 -40.23 -97.11 L 437 115.19 A 28.44 28.44 0 0 0 396.8 75 L 381.56 90.22 c -35.84 35.83 -97.11 10.45 -97.11 -40.23 V 28.44 a 28.45 28.45 0 0 0 -56.9 0 V 50 c 0 50.68 -61.27 76.06 -97.11 40.23 L 115.2 75 A 28.44 28.44 0 0 0 75 115.19 l 15.25 15.25 c 35.84 35.84 10.45 97.11 -40.23 97.11 H 28.45 a 28.45 28.45 0 1 0 0 56.89 H 50 c 50.68 0 76.07 61.28 40.23 97.12 L 75 396.8 A 28.45 28.45 0 0 0 115.2 437 l 15.24 -15.25 c 35.84 -35.84 97.11 -10.45 97.11 40.23 v 21.54 a 28.45 28.45 0 0 0 56.9 0 V 462 c 0 -50.68 61.27 -76.07 97.11 -40.23 L 396.8 437 A 28.45 28.45 0 0 0 437 396.8 l -15.25 -15.24 c -35.84 -35.84 -10.45 -97.12 40.23 -97.12 h 21.54 a 28.45 28.45 0 1 0 0 -56.89 Z M 224 272 a 48 48 0 1 1 48 -48 A 48 48 0 0 1 224 272 Z m 80 56 a 24 24 0 1 1 24 -24 A 24 24 0 0 1 304 328 Z';\n\nconst YES_ICON =\n    'M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z',\n  NO_ICON =\n    'M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z';\n\nconst DRUG_ICON =\n  'M 555.3 300.1 L 424.2 112.8 C 401.9 81 366.4 64 330.4 64 c -22.6 0 -45.5 6.7 -65.5 20.7 c -19.7 13.8 -33.7 32.8 -41.5 53.8 C 220.5 79.2 172 32 112 32 C 50.1 32 0 82.1 0 144 v 224 c 0 61.9 50.1 112 112 112 s 112 -50.1 112 -112 V 218.9 c 3.3 8.6 7.3 17.1 12.8 25 L 368 431.2 c 22.2 31.8 57.7 48.8 93.8 48.8 c 22.7 0 45.5 -6.7 65.5 -20.7 c 51.7 -36.2 64.2 -107.5 28 -159.2 Z M 160 256 H 64 V 144 c 0 -26.5 21.5 -48 48 -48 s 48 21.5 48 48 v 112 Z m 194.8 44.9 l -65.6 -93.7 c -7.7 -11 -10.7 -24.4 -8.3 -37.6 c 2.3 -13.2 9.7 -24.8 20.7 -32.5 c 8.5 -6 18.5 -9.1 28.8 -9.1 c 16.5 0 31.9 8 41.3 21.5 l 65.6 93.7 l -82.5 57.7 Z';\n\nconst EDIT_ICON =\n  'M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z';\n\nconst SEARCH_ICON =\n  'M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z';\n\nconst LOADING_ICON = (\n  <g>\n    <text textAnchor=\"middle\" x=\"24\">\n      LOADING...\n    </text>\n    <rect x=\"0\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"20\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.2s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"40\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.4s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n  </g>\n);\n\nexport {\n  VIRUS_ICON,\n  YES_ICON,\n  NO_ICON,\n  DRUG_ICON,\n  EDIT_ICON,\n  LOADING_ICON,\n  SEARCH_ICON,\n};\n","const COLORS = [\n  '#4e79a7', // \"anatomy\",\n  '#edc949', // \"biological_process\",\n  '#e15759', // \"cellular_component\",\n  '#f28e2c', // \"disease\",\n  '#76b7b2', // \"drug\",\n  '#59a14f', // \"effect/phenotype\",\n  '#af7aa1', // \"exposure\",\n  '#ff9da7', // \"gene/protein\",\n  '#9c755f', // \"molecular_function\",\n  '#bab0ab', // \"pathway\"\n];\nlet colorDict: { [node: string]: string } = {};\n\nconst setNodeColor = (nodeTypes: string[]) => {\n  colorDict = {};\n  nodeTypes.forEach((nodeType, idx) => {\n    if (idx > COLORS.length - 1) {\n      idx = idx % (COLORS.length - 1);\n    }\n    colorDict[nodeType] = COLORS[idx];\n  });\n};\n\nconst getNodeColor = (nodeType: string) => {\n  if (colorDict[nodeType] === undefined) {\n    colorDict[nodeType] = COLORS[Object.keys(colorDict).length];\n  }\n\n  return colorDict[nodeType];\n};\n\nconst HIGHLIGHT_COLOR = '#1890ff';\nconst SELECTED_COLOR = 'black';\n\nexport { setNodeColor, getNodeColor, HIGHLIGHT_COLOR, SELECTED_COLOR };\n","import { IAttentionTree } from 'types';\nexport { cropText, getTextWidth } from './text';\nexport * from './icon';\n\nexport {\n  setNodeColor,\n  getNodeColor,\n  HIGHLIGHT_COLOR,\n  SELECTED_COLOR,\n} from './color';\n\nexport const pruneEdge = (\n  node: IAttentionTree,\n  threshold: number\n): IAttentionTree => {\n  if (node.children.length > 0) {\n    node = {\n      ...node,\n      children: node.children\n        .filter((d) => d.score >= threshold)\n        .map((node) => pruneEdge(node, threshold)),\n    };\n  }\n  return node;\n};\n\nexport const flatTree = (node: IAttentionTree): string[] => {\n  let res = [node.nodeId];\n  if (node.children.length > 0) {\n    res = res.concat(...node.children.map((d) => flatTree(d)));\n  }\n  return res;\n};\n\nexport const sigmoid = (t: number) => {\n  return 1 / (1 + Math.pow(Math.E, -t));\n};\n\nexport const removeDiseaseList = [\n  'mendelian disease',\n  'disease of cell nucleous',\n  'hip region disease',\n  'acute disease',\n  'vector borne disease',\n  'cancer',\n  'sex-linked disease',\n  'movement disorder',\n];\n\nexport const wheterRemoveDisease = (disease: string): boolean => {\n  if (!disease) return false;\n  return removeDiseaseList.includes(disease.toLowerCase());\n};\n\nexport const sentenceCapitalizer = (str: string) => {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n};\n\n// For drug-to-disease mode: use Inebilizumab (DB12530) as the primary drug\nexport const INIT_DRUG_PRIMARY = 'DB12530';  // Inebilizumab\n// Top disease predictions for this drug\nexport const INIT_DISEASES = ['15783', '7381', '15896'];  // Top predicted diseases\n\n// For backwards compatibility (disease-to-drug mode)\nexport const INIT_DISEASE = '15783';  // congenital anomaly of hepatic vein - first disease in our predictions\nexport const INIT_DRUGS = ['DB12530'];  // Inebilizumab\n\n// Default mode - start with drug-to-disease\nexport const DEFAULT_APP_MODE = 'drug-to-disease' as const;\n\n","import React from 'react';\nimport { IState, IAttentionTree } from 'types';\nimport * as d3 from 'd3';\nimport { Tooltip } from 'antd';\nimport { getNodeColor, pruneEdge } from 'helpers';\nimport {\n  cropText,\n  VIRUS_ICON,\n  DRUG_ICON,\n  getTextWidth,\n  LOADING_ICON,\n} from 'helpers';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n}\n\nexport default class AttentionTree extends React.Component<Props, {}> {\n  nodeHeight = 20;\n  fontSize = 14;\n  labelLength = 150;\n  midGap = 60; // the gaph between two trees\n  drawNodeAttentionHorizontal(\n    nodeAttention: IAttentionTree,\n    stepGap: number,\n    edgeThreshold: number\n  ) {\n    const { width } = this.props;\n    const {\n      nodeNameDict,\n      edgeTypes,\n      selectedPathNodes,\n    } = this.props.globalState;\n\n    let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n\n    const rootNode = d3.hierarchy(nodeAttentionFiltered);\n    const d3Tree = d3\n      .tree<IAttentionTree>()\n      .nodeSize([this.nodeHeight + 2, stepGap]);\n\n    const root = d3Tree(rootNode);\n\n    const linkGene = d3\n      .linkHorizontal<any, d3.HierarchyPointLink<IAttentionTree>, any>()\n      // modify the source and target x, y to make space for node\n      .source((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.source.y -\n            this.labelLength / 2\n            : d.source.y + this.labelLength / 2;\n        const newY = d.source.x;\n\n        return { x: newX, y: newY };\n      })\n      .target((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.target.y +\n            this.labelLength / 2\n            : d.target.y - this.labelLength / 2;\n        const newY = d.target.x;\n\n        return { x: newX, y: newY };\n      })\n      .x((d) => d.x)\n      .y((d) => d.y);\n\n    const maxScore = Math.max(\n      ...root.links().map((link) => link.target.data.score)\n    );\n\n    let widthScale = d3.scaleLinear().domain([0, maxScore]).range([1, 5]);\n\n    const links = root.links().map((link, i) => {\n      let edgeInfo = link.target.data.edgeInfo.replace('rev_', '');\n      if (edgeTypes[edgeInfo]) {\n        edgeInfo = edgeTypes[edgeInfo]['edgeInfo'] || edgeInfo;\n      }\n      return (\n        <Tooltip\n          title={edgeInfo}\n          key={`${link.source.data.nodeId}=>${link.target.data.nodeId}_link${i}`}\n          destroyTooltipOnHide\n        >\n          <g>\n            <path\n              d={linkGene(link)!}\n              className={`link ${link.source.data.nodeId}=>${link.target.data.nodeId}`}\n              fill=\"none\"\n              stroke=\"gray\"\n              strokeWidth={widthScale(link.target.data.score)}\n              opacity={selectedPathNodes.length > 0 ? 0.5 : 1}\n            />\n            <path\n              d={linkGene(link)!}\n              className=\"mask\"\n              fill=\"none\"\n              stroke=\"transparent\"\n              strokeWidth=\"3\"\n            />\n          </g>\n        </Tooltip>\n      );\n    });\n\n    const allY = root.descendants().map((node) => node.x);\n    const minY = Math.min(...allY);\n    const maxY = Math.max(...allY);\n\n    const height = maxY - minY + this.nodeHeight + 4; // default seperation in d3 tree is 2\n\n    const nodes = root.descendants().map((node, i) => {\n      let { nodeId, nodeType } = node.data;\n      let nodeFullName = nodeNameDict[nodeType][nodeId];\n      if (nodeFullName === undefined) {\n        nodeId = nodeId.replace(/_/g, '') + '.0'; // the id of a merged node is xxx_xxx_xxxx\n        nodeFullName = nodeNameDict[nodeType][nodeId];\n      }\n      let nodeShortName = cropText(\n        nodeFullName,\n        12,\n        this.labelLength - 25 - getTextWidth('..(0.00)', 14)\n      );\n      let tooltipTitle = nodeShortName?.includes('..') ? nodeFullName : '';\n      if (node.data.source) {\n        tooltipTitle = tooltipTitle ? `${tooltipTitle} (${node.data.source})` : `${nodeFullName} (${node.data.source})`;\n      }\n      let icon_path = '';\n      if (nodeType === 'disease') icon_path = VIRUS_ICON;\n      if (nodeType === 'drug') icon_path = DRUG_ICON;\n\n      const isHighlighted =\n        selectedPathNodes.length === 0 ||\n        (selectedPathNodes.map((d) => d.nodeType).includes(nodeType) &&\n          selectedPathNodes.map((d) => d.nodeId).includes(nodeId));\n\n      return (\n        <Tooltip\n          title={tooltipTitle}\n          key={`node${i}_${nodeFullName}`}\n          destroyTooltipOnHide\n          mouseEnterDelay={0.3}\n        >\n          <g\n            className={`${nodeId} node`}\n            transform={`translate(${root.data.nodeType === 'drug'\n              ? width / 2 - this.midGap / 2 - this.labelLength - node.y\n              : node.y\n              }, ${node.x})`}\n            cursor=\"pointer\"\n          >\n            <rect\n              width={this.labelLength}\n              height={this.nodeHeight}\n              fill={getNodeColor(nodeType)}\n              x={(-1 * this.labelLength) / 2}\n              y={-this.nodeHeight / 2}\n              opacity={isHighlighted ? 1 : 0.2}\n            />\n            <path\n              className=\"virus_icon\"\n              d={icon_path}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 2}, ${-this.nodeHeight / 2\n                }) scale(0.04)`}\n              fill=\"white\"\n            />\n            <text\n              fill=\"white\"\n              fontSize={this.fontSize}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 25}, ${(this.nodeHeight - this.fontSize) / 2\n                })`}\n            >\n              {/* {`${nodeShortName}\n                  ${node.depth > 0 ? ':' + node.data.score.toFixed(2) : ''}`} */}\n              {nodeShortName}\n            </text>\n            {node.depth === 0 && node.children === undefined && (\n              <text\n                fill=\"gray\"\n                fontSize={this.fontSize}\n                transform={`translate(${root.data.nodeType === 'drug'\n                  ? -this.labelLength / 2 - 10 - getTextWidth('No Attention Data', this.fontSize)\n                  : this.labelLength / 2 + 10\n                  }, ${(this.nodeHeight - this.fontSize) / 2})`}\n              >\n                No Attention Data\n              </text>\n            )}\n          </g>\n        </Tooltip>\n      );\n    });\n\n    return {\n      content: [\n        <g key=\"links\" className=\"links\">\n          {links}\n        </g>,\n        <g key=\"nodes\" className=\"nodes\">\n          {nodes}\n        </g>,\n      ],\n      height: height,\n    };\n  }\n  drawSubgraph() {\n    let { attention, edgeThreshold } = this.props.globalState;\n    let { width } = this.props;\n\n    let stepGap = (width - 2 * this.labelLength - this.midGap) / 4;\n    let heights = [0];\n    const content = Object.keys(attention).map((nodeKey: string, idx) => {\n      const { height, content } = this.drawNodeAttentionHorizontal(\n        attention[nodeKey],\n        stepGap,\n        edgeThreshold\n      );\n      heights.push(height);\n      return (\n        <g\n          className={nodeKey}\n          key={nodeKey}\n          transform={`translate(${((width + this.midGap) / 2) * idx + this.labelLength / 2\n            }, ${height / 2 + 2 * this.nodeHeight})`}\n        >\n          {content}\n        </g>\n      );\n    });\n    return { content, height: Math.max(...heights) };\n  }\n  render() {\n    const { width, height, globalState } = this.props;\n    const {\n      isAttentionLoading,\n      selectedDisease,\n      drugPredictions,\n      diseasePredictions,\n      appMode,\n    } = globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedItems = predictions.filter((d) => d.selected);\n\n    const { content, height: graphHeight } = this.drawSubgraph();\n    return (\n      <svg\n        width={width}\n        height={Math.max(graphHeight, height)}\n        className=\"nodeLink\"\n      >\n        {selectedItems.length > 0 && (appMode === 'drug-to-disease' ? true : selectedDisease) ? (\n          content\n        ) : (\n          <text x={width / 2} y={height / 2} fill=\"gray\">\n            Please select a disease and a drug first\n          </text>\n        )}\n        {isAttentionLoading ? (\n          <g>\n            <rect width={width} height={height} fill=\"white\" opacity={0.5} />\n            <g\n              transform={`translate(${width / 2}, ${height / 2})`}\n              textAnchor=\"middle\"\n            >\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <g />\n        )}\n      </svg>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as d3 from 'd3';\nimport { IAttentionTree, IState } from 'types';\nimport { flatTree, getNodeColor, pruneEdge, LOADING_ICON } from 'helpers';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n}\n\ninterface State { }\n\ninterface INode extends d3.SimulationNodeDatum {\n  id: string; // `${node_type}:${node_id}`\n  nodeId: string; //\n  nodeType: string; //\n  fx?: number;\n  fy?: number;\n}\n\ninterface ILink {\n  source: string;\n  target: string;\n  score: number;\n  edgeInfo: string;\n}\n\nexport default class ModelNodeForce extends React.Component<Props, State> {\n  public padding = 10;\n  RADIUS = 7;  // Smaller node radius for more compact view\n  prevNodes: INode[] = [];\n  prevLinks: ILink[] = [];\n  simulation: d3.Simulation<INode, ILink>;\n\n  constructor(props: Props) {\n    super(props);\n    \n    // Initialize simulation with animation\n    this.simulation = d3\n      .forceSimulation<INode, ILink>()\n      .force('charge', d3.forceManyBody<INode>().strength(-60))\n      .force(\n        'link',\n        d3\n          .forceLink<INode, ILink>()\n          .id((d) => d.id)\n          .distance(35)\n          .strength(0.6)\n      )\n      .force('collision', d3.forceCollide().radius(this.RADIUS + 2))\n      .force('center', d3.forceCenter(props.width / 2, props.height / 2))\n      .alphaDecay(0.02)  // Slower decay for smoother animation\n      .velocityDecay(0.3);  // Add some friction\n  }\n\n  ticked(\n    svgNodes: d3.Selection<\n      SVGGElement | d3.BaseType,\n      INode,\n      d3.BaseType,\n      unknown\n    >,\n    svgLinks: any\n  ) {\n    svgNodes.attr('transform', (d) => `translate(${d.x}, ${d.y})`);\n\n    svgLinks\n      .select('line.link')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('line.mask')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('text')\n      .attr('text-anchor', 'middle')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      );\n  }\n\n  dragstarted(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0.3).restart();\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  dragged(d: INode) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  dragended(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0);\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  isTargetNode(d: INode) {\n    const { drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    if (appMode === 'drug-to-disease') {\n      // In this mode, selectedIds are diseases (targets), and selectedDrugPrimary is source.\n      return selectedIds.includes(d.nodeId) || selectedDrugPrimary === d.nodeId;\n    }\n    return selectedIds.includes(d.nodeId) || selectedDisease === d.nodeId;\n  }\n\n  isHighlighted(d: INode) {\n    const { selectedPathNodes } = this.props.globalState;\n    return (\n      selectedPathNodes.map((i) => i.nodeType).includes(d.nodeType) &&\n      selectedPathNodes.map((i) => i.nodeId).includes(d.nodeId)\n    );\n  }\n\n  getNodeLinks() {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      attention,\n      // edgeThreshold,\n      selectedDisease,\n      selectedDrugPrimary,\n      edgeTypes,\n      appMode,\n    } = this.props.globalState;\n    const { width, height } = this.props;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    let nodes: INode[] = [],\n      links: ILink[] = [];\n\n    Object.values(attention).forEach((nodeAttention: IAttentionTree) => {\n      // let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n      const rootNode = d3.hierarchy(nodeAttention);\n      let desNodes: INode[] = [];\n      rootNode.descendants().forEach((d) => {\n        const node = {\n          id: `${d.data.nodeType}:${d.data.nodeId}`,\n          nodeId: d.data.nodeId,\n          nodeType: d.data.nodeType,\n        };\n        const prevNode = this.prevNodes.find((d) => d.id === node.id);\n        desNodes.push({ ...node, ...prevNode });\n      });\n      nodes = nodes.concat(desNodes);\n      const desLinks = rootNode.links().map((d) => {\n        const sourceData = d.source.data,\n          targetData = d.target.data;\n        let edgeInfo = targetData.edgeInfo.replace('rev_', '');\n        edgeInfo = edgeTypes[edgeInfo]?.edgeInfo || edgeInfo;\n        return {\n          source: `${sourceData.nodeType}:${sourceData.nodeId}`,\n          target: `${targetData.nodeType}:${targetData.nodeId}`,\n          score: targetData.score,\n          edgeInfo,\n        };\n      });\n      links = links.concat(desLinks);\n    });\n\n    // // show the virus host proteins\n    // let nodes:INode[] =  viralTargets.map(d => { return { id: d.toString() } }),\n    //     links:ILink[] = targetLinks.map(edge => { return { source: edge[0].toString(), target: edge[1].toString() } })\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n      const selectedIdx = selectedIds.indexOf(node.nodeId);\n\n      if (appMode === 'drug-to-disease') {\n        if (node.nodeId === selectedDrugPrimary) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      } else {\n        if (node.nodeId === selectedDisease) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      }\n    }\n\n    this.prevNodes = nodes;\n    this.prevLinks = links;\n\n    return { nodes, links };\n  }\n\n  drawGraph() {\n    const { nodeNameDict } = this.props.globalState;\n    const { nodes, links } = this.getNodeLinks();\n    const { width, height } = this.props;\n\n    const widthScale = d3\n      .scaleLinear()\n      .range([2, 6])  // Increased line widths for better visibility\n      .domain(d3.extent(links.map((d) => d.score)) as [number, number]);\n\n    let svgLinks: any = d3\n      .select('svg.graph')\n      .select('g.links')\n      .selectAll('g.link')\n      .data(links)\n      .join((enter) => enter.append('g').attr('class', 'link'))\n      .on('mouseover', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel');\n      })\n      .on('mouseout', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel hidden');\n      });\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'link')\n      .attr('stroke', '#aaa')\n      .attr('stroke-width', (d: any) => widthScale(d.score))\n      .attr('id', (d: any) => d.id);\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'mask')\n      .attr('stroke-width', 4)\n      .attr('stroke', 'transparent');\n\n    svgLinks\n      .append('text')\n      .attr('class', 'edgeLabel hidden')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      )\n      .text((d: any) => d.edgeInfo);\n\n    let svgNodes = d3\n      .select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .data(nodes, (d: any) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'nodeGroup')\n            .attr('transform', (d) => {\n              return `translate(${d.x || width / 2}, ${d.y || height / 2})`;\n            }) // ensure d.x is not undefined when first entering\n            .attr('cursor', 'pointer')\n            .call(\n              d3\n                .drag<SVGGElement, INode>()\n                .on('start', this.dragstarted.bind(this))\n                .on('drag', this.dragged.bind(this))\n                .on('end', this.dragended.bind(this))\n            ),\n\n        (update) =>\n          update.attr('transform', (d) => `translate(${d.x}, ${d.y})`),\n\n        (exit) => exit.remove()\n      );\n\n    svgNodes\n      .append('circle')\n      // .filter(d=>!drugTargets.includes(d.id))\n      .attr('r', this.RADIUS)\n      // .attr(\"r\", 5)\n      .attr('class', 'node')\n      .attr('id', (d) => d.id)\n      .attr('fill', (d: INode) => getNodeColor(d.nodeType))\n      .attr('stroke', 'white');\n\n    // add label to all nodes\n    svgNodes\n      .append('text')\n      .attr('class', 'nodeLabel')\n      .attr('transform', `translate(${-1 * this.RADIUS}, ${-2.5 * this.RADIUS} )`)\n      .attr('font-size', '13px')  // Slightly larger font\n      .text((d) => nodeNameDict[d.nodeType][d.nodeId])\n      .classed('hidden', true);\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n\n    // toggle node visibility through click\n    svgNodes.on('click', function (d) {\n      const textlabel = d3.select(this).select('text.nodeLabel');\n      const isHidden = textlabel.classed('hidden');\n      textlabel.classed('hidden', !isHidden);\n    });\n\n    this.simulation.nodes(nodes);\n    this.simulation.force<d3.ForceLink<INode, ILink>>('link')!.links(links);\n    this.simulation.on('tick', () => this.ticked(svgNodes, svgLinks));\n\n    this.updateVisibility();\n  }\n\n  updateNodeLabel() {\n    let svgNodes: d3.Selection<\n      SVGGElement,\n      INode,\n      d3.BaseType,\n      any\n    > = d3.select('svg.graph').select('g.nodes').selectAll('g.nodeGroup');\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n  }\n\n  updateVisibility() {\n    // update visibility of nodes and edges based on threshold\n    const { attention, edgeThreshold } = this.props.globalState;\n\n    d3.select('svg.graph')\n      .selectAll('g.link')\n      .style('opacity', (d: any) => (d.score > edgeThreshold ? 1 : 0));\n\n    var visibleNodes: string[] = [];\n    Object.values(attention).forEach((d) => {\n      visibleNodes = visibleNodes.concat(flatTree(pruneEdge(d, edgeThreshold)));\n    });\n\n    d3.select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .select('circle')\n      .style('opacity', (d: any) => {\n        return visibleNodes.includes(d.nodeId) ? 1 : 0;\n      });\n  }\n\n  componentDidMount() {\n    this.drawGraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const {\n      metaPathGroups: prevGroups,\n      selectedPathNodes: prevNodes,\n      edgeThreshold: prevThreshold,\n      attention: prevAttention,\n    } = prevProps.globalState;\n    const {\n      metaPathGroups: currGroups,\n      selectedPathNodes: currNodes,\n      edgeThreshold: currThreshold,\n      attention: currAttention,\n    } = this.props.globalState;\n    \n    // Redraw and restart animation when data changes\n    const prevGroupKeys = Object.keys(prevGroups).sort().join(',');\n    const currGroupKeys = Object.keys(currGroups).sort().join(',');\n    const prevAttentionKeys = Object.keys(prevAttention).sort().join(',');\n    const currAttentionKeys = Object.keys(currAttention).sort().join(',');\n    \n    if (prevGroupKeys !== currGroupKeys || prevAttentionKeys !== currAttentionKeys) {\n      this.drawGraph();\n      // Restart simulation with high alpha for smooth animation\n      this.simulation.alpha(1).restart();\n    }\n    \n    if (\n      prevNodes.map((d) => d.nodeId).join() !==\n      currNodes.map((d) => d.nodeId).join()\n    ) {\n      this.updateNodeLabel();\n    }\n\n    if (prevThreshold !== currThreshold) {\n      this.updateVisibility();\n    }\n    return false;\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { isAttentionLoading } = this.props.globalState;\n\n    const selectedDrugs = Object.keys(this.props.globalState.metaPathGroups);\n    const reminderText = (\n      <text\n        transform={`translate(${width / 2}, ${height / 2})`}\n        fill=\"gray\"\n        fontSize={20}\n      >\n        Please select a drug first\n      </text>\n    );\n\n    return (\n      <svg className=\"graph\" width={width} height={height}>\n        <g className=\"links\" />\n        <g className=\"nodes\" />\n        <text x={0} y={height - 25} fill=\"gray\" fontSize={12}>\n          Drag & Drop to move nodes.\n        </text>\n        <text x={0} y={height - 10} fill=\"gray\" fontSize={12}>\n          Click on nodes to show/hide labels.\n        </text>\n        {selectedDrugs.length === 0 ? reminderText : <></>}\n        {isAttentionLoading ? (\n          <g className=\"loading\">\n            <rect\n              className=\"loading__background\"\n              width={width}\n              height={height}\n              fill=\"white\"\n              opacity={0.5}\n            />\n            <g transform={`translate(${width / 2}, ${height / 2})`}>\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <></>\n        )}\n      </svg>\n    );\n  }\n}\n","import * as React from 'react';\nimport { IState, IDispatch } from 'types';\nimport { LOADING_ICON, getNodeColor } from 'helpers';\nimport { requestSubgraph } from 'stores/DataService';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface SubgraphEdge {\n  source: string;\n  target: string;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n}\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\ninterface State {\n  subgraph: Subgraph | null;\n  loading: boolean;\n  error: string | null;\n}\n\nexport default class V1AttentionTable extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subgraph: null,\n      loading: false,\n      error: null,\n    };\n  }\n\n  componentDidMount() {\n    this.loadSubgraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const prevDrug = prevProps.globalState.selectedDrugPrimary;\n    const prevDiseases = prevProps.globalState.diseasePredictions;\n\n    // Get currently selected disease\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n    const prevSelectedDisease = prevDiseases.find((d) => d.selected);\n\n    if (\n      selectedDrugPrimary !== prevDrug ||\n      selectedDisease?.id !== prevSelectedDisease?.id\n    ) {\n      this.loadSubgraph();\n    }\n  }\n\n  async loadSubgraph() {\n    const { selectedDrugPrimary, diseasePredictions, nodeNameDict } = this.props.globalState;\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      this.setState({ subgraph: null, loading: false });\n      return;\n    }\n\n    // Get disease node ID\n    const diseaseNodeId = selectedDisease.node_id || selectedDisease.id;\n\n    this.setState({ loading: true, error: null });\n\n    try {\n      const subgraph = await requestSubgraph(selectedDrugPrimary, diseaseNodeId);\n      this.setState({ subgraph, loading: false });\n    } catch (error) {\n      console.error('Failed to load subgraph:', error);\n      this.setState({ loading: false, error: 'Failed to load attention data' });\n    }\n  }\n\n  formatType(type: string): string {\n    if (!type) return 'Unknown';\n    if (type === 'gene/protein') return 'Protein';\n    return type\n      .replace(/_/g, ' ')\n      .replace(/\\b\\w/g, (l) => l.toUpperCase());\n  }\n\n  renderAttentionBar(score: number): React.ReactNode {\n    const percentage = Math.min(score * 100, 100);\n    const color =\n      score > 0.7\n        ? '#28a745'\n        : score > 0.4\n        ? '#ffc107'\n        : '#dc3545';\n\n    return (\n      <div\n        style={{\n          width: '100%',\n          height: '20px',\n          backgroundColor: '#e9ecef',\n          borderRadius: '10px',\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          style={{\n            width: `${percentage}%`,\n            height: '100%',\n            background: `linear-gradient(90deg, ${color} 0%, ${color}88 100%)`,\n            borderRadius: '10px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'flex-end',\n            paddingRight: '5px',\n          }}\n        >\n          <span\n            style={{\n              fontSize: '11px',\n              fontWeight: 'bold',\n              color: 'white',\n              textShadow: '1px 1px 2px rgba(0,0,0,0.5)',\n            }}\n          >\n            {score.toFixed(3)}\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { subgraph, loading, error } = this.state;\n    const { selectedDrugPrimary, diseasePredictions, nodeNameDict } = this.props.globalState;\n\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (loading) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <svg width={100} height={100}>\n            {LOADING_ICON}\n          </svg>\n        </div>\n      );\n    }\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#6c757d',\n            fontSize: '16px',\n          }}\n        >\n          Please select a drug and disease to see attention scores\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#dc3545',\n            fontSize: '16px',\n          }}\n        >\n          {error}\n        </div>\n      );\n    }\n\n    if (!subgraph || !subgraph.edges || subgraph.edges.length === 0) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            padding: '20px',\n          }}\n        >\n          <div\n            style={{\n              background: '#e7f3ff',\n              borderLeft: '4px solid #3a7bd5',\n              padding: '15px',\n              borderRadius: '5px',\n            }}\n          >\n            No attention data found for this drug-disease pair.\n          </div>\n        </div>\n      );\n    }\n\n    // Create node lookup map\n    const nodeMap: { [key: string]: SubgraphNode } = {};\n    subgraph.nodes.forEach((node) => {\n      nodeMap[node.id] = node;\n    });\n\n    // Group edges by relation\n    const edgesByRelation: { [key: string]: SubgraphEdge[] } = {};\n    subgraph.edges.forEach((edge) => {\n      const relation = edge.relation || 'unknown';\n      if (!edgesByRelation[relation]) {\n        edgesByRelation[relation] = [];\n      }\n      edgesByRelation[relation].push(edge);\n    });\n\n    // Sort edges within each group by attention score\n    Object.values(edgesByRelation).forEach((edges) => {\n      edges.sort((a, b) => b.attention - a.attention);\n    });\n\n    const drugName = nodeNameDict['drug']?.[selectedDrugPrimary] || selectedDrugPrimary;\n    const diseaseName = selectedDisease.name || selectedDisease.id;\n\n    return (\n      <div style={{ width, height, overflow: 'auto', padding: '10px' }}>\n        {/* Info Box */}\n        <div\n          style={{\n            background: '#e7f3ff',\n            borderLeft: '4px solid #3a7bd5',\n            padding: '15px',\n            marginBottom: '15px',\n            borderRadius: '5px',\n          }}\n        >\n          <strong>Total Edges:</strong> {subgraph.edges.length} |{' '}\n          <strong>Relation Types:</strong> {Object.keys(edgesByRelation).length}\n          <br />\n          <small>\n            Showing attention scores for: <strong>{drugName}</strong>  <strong>{diseaseName}</strong>\n          </small>\n        </div>\n\n        {/* Tables by Relation */}\n        {Object.entries(edgesByRelation).map(([relation, edges]) => (\n          <div key={relation} style={{ marginBottom: '20px' }}>\n            <h4\n              style={{\n                color: '#3a7bd5',\n                marginTop: '15px',\n                marginBottom: '10px',\n                fontSize: '14px',\n                fontWeight: 600,\n              }}\n            >\n              {relation.replace(/_/g, '  ')} ({edges.length})\n            </h4>\n            <table\n              style={{\n                width: '100%',\n                borderCollapse: 'collapse',\n                fontSize: '13px',\n              }}\n            >\n              <thead>\n                <tr style={{ background: '#f8f9fa' }}>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                    }}\n                  >\n                    Source\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                    }}\n                  >\n                    Target\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'center',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '80px',\n                    }}\n                  >\n                    Layer 1\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'center',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '80px',\n                    }}\n                  >\n                    Layer 2\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '150px',\n                    }}\n                  >\n                    Max Attention\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {edges.slice(0, 20).map((edge, idx) => {\n                  const sourceNode = nodeMap[edge.source];\n                  const targetNode = nodeMap[edge.target];\n                  const maxAtt = Math.max(edge.layer1_att || 0, edge.layer2_att || 0);\n\n                  return (\n                    <tr\n                      key={idx}\n                      style={{\n                        borderBottom: '1px solid #e9ecef',\n                      }}\n                      onMouseEnter={(e) => {\n                        (e.currentTarget as HTMLElement).style.backgroundColor = '#f8f9fa';\n                      }}\n                      onMouseLeave={(e) => {\n                        (e.currentTarget as HTMLElement).style.backgroundColor = 'transparent';\n                      }}\n                    >\n                      <td style={{ padding: '10px' }}>\n                        <strong>{sourceNode?.label || edge.source}</strong>\n                        <br />\n                        <small style={{ color: '#6c757d' }}>\n                          ({this.formatType(sourceNode?.type || 'unknown')})\n                        </small>\n                      </td>\n                      <td style={{ padding: '10px' }}>\n                        <strong>{targetNode?.label || edge.target}</strong>\n                        <br />\n                        <small style={{ color: '#6c757d' }}>\n                          ({this.formatType(targetNode?.type || 'unknown')})\n                        </small>\n                      </td>\n                      <td\n                        style={{\n                          padding: '10px',\n                          textAlign: 'center',\n                        }}\n                      >\n                        {(edge.layer1_att || 0).toFixed(4)}\n                      </td>\n                      <td\n                        style={{\n                          padding: '10px',\n                          textAlign: 'center',\n                        }}\n                      >\n                        {(edge.layer2_att || 0).toFixed(4)}\n                      </td>\n                      <td style={{ padding: '10px' }}>\n                        {this.renderAttentionBar(maxAtt)}\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n            {edges.length > 20 && (\n              <div\n                style={{\n                  textAlign: 'center',\n                  padding: '10px',\n                  color: '#6c757d',\n                  fontSize: '12px',\n                }}\n              >\n                Showing top 20 of {edges.length} edges\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n\n","import * as React from 'react';\nimport * as d3 from 'd3';\nimport { IState, IDispatch } from 'types';\nimport { LOADING_ICON } from 'helpers';\nimport { requestSubgraph } from 'stores/DataService';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface SubgraphEdge {\n  source: string | SimNode;\n  target: string | SimNode;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n}\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface SimNode extends d3.SimulationNodeDatum {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\ninterface State {\n  subgraph: Subgraph | null;\n  loading: boolean;\n  error: string | null;\n}\n\n// Node colors matching V1 dashboard\nconst NODE_COLORS: { [key: string]: string } = {\n  drug: '#3a7bd5',\n  disease: '#dc3545',\n  'gene/protein': '#28a745',\n  protein: '#28a745',\n  pathway: '#fd7e14',\n  biological_process: '#6f42c1',\n  molecular_function: '#20c997',\n  cellular_component: '#e83e8c',\n  anatomy: '#17a2b8',\n  effect_phenotype: '#ffc107',\n  exposure: '#795548',\n  unknown: '#6c757d',\n};\n\nexport default class V1SubGraph extends React.Component<Props, State> {\n  svgRef = React.createRef<SVGSVGElement>();\n  simulation: d3.Simulation<SimNode, SubgraphEdge> | null = null;\n  selectedDrugPrimary: string = '';\n  diseaseNodeId: string = '';\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subgraph: null,\n      loading: false,\n      error: null,\n    };\n    this.dragstarted = this.dragstarted.bind(this);\n    this.dragged = this.dragged.bind(this);\n    this.dragended = this.dragended.bind(this);\n  }\n\n  componentDidMount() {\n    this.loadSubgraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const prevDrug = prevProps.globalState.selectedDrugPrimary;\n    const prevDiseases = prevProps.globalState.diseasePredictions;\n\n    // Get currently selected disease\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n    const prevSelectedDisease = prevDiseases.find((d) => d.selected);\n\n    if (\n      selectedDrugPrimary !== prevDrug ||\n      selectedDisease?.id !== prevSelectedDisease?.id\n    ) {\n      this.loadSubgraph();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.simulation) {\n      this.simulation.stop();\n    }\n  }\n\n  async loadSubgraph() {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      this.setState({ subgraph: null, loading: false });\n      return;\n    }\n\n    const diseaseNodeId = selectedDisease.node_id || selectedDisease.id;\n    this.selectedDrugPrimary = selectedDrugPrimary;\n    this.diseaseNodeId = diseaseNodeId;\n\n    this.setState({ loading: true, error: null });\n\n    try {\n      const subgraph = await requestSubgraph(selectedDrugPrimary, diseaseNodeId);\n      this.setState({ subgraph, loading: false }, () => {\n        this.drawGraph();\n      });\n    } catch (error) {\n      console.error('Failed to load subgraph:', error);\n      this.setState({ loading: false, error: 'Failed to load subgraph data' });\n    }\n  }\n\n  getNodeColor(type: string): string {\n    return NODE_COLORS[type] || NODE_COLORS['unknown'];\n  }\n\n  dragstarted(d: SimNode) {\n    if (!d3.event.active) this.simulation?.alphaTarget(0.3).restart();\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  dragged(d: SimNode) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  dragended(d: SimNode) {\n    if (!d3.event.active) this.simulation?.alphaTarget(0);\n    d.fx = null;\n    d.fy = null;\n  }\n\n  drawGraph() {\n    const { subgraph } = this.state;\n    const { width, height } = this.props;\n\n    if (!subgraph || !this.svgRef.current) return;\n\n    const selectedDrugPrimary = this.selectedDrugPrimary;\n    const diseaseNodeId = this.diseaseNodeId;\n\n    // Clear previous content\n    const svg = d3.select(this.svgRef.current);\n    svg.selectAll('*').remove();\n\n    // Create deep copies of nodes and edges for D3 simulation\n    const nodes: SimNode[] = subgraph.nodes.map((n) => ({\n      ...n,\n      x: undefined,\n      y: undefined,\n    }));\n    const edges: SubgraphEdge[] = subgraph.edges.map((e) => ({\n      ...e,\n      source: e.source,\n      target: e.target,\n    }));\n\n    // Create container for zoom\n    const container = svg.append('g').attr('class', 'zoom-container');\n\n    // Create zoom behavior (D3 v5 style)\n    const zoom = d3.zoom<SVGSVGElement, unknown>()\n      .scaleExtent([0.1, 4])\n      .on('zoom', () => {\n        container.attr('transform', d3.event.transform);\n      });\n\n    svg.call(zoom as any);\n\n    // Create simulation\n    if (this.simulation) {\n      this.simulation.stop();\n    }\n\n    this.simulation = d3\n      .forceSimulation<SimNode, SubgraphEdge>(nodes)\n      .force(\n        'link',\n        d3\n          .forceLink<SimNode, SubgraphEdge>(edges)\n          .id((d) => d.id)\n          .distance(120)\n      )\n      .force('charge', d3.forceManyBody().strength(-250))\n      .force('center', d3.forceCenter(width / 2, height / 2))\n      .force('collision', d3.forceCollide().radius(40));\n\n    // Draw links\n    const link = container\n      .append('g')\n      .selectAll('line')\n      .data(edges)\n      .enter()\n      .append('line')\n      .attr('stroke', '#999')\n      .attr('stroke-opacity', 0.6)\n      .attr('stroke-width', (d) => Math.max(2, (d.attention || 0.1) * 8));\n\n    // Draw nodes\n    const node = container\n      .append('g')\n      .selectAll('circle')\n      .data(nodes)\n      .enter()\n      .append('circle')\n      .attr('r', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 25;\n        }\n        return 15;\n      })\n      .attr('fill', (d) => this.getNodeColor(d.type))\n      .attr('stroke', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return '#ffc107';\n        }\n        return 'white';\n      })\n      .attr('stroke-width', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 3;\n        }\n        return 1.5;\n      })\n      .attr('cursor', 'pointer')\n      .call(\n        d3.drag<SVGCircleElement, SimNode>()\n          .on('start', this.dragstarted)\n          .on('drag', this.dragged)\n          .on('end', this.dragended) as any\n      );\n\n    // Add node labels\n    const label = container\n      .append('g')\n      .selectAll('text')\n      .data(nodes)\n      .enter()\n      .append('text')\n      .attr('font-size', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return '14px';\n        }\n        return '11px';\n      })\n      .attr('font-weight', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 'bold';\n        }\n        return 'normal';\n      })\n      .attr('text-anchor', 'middle')\n      .attr('dy', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return -30;\n        }\n        return -20;\n      })\n      .attr('pointer-events', 'none')\n      .text((d) => {\n        const maxLen = d.id === selectedDrugPrimary || d.id === diseaseNodeId ? 40 : 25;\n        return d.label && d.label.length > maxLen\n          ? d.label.substring(0, maxLen) + '...'\n          : d.label || d.id;\n      });\n\n    // Hover effects (D3 v5 style)\n    node\n      .on('mouseover', function() {\n        d3.select(this).attr('stroke', '#ffc107').attr('stroke-width', 3);\n      })\n      .on('mouseout', function(d: SimNode) {\n        d3.select(this)\n          .attr('stroke', d.id === selectedDrugPrimary || d.id === diseaseNodeId ? '#ffc107' : 'white')\n          .attr('stroke-width', d.id === selectedDrugPrimary || d.id === diseaseNodeId ? 3 : 1.5);\n      });\n\n    // Tooltip\n    node.append('title').text((d) => `${d.label}\\nType: ${d.type}\\nID: ${d.id}`);\n\n    // Update positions on tick\n    this.simulation.on('tick', () => {\n      link\n        .attr('x1', (d: any) => d.source.x)\n        .attr('y1', (d: any) => d.source.y)\n        .attr('x2', (d: any) => d.target.x)\n        .attr('y2', (d: any) => d.target.y);\n\n      node.attr('cx', (d) => d.x || 0).attr('cy', (d) => d.y || 0);\n\n      label.attr('x', (d) => d.x || 0).attr('y', (d) => d.y || 0);\n    });\n\n    // Initial zoom to fit\n    setTimeout(() => {\n      const bounds = (container.node() as SVGGElement)?.getBBox();\n      if (bounds) {\n        const dx = bounds.width;\n        const dy = bounds.height;\n        const x = bounds.x + dx / 2;\n        const y = bounds.y + dy / 2;\n        const scale = Math.min(0.9, 0.9 / Math.max(dx / width, dy / height));\n        const translate = [width / 2 - scale * x, height / 2 - scale * y];\n\n        svg.transition()\n          .duration(750)\n          .call(\n            zoom.transform as any,\n            d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)\n          );\n      }\n    }, 500);\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { subgraph, loading, error } = this.state;\n    const { selectedDrugPrimary, diseasePredictions, nodeNameDict } = this.props.globalState;\n\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (loading) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <svg width={100} height={100}>\n            {LOADING_ICON}\n          </svg>\n        </div>\n      );\n    }\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#6c757d',\n            fontSize: '16px',\n          }}\n        >\n          Please select a drug and disease to see the knowledge subgraph\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#dc3545',\n            fontSize: '16px',\n          }}\n        >\n          {error}\n        </div>\n      );\n    }\n\n    const drugName = nodeNameDict['drug']?.[selectedDrugPrimary] || selectedDrugPrimary;\n    const diseaseName = selectedDisease.name || selectedDisease.id;\n\n    return (\n      <div style={{ width, height, position: 'relative' }}>\n        {/* Info overlay */}\n        <div\n          style={{\n            position: 'absolute',\n            top: 10,\n            left: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '10px 15px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '13px',\n          }}\n        >\n          <div style={{ fontWeight: 'bold', color: '#3a7bd5', marginBottom: '5px' }}>\n            Knowledge Sub-Graph\n          </div>\n          <div>\n            <strong>Drug:</strong> {drugName}\n          </div>\n          <div>\n            <strong>Disease:</strong> {diseaseName}\n          </div>\n          {subgraph && (\n            <div style={{ color: '#6c757d', marginTop: '5px' }}>\n              {subgraph.nodes.length} nodes, {subgraph.edges.length} edges\n            </div>\n          )}\n        </div>\n\n        {/* Legend */}\n        <div\n          style={{\n            position: 'absolute',\n            bottom: 10,\n            left: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '10px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '11px',\n          }}\n        >\n          <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>Node Types</div>\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\n            {Object.entries(NODE_COLORS).slice(0, 8).map(([type, color]) => (\n              <div key={type} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n                <div\n                  style={{\n                    width: 12,\n                    height: 12,\n                    borderRadius: '50%',\n                    backgroundColor: color,\n                  }}\n                />\n                <span>{type.replace('_', ' ')}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div\n          style={{\n            position: 'absolute',\n            bottom: 10,\n            right: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '8px 12px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '11px',\n            color: '#6c757d',\n          }}\n        >\n          <div> Drag nodes to move</div>\n          <div> Scroll to zoom</div>\n          <div> Drag background to pan</div>\n        </div>\n\n        {/* SVG container */}\n        <svg\n          ref={this.svgRef}\n          width={width}\n          height={height}\n          style={{\n            background: '#f8f9fa',\n            borderRadius: '8px',\n            border: '2px solid #e9ecef',\n          }}\n        />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { requestEmbedding } from 'stores/DataService';\nimport { IState, IDispatch } from 'types';\nimport { StateConsumer } from 'stores';\nimport * as d3 from 'd3';\nimport { HIGHLIGHT_COLOR, SELECTED_COLOR } from 'helpers/color';\nimport { LOADING_ICON } from 'helpers';\nimport { selectDrug, selectDrugPrimary, selectDiseaseSecondary } from 'stores/actions';\nimport { isAddDrug, isAddDisease } from 'stores/reducer';\nimport lasso from './lasso.js';\n\ninterface State {\n  embedding: { [key: string]: [number, number] };\n  tooltip: {\n    visible: boolean;\n    info: string;\n    position: [number, number];\n  };\n}\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\nclass Scatter extends React.Component<Props, State> {\n  circleRadius = 3;\n  hoverTimeout: number = 0;\n  WAIT = 500;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      embedding: {},\n      tooltip: { visible: false, info: '', position: [0, 0] },\n    };\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n  }\n  async loadEmbedding() {\n    const { selectedDrugPrimary } = this.props.globalState;\n    const embedding = await requestEmbedding(selectedDrugPrimary);\n    this.setState({ embedding });\n  }\n  componentDidMount() {\n    this.loadEmbedding();\n  }\n  componentDidUpdate(prevProps: Props) {\n    // Reload embeddings when the primary drug changes\n    const { selectedDrugPrimary } = this.props.globalState;\n    const prevDrugPrimary = prevProps.globalState.selectedDrugPrimary;\n    \n    if (selectedDrugPrimary !== prevDrugPrimary) {\n      this.loadEmbedding();\n    }\n  }\n\n  addLasso(width: number, height: number) {\n    const { drugPredictions } = this.props.globalState;\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    // lasso draw\n    d3.selectAll('g.lasso').remove();\n    var svg = d3.select('svg.scatter');\n\n    var lasso_area = d3.select('rect.lasso');\n\n    // Lasso functions to execute while lassoing\n    var lasso_start = () => {\n      // (mylasso.items() as any).attr('r', 5); // reset size\n      // .attr('fill', 'white')\n    };\n\n    var lasso_draw = () => {\n      // Style the possible dots\n      // mylasso\n      // .possibleItems()\n      // .classed(\"possible\", true)\n    };\n\n    var lasso_end = () => {\n      // mylasso.selectedItems()\n      //     .attr('fill', colors[this.selected.length])\n      //     .attr('r', '7')\n      //     .classed(`group_${this.selected.length}`, true)\n      // mylasso\n      // .items()\n      // .classed(\"possible\", false)\n\n      (mylasso.selectedItems() as any)._groups[0].forEach((d: any) => {\n        const drugID = d.attributes.id.value;\n        if (!selectedDrugIds.includes(drugID)) {\n          selectDrug(\n            drugID,\n            this.props.globalState.selectedDisease,\n            true,\n            this.props.dispatch\n          );\n        }\n      });\n    };\n\n    var mylasso = lasso();\n    mylasso.items(svg.selectAll('circle.highlighted'));\n    mylasso\n      .targetArea(lasso_area) // area where the lasso can be started\n      .on('start', lasso_start) // lasso start function\n      .on('draw', lasso_draw) // lasso draw function\n      .on('end', lasso_end); // lasso end function\n\n    svg.call(mylasso);\n  }\n  drawScatter() {\n    const { diseasePredictions, appMode } = this.props.globalState;\n    const { width, height } = this.props;\n\n    // this.addLasso(width, height);\n\n    const { embedding } = this.state;\n    const xDomain = d3.extent(Object.values(embedding).map((d) => d[0])) as [\n      number,\n      number\n    ],\n      yDomain = d3.extent(Object.values(embedding).map((d) => d[1])) as [\n        number,\n        number\n      ];\n\n    const xScale = d3\n      .scaleLinear()\n      .domain(xDomain)\n      .range([this.circleRadius, width - this.circleRadius]);\n    const yScale = d3\n      .scaleLinear()\n      .domain(yDomain)\n      .range([this.circleRadius, height - this.circleRadius]);\n\n    // Use disease predictions in drug-to-disease mode\n    const diseaseIds = diseasePredictions.map((d) => d.node_id || d.id);\n    const selectedDiseaseIds = diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.node_id || d.id);\n\n    const getSortIndex = (diseaseId: string) =>\n      diseaseIds.indexOf(diseaseId) > -1 ? diseaseIds.indexOf(diseaseId) : diseaseIds.length;\n\n    const nodes = Object.keys(embedding)\n      .sort((a, b) => -getSortIndex(a) + getSortIndex(b))\n      .map((diseaseId) => {\n        const [x, y] = embedding[diseaseId];\n        const diseaseRank = diseaseIds.indexOf(diseaseId);\n        const isHighlighted = diseaseRank > -1; // predicted diseases\n        const isSelected = selectedDiseaseIds.includes(diseaseId);\n\n        return (\n          <circle\n            cx={xScale(x)}\n            cy={yScale(y)}\n            key={diseaseId}\n            className={isHighlighted ? 'highlighted disease' : 'disease'}\n            id={diseaseId}\n            fill={\n              isSelected\n                ? SELECTED_COLOR\n                : isHighlighted\n                  ? HIGHLIGHT_COLOR\n                  : 'lightGray'\n            }\n            opacity={isSelected ? 1 : 0.7}\n            stroke={'white'}\n            r={\n              isSelected\n                ? this.circleRadius * 1.5\n                : isHighlighted\n                  ? this.circleRadius * 1.1\n                  : this.circleRadius\n            }\n            onDoubleClick={() => {\n              if (isHighlighted) this.onChangeDisease(diseaseId);\n            }}\n            onClick={() => this.showTooltip(diseaseId, [xScale(x), yScale(y)])}\n          />\n        );\n      });\n    return nodes;\n  }\n  onChangeDisease(selectedDiseaseNodeId: string) {\n    const { appMode, selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease' && selectedDrugPrimary) {\n      // Find the disease prediction by node_id to get the correct disease_id\n      const diseasePrediction = diseasePredictions.find(\n        (d) => (d.node_id || d.id) === selectedDiseaseNodeId\n      );\n      \n      if (!diseasePrediction) {\n        console.warn(`Disease prediction not found for node_id: ${selectedDiseaseNodeId}`);\n        return;\n      }\n      \n      // Use disease_id (d.id) for selection toggle, node_id for attention API\n      const diseaseId = diseasePrediction.id;\n      const diseaseNodeId = diseasePrediction.node_id || diseasePrediction.id;\n      \n      // In Drug-to-Disease mode, clicking a disease selects/deselects it\n      const isAdd = isAddDisease(diseasePredictions, diseaseId);\n      selectDiseaseSecondary(\n        diseaseId,           // disease_id for selection toggle\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch,\n        diseaseNodeId        // node_id for attention API\n      );\n    }\n  }\n  onChangeDrug(selectedDrug: string) {\n    const { appMode } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      selectDrugPrimary(selectedDrug, this.props.dispatch);\n    } else {\n      const isAdd = isAddDrug(\n        this.props.globalState.drugPredictions,\n        selectedDrug\n      );\n      selectDrug(\n        selectedDrug,\n        this.props.globalState.selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n  showTooltip(diseaseId: string, position: [number, number]) {\n    const { nodeNameDict } = this.props.globalState;\n    this.hoverTimeout = window.setTimeout(() => {\n      const diseaseName = nodeNameDict['disease']?.[diseaseId] || diseaseId;\n      this.setState({\n        tooltip: {\n          visible: true,\n          info: `disease: ${diseaseName}`,\n          position,\n        },\n      });\n    }, this.WAIT);\n  }\n  hideTooltip() {\n    window.clearTimeout(this.hoverTimeout);\n    this.setState({\n      tooltip: {\n        visible: false,\n        info: ``,\n        position: [0, 0],\n      },\n    });\n  }\n  render() {\n    const { isDrugLoading, isInitializing } = this.props.globalState;\n    const { width, height } = this.props;\n    const { tooltip } = this.state;\n\n    return (\n      <div style={{ position: 'relative' }}>\n        <svg width={width} height={height} className=\"scatter\">\n          <rect\n            className=\"lasso area\"\n            width={width}\n            height={height}\n            opacity={0}\n          />\n          <g className=\"scatter\">\n            {this.state.embedding ? (\n              this.drawScatter()\n            ) : (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            )}\n            {/* overlap a loading icon when loading */}\n            {isDrugLoading && !isInitializing ? (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            ) : (\n              <g />\n            )}\n          </g>{' '}\n          <text x={0} y={height - 25} fontSize={12} fill=\"gray\">\n            Click to reveal the disease name.\n          </text>\n          <text x={0} y={height - 10} fontSize={12} fill=\"gray\">\n            Double click to select the disease.\n          </text>\n        </svg>\n        <div\n          className={`tooltip tooltip-${tooltip.visible ? 'show' : 'hide'}`}\n          style={{\n            left: tooltip.position[0] + this.circleRadius,\n            top: tooltip.position[1] + this.circleRadius,\n          }}\n        >\n          {tooltip.info}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default StateConsumer(Scatter);\n","import * as selection from 'd3-selection';\nimport * as drag from 'd3-drag';\nimport classifyPoint from 'robust-point-in-polygon';\n\nexport default function () {\n  var items = [],\n    closePathDistance = 75,\n    closePathSelect = true,\n    isPathClosed = false,\n    hoverSelect = true,\n    targetArea,\n    on = { start: function () {}, draw: function () {}, end: function () {} };\n\n  // Function to execute on call\n  function lasso(_this) {\n    // add a new group for the lasso\n    var g = _this.append('g').attr('class', 'lasso');\n\n    // add the drawn path for the lasso\n    var dyn_path = g.append('path').attr('class', 'drawn');\n\n    // add a closed path\n    var close_path = g.append('path').attr('class', 'loop_close');\n\n    // add an origin node\n    var origin_node = g.append('circle').attr('class', 'origin');\n\n    // The transformed lasso path for rendering\n    var tpath;\n\n    // The lasso origin for calculations\n    var origin;\n\n    // The transformed lasso origin for rendering\n    var torigin;\n\n    // Store off coordinates drawn\n    var drawnCoords;\n\n    // Apply drag behaviors\n    var dragAction = drag\n      .drag()\n      .on('start', dragstart)\n      .on('drag', dragmove)\n      .on('end', dragend);\n\n    // Call drag\n    targetArea.call(dragAction);\n\n    function dragstart() {\n      // Init coordinates\n      drawnCoords = [];\n\n      // Initialize paths\n      tpath = '';\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n\n      // Set every item to have a false selection and reset their center point and counters\n      items.nodes().forEach(function (e) {\n        e.__lasso.possible = false;\n        e.__lasso.selected = false;\n        e.__lasso.hoverSelect = false;\n        e.__lasso.loopSelect = false;\n\n        var box = e.getBoundingClientRect();\n        e.__lasso.lassoPoint = [\n          Math.round(box.left + box.width / 2),\n          Math.round(box.top + box.height / 2),\n        ];\n      });\n\n      // if hover is on, add hover function\n      if (hoverSelect) {\n        items.on('mouseover.lasso', function () {\n          // if hovered, change lasso selection attribute to true\n          this.__lasso.hoverSelect = true;\n        });\n      }\n\n      // Run user defined start function\n      on.start();\n    }\n\n    function dragmove() {\n      // Get mouse position within body, used for calculations\n      var x, y;\n      if (selection.event.sourceEvent.type === 'touchmove') {\n        x = selection.event.sourceEvent.touches[0].clientX;\n        y = selection.event.sourceEvent.touches[0].clientY;\n      } else {\n        x = selection.event.sourceEvent.clientX;\n        y = selection.event.sourceEvent.clientY;\n      }\n\n      // Get mouse position within drawing area, used for rendering\n      var tx = selection.mouse(this)[0];\n      var ty = selection.mouse(this)[1];\n\n      // Initialize the path or add the latest point to it\n      if (tpath === '') {\n        tpath = tpath + 'M ' + tx + ' ' + ty;\n        origin = [x, y];\n        torigin = [tx, ty];\n        // Draw origin node\n        origin_node\n          .attr('cx', tx)\n          .attr('cy', ty)\n          .attr('r', 7)\n          .attr('display', null);\n      } else {\n        tpath = tpath + ' L ' + tx + ' ' + ty;\n      }\n\n      drawnCoords.push([x, y]);\n\n      // Calculate the current distance from the lasso origin\n      var distance = Math.sqrt(\n        Math.pow(x - origin[0], 2) + Math.pow(y - origin[1], 2)\n      );\n\n      // Set the closed path line\n      var close_draw_path =\n        'M ' + tx + ' ' + ty + ' L ' + torigin[0] + ' ' + torigin[1];\n\n      // Draw the lines\n      dyn_path.attr('d', tpath);\n\n      close_path.attr('d', close_draw_path);\n\n      // Check if the path is closed\n      isPathClosed = distance <= closePathDistance ? true : false;\n\n      // If within the closed path distance parameter, show the closed path. otherwise, hide it\n      if (isPathClosed && closePathSelect) {\n        close_path.attr('display', null);\n      } else {\n        close_path.attr('display', 'none');\n      }\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.loopSelect =\n          isPathClosed && closePathSelect && n.__lasso.lassoPoint\n            ? classifyPoint(drawnCoords, n.__lasso.lassoPoint) < 1\n            : false;\n        n.__lasso.possible = n.__lasso.hoverSelect || n.__lasso.loopSelect;\n      });\n\n      on.draw();\n    }\n\n    function dragend() {\n      // Remove mouseover tagging function\n      items.on('mouseover.lasso', null);\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.selected = n.__lasso.possible;\n        n.__lasso.possible = false;\n      });\n\n      // Clear lasso\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n      origin_node.attr('display', 'none');\n\n      // Run user defined end function\n      on.end();\n    }\n  }\n\n  // Set or get list of items for lasso to select\n  lasso.items = function (_) {\n    if (!arguments.length) return items;\n    items = _;\n    var nodes = items.nodes();\n    nodes.forEach(function (n) {\n      n.__lasso = {\n        possible: false,\n        selected: false,\n      };\n    });\n    return lasso;\n  };\n\n  // Return possible items\n  lasso.possibleItems = function () {\n    return items.filter(function () {\n      return this.__lasso.possible;\n    });\n  };\n\n  // Return selected items\n  lasso.selectedItems = function () {\n    return items.filter(function () {\n      return this.__lasso.selected;\n    });\n  };\n\n  // Return not possible items\n  lasso.notPossibleItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.possible;\n    });\n  };\n\n  // Return not selected items\n  lasso.notSelectedItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.selected;\n    });\n  };\n\n  // Distance required before path auto closes loop\n  lasso.closePathDistance = function (_) {\n    if (!arguments.length) return closePathDistance;\n    closePathDistance = _;\n    return lasso;\n  };\n\n  // Option to loop select or not\n  lasso.closePathSelect = function (_) {\n    if (!arguments.length) return closePathSelect;\n    closePathSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Not sure what this is for\n  lasso.isPathClosed = function (_) {\n    if (!arguments.length) return isPathClosed;\n    isPathClosed = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Option to select on hover or not\n  lasso.hoverSelect = function (_) {\n    if (!arguments.length) return hoverSelect;\n    hoverSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Events\n  lasso.on = function (type, _) {\n    if (!arguments.length) return on;\n    if (arguments.length === 1) return on[type];\n    var types = ['start', 'draw', 'end'];\n    if (types.indexOf(type) > -1) {\n      on[type] = _;\n    }\n    return lasso;\n  };\n\n  // Area where lasso can be triggered from\n  lasso.targetArea = function (_) {\n    if (!arguments.length) return targetArea;\n    targetArea = _;\n    return lasso;\n  };\n\n  return lasso;\n}\n","import { Tooltip, Modal } from 'antd';\nimport { cropText, YES_ICON, NO_ICON, LOADING_ICON } from 'helpers';\nimport { getNodeColor } from 'helpers/color';\nimport { ACTION_TYPES, selectDrug, selectDiseaseSecondary, toggleMetaPathHide } from 'stores/actions';\nimport { isAddDrug } from 'stores/reducer';\nimport React from 'react';\n\nimport { StateConsumer } from 'stores';\nimport { IPath, IMetaPathSummary, IState, IDispatch } from 'types';\nimport * as d3 from 'd3';\n\nimport './index.css';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  expand: boolean[];\n  isModalVisible: boolean;\n}\n\nclass PathMatrix extends React.Component<Props, State> {\n  TITLE_HEIGHT = 36;\n  MARGIN = 10;\n  PADDING = 10;\n  EDGE_LENGTH = 120;\n  NODE_WIDTH = 130;\n  NODE_HEIGHT = 25;\n  VERTICAL_GAP = 2; // vertical gap between path\n  GROUP_GAP = 6; // vertical gap between path groups\n  COUNT_GAP = 5; // horizontal gap between count circles\n  RADIUS = this.NODE_HEIGHT / 2; // max radius of the count circle\n  HEAD_HEIGHT = 70; // height of the header ()\n  ICON_GAP = 20; // width of the expand triangle icon\n  offsetY = 0; // record the height of the expanded meta paths\n\n  constructor(prop: Props) {\n    super(prop);\n    this.state = {\n      expand: this.props.globalState.metaPathSummary.map((d) => false),\n      isModalVisible: false,\n    };\n\n    this.showModal = this.showModal.bind(this);\n    this.hideModal = this.hideModal.bind(this);\n    this.filterMetaPathGroups = this.filterMetaPathGroups.bind(this);\n  }\n  toggleExpand(idx: number, flag: undefined | boolean) {\n    let { expand } = this.state;\n    if (flag === undefined) {\n      expand[idx] = !expand[idx];\n    } else {\n      expand[idx] = flag;\n    }\n    this.setState({ expand });\n  }\n\n  isPathSelected(nodes: IPath['nodes']) {\n    const { selectedPathNodes } = this.props.globalState;\n    const doesExist =\n      selectedPathNodes.map((d) => d.nodeId).join() ===\n      nodes.map((d) => d.nodeId).join() &&\n      selectedPathNodes.map((d) => d.nodeType).join() ===\n      nodes.map((d) => d.nodeType).join();\n    return doesExist;\n  }\n\n  togglePathNodes(nodes: IPath['nodes'], doesExist: boolean) {\n    if (doesExist) {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: [] },\n      });\n    } else {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: nodes },\n      });\n    }\n  }\n  getMetaIconGroup(toggleHideFunc: (hide: boolean) => void, isHide: boolean) {\n    return (\n      <g\n        className=\"feedback\"\n        cursor=\"pointer\"\n        style={{ fill: '#777' }}\n        transform={`translate(5, 0)`}\n      >\n        <g\n          className=\"yes\"\n          transform={`translate(${0 * this.ICON_GAP}, 0)`}\n          onClick={() => toggleHideFunc(!isHide)}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={isHide ? YES_ICON : NO_ICON} transform={`scale(0.03)`} />\n        </g>\n      </g>\n    );\n  }\n  getIconGroup(nodes: IPath['nodes']) {\n    return (\n      <g className=\"feedback\" cursor=\"pointer\" style={{ fill: '#777' }}>\n        {/* <g\n          className=\"search\"\n          transform={`translate(0, 0)`}\n          fill={doesExist ? 'red' : 'inherit'}\n          onClick={() => this.togglePathNodes(nodes, doesExist)}\n        >\n          <rect\n            width={this.ICON_GAP}\n            height={this.ICON_GAP}\n            fill=\"white\"\n            stroke=\"white\"\n          />\n          <path d={SEARCH_ICON} transform={`scale(0.018)`} />\n        </g> */}\n        {/* <g className=\"yes\" transform={`translate(${this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={YES_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g className=\"no\" transform={`translate(${2 * this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={NO_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g\n          className=\"edit\"\n          transform={`translate(${3 * this.ICON_GAP}, 0)`}\n          onClick={this.showModal}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={EDIT_ICON} transform={`scale(0.03)`} />\n        </g> */}\n      </g>\n    );\n  }\n  drawHeader() {\n    const { drugPredictions, diseasePredictions, nodeNameDict, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const nameType = appMode === 'drug-to-disease' ? 'disease' : 'drug';\n\n    const headerNames = predictions\n      .filter((d) => d.selected)\n      .map((item) => item.name || nodeNameDict[nameType][item.id] || item.id);\n    // headerNames.push('SUM');\n\n    const header = headerNames.map((name, idx) => {\n      // const isSelected =\n      //   idx > drugPredictions.length - 1\n      //     ? false\n      //     : drugPredictions[idx].selected;\n      return (\n        <text\n          key={name}\n          className={name}\n          fill={'gray'}\n          cursor=\"pointer\"\n          transform={`translate(\n            ${idx * (this.RADIUS * 2 + this.COUNT_GAP) + this.RADIUS}, \n            ${this.HEAD_HEIGHT}) \n            rotate(-45)`}\n          onClick={() => {\n            if (idx < predictions.length)\n              this.onChangeDrug(predictions[idx].id);\n          }}\n        >\n          {name}\n        </text>\n      );\n    });\n    return header;\n  }\n  getCountWidth() {\n    const { drugPredictions, diseasePredictions, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const width =\n      predictions.filter((d) => d.selected).length *\n      (this.RADIUS * 2 + this.COUNT_GAP) +\n      this.COUNT_GAP;\n    return width;\n  }\n  drawSummary() {\n    let { EDGE_LENGTH, NODE_WIDTH, NODE_HEIGHT, VERTICAL_GAP } = this;\n\n    let { metaPathSummary, drugPredictions, diseasePredictions, appMode, nodeNameDict } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const COUNT_WIDTH = this.getCountWidth();\n\n    let metaPathGroups = this.filterMetaPathGroups();\n    const triangleRight =\n      'M 9 17.879 V 6.707 A 1 1 0 0 1 10.707 6 l 5.586 5.586 a 1 1 0 0 1 0 1.414 l -5.586 5.586 A 1 1 0 0 1 9 17.879 Z',\n      triangelBottom =\n        'M 6.414 9 h 11.172 a 1 1 0 0 1 0.707 1.707 l -5.586 5.586 a 1 1 0 0 1 -1.414 0 l -5.586 -5.586 A 1 1 0 0 1 6.414 9 Z';\n\n    const maxCount = Math.max(\n      ...metaPathSummary.map((d) => Object.values(d.count)).flat()\n    );\n    const rScale = d3\n      .scaleLinear()\n      .range([this.RADIUS / 3, this.RADIUS])\n      .domain([0, maxCount]);\n\n    this.offsetY = 0;\n    const allRows = [...metaPathSummary]\n      .sort((a, b) => (a.hide ? 1 : 0) - (b.hide ? 1 : 0))\n      .map((summary) => {\n        let nodes = summary.nodeTypes.map((node, nodeIdx) => {\n          let translate = `translate(${(EDGE_LENGTH + NODE_WIDTH) * nodeIdx\n            }, ${0})`;\n          return (\n            <g key={`node_${nodeIdx}`} transform={translate}>\n              <rect\n                width={NODE_WIDTH}\n                height={NODE_HEIGHT}\n                fill=\"white\"\n                strokeWidth=\"3\"\n                stroke={getNodeColor(node)}\n                rx={this.NODE_HEIGHT / 2}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={NODE_HEIGHT / 2 + 6}\n                x={NODE_WIDTH / 2}\n                fill=\"black\"\n              >\n                {node}\n              </text>\n            </g>\n          );\n        });\n        let edges = [...Array(nodes.length - 1)].map((_, edgeIdx) => {\n          let translate = `translate(${NODE_WIDTH + (EDGE_LENGTH + NODE_WIDTH) * edgeIdx\n            }, ${+NODE_HEIGHT / 2})`;\n          return (\n            <g key={`edge_${edgeIdx}`} transform={translate}>\n              <line\n                stroke=\"lightgray\"\n                // strokeWidth={1+Math.random() * 8}\n                strokeWidth={2}\n                x1={0}\n                y1={0}\n                x2={EDGE_LENGTH}\n                y2={0}\n              />\n            </g>\n          );\n        });\n        let currentY = this.offsetY;\n        this.offsetY += NODE_HEIGHT + VERTICAL_GAP;\n\n        let differentChildren: JSX.Element[] = [];\n        let childrenOffsetY = 0;\n        const showChildren = this.state.expand[summary.idx];\n\n        let lastMetaPath: IPath | undefined = undefined;\n        let diseaseIndex = 0;\n        Object.keys(metaPathGroups).forEach((drugId) => {\n          const metaPathGroup = metaPathGroups[drugId];\n          const metaPaths =\n            metaPathGroup.filter(\n              (d) => d.nodeTypes.join('') === summary.nodeTypes.join('')\n            )[0]?.paths || [];\n\n          const drugRank = predictions\n            .filter((d) => d.selected)\n            .map((d) => d.id)\n            .indexOf(drugId);\n          \n          // Get disease name for label\n          const prediction = predictions.find((d) => d.id === drugId);\n          const diseaseName = prediction?.name || nodeNameDict['disease']?.[drugId] || drugId;\n          const shortDiseaseName = diseaseName.length > 25 ? diseaseName.slice(0, 22) + '...' : diseaseName;\n          \n          const { children, numOfChildren } = this.drawChildrenPaths(\n            metaPaths,\n            drugRank,\n            lastMetaPath\n          );\n          lastMetaPath = metaPaths[metaPaths.length - 1];\n          const childrenHeight = (NODE_HEIGHT + VERTICAL_GAP) * numOfChildren;\n          \n          // Add disease number label before paths\n          const diseaseLabel = numOfChildren > 0 ? (\n            <g transform={`translate(0, ${childrenOffsetY})`}>\n              <text \n                x={this.PADDING} \n                y={this.NODE_HEIGHT / 2 + 5} \n                fill=\"#333\" \n                fontSize={11}\n                fontWeight=\"bold\"\n              >\n                [{diseaseIndex + 1}] {shortDiseaseName}\n              </text>\n            </g>\n          ) : null;\n          \n          if (numOfChildren > 0) {\n            diseaseIndex++;\n            differentChildren.push(\n              <g\n                key={`drugRank: ${drugRank}`}\n                className={`drugRank_${drugRank}`}\n                transform={`translate(0, ${childrenOffsetY})`}\n              >\n                {diseaseLabel}\n                <g transform={`translate(0, ${this.NODE_HEIGHT + 5})`}>\n                  {children}\n                </g>\n              </g>\n            );\n            \n            childrenOffsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            if (showChildren) {\n              this.offsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            }\n          }\n\n          this.offsetY += this.GROUP_GAP;\n        });\n\n        const toggleHideFunc = (hide: boolean) => {\n          toggleMetaPathHide(\n            metaPathSummary,\n            summary.idx,\n            hide,\n            this.props.dispatch\n          );\n          if (hide) {\n            this.toggleExpand(summary.idx, false);\n          }\n        };\n\n        return (\n          <g\n            key={`prototype_${summary.idx}`}\n            transform={`translate(${0}, ${currentY})`}\n            opacity={summary.hide ? 0.4 : 1}\n          >\n            <g className=\"metaCount\">{this.drawMetaCount(summary, rScale)}</g>\n            <g className=\"icon\">\n              <path\n                d={showChildren ? triangelBottom : triangleRight}\n                transform={`translate(${COUNT_WIDTH}, 0)`}\n                fill=\"gray\"\n                onClick={() => {\n                  if (!summary.hide) this.toggleExpand(summary.idx, undefined);\n                }}\n                cursor=\"pointer\"\n              />\n            </g>\n            <g\n              className=\"prototype\"\n              transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}\n            >\n              {nodes}\n              {edges}\n              <g\n                className=\"iconGroup\"\n                transform={`translate(${NODE_WIDTH * nodes.length + EDGE_LENGTH * edges.length\n                  }, 0)`}\n              >\n                {this.getMetaIconGroup(toggleHideFunc, summary.hide)}\n              </g>\n            </g>\n            <g className=\"metapaths\">\n              {showChildren ? differentChildren : <g />}\n            </g>\n          </g>\n        );\n      });\n    const header = this.drawHeader();\n    const content = (\n      <g>\n        <g\n          className=\"header\"\n          transform={`translate(${this.PADDING}, ${this.PADDING})`}\n        >\n          {header}\n        </g>\n        <g\n          className=\"rows\"\n          transform={`translate(${0}, ${this.PADDING + this.HEAD_HEIGHT})`}\n        >\n          {allRows}\n        </g>\n      </g>\n    );\n    return content;\n  }\n\n  onChangeDrug(selectedId: string) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      const isAdd = isAddDrug(diseasePredictions, selectedId);\n\n      if (selectedDrugPrimary) {\n        selectDiseaseSecondary(\n          selectedId,\n          selectedDrugPrimary,\n          isAdd,\n          this.props.dispatch\n        );\n      }\n    } else {\n      const isAdd = isAddDrug(\n        drugPredictions,\n        selectedId\n      );\n      selectDrug(\n        selectedId,\n        selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, metaPathSummary } = this.props.globalState;\n    const prevPredictions = prevProps.globalState.appMode === 'drug-to-disease' ? prevProps.globalState.diseasePredictions : prevProps.globalState.drugPredictions;\n    const currPredictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    if (\n      // when disease changed, collapse all meta paths\n      prevProps.globalState.selectedDisease !==\n      selectedDisease\n    ) {\n      this.setState({\n        expand: metaPathSummary.map((d) => false),\n      });\n    } else if (\n      prevPredictions.filter((d) => d.selected).length !==\n      currPredictions.filter((d) => d.selected).length\n    ) {\n      // update expended metapaths when selected drug changes\n      const expandStatus = metaPathSummary.map((d) => false); // collapse all metapaths by default\n      this.setState({ expand: expandStatus });\n    }\n  }\n\n  drawMetaCount(\n    summary: IMetaPathSummary,\n    rScale: d3.ScaleLinear<number, number>\n  ) {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      isAttentionLoading,\n      metaPathGroups,\n      edgeThreshold,\n      appMode,\n    } = this.props.globalState;\n    const { count, nodeTypes } = summary;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const vis = predictions\n      .filter((d) => d.selected)\n      .map((prediction, idx) => {\n        const { id: predictionId } = prediction;\n        // const num = count[predictionId]\n        //   ? count[predictionId]\n        //   : isAttentionLoading\n        //   ? '...'\n        //   : 0;\n\n        const metaPath = metaPathGroups[predictionId]?.find(\n          (d) => d.nodeTypes.join(',') === nodeTypes.join(',')\n        );\n        const num = metaPath\n          ? metaPath.paths.filter((path) =>\n            path.edges.every((e) => e.score >= edgeThreshold)\n          ).length\n          : isAttentionLoading\n            ? '...'\n            : 0;\n\n        const content = (\n          <text\n            textAnchor=\"middle\"\n            transform={`translate(${this.RADIUS}, ${this.RADIUS / 2})`}\n            fontSize={15}\n            fill={'gray'}\n          >\n            {num}\n          </text>\n        );\n        return (\n          <g\n            key={idx}\n            className=\"count\"\n            transform={`translate(${idx * (2 * this.RADIUS + this.COUNT_GAP)\n              }, ${this.NODE_HEIGHT / 2})`}\n            cursor=\"pointer\"\n            onClick={() => this.onChangeDrug(predictionId)}\n          >\n            {content}\n          </g>\n        );\n      });\n    return (\n      <g className=\"metaCount\" transform={`translate(${this.PADDING}, 0)`}>\n        {vis}\n        {/* <g\n          className=\"sum\"\n          transform={`translate(${\n            count.length * (2 * this.RADIUS + this.COUNT_GAP)\n          }, 0)`}\n        >\n          <text\n            x={this.RADIUS}\n            y={this.NODE_HEIGHT / 2 + 6}\n            textAnchor=\"middle\"\n          >\n            {' '}\n            {`${sum}`}{' '}\n          </text>\n        </g> */}\n      </g>\n    );\n  }\n\n  drawChildrenPaths(\n    metaPaths: IPath[],\n    drugRank: number,\n    prevPath: IPath | undefined,\n    showFullPaths: boolean = true  // Always show full paths, don't abbreviate\n  ) {\n    const { nodeNameDict, edgeTypes, edgeThreshold } = this.props.globalState;\n    const COUNT_WIDTH = this.getCountWidth();\n    const filteredMetaPaths = metaPaths.filter((metaPath) =>\n      metaPath.edges.every((e) => e.score >= edgeThreshold)\n    );\n    const children = filteredMetaPaths.map((metaPath, childIdx) => {\n      // Calculate path weight from edge scores - use max score if available\n      const edgeScores = metaPath.edges.map(e => e.score).filter(s => s > 0);\n      const pathWeight = edgeScores.length > 0 \n        ? (edgeScores.reduce((sum, s) => sum + s, 0) / edgeScores.length).toFixed(2)\n        : (childIdx + 1).toString();  // Use path index if no scores\n      \n      const nodes = metaPath.nodes.map((node, nodeIdx) => {\n        const { nodeId, nodeType } = node;\n        const nodeName = nodeNameDict[nodeType]?.[nodeId] || nodeId;\n\n        // Always show full node names - don't use '' abbreviation\n        let shortNodeName = cropText(nodeName, 14, this.NODE_WIDTH - 10) || nodeId || 'unknown';\n\n        // Add offset for the weight label on the left\n        let translate = `translate(${40 + (this.EDGE_LENGTH + this.NODE_WIDTH) * nodeIdx\n          }, ${0})`;\n\n        return (\n          <Tooltip\n            key={`node_${nodeIdx}`}\n            title={(shortNodeName.includes('.') ? nodeName : nodeName) + (node.source ? ` (${node.source})` : '')}\n          >\n            <g\n              transform={translate}\n              className={`node_${nodeId}`}\n              style={{ cursor: 'pointer' }}\n              onClick={() =>\n                nodeType === 'drug' &&\n                window.open(\n                  `https://go.drugbank.com/drugs/${nodeId}`,\n                  'windowName',\n                  'popup,right=10,top=10,width=320,height=600'\n                )\n              }\n            >\n              <rect\n                width={this.NODE_WIDTH}\n                height={this.NODE_HEIGHT}\n                fill={getNodeColor(nodeType)}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={this.NODE_HEIGHT / 2 + 6}\n                x={this.NODE_WIDTH / 2}\n                fill=\"white\"\n              >\n                {shortNodeName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      \n      // Add path weight/count on the left side\n      const weightLabel = (\n        <g key=\"weight\" transform={`translate(0, ${this.NODE_HEIGHT / 2 + 5})`}>\n          <text\n            textAnchor=\"end\"\n            x={35}\n            fill=\"#666\"\n            fontSize={12}\n            fontWeight=\"bold\"\n          >\n            {pathWeight}\n          </text>\n        </g>\n      );\n      \n      const edges = metaPath.edges.map((edge, edgeIdx) => {\n        // Add offset for the weight label\n        const translate = `translate(${40 + this.NODE_WIDTH + (this.EDGE_LENGTH + this.NODE_WIDTH) * edgeIdx\n          }, ${+this.NODE_HEIGHT / 2})`;\n\n        let edgeName = edge.edgeInfo.replace('rev_', '');\n        edgeName = edgeTypes[edgeName]?.edgeInfo || edgeName;\n        const edgeShortName = cropText(edgeName, 14, this.EDGE_LENGTH);\n        return (\n          <Tooltip\n            title={edgeShortName === edgeName ? '' : edgeName}\n            destroyTooltipOnHide\n          >\n            <g\n              key={`edge_${edgeIdx}`}\n              transform={translate}\n              style={{ cursor: 'pointer' }}\n            >\n              <line\n                stroke=\"gray\"\n                strokeWidth={1 + edge.score * 2}\n                x1={0}\n                y1={this.NODE_HEIGHT / 4}\n                x2={this.EDGE_LENGTH}\n                y2={this.NODE_HEIGHT / 4}\n              />\n              <text\n                x={this.EDGE_LENGTH / 2}\n                y={0}\n                textAnchor=\"middle\"\n                fill=\"gray\"\n              >\n                {edgeShortName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      return (\n        <g\n          key={childIdx}\n          transform={`translate(0, ${(this.NODE_HEIGHT + this.VERTICAL_GAP) * (1 + childIdx)\n            })`}\n        >\n          <circle\n            cx={\n              drugRank * (2 * this.RADIUS + this.COUNT_GAP) +\n              this.RADIUS +\n              this.PADDING\n            }\n            cy={this.NODE_HEIGHT / 2}\n            fill=\"gray\"\n            r={this.RADIUS / 4}\n          />\n          <g transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}>\n            {weightLabel}\n            {nodes}\n            {edges}\n            <g\n              className=\"iconGroup\"\n              transform={`translate(${40 + this.NODE_WIDTH * nodes.length + this.EDGE_LENGTH * edges.length\n                }, 0)`}\n            >\n              {this.getIconGroup(metaPath.nodes)}\n            </g>\n          </g>\n        </g>\n      );\n    });\n    return { children, numOfChildren: filteredMetaPaths.length };\n  }\n  showModal() {\n    this.setState({ isModalVisible: true });\n  }\n  hideModal() {\n    this.setState({ isModalVisible: false });\n  }\n  filterMetaPathGroups() {\n    let { metaPathGroups, edgeThreshold } = this.props.globalState;\n    let filteredMetaGroups: IState['metaPathGroups'] = {};\n    Object.keys(metaPathGroups).forEach((k) => {\n      filteredMetaGroups[k] = metaPathGroups[k].map((metaPathGroup) => {\n        const metaPaths = metaPathGroup.paths.filter((path) =>\n          path.edges.every((e) => e.score > edgeThreshold)\n        );\n        return { ...metaPathGroup, metaPaths };\n      });\n    });\n\n    Object.keys(filteredMetaGroups).forEach((k) => {\n      filteredMetaGroups[k] = filteredMetaGroups[k].filter(\n        (metaPathGroup) => metaPathGroup.paths.length > 0\n      );\n    });\n\n    return filteredMetaGroups;\n  }\n  render() {\n    const { width, height } = this.props,\n      { isModalVisible, expand } = this.state;\n    const {\n      isDrugLoading,\n      isAttentionLoading,\n      metaPathSummary,\n      selectedDisease,\n      drugPredictions,\n    } = this.props.globalState;\n\n    const svgWidth = Math.max(\n      width - 2 * this.PADDING - 2 * this.MARGIN,\n      this.getCountWidth() +\n      this.ICON_GAP * 5 +\n      this.NODE_WIDTH +\n      (this.EDGE_LENGTH + this.NODE_WIDTH) * 4\n    );\n\n    const matrixRowsCount = Object.values(metaPathSummary)\n      .map((d, idx) => {\n        return expand[idx] ? d.sum : 0;\n      })\n      .reduce((a, b) => a + b, 0),\n      matrixGroupsCount = Object.keys(metaPathSummary).length,\n      matrixHeight =\n        matrixRowsCount * (this.NODE_HEIGHT + this.VERTICAL_GAP) +\n        this.PADDING +\n        matrixGroupsCount * (this.HEAD_HEIGHT + this.GROUP_GAP);\n\n    const svgOuterHeight = height - 2 * this.PADDING - this.TITLE_HEIGHT,\n      svgHeight = Math.max(matrixHeight + this.HEAD_HEIGHT, svgOuterHeight);\n\n    const reminderText = (\n      <text\n        x={width / 2}\n        y={height / 2}\n        fill=\"gray\"\n        textAnchor=\"middle\"\n        fontSize={20}\n      >\n        {isAttentionLoading\n          ? ''\n          : typeof selectedDisease == 'string' &&\n            drugPredictions.filter((d) => d.selected).length > 0\n            ? 'Sorry, we find no meta path with current computational resources.'\n            : 'Please select a disease and at least one drug'}\n      </text>\n    );\n\n    const metaPaths = this.drawSummary();\n    const content = metaPathSummary.length === 0 ? reminderText : metaPaths;\n    return (\n      <>\n        <svg width={svgWidth} height={svgHeight}>\n          {content}\n          {/* overlap loading icon when it is loading */}\n          {isAttentionLoading ? (\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={svgWidth}\n                height={svgOuterHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${svgWidth / 2}, ${svgOuterHeight / 2})`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          ) : (\n            <></>\n          )}\n        </svg>\n\n        <Modal\n          title=\"Edit Explanation\"\n          visible={isModalVisible}\n          onOk={this.hideModal}\n          onCancel={this.hideModal}\n          okText=\"Confirm\"\n          width={width}\n          zIndex={1999}\n        >\n          <svg width={width}></svg>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(PathMatrix);\n","import React from 'react';\nimport { Tabs } from 'antd';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\n\nimport AttentionTree from './AttentionTree';\nimport Graph from './Graph';\nimport V1AttentionTable from './V1AttentionTable';\nimport V1SubGraph from './V1SubGraph';\nimport Scatter from 'components/CardContainer/Scatter';\n\nimport './index.css';\nimport PathMatrix from 'components/TabContainer/PathMatrix';\n\nconst { TabPane } = Tabs;\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  activeTab: string;\n}\n\nclass NodeLink extends React.Component<Props, State> {\n  titleHeight = 36;\n  margin = 10;\n  padding = 10;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      activeTab: 'metapath',\n    };\n  }\n  changeActiveTab(key: string) {\n    this.setState({ activeTab: key });\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const cardWidth = width - 2 * this.margin - 2 * this.padding,\n      cardHeight =\n        height - 2 * this.padding - this.titleHeight - 2 * this.margin;\n\n    const props = { ...this.props, height: cardHeight, width: cardWidth };\n\n    return (\n      <Tabs\n        size=\"small\"\n        activeKey={this.state.activeTab}\n        style={{\n          width: width - 2 * this.margin,\n          height: height - this.margin,\n          margin: this.margin,\n          marginBottom: 0,\n          backgroundColor: 'white',\n        }}\n        tabBarStyle={{\n          height: this.titleHeight,\n          padding: '0px 10px',\n          margin: '0px',\n        }}\n        onChange={this.changeActiveTab.bind(this)}\n      >\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"metapath\"\n          tab=\"Meta-Path\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <PathMatrix {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"attention\"\n          tab=\"Node Attention\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <AttentionTree {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"graph\" tab=\"Sub-Graph\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Graph {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"v1attention\" tab=\"Node_Attention\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <V1AttentionTable {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"v1subgraph\" tab=\"Sub_Graph\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflow: 'hidden',\n            }}\n          >\n            <V1SubGraph {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"embedding\" tab=\"Disease Embeddings\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Scatter width={cardWidth} height={cardHeight} />\n          </div>\n        </TabPane>\n      </Tabs>\n    );\n  }\n}\n\nexport default StateConsumer(NodeLink);\n","import React from 'react';\nimport { StateConsumer } from 'stores';\nimport { IDispatch, IState } from 'types';\nimport {\n  ACTION_TYPES,\n  selectDisease,\n  selectDrug,\n  changeAppMode,\n  selectDrugPrimary,\n  selectDiseaseSecondary,\n} from 'stores/actions';\n\nimport './Sider.css';\n\nimport {\n  Col,\n  InputNumber,\n  Layout,\n  Row,\n  Select,\n  Skeleton,\n  Slider,\n  Tooltip,\n  Radio,\n} from 'antd';\nimport { QuestionCircleOutlined, CheckCircleOutlined } from '@ant-design/icons';\nimport {\n  getNodeColor,\n  sigmoid,\n  wheterRemoveDisease,\n  sentenceCapitalizer,\n  INIT_DISEASE,\n  INIT_DRUGS,\n} from 'helpers';\n\nconst { Sider } = Layout;\nconst { Option } = Select;\n\ninterface Props {\n  siderWidth: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\nclass DrugSider extends React.Component<Props> {\n  padding = 10;\n  listHeight = 450; // height of the open drug list\n  constructor(props: Props) {\n    super(props);\n    this.changeEdgeTHR = this.changeEdgeTHR.bind(this);\n    this.changeRevEdgeTHR = this.changeRevEdgeTHR.bind(this);\n    this.onChangeDisease = this.onChangeDisease.bind(this);\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n    this.onChangeAppMode = this.onChangeAppMode.bind(this);\n    this.onChangeDrugPrimary = this.onChangeDrugPrimary.bind(this);\n    this.onChangeDiseaseSecondary = this.onChangeDiseaseSecondary.bind(this);\n  }\n\n  onChangeAppMode(e: any) {\n    changeAppMode(e.target.value, this.props.dispatch);\n  }\n\n  onChangeDrugPrimary(selectedDrug: string) {\n    selectDrugPrimary(selectedDrug, this.props.dispatch);\n  }\n\n  onChangeDiseaseSecondary(selectedDiseases: string[]) {\n    // For now, we only support selecting one disease at a time in the secondary list for visualization\n    // But the UI might allow multiple. Let's assume the last selected one is the target.\n    // We reuse the selectDrug logic but inverted? No, we need to adapt selectDrug or create a new one.\n    // Actually, the existing selectDrug logic expects a drug ID.\n    // For Drug-to-Disease, we want to visualize the pair.\n    // Let's reuse selectDrug but we need to be careful about what 'selectedDrug' means in state.\n    // In Drug-to-Disease mode:\n    // selectedDrugPrimary is the source drug.\n    // We want to see attention for (selectedDrugPrimary, selectedDisease).\n\n    // Wait, the existing visualization expects `selectedDisease` and `drugPredictions` (with `selected` flag).\n    // If we want to reuse the visualization components without massive refactoring:\n    // We can map:\n    // Drug-to-Disease Mode ->\n    //   selectedDisease in State = The selected disease from the list (Secondary)\n    //   selectedDrug in State = The primary drug (Primary)\n\n    // But `selectedDisease` triggers `requestDrugPredictions`. We don't want that in this mode.\n    // We want `selectedDrugPrimary` to trigger `requestDiseasePredictions`.\n\n    // Let's look at `selectDrug` action:\n    // It calls `modifyAttentionPaths`.\n    // `modifyAttentionPaths` takes (selectedDrug, selectedDisease).\n\n    // So, when a disease is selected in the secondary list:\n    // We should call `modifyAttentionPaths(selectedDrugPrimary, selectedDisease)`.\n\n    const prevSelectedDiseases = this.props.globalState.diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const isAdd = selectedDiseases.length > prevSelectedDiseases.length;\n    const currentDisease = isAdd\n      ? selectedDiseases[selectedDiseases.length - 1]\n      : prevSelectedDiseases.filter((d) => !selectedDiseases.includes(d))[0];\n\n    // Trigger attention path update\n    if (this.props.globalState.selectedDrugPrimary && currentDisease) {\n      const { selectedDrugPrimary } = this.props.globalState;\n\n      // Find the disease prediction to get node_id for attention queries\n      const diseasePrediction = this.props.globalState.diseasePredictions.find(\n        d => d.id === currentDisease\n      );\n\n      // Use node_id if available, otherwise fall back to id\n      const diseaseNodeId = diseasePrediction?.node_id || currentDisease;\n\n      // selectDiseaseSecondary handles both the selection toggle and attention path update\n      selectDiseaseSecondary(\n        currentDisease,  // Pass the id for toggle (matches d.id in diseasePredictions)\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch,\n        diseaseNodeId  // Pass node_id for attention API\n      );\n    }\n  }\n\n  onChangeDrug(selectedDrugs: string[]) {\n    const prevSelectedDrugs = this.props.globalState.drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    const isAdd = selectedDrugs.length > prevSelectedDrugs.length;\n\n    const currentDrug = isAdd\n      ? selectedDrugs[selectedDrugs.length - 1]\n      : prevSelectedDrugs.filter((d) => !selectedDrugs.includes(d))[0];\n    selectDrug(\n      currentDrug,\n      this.props.globalState.selectedDisease,\n      isAdd,\n      this.props.dispatch\n    );\n  }\n  changeEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: value },\n      });\n    }\n  }\n\n  changeRevEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: Math.round(10 - 10 * value) / 10 },\n      });\n    }\n  }\n\n  onChangeDisease(selectedDisease: string) {\n    selectDisease(selectedDisease, this.props.dispatch);\n  }\n  render() {\n    let { siderWidth } = this.props;\n    let {\n      edgeThreshold,\n      nodeTypes,\n      diseaseOptions,\n      drugOptions,\n      drugPredictions,\n      diseasePredictions,\n      nodeNameDict,\n      selectedDisease,\n      selectedDrugPrimary,\n      appMode,\n    } = this.props.globalState;\n\n    // Default to disease-to-drug if undefined\n    const currentMode = appMode || 'disease-to-drug';\n\n    const defaultDiseaseText = 'Search to Select a disease';\n    const defaultDrugText = 'Select a drug from the prediction';\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const selectedDiseaseIds = diseasePredictions\n      ? diseasePredictions.filter((d) => d.selected).map((d) => d.id)\n      : [];\n\n    const untreatable_disease_icon = (\n      <Tooltip\n        // title=\"The knowledge graph contains no drug for treating this disease\"\n        title=\"Diseases with no known drug indications in the dataset\"\n      >\n        <QuestionCircleOutlined style={{ color: '#eb2f96' }} />\n      </Tooltip>\n    );\n\n    const known_drug_icon = (\n      <Tooltip\n        // title=\"the knowledge graph contains this drug indication\"\n        title=\"US FDA-approved drug indication\"\n      >\n        <CheckCircleOutlined style={{ color: '#52c41a' }} />\n      </Tooltip>\n    );\n\n    let sider = (\n      <Sider\n        width={siderWidth}\n        theme=\"light\"\n        style={{ padding: `${this.padding}px` }}\n      >\n        <div style={{ marginBottom: 10, textAlign: 'center' }}>\n          <Radio.Group value={currentMode} onChange={this.onChangeAppMode}>\n            <Radio.Button value=\"disease-to-drug\">Disease &rarr; Drug</Radio.Button>\n            <Radio.Button value=\"drug-to-disease\">Drug &rarr; Disease</Radio.Button>\n          </Radio.Group>\n        </div>\n\n        {currentMode === 'disease-to-drug' ? (\n          <>\n            Disease:\n            <Select\n              defaultValue={INIT_DISEASE}\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDisease}\n              showSearch\n              optionFilterProp=\"label\"\n              value={selectedDisease}\n            >\n              {diseaseOptions.length > 0 ? (\n                diseaseOptions\n                  .filter(\n                    (d) => {\n                      if (!nodeNameDict['disease'] || !nodeNameDict['disease'][d[0]]) return true;\n                      return !wheterRemoveDisease(nodeNameDict['disease'][d[0]]);\n                    }\n                  )\n                  .map((d) => {\n                    const [id, treatable] = d;\n                    const name = (nodeNameDict['disease'] && nodeNameDict['disease'][id]) || id;\n                    const cropName =\n                      name.length * 10 > siderWidth * 0.8\n                        ? name.slice(0, 40) + '...'\n                        : name;\n                    return (\n                      <Option value={id} label={name} key={`diseaseID_${d}`}>\n                        <span title={name}> {sentenceCapitalizer(cropName)} </span>\n                        {!treatable && untreatable_disease_icon}\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\">\n                  data is loading..\n                </Option>\n              )}\n            </Select>\n            <br />\n            Drug:\n            {drugPredictions.length === 0 ? (\n              // <span>Data is Loading.. </span>\n              <Skeleton />\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDrug}\n                defaultValue={INIT_DRUGS}\n                value={selectedDrugIds}\n                // menuItemSelectedIcon={<EyeOutlined />}\n                menuItemSelectedIcon={<></>}\n              >\n                {drugPredictions.map((d, idx) => {\n                  const { id: drug_id, score, known } = d;\n                  const name = (nodeNameDict['drug'] && nodeNameDict['drug'][drug_id]) || drug_id;\n                  const cropName =\n                    name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  return (\n                    <Option value={drug_id} key={`disease_${idx}`} label={name}>\n                      <div>\n                        <span>\n                          [{idx + 1}] <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span style={{ float: 'right' }}>\n                          score: {sigmoid(score).toFixed(3)}\n                          {/* rank: {idx + 1} */}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        ) : (\n          <>\n            Drug:\n            <Select\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDrugPrimary}\n              showSearch\n              optionFilterProp=\"label\"\n              placeholder=\"Click to select a drug\"\n              value={selectedDrugPrimary}\n              dropdownStyle={{ maxHeight: 400, overflow: 'auto' }}\n              listHeight={350}\n              virtual={false}\n            >\n              {drugOptions && drugOptions.length > 0 ? (\n                // Sort drugs alphabetically by name\n                [...drugOptions]\n                  .map((drug_id) => ({\n                    id: drug_id,\n                    name: nodeNameDict['drug'] ? nodeNameDict['drug'][drug_id] : drug_id\n                  }))\n                  .sort((a, b) => (a.name || a.id).localeCompare(b.name || b.id))\n                  .map(({ id: drug_id, name }, idx) => {\n                    const displayName = name || drug_id;\n                    return (\n                      <Option value={drug_id} label={displayName} key={`drugID_${drug_id}`}>\n                        <div style={{ padding: '4px 0' }}>\n                          <span style={{ fontWeight: 500 }}>[{idx + 1}]</span>{' '}\n                          <span title={displayName}>{displayName}</span>\n                        </div>\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\" disabled>\n                  Loading drugs... (Please wait)\n                </Option>\n              )}\n            </Select>\n            <br />\n            Disease Candidates:\n            {!diseasePredictions || diseasePredictions.length === 0 ? (\n              this.props.globalState.isDiseaseLoading ? <Skeleton /> : <div>Select a drug to see candidates</div>\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDiseaseSecondary}\n                value={selectedDiseaseIds}\n                menuItemSelectedIcon={<></>}\n              >\n                {diseasePredictions.map((d, idx) => {\n                  const { id: disease_id, score, known, name: predictionName } = d;\n                  const name = predictionName || (nodeNameDict['disease'] ? nodeNameDict['disease'][disease_id] : disease_id);\n                  const cropName =\n                    name && name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  return (\n                    <Option value={disease_id} key={`drug_${idx}`} label={name}>\n                      <div>\n                        <span>\n                          [{idx + 1}] <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span style={{ float: 'right' }}>\n                          score: {sigmoid(score).toFixed(3)}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        )}\n\n        <div className=\"dummy\" style={{ height: this.listHeight + 20 }} />\n        Minimum self-explaining edge score:\n        <Row gutter={20}>\n          <Col span={5}>\n            <InputNumber\n              value={edgeThreshold}\n              onChange={this.changeEdgeTHR}\n              style={{ width: '100%' }}\n              step={0.1}\n              min={0}\n              max={1}\n            />\n          </Col>\n          <Col span={16}>\n            <Slider\n              step={0.1}\n              value={1 - edgeThreshold}\n              min={0}\n              max={1}\n              onChange={this.changeRevEdgeTHR}\n              marks={{ 0: '1.0', 1: '0.0' }}\n              reverse={true}\n              tipFormatter={(value?: number) => {\n                return value && (1 - value).toFixed(1);\n              }}\n            />\n          </Col>\n        </Row>\n        <div className=\"nodeTypes\">\n          Node Types:\n          <br />\n          {nodeTypes.map((nodeType) => {\n            return (\n              <div key={nodeType} style={{ marginLeft: '5px' }}>\n                {/* <input type=\"checkbox\" style={{ margin: \"2px\" }} /> */}\n                <span\n                  style={{\n                    background: getNodeColor(nodeType),\n                    color: 'white',\n                    padding: '2px',\n                  }}\n                >\n                  {nodeType}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n        <br />\n        {/* <Button\n          icon={<SearchOutlined />}\n          type=\"primary\"\n          shape=\"round\"\n          onClick={() => this.startAnalysis()}\n        >\n          Show Attention Tree\n        </Button> */}\n        <br />\n      </Sider>\n    );\n\n    return sider;\n  }\n}\n\nexport default StateConsumer(DrugSider);\n","import React from 'react';\nimport NodeLink from 'components/TabContainer';\nimport DrugSider from 'components/Sider';\n\nimport { Layout, Modal } from 'antd';\nimport { InfoCircleOutlined, LinkOutlined } from '@ant-design/icons';\nimport './App.css';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\nimport { ACTION_TYPES, selectDisease, selectDrug, selectDrugPrimary, selectDiseaseSecondary, changeAppMode } from 'stores/actions';\nimport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestNodeNameDict,\n  requestDiseaseOptions,\n  requestDrugList,\n} from 'stores/DataService';\nimport { setNodeColor, LOADING_ICON, INIT_DRUG_PRIMARY, INIT_DISEASES, DEFAULT_APP_MODE } from 'helpers';\n\nconst { Header, Footer, Content } = Layout;\n\ninterface Props {\n  globalState: IState;\n  dispatch: IDispatch;\n}\ninterface State {\n  width: number;\n  height: number;\n  isModalVisible: boolean;\n}\n\nclass App extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      isModalVisible: false,\n    };\n\n    this.updateSize = this.updateSize.bind(this);\n  }\n\n  showModal = () => {\n    this.setState({ isModalVisible: true });\n  };\n\n  hideModal = () => {\n    this.setState({ isModalVisible: false });\n  };\n\n  updateSize() {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    });\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.updateSize);\n\n    requestNodeTypes()\n      .then((nodeTypes) => {\n        setNodeColor(nodeTypes);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Types,\n          payload: { nodeTypes },\n        });\n      })\n      .then(() => requestEdgeTypes())\n      .then((edgeTypes) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Edge_Types,\n          payload: { edgeTypes },\n        });\n      })\n      .then(() => requestNodeNameDict())\n      .then((nodeNameDict) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Name_Dict,\n          payload: { nodeNameDict },\n        });\n      })\n      .then(() => requestDiseaseOptions())\n      .then((diseaseOptions) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Disease_Options,\n          payload: { diseaseOptions },\n        });\n      })\n      .then(() => requestDrugList())\n      .then((drugList) => {\n        // Load available drugs for selection\n        const drugOptions = drugList.map(d => d.id);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions },\n        });\n      })\n      // Initialize in drug-to-disease mode with Inebilizumab\n      .then(() => {\n        changeAppMode(DEFAULT_APP_MODE, this.props.dispatch);\n      })\n      .then(() => selectDrugPrimary(INIT_DRUG_PRIMARY, this.props.dispatch))\n      .then(() => {\n        // Select first disease prediction\n        if (INIT_DISEASES.length > 0) {\n          selectDiseaseSecondary(INIT_DISEASES[0], INIT_DRUG_PRIMARY, true, this.props.dispatch);\n        }\n      })\n      .then(() => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Set_Loading_Status,\n          payload: { isInitializing: false },\n        });\n      });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateSize);\n  }\n\n  render() {\n    let siderWidth = 380,\n      footHeight = 20,\n      mainViewWidth = Math.max(0, window.innerWidth - siderWidth),\n      headerHeight = 64,\n      mainViewHeight = Math.max(0, window.innerHeight - headerHeight - footHeight);\n\n    const { isInitializing } = this.props.globalState;\n\n    let header = (\n      <Header className=\"header\" style={{ height: headerHeight }}>\n        <img\n          src=\"favicon.ico\"\n          style={{ height: headerHeight * 0.8, padding: '2px 10px' }}\n          alt=\"logo\"\n        />\n        <b style={{ fontSize: '30px' }}>Amgen Drugs and candidate Diseases Explorer</b>\n        <span\n          style={{ float: 'right', cursor: 'pointer' }}\n          onClick={this.showModal}\n        >\n          <InfoCircleOutlined\n            style={{ height: headerHeight, fontSize: '20px' }}\n          />\n          <span\n            style={{\n              paddingLeft: '5px',\n              fontSize: '18px',\n              height: headerHeight,\n            }}\n          >\n            About\n          </span>{' '}\n        </span>\n      </Header>\n    );\n\n    return (\n      <>\n        <Layout>\n          {header}\n\n          <Layout>\n            <DrugSider siderWidth={siderWidth} />\n            <Content className=\"main\" style={{ height: mainViewHeight }}>\n              <NodeLink width={mainViewWidth} height={mainViewHeight - footHeight} />\n              <Footer\n                style={{\n                  textAlign: 'center',\n                  color: 'gray',\n                  height: footHeight,\n                  padding: 0,\n                }}\n              >\n\n                <span style={{ color: 'gray' }}>\n                  {' '}\n                  <b onClick={this.showModal} style={{ cursor: 'help' }}>\n                    DISCLAIMER:\n                  </b>\n                  THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE{' '}\n                </span>\n              </Footer>\n            </Content>\n          </Layout>\n        </Layout>\n\n        {isInitializing && (\n          <svg\n            width={window.innerWidth}\n            height={window.innerHeight}\n            style={{ position: 'absolute', left: 0, top: 0 }}\n          >\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={window.innerWidth}\n                height={window.innerHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${window.innerWidth / 2}, ${window.innerHeight / 2\n                  })`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          </svg>\n        )}\n\n        <Modal\n          title=\"About Amgen Drugs and candidate Diseases Explorer\"\n          className=\"about-modal\"\n          visible={this.state.isModalVisible}\n          footer={null}\n          onCancel={this.hideModal}\n          zIndex={1099}\n          width={window.innerWidth * 0.5}\n        >\n          <h3>About</h3>\n          <p>\n            This Drug and Diseases Explorer provides a visual interface to interact with the predictions and explanations of an AI model that identify candidate diseases with limited treatment options and minimal molecular understanding for a given Drug.\n          </p>\n          <p>\n            AI model is a graph neural network pre-trained on a comprehensive knowledge graph of 17,080 clinically-recognized diseases and 7,957 therapeutic candidates. The model can process various therapeutic tasks in a unified formulation. Once trained, the model can perform zero-shot inference on new diseases without the need for additional parameters or fine-tuning on ground truth labels.\n          </p>\n\n          <h3>Medical Advice Disclaimer</h3>\n          <p>\n            DISCLAIMER: THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE\n            <br />\n            The information, including but not limited to, text, graphics, images and other material contained on this website are for informational purposes only. No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment. Always seek the advice of your physician or other qualified health care provider with any questions you may have regarding a medical condition or treatment and before undertaking a new health care regimen, and never disregard professional medical advice or delay in seeking it because of something you have read on this website.\n          </p>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'antd/dist/antd.css';\nimport { StateProvider } from 'stores';\n\nReactDOM.render(\n  <StateProvider>\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>\n  </StateProvider>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}