{"version":3,"sources":["stores/DataService.ts","Const.ts","stores/actions.ts","stores/reducer.ts","stores/index.tsx","helpers/text.ts","helpers/icon.tsx","helpers/color.ts","helpers/index.ts","components/TabContainer/AttentionTree.tsx","components/TabContainer/Graph.tsx","components/CardContainer/Scatter.tsx","components/CardContainer/lasso.js","components/TabContainer/PathMatrix.tsx","components/TabContainer/index.tsx","components/Sider/index.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["axiosInstance","axios","create","baseURL","withCredentials","headers","requestNodeTypes","a","get","response","data","requestEdgeTypes","requestNodeNameDict","requestAttentionPair","diseaseID","drugID","url","requestDiseaseOptions","diseaseOptions","requestDrugPredictions","predictions","requestDiseasePredictions","requestEmbedding","drugId","requestDrugList","ACTION_TYPES","selectDrug","selectedDrug","selectedDisease","isAdd","dispatch","modifyAttentionPaths","changeDrug","selectDrugPrimary","type","payload","isDiseaseLoading","selectedDrugPrimary","undefined","then","res","diseasePredictions","map","d","selected","changeAppMode","mode","appMode","fetch","json","drugs","drugOptions","selectDiseaseSecondary","diseaseNodeId","nodeIdForAttention","diseaseId","key","groupKey","isAttentionLoading","attention","metaPathGroups","groupMetaPaths","metapaths","paths","groups","groupDict","forEach","path","hide","nodeTypeString","nodes","nodeType","join","groupIdx","indexOf","push","nodeTypes","toggleDrugSelection","drugPredictions","id","updateMetaPathSummary","oldSummary","currentMetaPaths","newSummary","metaPath","count","length","sharedMeta","find","sum","idx","filter","isAddDrug","includes","rootReducer","state","action","edgeTypes","metaPathSummary","nodeNameDict","selectedPathNodes","edgeThreshold","JSON","parse","stringify","keyToDelete","updatedDiseasePredictions","initialState","isInitializing","isDrugLoading","GlobalStore","createContext","StateProvider","props","React","useReducer","dispatchBase","useCallback","asyncer","Provider","value","children","StateConsumer","Component","Consumer","context","globalState","cropText","text","fontSize","maxWidth","fontWeight","returnText","document","createElement","getContext","font","width","measureText","i","prevText","substr","concat","currText","prevWidth","currWidth","getTextWidth","LOADING_ICON","textAnchor","x","y","height","fill","attributeType","attributeName","values","begin","dur","repeatCount","COLORS","colorDict","getNodeColor","Object","keys","pruneEdge","node","threshold","score","sigmoid","t","Math","pow","E","removeDiseaseList","INIT_DISEASES","INIT_DRUGS","AttentionTree","nodeHeight","labelLength","midGap","nodeAttention","stepGap","this","nodeAttentionFiltered","rootNode","d3","root","nodeSize","d3Tree","linkGene","source","target","maxScore","max","links","link","widthScale","domain","range","edgeInfo","replace","title","nodeId","destroyTooltipOnHide","className","stroke","strokeWidth","opacity","allY","descendants","minY","min","nodeFullName","nodeShortName","tooltipTitle","icon_path","isHighlighted","mouseEnterDelay","transform","cursor","depth","content","heights","nodeKey","drawNodeAttentionHorizontal","selectedItems","drawSubgraph","graphHeight","ModelNodeForce","padding","RADIUS","prevNodes","prevLinks","simulation","force","strength","distance","radius","alphaDecay","velocityDecay","svgNodes","svgLinks","attr","select","active","alpha","restart","fx","fy","selectedIds","desNodes","prevNode","desLinks","sourceData","targetData","selectedIdx","getNodeLinks","selectAll","enter","append","on","transition","delay","call","dragstarted","bind","dragged","dragended","update","exit","remove","classed","isTargetNode","textlabel","isHidden","ticked","updateVisibility","style","visibleNodes","flatTree","drawGraph","prevProps","prevGroups","prevThreshold","prevAttention","currGroups","currNodes","currThreshold","currAttention","prevGroupKeys","sort","currGroupKeys","prevAttentionKeys","currAttentionKeys","updateNodeLabel","selectedDrugs","reminderText","circleRadius","hoverTimeout","WAIT","embedding","tooltip","visible","info","position","onChangeDrug","setState","loadEmbedding","selectedDrugIds","svg","lasso_area","mylasso","targetArea","items","closePathDistance","closePathSelect","isPathClosed","hoverSelect","start","draw","end","lasso","_this","tpath","origin","torigin","drawnCoords","g","dyn_path","close_path","origin_node","dragAction","drag","e","__lasso","possible","loopSelect","box","getBoundingClientRect","lassoPoint","round","left","top","selection","sourceEvent","touches","clientX","clientY","tx","ty","sqrt","close_draw_path","n","classifyPoint","_","arguments","possibleItems","notPossibleItems","notSelectedItems","types","_groups","attributes","xDomain","yDomain","xScale","yScale","diseaseIds","node_id","selectedDiseaseIds","getSortIndex","b","isSelected","cx","cy","r","onDoubleClick","onChangeDisease","onClick","showTooltip","isAddDisease","window","setTimeout","diseaseName","clearTimeout","drawScatter","prop","TITLE_HEIGHT","MARGIN","PADDING","EDGE_LENGTH","NODE_WIDTH","NODE_HEIGHT","VERTICAL_GAP","GROUP_GAP","COUNT_GAP","HEAD_HEIGHT","ICON_GAP","offsetY","expand","isModalVisible","showModal","hideModal","filterMetaPathGroups","flag","doesExist","toggleHideFunc","isHide","nameType","item","name","COUNT_WIDTH","getCountWidth","maxCount","flat","rScale","allRows","summary","nodeIdx","translate","rx","edges","Array","edgeIdx","x1","y1","x2","y2","currentY","differentChildren","childrenOffsetY","showChildren","lastMetaPath","diseaseIndex","metaPaths","drugRank","prediction","shortDiseaseName","slice","drawChildrenPaths","numOfChildren","childrenHeight","diseaseLabel","drawMetaCount","toggleExpand","getMetaIconGroup","toggleMetaPathHide","header","drawHeader","selectedId","prevPredictions","currPredictions","expandStatus","vis","predictionId","num","every","prevPath","filteredMetaPaths","childIdx","edgeScores","s","pathWeight","reduce","toFixed","toString","nodeName","shortNodeName","open","weightLabel","edge","edgeName","edgeShortName","getIconGroup","filteredMetaGroups","k","metaPathGroup","svgWidth","matrixRowsCount","matrixGroupsCount","matrixHeight","svgOuterHeight","svgHeight","drawSummary","onOk","onCancel","okText","zIndex","TabPane","Tabs","titleHeight","margin","activeTab","cardWidth","cardHeight","size","activeKey","marginBottom","backgroundColor","tabBarStyle","onChange","changeActiveTab","tab","overflowY","Sider","Layout","Option","Select","listHeight","changeEdgeTHR","changeRevEdgeTHR","onChangeAppMode","onChangeDrugPrimary","onChangeDiseaseSecondary","selectedDiseases","prevSelectedDiseases","currentDisease","diseasePrediction","prevSelectedDrugs","currentDrug","selectDisease","siderWidth","currentMode","untreatable_disease_icon","QuestionCircleOutlined","color","known_drug_icon","CheckCircleOutlined","theme","textAlign","Group","Button","defaultValue","showSearch","optionFilterProp","disease","toLowerCase","str","treatable","cropName","label","charAt","toUpperCase","menuItemSelectedIcon","drug_id","known","float","placeholder","dropdownStyle","maxHeight","overflow","virtual","localeCompare","displayName","disabled","disease_id","gutter","span","step","marks","0","1","reverse","tipFormatter","marginLeft","background","Header","Footer","Content","innerWidth","innerHeight","updateSize","addEventListener","setNodeColor","drugList","removeEventListener","mainViewWidth","mainViewHeight","src","headerHeight","alt","InfoCircleOutlined","paddingLeft","footer","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.e36eb74c.chunk.js","sourcesContent":["import axios from 'axios';\nimport { IAttentionTree, IEdgeTypes, IPath, IState } from 'types';\nimport { SERVER_URL } from 'Const';\n\nconst axiosInstance = axios.create({\n  baseURL: `${SERVER_URL}/`,\n  // timeout: 1000,\n  withCredentials: false,\n  headers: {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'GET,PUT,POST,DELETE,PATCH,OPTIONS',\n  },\n});\n\nconst requestNodeTypes = async (): Promise<string[]> => {\n  const url = './txgnn_data/node_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestEdgeTypes = async (): Promise<IEdgeTypes> => {\n  const url = './txgnn_data/edge_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestNodeNameDict = async () => {\n  const url = './api/node_name_dict';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttention = async (diseaseID: string, drugID: string) => {\n  const url = `./api/attention?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttentionPair = async (\n  diseaseID: string,\n  drugID: string\n): Promise<{ attention: { [k: string]: IAttentionTree }; metapaths: IPath[] }> => {\n  const url = `./api/attention_pair?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestDiseaseOptions = async () => {\n  // // // the ranking is too costy\n  const url = './api/diseases';\n  const response = await axiosInstance.get(url);\n  const diseaseOptions: IState['diseaseOptions'] = response.data;\n\n  // const urlRanking = './txgnn_data/disease_ranking.json';\n  // let rank = await axiosInstance.get(urlRanking);\n  // const ranking = rank.data;\n\n  // diseaseOptions.sort((a, b) => ranking.indexOf(a[0]) - ranking.indexOf(b[0]));\n  // const urlRanking = './txgnn_data/disease_options.json'; // ranking is too costy, use pre-processed data\n  // let res = await axiosInstance.get(urlRanking);\n\n  return diseaseOptions;\n};\n\nconst requestDrugPredictions = async (diseaseID: string) => {\n  const url = `./api/drug_predictions?disease_id=${diseaseID}`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  return predictions;\n};\n\nconst requestDiseasePredictions = async (drugID: string) => {\n  const url = `./api/disease_predictions?drug_id=${drugID}&top_n=30`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  return predictions;\n};\n\nconst requestEmbedding = async (drugId?: string) => {\n  // Request drug-specific disease embeddings from API\n  const url = drugId \n    ? `./api/disease_embeddings?drug_id=${drugId}`\n    : './data/disease_tsne.json';\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestDrugList = async (): Promise<{id: string, name: string}[]> => {\n  // Get list of available drugs from API\n  const url = './api/drug_list';\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\nexport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestAttention,\n  requestNodeNameDict,\n  requestDrugPredictions,\n  requestDiseaseOptions,\n  requestEmbedding,\n  requestAttentionPair,\n  requestDiseasePredictions,\n  requestDrugList,\n};\n","const STATIC_URL =\n  process.env.NODE_ENV === 'development'\n    ? `http://localhost:${process.env.REACT_APP_PORT}`\n    : './';\n\nconst SERVER_URL =\n  process.env.NODE_ENV === 'development' ? `http://localhost:8002` : './';\n\nexport { STATIC_URL, SERVER_URL };\n","import {\n  DrugPrediction,\n  IDispatch,\n  IPath,\n  IMetaPath,\n  IMetaPathSummary,\n} from 'types';\nimport {\n  requestAttentionPair,\n  requestDrugPredictions,\n  requestDiseasePredictions,\n} from 'stores/DataService';\n\nexport const ACTION_TYPES = {\n  Load_Node_Types: 'Load_Node_Types',\n  Load_Edge_Types: 'Load_Edge_Types',\n  Load_Meta_Paths: 'Load_Meta_Paths',\n  Add_Attention_Paths: 'Add_Attention_Paths',\n  Del_Attention_Paths: 'Del_Attention_Paths',\n  Load_Node_Name_Dict: 'Load_Node_Name_Dict',\n  Load_Drug_Options: 'Load_Drug_Options',\n  Load_Disease_Options: 'Load_Disease_Options',\n  Load_Disease_Predictions: 'Load_Disease_Predictions',\n  Load_Drug_List: 'Load_Drug_List',\n\n  Set_Loading_Status: 'Set_Loading_Status',\n\n  Change_Edge_THR: 'Change_Edge_THR',\n  Change_Drug: 'Change_Drug',\n  Change_Disease: 'Change_Disease',\n  Change_App_Mode: 'Change_App_Mode',\n  Change_Selected_Drug_Primary: 'Change_Selected_Drug_Primary',\n  Select_Path_Noes: 'Select_Path_Nodes',\n\n  Toggle_Meta_Path_Hide: 'Toggle_Meta_Path_Hide',\n  Toggle_Disease_Selection: 'Toggle_Disease_Selection',\n};\n\nexport const selectDrug = (\n  selectedDrug: string,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch\n) => {\n  if (selectedDisease) {\n    modifyAttentionPaths(selectedDrug, selectedDisease, isAdd, dispatch);\n    changeDrug(selectedDrug, dispatch);\n  }\n};\n\nexport const selectDisease = (selectedDisease: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDrugLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: undefined },\n  });\n\n  return requestDrugPredictions(selectedDisease)\n    .then((res) => {\n      const predictions = res.predictions;\n      const drugPredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Drug_Options,\n        payload: { drugPredictions },\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDrugLoading: false },\n      });\n    });\n};\n\nexport const selectDrugPrimary = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDiseaseLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Selected_Drug_Primary,\n    payload: { selectedDrugPrimary: selectedDrug },\n  });\n\n  // Clear previous selections\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: undefined },\n  });\n\n  // Fetch disease predictions\n  return requestDiseasePredictions(selectedDrug)\n    .then((res) => {\n      const predictions = res.predictions;\n      const diseasePredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Disease_Predictions,\n        payload: { diseasePredictions },\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDiseaseLoading: false },\n      });\n    });\n};\n\nexport const changeAppMode = (mode: 'disease-to-drug' | 'drug-to-disease', dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_App_Mode,\n    payload: { appMode: mode },\n  });\n\n  // Load drug list if switching to drug-to-disease and list is empty\n  if (mode === 'drug-to-disease') {\n    fetch(`http://127.0.0.1:8002/api/drugs`)\n      .then((response) => response.json())\n      .then((drugs) => {\n        dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions: drugs },\n        });\n      });\n  }\n};\n\nexport const selectDiseaseSecondary = (\n  selectedDisease: string,  // disease_id for selection toggle\n  selectedDrugPrimary: string,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  diseaseNodeId?: string  // Optional: node_id for attention API (defaults to selectedDisease)\n) => {\n  const nodeIdForAttention = diseaseNodeId || selectedDisease;\n  \n  // Toggle disease selection state (uses disease_id)\n  dispatch({\n    type: ACTION_TYPES.Toggle_Disease_Selection,\n    payload: { diseaseId: selectedDisease },\n  });\n\n  // Update selected disease in state\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: nodeIdForAttention },\n  });\n\n  // Ensure primary drug is set as selectedDrug for attention paths\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: selectedDrugPrimary },\n  });\n\n  // Use node_id for attention API, disease_id as the groupKey\n  modifyAttentionPaths(selectedDrugPrimary, nodeIdForAttention, isAdd, dispatch, selectedDisease);\n};\n\nconst modifyAttentionPaths = (\n  selectedDrug: string | undefined,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  key?: string // Optional key to use for metaPathGroups (defaults to selectedDrug)\n) => {\n  const groupKey = key || selectedDrug;\n  if (selectedDrug !== undefined && selectedDisease !== undefined && groupKey !== undefined) {\n    if (isAdd) {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isAttentionLoading: true },\n      });\n\n      requestAttentionPair(selectedDisease, selectedDrug)\n        .then((res) => {\n          dispatch({\n            type: ACTION_TYPES.Add_Attention_Paths,\n            payload: {\n              attention: res.attention,\n              selectedDrug: groupKey, // Use groupKey as the identifier for adding/removing\n              metaPathGroups: { [groupKey]: groupMetaPaths(res.metapaths) },\n            },\n          });\n        })\n        .then(() => {\n          dispatch({\n            type: ACTION_TYPES.Set_Loading_Status,\n            payload: { isAttentionLoading: false },\n          });\n        });\n    } else {\n      dispatch({\n        type: ACTION_TYPES.Del_Attention_Paths,\n        payload: {\n          selectedDrug: groupKey,\n        },\n      });\n    }\n  }\n};\n\nconst changeDrug = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug },\n  });\n};\n\nconst groupMetaPaths = (paths: IPath[]): IMetaPath[] => {\n  let groups: IMetaPath[] = [];\n  let groupDict: string[] = [];\n  paths.forEach((path) => {\n    path.hide = false; // initi, show all metapaths\n    const nodeTypeString = path.nodes.map((d) => d.nodeType).join('_');\n    const groupIdx = groupDict.indexOf(nodeTypeString);\n    if (groupIdx > -1) {\n      groups[groupIdx].paths.push(path);\n    } else {\n      groupDict.push(nodeTypeString);\n      groups.push({\n        nodeTypes: path.nodes.map((d) => d.nodeType),\n        paths: [path],\n      });\n    }\n  });\n  return groups;\n};\n\nexport const toggleMetaPathHide = (\n  metaPathSummary: IMetaPathSummary[],\n  idx: number,\n  hide: boolean,\n  dispatch: IDispatch\n) => {\n  metaPathSummary[idx]['hide'] = hide;\n  dispatch({\n    type: ACTION_TYPES.Toggle_Meta_Path_Hide,\n    payload: { metaPathSummary },\n  });\n};\n","import { IState, IAction, IMetaPathSummary, IMetaPath } from 'types';\nimport { ACTION_TYPES } from 'stores/actions';\n\nconst rootReducer = (state: IState, action: IAction): IState => {\n  switch (action.type) {\n    case ACTION_TYPES.Load_Drug_Options:\n      return {\n        ...state,\n        drugPredictions: action.payload.drugPredictions,\n      };\n\n    case ACTION_TYPES.Load_Disease_Options:\n      return { ...state, diseaseOptions: action.payload.diseaseOptions };\n\n    case ACTION_TYPES.Load_Node_Types:\n      return { ...state, nodeTypes: action.payload.nodeTypes };\n\n    case ACTION_TYPES.Load_Edge_Types:\n      return { ...state, edgeTypes: action.payload.edgeTypes };\n\n    case ACTION_TYPES.Change_Disease:\n      return {\n        ...state,\n        selectedDisease: action.payload.selectedDisease,\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Change_Drug:\n      return {\n        ...state,\n        drugPredictions: toggleDrugSelection(\n          state.drugPredictions,\n          action.payload.selectedDrug\n        ),\n      };\n\n    case ACTION_TYPES.Load_Node_Name_Dict:\n      return { ...state, nodeNameDict: action.payload.nodeNameDict };\n\n    case ACTION_TYPES.Set_Loading_Status:\n      return { ...state, ...action.payload };\n\n    case ACTION_TYPES.Select_Path_Noes:\n      return { ...state, selectedPathNodes: action.payload.selectedPathNodes };\n\n    case ACTION_TYPES.Change_Edge_THR: {\n      return { ...state, edgeThreshold: action.payload.edgeThreshold };\n    }\n\n    case ACTION_TYPES.Toggle_Meta_Path_Hide: {\n      return { ...state, metaPathSummary: action.payload.metaPathSummary };\n    }\n\n    case ACTION_TYPES.Add_Attention_Paths: {\n      return {\n        ...state,\n        attention: { ...state.attention, ...action.payload.attention },\n        metaPathGroups: {\n          ...state.metaPathGroups,\n          ...action.payload.metaPathGroups,\n        },\n        metaPathSummary: updateMetaPathSummary(\n          state.metaPathSummary,\n          action.payload.metaPathGroups[action.payload.selectedDrug],\n          action.payload.selectedDrug,\n          true // whether add new drug\n        ),\n      };\n    }\n\n    case ACTION_TYPES.Del_Attention_Paths: {\n      // deep copy\n      let attention = JSON.parse(JSON.stringify(state.attention)),\n        metaPathGroups = JSON.parse(JSON.stringify(state.metaPathGroups));\n\n      const keyToDelete = action.payload.selectedDrug;\n      // In drug-to-disease mode, the key is a disease ID\n      // Delete both possible attention keys (disease:X and drug:X)\n      delete attention[`disease:${keyToDelete}`];\n      delete attention[`drug:${keyToDelete}`];\n      delete metaPathGroups[keyToDelete];\n      return {\n        ...state,\n        attention,\n        metaPathGroups,\n        metaPathSummary: updateMetaPathSummary(\n          state.metaPathSummary,\n          metaPathGroups[keyToDelete],\n          keyToDelete,\n          false // whether add new drug\n        ),\n      };\n    }\n\n    case ACTION_TYPES.Change_App_Mode:\n      return { ...state, appMode: action.payload.appMode };\n\n    case ACTION_TYPES.Change_Selected_Drug_Primary:\n      return {\n        ...state,\n        selectedDrugPrimary: action.payload.selectedDrugPrimary,\n        diseasePredictions: [], // Clear previous predictions\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Load_Disease_Predictions:\n      return { ...state, diseasePredictions: action.payload.diseasePredictions };\n\n    case ACTION_TYPES.Toggle_Disease_Selection: {\n      const diseaseId = action.payload.diseaseId;\n      const updatedDiseasePredictions = state.diseasePredictions.map((d) => {\n        // Match by d.id (the disease_id used in the Select component)\n        if (d.id === diseaseId) {\n          return { ...d, selected: !d.selected };\n        }\n        return d;\n      });\n      return { ...state, diseasePredictions: updatedDiseasePredictions };\n    }\n\n    case ACTION_TYPES.Load_Drug_List:\n      return { ...state, drugOptions: action.payload.drugOptions };\n\n    default:\n      return state;\n  }\n};\n\nconst toggleDrugSelection = (\n  drugPredictions: IState['drugPredictions'],\n  selectedDrug: string\n) => {\n  return drugPredictions.map((d) => {\n    return {\n      ...d,\n      selected: selectedDrug === d.id ? !d.selected : d.selected,\n    };\n  });\n};\n\nconst updateMetaPathSummary = (\n  oldSummary: IMetaPathSummary[],\n  currentMetaPaths: IMetaPath[],\n  drugId: number,\n  isAdd: boolean\n) => {\n  let newSummary = oldSummary.map((d) => d);\n\n  // if add new drug\n  if (isAdd) {\n    currentMetaPaths.forEach((metaPath) => {\n      let count = metaPath.paths.length;\n      let sharedMeta = newSummary.find(\n        (d) => d.nodeTypes.join() === metaPath.nodeTypes.join()\n      );\n      if (sharedMeta) {\n        // if shared meta path exists\n        sharedMeta.count[drugId] = count;\n        sharedMeta.sum += count;\n      } else {\n        // if shared meta path does not exist\n        newSummary.push({\n          nodeTypes: metaPath.nodeTypes,\n          count: { [drugId]: count },\n          sum: count,\n          hide: false,\n          idx: newSummary.length,\n        });\n      }\n    });\n  } else {\n    // if delete existing drug\n\n    newSummary.forEach((metaPath) => {\n      if (drugId in metaPath.count) {\n        metaPath.sum -= metaPath.count[drugId];\n        delete metaPath.count[drugId];\n      }\n    });\n\n    newSummary = newSummary.filter((d) => d.sum > 0);\n  }\n\n  return newSummary;\n};\n\nexport const isAddDrug = (\n  drugPredictions: IState['drugPredictions'],\n  drugID: string\n) => {\n  return !drugPredictions\n    .filter((d) => d.selected)\n    .map((d) => d.id)\n    .includes(drugID);\n};\n\nexport const isAddDisease = (\n  diseasePredictions: IState['diseasePredictions'],\n  diseaseID: string\n) => {\n  return !diseasePredictions\n    .filter((d) => d.selected)\n    .map((d) => d.node_id || d.id)\n    .includes(diseaseID);\n};\n\nexport default rootReducer;\n","import React, { createContext } from 'react';\nimport rootReducer from './reducer';\nimport { IState } from 'types';\n\nconst initialState: IState = {\n  diseaseOptions: [],\n  drugPredictions: [],\n  nodeTypes: [],\n  edgeTypes: {},\n  metaPathGroups: {},\n  attention: {},\n  selectedDisease: undefined,\n  nodeNameDict: {},\n  isInitializing: true,\n  isDrugLoading: false,\n  isAttentionLoading: false,\n  isDiseaseLoading: false,\n  edgeThreshold: 0,\n  metaPathSummary: [],\n  selectedPathNodes: [],\n  drugOptions: [],\n  diseasePredictions: [],\n  selectedDrugPrimary: undefined,\n  appMode: 'disease-to-drug',\n};\n\ninterface IStateContext {\n  state: IState;\n  dispatch: ({ type }: { type: string }) => void;\n}\n\nconst GlobalStore = createContext({} as IStateContext);\n\n// An wrapping function to handle thunks (dispatched actions which are wrapped in a function, needed for async callbacks)\nconst asyncer = (dispatch: any, state: IState) => (action: any) =>\n  typeof action === 'function' ? action(dispatch, state) : dispatch(action);\n\n// The StateProvider component to provide the global state to all child components\nexport function StateProvider(props: any) {\n  const [state, dispatchBase] = React.useReducer(rootReducer, initialState);\n\n  const dispatch = React.useCallback(asyncer(dispatchBase, state), []);\n\n  return (\n    <GlobalStore.Provider value={{ state, dispatch }}>\n      {props.children}\n    </GlobalStore.Provider>\n  );\n}\n\nexport function StateConsumer(Component: any) {\n  return function WrapperComponent(props: any) {\n    return (\n      <GlobalStore.Consumer>\n        {(context) => (\n          <Component\n            {...props}\n            globalState={context.state}\n            dispatch={context.dispatch}\n          />\n        )}\n      </GlobalStore.Consumer>\n    );\n  };\n}\n","const cropText = (\n  text: string,\n  fontSize: number,\n  maxWidth: number,\n  fontWeight: number = 800\n): string => {\n  let returnText = text;\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontWeight} ${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  if (width > maxWidth) {\n    for (let i = 1; i < text.length; i += 1) {\n      const prevText = text.substr(0, i - 1).concat('...');\n      const currText = text.substr(0, i).concat('...');\n      const prevWidth = context.measureText(prevText).width;\n      const currWidth = context.measureText(currText).width;\n      if (currWidth > maxWidth && prevWidth < maxWidth) {\n        returnText = prevText;\n        break;\n      }\n    }\n  }\n  return returnText;\n};\n\nconst getTextWidth = (text: string, fontSize: number): number => {\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  return width;\n};\n\nexport { cropText, getTextWidth };\n","import React from 'react';\n\nconst VIRUS_ICON =\n  'M 483.55 227.55 H 462 c -50.68 0 -76.07 -61.27 -40.23 -97.11 L 437 115.19 A 28.44 28.44 0 0 0 396.8 75 L 381.56 90.22 c -35.84 35.83 -97.11 10.45 -97.11 -40.23 V 28.44 a 28.45 28.45 0 0 0 -56.9 0 V 50 c 0 50.68 -61.27 76.06 -97.11 40.23 L 115.2 75 A 28.44 28.44 0 0 0 75 115.19 l 15.25 15.25 c 35.84 35.84 10.45 97.11 -40.23 97.11 H 28.45 a 28.45 28.45 0 1 0 0 56.89 H 50 c 50.68 0 76.07 61.28 40.23 97.12 L 75 396.8 A 28.45 28.45 0 0 0 115.2 437 l 15.24 -15.25 c 35.84 -35.84 97.11 -10.45 97.11 40.23 v 21.54 a 28.45 28.45 0 0 0 56.9 0 V 462 c 0 -50.68 61.27 -76.07 97.11 -40.23 L 396.8 437 A 28.45 28.45 0 0 0 437 396.8 l -15.25 -15.24 c -35.84 -35.84 -10.45 -97.12 40.23 -97.12 h 21.54 a 28.45 28.45 0 1 0 0 -56.89 Z M 224 272 a 48 48 0 1 1 48 -48 A 48 48 0 0 1 224 272 Z m 80 56 a 24 24 0 1 1 24 -24 A 24 24 0 0 1 304 328 Z';\n\nconst YES_ICON =\n    'M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z',\n  NO_ICON =\n    'M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z';\n\nconst DRUG_ICON =\n  'M 555.3 300.1 L 424.2 112.8 C 401.9 81 366.4 64 330.4 64 c -22.6 0 -45.5 6.7 -65.5 20.7 c -19.7 13.8 -33.7 32.8 -41.5 53.8 C 220.5 79.2 172 32 112 32 C 50.1 32 0 82.1 0 144 v 224 c 0 61.9 50.1 112 112 112 s 112 -50.1 112 -112 V 218.9 c 3.3 8.6 7.3 17.1 12.8 25 L 368 431.2 c 22.2 31.8 57.7 48.8 93.8 48.8 c 22.7 0 45.5 -6.7 65.5 -20.7 c 51.7 -36.2 64.2 -107.5 28 -159.2 Z M 160 256 H 64 V 144 c 0 -26.5 21.5 -48 48 -48 s 48 21.5 48 48 v 112 Z m 194.8 44.9 l -65.6 -93.7 c -7.7 -11 -10.7 -24.4 -8.3 -37.6 c 2.3 -13.2 9.7 -24.8 20.7 -32.5 c 8.5 -6 18.5 -9.1 28.8 -9.1 c 16.5 0 31.9 8 41.3 21.5 l 65.6 93.7 l -82.5 57.7 Z';\n\nconst EDIT_ICON =\n  'M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z';\n\nconst SEARCH_ICON =\n  'M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z';\n\nconst LOADING_ICON = (\n  <g>\n    <text textAnchor=\"middle\" x=\"24\">\n      LOADING...\n    </text>\n    <rect x=\"0\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"20\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.2s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"40\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.4s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n  </g>\n);\n\nexport {\n  VIRUS_ICON,\n  YES_ICON,\n  NO_ICON,\n  DRUG_ICON,\n  EDIT_ICON,\n  LOADING_ICON,\n  SEARCH_ICON,\n};\n","const COLORS = [\n  '#4e79a7', // \"anatomy\",\n  '#edc949', // \"biological_process\",\n  '#e15759', // \"cellular_component\",\n  '#f28e2c', // \"disease\",\n  '#76b7b2', // \"drug\",\n  '#59a14f', // \"effect/phenotype\",\n  '#af7aa1', // \"exposure\",\n  '#ff9da7', // \"gene/protein\",\n  '#9c755f', // \"molecular_function\",\n  '#bab0ab', // \"pathway\"\n];\nlet colorDict: { [node: string]: string } = {};\n\nconst setNodeColor = (nodeTypes: string[]) => {\n  colorDict = {};\n  nodeTypes.forEach((nodeType, idx) => {\n    if (idx > COLORS.length - 1) {\n      idx = idx % (COLORS.length - 1);\n    }\n    colorDict[nodeType] = COLORS[idx];\n  });\n};\n\nconst getNodeColor = (nodeType: string) => {\n  if (colorDict[nodeType] === undefined) {\n    colorDict[nodeType] = COLORS[Object.keys(colorDict).length];\n  }\n\n  return colorDict[nodeType];\n};\n\nconst HIGHLIGHT_COLOR = '#1890ff';\nconst SELECTED_COLOR = 'black';\n\nexport { setNodeColor, getNodeColor, HIGHLIGHT_COLOR, SELECTED_COLOR };\n","import { IAttentionTree } from 'types';\nexport { cropText, getTextWidth } from './text';\nexport * from './icon';\n\nexport {\n  setNodeColor,\n  getNodeColor,\n  HIGHLIGHT_COLOR,\n  SELECTED_COLOR,\n} from './color';\n\nexport const pruneEdge = (\n  node: IAttentionTree,\n  threshold: number\n): IAttentionTree => {\n  if (node.children.length > 0) {\n    node = {\n      ...node,\n      children: node.children\n        .filter((d) => d.score >= threshold)\n        .map((node) => pruneEdge(node, threshold)),\n    };\n  }\n  return node;\n};\n\nexport const flatTree = (node: IAttentionTree): string[] => {\n  let res = [node.nodeId];\n  if (node.children.length > 0) {\n    res = res.concat(...node.children.map((d) => flatTree(d)));\n  }\n  return res;\n};\n\nexport const sigmoid = (t: number) => {\n  return 1 / (1 + Math.pow(Math.E, -t));\n};\n\nexport const removeDiseaseList = [\n  'mendelian disease',\n  'disease of cell nucleous',\n  'hip region disease',\n  'acute disease',\n  'vector borne disease',\n  'cancer',\n  'sex-linked disease',\n  'movement disorder',\n];\n\nexport const wheterRemoveDisease = (disease: string): boolean => {\n  if (!disease) return false;\n  return removeDiseaseList.includes(disease.toLowerCase());\n};\n\nexport const sentenceCapitalizer = (str: string) => {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n};\n\n// For drug-to-disease mode: use Inebilizumab (DB12530) as the primary drug\nexport const INIT_DRUG_PRIMARY = 'DB12530';  // Inebilizumab\n// Top disease predictions for this drug\nexport const INIT_DISEASES = ['15783', '7381', '15896'];  // Top predicted diseases\n\n// For backwards compatibility (disease-to-drug mode)\nexport const INIT_DISEASE = '15783';  // congenital anomaly of hepatic vein - first disease in our predictions\nexport const INIT_DRUGS = ['DB12530'];  // Inebilizumab\n\n// Default mode - start with drug-to-disease\nexport const DEFAULT_APP_MODE = 'drug-to-disease' as const;\n\n","import React from 'react';\nimport { IState, IAttentionTree } from 'types';\nimport * as d3 from 'd3';\nimport { Tooltip } from 'antd';\nimport { getNodeColor, pruneEdge } from 'helpers';\nimport {\n  cropText,\n  VIRUS_ICON,\n  DRUG_ICON,\n  getTextWidth,\n  LOADING_ICON,\n} from 'helpers';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n}\n\nexport default class AttentionTree extends React.Component<Props, {}> {\n  nodeHeight = 20;\n  fontSize = 14;\n  labelLength = 150;\n  midGap = 60; // the gaph between two trees\n  drawNodeAttentionHorizontal(\n    nodeAttention: IAttentionTree,\n    stepGap: number,\n    edgeThreshold: number\n  ) {\n    const { width } = this.props;\n    const {\n      nodeNameDict,\n      edgeTypes,\n      selectedPathNodes,\n    } = this.props.globalState;\n\n    let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n\n    const rootNode = d3.hierarchy(nodeAttentionFiltered);\n    const d3Tree = d3\n      .tree<IAttentionTree>()\n      .nodeSize([this.nodeHeight + 2, stepGap]);\n\n    const root = d3Tree(rootNode);\n\n    const linkGene = d3\n      .linkHorizontal<any, d3.HierarchyPointLink<IAttentionTree>, any>()\n      // modify the source and target x, y to make space for node\n      .source((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.source.y -\n            this.labelLength / 2\n            : d.source.y + this.labelLength / 2;\n        const newY = d.source.x;\n\n        return { x: newX, y: newY };\n      })\n      .target((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.target.y +\n            this.labelLength / 2\n            : d.target.y - this.labelLength / 2;\n        const newY = d.target.x;\n\n        return { x: newX, y: newY };\n      })\n      .x((d) => d.x)\n      .y((d) => d.y);\n\n    const maxScore = Math.max(\n      ...root.links().map((link) => link.target.data.score)\n    );\n\n    let widthScale = d3.scaleLinear().domain([0, maxScore]).range([1, 5]);\n\n    const links = root.links().map((link, i) => {\n      let edgeInfo = link.target.data.edgeInfo.replace('rev_', '');\n      if (edgeTypes[edgeInfo]) {\n        edgeInfo = edgeTypes[edgeInfo]['edgeInfo'] || edgeInfo;\n      }\n      return (\n        <Tooltip\n          title={edgeInfo}\n          key={`${link.source.data.nodeId}=>${link.target.data.nodeId}_link${i}`}\n          destroyTooltipOnHide\n        >\n          <g>\n            <path\n              d={linkGene(link)!}\n              className={`link ${link.source.data.nodeId}=>${link.target.data.nodeId}`}\n              fill=\"none\"\n              stroke=\"gray\"\n              strokeWidth={widthScale(link.target.data.score)}\n              opacity={selectedPathNodes.length > 0 ? 0.5 : 1}\n            />\n            <path\n              d={linkGene(link)!}\n              className=\"mask\"\n              fill=\"none\"\n              stroke=\"transparent\"\n              strokeWidth=\"3\"\n            />\n          </g>\n        </Tooltip>\n      );\n    });\n\n    const allY = root.descendants().map((node) => node.x);\n    const minY = Math.min(...allY);\n    const maxY = Math.max(...allY);\n\n    const height = maxY - minY + this.nodeHeight + 4; // default seperation in d3 tree is 2\n\n    const nodes = root.descendants().map((node, i) => {\n      let { nodeId, nodeType } = node.data;\n      let nodeFullName = nodeNameDict[nodeType][nodeId];\n      if (nodeFullName === undefined) {\n        nodeId = nodeId.replace(/_/g, '') + '.0'; // the id of a merged node is xxx_xxx_xxxx\n        nodeFullName = nodeNameDict[nodeType][nodeId];\n      }\n      let nodeShortName = cropText(\n        nodeFullName,\n        12,\n        this.labelLength - 25 - getTextWidth('..(0.00)', 14)\n      );\n      let tooltipTitle = nodeShortName?.includes('..') ? nodeFullName : '';\n      if (node.data.source) {\n        tooltipTitle = tooltipTitle ? `${tooltipTitle} (${node.data.source})` : `${nodeFullName} (${node.data.source})`;\n      }\n      let icon_path = '';\n      if (nodeType === 'disease') icon_path = VIRUS_ICON;\n      if (nodeType === 'drug') icon_path = DRUG_ICON;\n\n      const isHighlighted =\n        selectedPathNodes.length === 0 ||\n        (selectedPathNodes.map((d) => d.nodeType).includes(nodeType) &&\n          selectedPathNodes.map((d) => d.nodeId).includes(nodeId));\n\n      return (\n        <Tooltip\n          title={tooltipTitle}\n          key={`node${i}_${nodeFullName}`}\n          destroyTooltipOnHide\n          mouseEnterDelay={0.3}\n        >\n          <g\n            className={`${nodeId} node`}\n            transform={`translate(${root.data.nodeType === 'drug'\n              ? width / 2 - this.midGap / 2 - this.labelLength - node.y\n              : node.y\n              }, ${node.x})`}\n            cursor=\"pointer\"\n          >\n            <rect\n              width={this.labelLength}\n              height={this.nodeHeight}\n              fill={getNodeColor(nodeType)}\n              x={(-1 * this.labelLength) / 2}\n              y={-this.nodeHeight / 2}\n              opacity={isHighlighted ? 1 : 0.2}\n            />\n            <path\n              className=\"virus_icon\"\n              d={icon_path}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 2}, ${-this.nodeHeight / 2\n                }) scale(0.04)`}\n              fill=\"white\"\n            />\n            <text\n              fill=\"white\"\n              fontSize={this.fontSize}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 25}, ${(this.nodeHeight - this.fontSize) / 2\n                })`}\n            >\n              {/* {`${nodeShortName}\n                  ${node.depth > 0 ? ':' + node.data.score.toFixed(2) : ''}`} */}\n              {nodeShortName}\n            </text>\n            {node.depth === 0 && node.children === undefined && (\n              <text\n                fill=\"gray\"\n                fontSize={this.fontSize}\n                transform={`translate(${root.data.nodeType === 'drug'\n                  ? -this.labelLength / 2 - 10 - getTextWidth('No Attention Data', this.fontSize)\n                  : this.labelLength / 2 + 10\n                  }, ${(this.nodeHeight - this.fontSize) / 2})`}\n              >\n                No Attention Data\n              </text>\n            )}\n          </g>\n        </Tooltip>\n      );\n    });\n\n    return {\n      content: [\n        <g key=\"links\" className=\"links\">\n          {links}\n        </g>,\n        <g key=\"nodes\" className=\"nodes\">\n          {nodes}\n        </g>,\n      ],\n      height: height,\n    };\n  }\n  drawSubgraph() {\n    let { attention, edgeThreshold } = this.props.globalState;\n    let { width } = this.props;\n\n    let stepGap = (width - 2 * this.labelLength - this.midGap) / 4;\n    let heights = [0];\n    const content = Object.keys(attention).map((nodeKey: string, idx) => {\n      const { height, content } = this.drawNodeAttentionHorizontal(\n        attention[nodeKey],\n        stepGap,\n        edgeThreshold\n      );\n      heights.push(height);\n      return (\n        <g\n          className={nodeKey}\n          key={nodeKey}\n          transform={`translate(${((width + this.midGap) / 2) * idx + this.labelLength / 2\n            }, ${height / 2 + 2 * this.nodeHeight})`}\n        >\n          {content}\n        </g>\n      );\n    });\n    return { content, height: Math.max(...heights) };\n  }\n  render() {\n    const { width, height, globalState } = this.props;\n    const {\n      isAttentionLoading,\n      selectedDisease,\n      drugPredictions,\n      diseasePredictions,\n      appMode,\n    } = globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedItems = predictions.filter((d) => d.selected);\n\n    const { content, height: graphHeight } = this.drawSubgraph();\n    return (\n      <svg\n        width={width}\n        height={Math.max(graphHeight, height)}\n        className=\"nodeLink\"\n      >\n        {selectedItems.length > 0 && (appMode === 'drug-to-disease' ? true : selectedDisease) ? (\n          content\n        ) : (\n          <text x={width / 2} y={height / 2} fill=\"gray\">\n            Please select a disease and a drug first\n          </text>\n        )}\n        {isAttentionLoading ? (\n          <g>\n            <rect width={width} height={height} fill=\"white\" opacity={0.5} />\n            <g\n              transform={`translate(${width / 2}, ${height / 2})`}\n              textAnchor=\"middle\"\n            >\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <g />\n        )}\n      </svg>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as d3 from 'd3';\nimport { IAttentionTree, IState } from 'types';\nimport { flatTree, getNodeColor, pruneEdge, LOADING_ICON } from 'helpers';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n}\n\ninterface State { }\n\ninterface INode extends d3.SimulationNodeDatum {\n  id: string; // `${node_type}:${node_id}`\n  nodeId: string; //\n  nodeType: string; //\n  fx?: number;\n  fy?: number;\n}\n\ninterface ILink {\n  source: string;\n  target: string;\n  score: number;\n  edgeInfo: string;\n}\n\nexport default class ModelNodeForce extends React.Component<Props, State> {\n  public padding = 10;\n  RADIUS = 7;  // Smaller node radius for more compact view\n  prevNodes: INode[] = [];\n  prevLinks: ILink[] = [];\n  simulation: d3.Simulation<INode, ILink>;\n\n  constructor(props: Props) {\n    super(props);\n    \n    // Initialize simulation with animation\n    this.simulation = d3\n      .forceSimulation<INode, ILink>()\n      .force('charge', d3.forceManyBody<INode>().strength(-60))\n      .force(\n        'link',\n        d3\n          .forceLink<INode, ILink>()\n          .id((d) => d.id)\n          .distance(35)\n          .strength(0.6)\n      )\n      .force('collision', d3.forceCollide().radius(this.RADIUS + 2))\n      .force('center', d3.forceCenter(props.width / 2, props.height / 2))\n      .alphaDecay(0.02)  // Slower decay for smoother animation\n      .velocityDecay(0.3);  // Add some friction\n  }\n\n  ticked(\n    svgNodes: d3.Selection<\n      SVGGElement | d3.BaseType,\n      INode,\n      d3.BaseType,\n      unknown\n    >,\n    svgLinks: any\n  ) {\n    svgNodes.attr('transform', (d) => `translate(${d.x}, ${d.y})`);\n\n    svgLinks\n      .select('line.link')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('line.mask')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('text')\n      .attr('text-anchor', 'middle')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      );\n  }\n\n  dragstarted(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0.3).restart();\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  dragged(d: INode) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  dragended(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0);\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  isTargetNode(d: INode) {\n    const { drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    if (appMode === 'drug-to-disease') {\n      // In this mode, selectedIds are diseases (targets), and selectedDrugPrimary is source.\n      return selectedIds.includes(d.nodeId) || selectedDrugPrimary === d.nodeId;\n    }\n    return selectedIds.includes(d.nodeId) || selectedDisease === d.nodeId;\n  }\n\n  isHighlighted(d: INode) {\n    const { selectedPathNodes } = this.props.globalState;\n    return (\n      selectedPathNodes.map((i) => i.nodeType).includes(d.nodeType) &&\n      selectedPathNodes.map((i) => i.nodeId).includes(d.nodeId)\n    );\n  }\n\n  getNodeLinks() {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      attention,\n      // edgeThreshold,\n      selectedDisease,\n      selectedDrugPrimary,\n      edgeTypes,\n      appMode,\n    } = this.props.globalState;\n    const { width, height } = this.props;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    let nodes: INode[] = [],\n      links: ILink[] = [];\n\n    Object.values(attention).forEach((nodeAttention: IAttentionTree) => {\n      // let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n      const rootNode = d3.hierarchy(nodeAttention);\n      let desNodes: INode[] = [];\n      rootNode.descendants().forEach((d) => {\n        const node = {\n          id: `${d.data.nodeType}:${d.data.nodeId}`,\n          nodeId: d.data.nodeId,\n          nodeType: d.data.nodeType,\n        };\n        const prevNode = this.prevNodes.find((d) => d.id === node.id);\n        desNodes.push({ ...node, ...prevNode });\n      });\n      nodes = nodes.concat(desNodes);\n      const desLinks = rootNode.links().map((d) => {\n        const sourceData = d.source.data,\n          targetData = d.target.data;\n        let edgeInfo = targetData.edgeInfo.replace('rev_', '');\n        edgeInfo = edgeTypes[edgeInfo]?.edgeInfo || edgeInfo;\n        return {\n          source: `${sourceData.nodeType}:${sourceData.nodeId}`,\n          target: `${targetData.nodeType}:${targetData.nodeId}`,\n          score: targetData.score,\n          edgeInfo,\n        };\n      });\n      links = links.concat(desLinks);\n    });\n\n    // // show the virus host proteins\n    // let nodes:INode[] =  viralTargets.map(d => { return { id: d.toString() } }),\n    //     links:ILink[] = targetLinks.map(edge => { return { source: edge[0].toString(), target: edge[1].toString() } })\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n      const selectedIdx = selectedIds.indexOf(node.nodeId);\n\n      if (appMode === 'drug-to-disease') {\n        if (node.nodeId === selectedDrugPrimary) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      } else {\n        if (node.nodeId === selectedDisease) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      }\n    }\n\n    this.prevNodes = nodes;\n    this.prevLinks = links;\n\n    return { nodes, links };\n  }\n\n  drawGraph() {\n    const { nodeNameDict } = this.props.globalState;\n    const { nodes, links } = this.getNodeLinks();\n    const { width, height } = this.props;\n\n    const widthScale = d3\n      .scaleLinear()\n      .range([2, 6])  // Increased line widths for better visibility\n      .domain(d3.extent(links.map((d) => d.score)) as [number, number]);\n\n    let svgLinks: any = d3\n      .select('svg.graph')\n      .select('g.links')\n      .selectAll('g.link')\n      .data(links)\n      .join((enter) => enter.append('g').attr('class', 'link'))\n      .on('mouseover', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel');\n      })\n      .on('mouseout', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel hidden');\n      });\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'link')\n      .attr('stroke', '#aaa')\n      .attr('stroke-width', (d: any) => widthScale(d.score))\n      .attr('id', (d: any) => d.id);\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'mask')\n      .attr('stroke-width', 4)\n      .attr('stroke', 'transparent');\n\n    svgLinks\n      .append('text')\n      .attr('class', 'edgeLabel hidden')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      )\n      .text((d: any) => d.edgeInfo);\n\n    let svgNodes = d3\n      .select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .data(nodes, (d: any) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'nodeGroup')\n            .attr('transform', (d) => {\n              return `translate(${d.x || width / 2}, ${d.y || height / 2})`;\n            }) // ensure d.x is not undefined when first entering\n            .attr('cursor', 'pointer')\n            .call(\n              d3\n                .drag<SVGGElement, INode>()\n                .on('start', this.dragstarted.bind(this))\n                .on('drag', this.dragged.bind(this))\n                .on('end', this.dragended.bind(this))\n            ),\n\n        (update) =>\n          update.attr('transform', (d) => `translate(${d.x}, ${d.y})`),\n\n        (exit) => exit.remove()\n      );\n\n    svgNodes\n      .append('circle')\n      // .filter(d=>!drugTargets.includes(d.id))\n      .attr('r', this.RADIUS)\n      // .attr(\"r\", 5)\n      .attr('class', 'node')\n      .attr('id', (d) => d.id)\n      .attr('fill', (d: INode) => getNodeColor(d.nodeType))\n      .attr('stroke', 'white');\n\n    // add label to all nodes\n    svgNodes\n      .append('text')\n      .attr('class', 'nodeLabel')\n      .attr('transform', `translate(${-1 * this.RADIUS}, ${-2.5 * this.RADIUS} )`)\n      .attr('font-size', '13px')  // Slightly larger font\n      .text((d) => nodeNameDict[d.nodeType][d.nodeId])\n      .classed('hidden', true);\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n\n    // toggle node visibility through click\n    svgNodes.on('click', function (d) {\n      const textlabel = d3.select(this).select('text.nodeLabel');\n      const isHidden = textlabel.classed('hidden');\n      textlabel.classed('hidden', !isHidden);\n    });\n\n    this.simulation.nodes(nodes);\n    this.simulation.force<d3.ForceLink<INode, ILink>>('link')!.links(links);\n    this.simulation.on('tick', () => this.ticked(svgNodes, svgLinks));\n\n    this.updateVisibility();\n  }\n\n  updateNodeLabel() {\n    let svgNodes: d3.Selection<\n      SVGGElement,\n      INode,\n      d3.BaseType,\n      any\n    > = d3.select('svg.graph').select('g.nodes').selectAll('g.nodeGroup');\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n  }\n\n  updateVisibility() {\n    // update visibility of nodes and edges based on threshold\n    const { attention, edgeThreshold } = this.props.globalState;\n\n    d3.select('svg.graph')\n      .selectAll('g.link')\n      .style('opacity', (d: any) => (d.score > edgeThreshold ? 1 : 0));\n\n    var visibleNodes: string[] = [];\n    Object.values(attention).forEach((d) => {\n      visibleNodes = visibleNodes.concat(flatTree(pruneEdge(d, edgeThreshold)));\n    });\n\n    d3.select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .select('circle')\n      .style('opacity', (d: any) => {\n        return visibleNodes.includes(d.nodeId) ? 1 : 0;\n      });\n  }\n\n  componentDidMount() {\n    this.drawGraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const {\n      metaPathGroups: prevGroups,\n      selectedPathNodes: prevNodes,\n      edgeThreshold: prevThreshold,\n      attention: prevAttention,\n    } = prevProps.globalState;\n    const {\n      metaPathGroups: currGroups,\n      selectedPathNodes: currNodes,\n      edgeThreshold: currThreshold,\n      attention: currAttention,\n    } = this.props.globalState;\n    \n    // Redraw and restart animation when data changes\n    const prevGroupKeys = Object.keys(prevGroups).sort().join(',');\n    const currGroupKeys = Object.keys(currGroups).sort().join(',');\n    const prevAttentionKeys = Object.keys(prevAttention).sort().join(',');\n    const currAttentionKeys = Object.keys(currAttention).sort().join(',');\n    \n    if (prevGroupKeys !== currGroupKeys || prevAttentionKeys !== currAttentionKeys) {\n      this.drawGraph();\n      // Restart simulation with high alpha for smooth animation\n      this.simulation.alpha(1).restart();\n    }\n    \n    if (\n      prevNodes.map((d) => d.nodeId).join() !==\n      currNodes.map((d) => d.nodeId).join()\n    ) {\n      this.updateNodeLabel();\n    }\n\n    if (prevThreshold !== currThreshold) {\n      this.updateVisibility();\n    }\n    return false;\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { isAttentionLoading } = this.props.globalState;\n\n    const selectedDrugs = Object.keys(this.props.globalState.metaPathGroups);\n    const reminderText = (\n      <text\n        transform={`translate(${width / 2}, ${height / 2})`}\n        fill=\"gray\"\n        fontSize={20}\n      >\n        Please select a drug first\n      </text>\n    );\n\n    return (\n      <svg className=\"graph\" width={width} height={height}>\n        <g className=\"links\" />\n        <g className=\"nodes\" />\n        <text x={0} y={height - 25} fill=\"gray\" fontSize={12}>\n          Drag & Drop to move nodes.\n        </text>\n        <text x={0} y={height - 10} fill=\"gray\" fontSize={12}>\n          Click on nodes to show/hide labels.\n        </text>\n        {selectedDrugs.length === 0 ? reminderText : <></>}\n        {isAttentionLoading ? (\n          <g className=\"loading\">\n            <rect\n              className=\"loading__background\"\n              width={width}\n              height={height}\n              fill=\"white\"\n              opacity={0.5}\n            />\n            <g transform={`translate(${width / 2}, ${height / 2})`}>\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <></>\n        )}\n      </svg>\n    );\n  }\n}\n","import React from 'react';\nimport { requestEmbedding } from 'stores/DataService';\nimport { IState, IDispatch } from 'types';\nimport { StateConsumer } from 'stores';\nimport * as d3 from 'd3';\nimport { HIGHLIGHT_COLOR, SELECTED_COLOR } from 'helpers/color';\nimport { LOADING_ICON } from 'helpers';\nimport { selectDrug, selectDrugPrimary, selectDiseaseSecondary } from 'stores/actions';\nimport { isAddDrug, isAddDisease } from 'stores/reducer';\nimport lasso from './lasso.js';\n\ninterface State {\n  embedding: { [key: string]: [number, number] };\n  tooltip: {\n    visible: boolean;\n    info: string;\n    position: [number, number];\n  };\n}\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\nclass Scatter extends React.Component<Props, State> {\n  circleRadius = 3;\n  hoverTimeout: number = 0;\n  WAIT = 500;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      embedding: {},\n      tooltip: { visible: false, info: '', position: [0, 0] },\n    };\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n  }\n  async loadEmbedding() {\n    const { selectedDrugPrimary } = this.props.globalState;\n    const embedding = await requestEmbedding(selectedDrugPrimary);\n    this.setState({ embedding });\n  }\n  componentDidMount() {\n    this.loadEmbedding();\n  }\n  componentDidUpdate(prevProps: Props) {\n    // Reload embeddings when the primary drug changes\n    const { selectedDrugPrimary } = this.props.globalState;\n    const prevDrugPrimary = prevProps.globalState.selectedDrugPrimary;\n    \n    if (selectedDrugPrimary !== prevDrugPrimary) {\n      this.loadEmbedding();\n    }\n  }\n\n  addLasso(width: number, height: number) {\n    const { drugPredictions } = this.props.globalState;\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    // lasso draw\n    d3.selectAll('g.lasso').remove();\n    var svg = d3.select('svg.scatter');\n\n    var lasso_area = d3.select('rect.lasso');\n\n    // Lasso functions to execute while lassoing\n    var lasso_start = () => {\n      // (mylasso.items() as any).attr('r', 5); // reset size\n      // .attr('fill', 'white')\n    };\n\n    var lasso_draw = () => {\n      // Style the possible dots\n      // mylasso\n      // .possibleItems()\n      // .classed(\"possible\", true)\n    };\n\n    var lasso_end = () => {\n      // mylasso.selectedItems()\n      //     .attr('fill', colors[this.selected.length])\n      //     .attr('r', '7')\n      //     .classed(`group_${this.selected.length}`, true)\n      // mylasso\n      // .items()\n      // .classed(\"possible\", false)\n\n      (mylasso.selectedItems() as any)._groups[0].forEach((d: any) => {\n        const drugID = d.attributes.id.value;\n        if (!selectedDrugIds.includes(drugID)) {\n          selectDrug(\n            drugID,\n            this.props.globalState.selectedDisease,\n            true,\n            this.props.dispatch\n          );\n        }\n      });\n    };\n\n    var mylasso = lasso();\n    mylasso.items(svg.selectAll('circle.highlighted'));\n    mylasso\n      .targetArea(lasso_area) // area where the lasso can be started\n      .on('start', lasso_start) // lasso start function\n      .on('draw', lasso_draw) // lasso draw function\n      .on('end', lasso_end); // lasso end function\n\n    svg.call(mylasso);\n  }\n  drawScatter() {\n    const { diseasePredictions, appMode } = this.props.globalState;\n    const { width, height } = this.props;\n\n    // this.addLasso(width, height);\n\n    const { embedding } = this.state;\n    const xDomain = d3.extent(Object.values(embedding).map((d) => d[0])) as [\n      number,\n      number\n    ],\n      yDomain = d3.extent(Object.values(embedding).map((d) => d[1])) as [\n        number,\n        number\n      ];\n\n    const xScale = d3\n      .scaleLinear()\n      .domain(xDomain)\n      .range([this.circleRadius, width - this.circleRadius]);\n    const yScale = d3\n      .scaleLinear()\n      .domain(yDomain)\n      .range([this.circleRadius, height - this.circleRadius]);\n\n    // Use disease predictions in drug-to-disease mode\n    const diseaseIds = diseasePredictions.map((d) => d.node_id || d.id);\n    const selectedDiseaseIds = diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.node_id || d.id);\n\n    const getSortIndex = (diseaseId: string) =>\n      diseaseIds.indexOf(diseaseId) > -1 ? diseaseIds.indexOf(diseaseId) : diseaseIds.length;\n\n    const nodes = Object.keys(embedding)\n      .sort((a, b) => -getSortIndex(a) + getSortIndex(b))\n      .map((diseaseId) => {\n        const [x, y] = embedding[diseaseId];\n        const diseaseRank = diseaseIds.indexOf(diseaseId);\n        const isHighlighted = diseaseRank > -1; // predicted diseases\n        const isSelected = selectedDiseaseIds.includes(diseaseId);\n\n        return (\n          <circle\n            cx={xScale(x)}\n            cy={yScale(y)}\n            key={diseaseId}\n            className={isHighlighted ? 'highlighted disease' : 'disease'}\n            id={diseaseId}\n            fill={\n              isSelected\n                ? SELECTED_COLOR\n                : isHighlighted\n                  ? HIGHLIGHT_COLOR\n                  : 'lightGray'\n            }\n            opacity={isSelected ? 1 : 0.7}\n            stroke={'white'}\n            r={\n              isSelected\n                ? this.circleRadius * 1.5\n                : isHighlighted\n                  ? this.circleRadius * 1.1\n                  : this.circleRadius\n            }\n            onDoubleClick={() => {\n              if (isHighlighted) this.onChangeDisease(diseaseId);\n            }}\n            onClick={() => this.showTooltip(diseaseId, [xScale(x), yScale(y)])}\n          />\n        );\n      });\n    return nodes;\n  }\n  onChangeDisease(selectedDisease: string) {\n    const { appMode, selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease' && selectedDrugPrimary) {\n      // In Drug-to-Disease mode, clicking a disease selects/deselects it\n      const isAdd = isAddDisease(diseasePredictions, selectedDisease);\n      selectDiseaseSecondary(\n        selectedDisease,\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n  onChangeDrug(selectedDrug: string) {\n    const { appMode } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      selectDrugPrimary(selectedDrug, this.props.dispatch);\n    } else {\n      const isAdd = isAddDrug(\n        this.props.globalState.drugPredictions,\n        selectedDrug\n      );\n      selectDrug(\n        selectedDrug,\n        this.props.globalState.selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n  showTooltip(diseaseId: string, position: [number, number]) {\n    const { nodeNameDict } = this.props.globalState;\n    this.hoverTimeout = window.setTimeout(() => {\n      const diseaseName = nodeNameDict['disease']?.[diseaseId] || diseaseId;\n      this.setState({\n        tooltip: {\n          visible: true,\n          info: `disease: ${diseaseName}`,\n          position,\n        },\n      });\n    }, this.WAIT);\n  }\n  hideTooltip() {\n    window.clearTimeout(this.hoverTimeout);\n    this.setState({\n      tooltip: {\n        visible: false,\n        info: ``,\n        position: [0, 0],\n      },\n    });\n  }\n  render() {\n    const { isDrugLoading, isInitializing } = this.props.globalState;\n    const { width, height } = this.props;\n    const { tooltip } = this.state;\n\n    return (\n      <div style={{ position: 'relative' }}>\n        <svg width={width} height={height} className=\"scatter\">\n          <rect\n            className=\"lasso area\"\n            width={width}\n            height={height}\n            opacity={0}\n          />\n          <g className=\"scatter\">\n            {this.state.embedding ? (\n              this.drawScatter()\n            ) : (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            )}\n            {/* overlap a loading icon when loading */}\n            {isDrugLoading && !isInitializing ? (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            ) : (\n              <g />\n            )}\n          </g>{' '}\n          <text x={0} y={height - 25} fontSize={12} fill=\"gray\">\n            Click to reveal the disease name.\n          </text>\n          <text x={0} y={height - 10} fontSize={12} fill=\"gray\">\n            Double click to select the disease.\n          </text>\n        </svg>\n        <div\n          className={`tooltip tooltip-${tooltip.visible ? 'show' : 'hide'}`}\n          style={{\n            left: tooltip.position[0] + this.circleRadius,\n            top: tooltip.position[1] + this.circleRadius,\n          }}\n        >\n          {tooltip.info}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default StateConsumer(Scatter);\n","import * as selection from 'd3-selection';\nimport * as drag from 'd3-drag';\nimport classifyPoint from 'robust-point-in-polygon';\n\nexport default function () {\n  var items = [],\n    closePathDistance = 75,\n    closePathSelect = true,\n    isPathClosed = false,\n    hoverSelect = true,\n    targetArea,\n    on = { start: function () {}, draw: function () {}, end: function () {} };\n\n  // Function to execute on call\n  function lasso(_this) {\n    // add a new group for the lasso\n    var g = _this.append('g').attr('class', 'lasso');\n\n    // add the drawn path for the lasso\n    var dyn_path = g.append('path').attr('class', 'drawn');\n\n    // add a closed path\n    var close_path = g.append('path').attr('class', 'loop_close');\n\n    // add an origin node\n    var origin_node = g.append('circle').attr('class', 'origin');\n\n    // The transformed lasso path for rendering\n    var tpath;\n\n    // The lasso origin for calculations\n    var origin;\n\n    // The transformed lasso origin for rendering\n    var torigin;\n\n    // Store off coordinates drawn\n    var drawnCoords;\n\n    // Apply drag behaviors\n    var dragAction = drag\n      .drag()\n      .on('start', dragstart)\n      .on('drag', dragmove)\n      .on('end', dragend);\n\n    // Call drag\n    targetArea.call(dragAction);\n\n    function dragstart() {\n      // Init coordinates\n      drawnCoords = [];\n\n      // Initialize paths\n      tpath = '';\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n\n      // Set every item to have a false selection and reset their center point and counters\n      items.nodes().forEach(function (e) {\n        e.__lasso.possible = false;\n        e.__lasso.selected = false;\n        e.__lasso.hoverSelect = false;\n        e.__lasso.loopSelect = false;\n\n        var box = e.getBoundingClientRect();\n        e.__lasso.lassoPoint = [\n          Math.round(box.left + box.width / 2),\n          Math.round(box.top + box.height / 2),\n        ];\n      });\n\n      // if hover is on, add hover function\n      if (hoverSelect) {\n        items.on('mouseover.lasso', function () {\n          // if hovered, change lasso selection attribute to true\n          this.__lasso.hoverSelect = true;\n        });\n      }\n\n      // Run user defined start function\n      on.start();\n    }\n\n    function dragmove() {\n      // Get mouse position within body, used for calculations\n      var x, y;\n      if (selection.event.sourceEvent.type === 'touchmove') {\n        x = selection.event.sourceEvent.touches[0].clientX;\n        y = selection.event.sourceEvent.touches[0].clientY;\n      } else {\n        x = selection.event.sourceEvent.clientX;\n        y = selection.event.sourceEvent.clientY;\n      }\n\n      // Get mouse position within drawing area, used for rendering\n      var tx = selection.mouse(this)[0];\n      var ty = selection.mouse(this)[1];\n\n      // Initialize the path or add the latest point to it\n      if (tpath === '') {\n        tpath = tpath + 'M ' + tx + ' ' + ty;\n        origin = [x, y];\n        torigin = [tx, ty];\n        // Draw origin node\n        origin_node\n          .attr('cx', tx)\n          .attr('cy', ty)\n          .attr('r', 7)\n          .attr('display', null);\n      } else {\n        tpath = tpath + ' L ' + tx + ' ' + ty;\n      }\n\n      drawnCoords.push([x, y]);\n\n      // Calculate the current distance from the lasso origin\n      var distance = Math.sqrt(\n        Math.pow(x - origin[0], 2) + Math.pow(y - origin[1], 2)\n      );\n\n      // Set the closed path line\n      var close_draw_path =\n        'M ' + tx + ' ' + ty + ' L ' + torigin[0] + ' ' + torigin[1];\n\n      // Draw the lines\n      dyn_path.attr('d', tpath);\n\n      close_path.attr('d', close_draw_path);\n\n      // Check if the path is closed\n      isPathClosed = distance <= closePathDistance ? true : false;\n\n      // If within the closed path distance parameter, show the closed path. otherwise, hide it\n      if (isPathClosed && closePathSelect) {\n        close_path.attr('display', null);\n      } else {\n        close_path.attr('display', 'none');\n      }\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.loopSelect =\n          isPathClosed && closePathSelect && n.__lasso.lassoPoint\n            ? classifyPoint(drawnCoords, n.__lasso.lassoPoint) < 1\n            : false;\n        n.__lasso.possible = n.__lasso.hoverSelect || n.__lasso.loopSelect;\n      });\n\n      on.draw();\n    }\n\n    function dragend() {\n      // Remove mouseover tagging function\n      items.on('mouseover.lasso', null);\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.selected = n.__lasso.possible;\n        n.__lasso.possible = false;\n      });\n\n      // Clear lasso\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n      origin_node.attr('display', 'none');\n\n      // Run user defined end function\n      on.end();\n    }\n  }\n\n  // Set or get list of items for lasso to select\n  lasso.items = function (_) {\n    if (!arguments.length) return items;\n    items = _;\n    var nodes = items.nodes();\n    nodes.forEach(function (n) {\n      n.__lasso = {\n        possible: false,\n        selected: false,\n      };\n    });\n    return lasso;\n  };\n\n  // Return possible items\n  lasso.possibleItems = function () {\n    return items.filter(function () {\n      return this.__lasso.possible;\n    });\n  };\n\n  // Return selected items\n  lasso.selectedItems = function () {\n    return items.filter(function () {\n      return this.__lasso.selected;\n    });\n  };\n\n  // Return not possible items\n  lasso.notPossibleItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.possible;\n    });\n  };\n\n  // Return not selected items\n  lasso.notSelectedItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.selected;\n    });\n  };\n\n  // Distance required before path auto closes loop\n  lasso.closePathDistance = function (_) {\n    if (!arguments.length) return closePathDistance;\n    closePathDistance = _;\n    return lasso;\n  };\n\n  // Option to loop select or not\n  lasso.closePathSelect = function (_) {\n    if (!arguments.length) return closePathSelect;\n    closePathSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Not sure what this is for\n  lasso.isPathClosed = function (_) {\n    if (!arguments.length) return isPathClosed;\n    isPathClosed = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Option to select on hover or not\n  lasso.hoverSelect = function (_) {\n    if (!arguments.length) return hoverSelect;\n    hoverSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Events\n  lasso.on = function (type, _) {\n    if (!arguments.length) return on;\n    if (arguments.length === 1) return on[type];\n    var types = ['start', 'draw', 'end'];\n    if (types.indexOf(type) > -1) {\n      on[type] = _;\n    }\n    return lasso;\n  };\n\n  // Area where lasso can be triggered from\n  lasso.targetArea = function (_) {\n    if (!arguments.length) return targetArea;\n    targetArea = _;\n    return lasso;\n  };\n\n  return lasso;\n}\n","import { Tooltip, Modal } from 'antd';\nimport { cropText, YES_ICON, NO_ICON, LOADING_ICON } from 'helpers';\nimport { getNodeColor } from 'helpers/color';\nimport { ACTION_TYPES, selectDrug, selectDiseaseSecondary, toggleMetaPathHide } from 'stores/actions';\nimport { isAddDrug } from 'stores/reducer';\nimport React from 'react';\n\nimport { StateConsumer } from 'stores';\nimport { IPath, IMetaPathSummary, IState, IDispatch } from 'types';\nimport * as d3 from 'd3';\n\nimport './index.css';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  expand: boolean[];\n  isModalVisible: boolean;\n}\n\nclass PathMatrix extends React.Component<Props, State> {\n  TITLE_HEIGHT = 36;\n  MARGIN = 10;\n  PADDING = 10;\n  EDGE_LENGTH = 120;\n  NODE_WIDTH = 130;\n  NODE_HEIGHT = 25;\n  VERTICAL_GAP = 2; // vertical gap between path\n  GROUP_GAP = 6; // vertical gap between path groups\n  COUNT_GAP = 5; // horizontal gap between count circles\n  RADIUS = this.NODE_HEIGHT / 2; // max radius of the count circle\n  HEAD_HEIGHT = 70; // height of the header ()\n  ICON_GAP = 20; // width of the expand triangle icon\n  offsetY = 0; // record the height of the expanded meta paths\n\n  constructor(prop: Props) {\n    super(prop);\n    this.state = {\n      expand: this.props.globalState.metaPathSummary.map((d) => false),\n      isModalVisible: false,\n    };\n\n    this.showModal = this.showModal.bind(this);\n    this.hideModal = this.hideModal.bind(this);\n    this.filterMetaPathGroups = this.filterMetaPathGroups.bind(this);\n  }\n  toggleExpand(idx: number, flag: undefined | boolean) {\n    let { expand } = this.state;\n    if (flag === undefined) {\n      expand[idx] = !expand[idx];\n    } else {\n      expand[idx] = flag;\n    }\n    this.setState({ expand });\n  }\n\n  isPathSelected(nodes: IPath['nodes']) {\n    const { selectedPathNodes } = this.props.globalState;\n    const doesExist =\n      selectedPathNodes.map((d) => d.nodeId).join() ===\n      nodes.map((d) => d.nodeId).join() &&\n      selectedPathNodes.map((d) => d.nodeType).join() ===\n      nodes.map((d) => d.nodeType).join();\n    return doesExist;\n  }\n\n  togglePathNodes(nodes: IPath['nodes'], doesExist: boolean) {\n    if (doesExist) {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: [] },\n      });\n    } else {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: nodes },\n      });\n    }\n  }\n  getMetaIconGroup(toggleHideFunc: (hide: boolean) => void, isHide: boolean) {\n    return (\n      <g\n        className=\"feedback\"\n        cursor=\"pointer\"\n        style={{ fill: '#777' }}\n        transform={`translate(5, 0)`}\n      >\n        <g\n          className=\"yes\"\n          transform={`translate(${0 * this.ICON_GAP}, 0)`}\n          onClick={() => toggleHideFunc(!isHide)}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={isHide ? YES_ICON : NO_ICON} transform={`scale(0.03)`} />\n        </g>\n      </g>\n    );\n  }\n  getIconGroup(nodes: IPath['nodes']) {\n    return (\n      <g className=\"feedback\" cursor=\"pointer\" style={{ fill: '#777' }}>\n        {/* <g\n          className=\"search\"\n          transform={`translate(0, 0)`}\n          fill={doesExist ? 'red' : 'inherit'}\n          onClick={() => this.togglePathNodes(nodes, doesExist)}\n        >\n          <rect\n            width={this.ICON_GAP}\n            height={this.ICON_GAP}\n            fill=\"white\"\n            stroke=\"white\"\n          />\n          <path d={SEARCH_ICON} transform={`scale(0.018)`} />\n        </g> */}\n        {/* <g className=\"yes\" transform={`translate(${this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={YES_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g className=\"no\" transform={`translate(${2 * this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={NO_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g\n          className=\"edit\"\n          transform={`translate(${3 * this.ICON_GAP}, 0)`}\n          onClick={this.showModal}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={EDIT_ICON} transform={`scale(0.03)`} />\n        </g> */}\n      </g>\n    );\n  }\n  drawHeader() {\n    const { drugPredictions, diseasePredictions, nodeNameDict, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const nameType = appMode === 'drug-to-disease' ? 'disease' : 'drug';\n\n    const headerNames = predictions\n      .filter((d) => d.selected)\n      .map((item) => item.name || nodeNameDict[nameType][item.id] || item.id);\n    // headerNames.push('SUM');\n\n    const header = headerNames.map((name, idx) => {\n      // const isSelected =\n      //   idx > drugPredictions.length - 1\n      //     ? false\n      //     : drugPredictions[idx].selected;\n      return (\n        <text\n          key={name}\n          className={name}\n          fill={'gray'}\n          cursor=\"pointer\"\n          transform={`translate(\n            ${idx * (this.RADIUS * 2 + this.COUNT_GAP) + this.RADIUS}, \n            ${this.HEAD_HEIGHT}) \n            rotate(-45)`}\n          onClick={() => {\n            if (idx < predictions.length)\n              this.onChangeDrug(predictions[idx].id);\n          }}\n        >\n          {name}\n        </text>\n      );\n    });\n    return header;\n  }\n  getCountWidth() {\n    const { drugPredictions, diseasePredictions, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const width =\n      predictions.filter((d) => d.selected).length *\n      (this.RADIUS * 2 + this.COUNT_GAP) +\n      this.COUNT_GAP;\n    return width;\n  }\n  drawSummary() {\n    let { EDGE_LENGTH, NODE_WIDTH, NODE_HEIGHT, VERTICAL_GAP } = this;\n\n    let { metaPathSummary, drugPredictions, diseasePredictions, appMode, nodeNameDict } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const COUNT_WIDTH = this.getCountWidth();\n\n    let metaPathGroups = this.filterMetaPathGroups();\n    const triangleRight =\n      'M 9 17.879 V 6.707 A 1 1 0 0 1 10.707 6 l 5.586 5.586 a 1 1 0 0 1 0 1.414 l -5.586 5.586 A 1 1 0 0 1 9 17.879 Z',\n      triangelBottom =\n        'M 6.414 9 h 11.172 a 1 1 0 0 1 0.707 1.707 l -5.586 5.586 a 1 1 0 0 1 -1.414 0 l -5.586 -5.586 A 1 1 0 0 1 6.414 9 Z';\n\n    const maxCount = Math.max(\n      ...metaPathSummary.map((d) => Object.values(d.count)).flat()\n    );\n    const rScale = d3\n      .scaleLinear()\n      .range([this.RADIUS / 3, this.RADIUS])\n      .domain([0, maxCount]);\n\n    this.offsetY = 0;\n    const allRows = [...metaPathSummary]\n      .sort((a, b) => (a.hide ? 1 : 0) - (b.hide ? 1 : 0))\n      .map((summary) => {\n        let nodes = summary.nodeTypes.map((node, nodeIdx) => {\n          let translate = `translate(${(EDGE_LENGTH + NODE_WIDTH) * nodeIdx\n            }, ${0})`;\n          return (\n            <g key={`node_${nodeIdx}`} transform={translate}>\n              <rect\n                width={NODE_WIDTH}\n                height={NODE_HEIGHT}\n                fill=\"white\"\n                strokeWidth=\"3\"\n                stroke={getNodeColor(node)}\n                rx={this.NODE_HEIGHT / 2}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={NODE_HEIGHT / 2 + 6}\n                x={NODE_WIDTH / 2}\n                fill=\"black\"\n              >\n                {node}\n              </text>\n            </g>\n          );\n        });\n        let edges = [...Array(nodes.length - 1)].map((_, edgeIdx) => {\n          let translate = `translate(${NODE_WIDTH + (EDGE_LENGTH + NODE_WIDTH) * edgeIdx\n            }, ${+NODE_HEIGHT / 2})`;\n          return (\n            <g key={`edge_${edgeIdx}`} transform={translate}>\n              <line\n                stroke=\"lightgray\"\n                // strokeWidth={1+Math.random() * 8}\n                strokeWidth={2}\n                x1={0}\n                y1={0}\n                x2={EDGE_LENGTH}\n                y2={0}\n              />\n            </g>\n          );\n        });\n        let currentY = this.offsetY;\n        this.offsetY += NODE_HEIGHT + VERTICAL_GAP;\n\n        let differentChildren: JSX.Element[] = [];\n        let childrenOffsetY = 0;\n        const showChildren = this.state.expand[summary.idx];\n\n        let lastMetaPath: IPath | undefined = undefined;\n        let diseaseIndex = 0;\n        Object.keys(metaPathGroups).forEach((drugId) => {\n          const metaPathGroup = metaPathGroups[drugId];\n          const metaPaths =\n            metaPathGroup.filter(\n              (d) => d.nodeTypes.join('') === summary.nodeTypes.join('')\n            )[0]?.paths || [];\n\n          const drugRank = predictions\n            .filter((d) => d.selected)\n            .map((d) => d.id)\n            .indexOf(drugId);\n          \n          // Get disease name for label\n          const prediction = predictions.find((d) => d.id === drugId);\n          const diseaseName = prediction?.name || nodeNameDict['disease']?.[drugId] || drugId;\n          const shortDiseaseName = diseaseName.length > 25 ? diseaseName.slice(0, 22) + '...' : diseaseName;\n          \n          const { children, numOfChildren } = this.drawChildrenPaths(\n            metaPaths,\n            drugRank,\n            lastMetaPath\n          );\n          lastMetaPath = metaPaths[metaPaths.length - 1];\n          const childrenHeight = (NODE_HEIGHT + VERTICAL_GAP) * numOfChildren;\n          \n          // Add disease number label before paths\n          const diseaseLabel = numOfChildren > 0 ? (\n            <g transform={`translate(0, ${childrenOffsetY})`}>\n              <text \n                x={this.PADDING} \n                y={this.NODE_HEIGHT / 2 + 5} \n                fill=\"#333\" \n                fontSize={11}\n                fontWeight=\"bold\"\n              >\n                [{diseaseIndex + 1}] {shortDiseaseName}\n              </text>\n            </g>\n          ) : null;\n          \n          if (numOfChildren > 0) {\n            diseaseIndex++;\n            differentChildren.push(\n              <g\n                key={`drugRank: ${drugRank}`}\n                className={`drugRank_${drugRank}`}\n                transform={`translate(0, ${childrenOffsetY})`}\n              >\n                {diseaseLabel}\n                <g transform={`translate(0, ${this.NODE_HEIGHT + 5})`}>\n                  {children}\n                </g>\n              </g>\n            );\n            \n            childrenOffsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            if (showChildren) {\n              this.offsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            }\n          }\n\n          this.offsetY += this.GROUP_GAP;\n        });\n\n        const toggleHideFunc = (hide: boolean) => {\n          toggleMetaPathHide(\n            metaPathSummary,\n            summary.idx,\n            hide,\n            this.props.dispatch\n          );\n          if (hide) {\n            this.toggleExpand(summary.idx, false);\n          }\n        };\n\n        return (\n          <g\n            key={`prototype_${summary.idx}`}\n            transform={`translate(${0}, ${currentY})`}\n            opacity={summary.hide ? 0.4 : 1}\n          >\n            <g className=\"metaCount\">{this.drawMetaCount(summary, rScale)}</g>\n            <g className=\"icon\">\n              <path\n                d={showChildren ? triangelBottom : triangleRight}\n                transform={`translate(${COUNT_WIDTH}, 0)`}\n                fill=\"gray\"\n                onClick={() => {\n                  if (!summary.hide) this.toggleExpand(summary.idx, undefined);\n                }}\n                cursor=\"pointer\"\n              />\n            </g>\n            <g\n              className=\"prototype\"\n              transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}\n            >\n              {nodes}\n              {edges}\n              <g\n                className=\"iconGroup\"\n                transform={`translate(${NODE_WIDTH * nodes.length + EDGE_LENGTH * edges.length\n                  }, 0)`}\n              >\n                {this.getMetaIconGroup(toggleHideFunc, summary.hide)}\n              </g>\n            </g>\n            <g className=\"metapaths\">\n              {showChildren ? differentChildren : <g />}\n            </g>\n          </g>\n        );\n      });\n    const header = this.drawHeader();\n    const content = (\n      <g>\n        <g\n          className=\"header\"\n          transform={`translate(${this.PADDING}, ${this.PADDING})`}\n        >\n          {header}\n        </g>\n        <g\n          className=\"rows\"\n          transform={`translate(${0}, ${this.PADDING + this.HEAD_HEIGHT})`}\n        >\n          {allRows}\n        </g>\n      </g>\n    );\n    return content;\n  }\n\n  onChangeDrug(selectedId: string) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      const isAdd = isAddDrug(diseasePredictions, selectedId);\n\n      if (selectedDrugPrimary) {\n        selectDiseaseSecondary(\n          selectedId,\n          selectedDrugPrimary,\n          isAdd,\n          this.props.dispatch\n        );\n      }\n    } else {\n      const isAdd = isAddDrug(\n        drugPredictions,\n        selectedId\n      );\n      selectDrug(\n        selectedId,\n        selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, metaPathSummary } = this.props.globalState;\n    const prevPredictions = prevProps.globalState.appMode === 'drug-to-disease' ? prevProps.globalState.diseasePredictions : prevProps.globalState.drugPredictions;\n    const currPredictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    if (\n      // when disease changed, collapse all meta paths\n      prevProps.globalState.selectedDisease !==\n      selectedDisease\n    ) {\n      this.setState({\n        expand: metaPathSummary.map((d) => false),\n      });\n    } else if (\n      prevPredictions.filter((d) => d.selected).length !==\n      currPredictions.filter((d) => d.selected).length\n    ) {\n      // update expended metapaths when selected drug changes\n      const expandStatus = metaPathSummary.map((d) => false); // collapse all metapaths by default\n      this.setState({ expand: expandStatus });\n    }\n  }\n\n  drawMetaCount(\n    summary: IMetaPathSummary,\n    rScale: d3.ScaleLinear<number, number>\n  ) {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      isAttentionLoading,\n      metaPathGroups,\n      edgeThreshold,\n      appMode,\n    } = this.props.globalState;\n    const { count, nodeTypes } = summary;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const vis = predictions\n      .filter((d) => d.selected)\n      .map((prediction, idx) => {\n        const { id: predictionId } = prediction;\n        // const num = count[predictionId]\n        //   ? count[predictionId]\n        //   : isAttentionLoading\n        //   ? '...'\n        //   : 0;\n\n        const metaPath = metaPathGroups[predictionId]?.find(\n          (d) => d.nodeTypes.join(',') === nodeTypes.join(',')\n        );\n        const num = metaPath\n          ? metaPath.paths.filter((path) =>\n            path.edges.every((e) => e.score >= edgeThreshold)\n          ).length\n          : isAttentionLoading\n            ? '...'\n            : 0;\n\n        const content = (\n          <text\n            textAnchor=\"middle\"\n            transform={`translate(${this.RADIUS}, ${this.RADIUS / 2})`}\n            fontSize={15}\n            fill={'gray'}\n          >\n            {num}\n          </text>\n        );\n        return (\n          <g\n            key={idx}\n            className=\"count\"\n            transform={`translate(${idx * (2 * this.RADIUS + this.COUNT_GAP)\n              }, ${this.NODE_HEIGHT / 2})`}\n            cursor=\"pointer\"\n            onClick={() => this.onChangeDrug(predictionId)}\n          >\n            {content}\n          </g>\n        );\n      });\n    return (\n      <g className=\"metaCount\" transform={`translate(${this.PADDING}, 0)`}>\n        {vis}\n        {/* <g\n          className=\"sum\"\n          transform={`translate(${\n            count.length * (2 * this.RADIUS + this.COUNT_GAP)\n          }, 0)`}\n        >\n          <text\n            x={this.RADIUS}\n            y={this.NODE_HEIGHT / 2 + 6}\n            textAnchor=\"middle\"\n          >\n            {' '}\n            {`${sum}`}{' '}\n          </text>\n        </g> */}\n      </g>\n    );\n  }\n\n  drawChildrenPaths(\n    metaPaths: IPath[],\n    drugRank: number,\n    prevPath: IPath | undefined,\n    showFullPaths: boolean = true  // Always show full paths, don't abbreviate\n  ) {\n    const { nodeNameDict, edgeTypes, edgeThreshold } = this.props.globalState;\n    const COUNT_WIDTH = this.getCountWidth();\n    const filteredMetaPaths = metaPaths.filter((metaPath) =>\n      metaPath.edges.every((e) => e.score >= edgeThreshold)\n    );\n    const children = filteredMetaPaths.map((metaPath, childIdx) => {\n      // Calculate path weight from edge scores - use max score if available\n      const edgeScores = metaPath.edges.map(e => e.score).filter(s => s > 0);\n      const pathWeight = edgeScores.length > 0 \n        ? (edgeScores.reduce((sum, s) => sum + s, 0) / edgeScores.length).toFixed(2)\n        : (childIdx + 1).toString();  // Use path index if no scores\n      \n      const nodes = metaPath.nodes.map((node, nodeIdx) => {\n        const { nodeId, nodeType } = node;\n        const nodeName = nodeNameDict[nodeType]?.[nodeId] || nodeId;\n\n        // Always show full node names - don't use '' abbreviation\n        let shortNodeName = cropText(nodeName, 14, this.NODE_WIDTH - 10) || nodeId || 'unknown';\n\n        // Add offset for the weight label on the left\n        let translate = `translate(${40 + (this.EDGE_LENGTH + this.NODE_WIDTH) * nodeIdx\n          }, ${0})`;\n\n        return (\n          <Tooltip\n            key={`node_${nodeIdx}`}\n            title={(shortNodeName.includes('.') ? nodeName : nodeName) + (node.source ? ` (${node.source})` : '')}\n          >\n            <g\n              transform={translate}\n              className={`node_${nodeId}`}\n              style={{ cursor: 'pointer' }}\n              onClick={() =>\n                nodeType === 'drug' &&\n                window.open(\n                  `https://go.drugbank.com/drugs/${nodeId}`,\n                  'windowName',\n                  'popup,right=10,top=10,width=320,height=600'\n                )\n              }\n            >\n              <rect\n                width={this.NODE_WIDTH}\n                height={this.NODE_HEIGHT}\n                fill={getNodeColor(nodeType)}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={this.NODE_HEIGHT / 2 + 6}\n                x={this.NODE_WIDTH / 2}\n                fill=\"white\"\n              >\n                {shortNodeName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      \n      // Add path weight/count on the left side\n      const weightLabel = (\n        <g key=\"weight\" transform={`translate(0, ${this.NODE_HEIGHT / 2 + 5})`}>\n          <text\n            textAnchor=\"end\"\n            x={35}\n            fill=\"#666\"\n            fontSize={12}\n            fontWeight=\"bold\"\n          >\n            {pathWeight}\n          </text>\n        </g>\n      );\n      \n      const edges = metaPath.edges.map((edge, edgeIdx) => {\n        // Add offset for the weight label\n        const translate = `translate(${40 + this.NODE_WIDTH + (this.EDGE_LENGTH + this.NODE_WIDTH) * edgeIdx\n          }, ${+this.NODE_HEIGHT / 2})`;\n\n        let edgeName = edge.edgeInfo.replace('rev_', '');\n        edgeName = edgeTypes[edgeName]?.edgeInfo || edgeName;\n        const edgeShortName = cropText(edgeName, 14, this.EDGE_LENGTH);\n        return (\n          <Tooltip\n            title={edgeShortName === edgeName ? '' : edgeName}\n            destroyTooltipOnHide\n          >\n            <g\n              key={`edge_${edgeIdx}`}\n              transform={translate}\n              style={{ cursor: 'pointer' }}\n            >\n              <line\n                stroke=\"gray\"\n                strokeWidth={1 + edge.score * 2}\n                x1={0}\n                y1={this.NODE_HEIGHT / 4}\n                x2={this.EDGE_LENGTH}\n                y2={this.NODE_HEIGHT / 4}\n              />\n              <text\n                x={this.EDGE_LENGTH / 2}\n                y={0}\n                textAnchor=\"middle\"\n                fill=\"gray\"\n              >\n                {edgeShortName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      return (\n        <g\n          key={childIdx}\n          transform={`translate(0, ${(this.NODE_HEIGHT + this.VERTICAL_GAP) * (1 + childIdx)\n            })`}\n        >\n          <circle\n            cx={\n              drugRank * (2 * this.RADIUS + this.COUNT_GAP) +\n              this.RADIUS +\n              this.PADDING\n            }\n            cy={this.NODE_HEIGHT / 2}\n            fill=\"gray\"\n            r={this.RADIUS / 4}\n          />\n          <g transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}>\n            {weightLabel}\n            {nodes}\n            {edges}\n            <g\n              className=\"iconGroup\"\n              transform={`translate(${40 + this.NODE_WIDTH * nodes.length + this.EDGE_LENGTH * edges.length\n                }, 0)`}\n            >\n              {this.getIconGroup(metaPath.nodes)}\n            </g>\n          </g>\n        </g>\n      );\n    });\n    return { children, numOfChildren: filteredMetaPaths.length };\n  }\n  showModal() {\n    this.setState({ isModalVisible: true });\n  }\n  hideModal() {\n    this.setState({ isModalVisible: false });\n  }\n  filterMetaPathGroups() {\n    let { metaPathGroups, edgeThreshold } = this.props.globalState;\n    let filteredMetaGroups: IState['metaPathGroups'] = {};\n    Object.keys(metaPathGroups).forEach((k) => {\n      filteredMetaGroups[k] = metaPathGroups[k].map((metaPathGroup) => {\n        const metaPaths = metaPathGroup.paths.filter((path) =>\n          path.edges.every((e) => e.score > edgeThreshold)\n        );\n        return { ...metaPathGroup, metaPaths };\n      });\n    });\n\n    Object.keys(filteredMetaGroups).forEach((k) => {\n      filteredMetaGroups[k] = filteredMetaGroups[k].filter(\n        (metaPathGroup) => metaPathGroup.paths.length > 0\n      );\n    });\n\n    return filteredMetaGroups;\n  }\n  render() {\n    const { width, height } = this.props,\n      { isModalVisible, expand } = this.state;\n    const {\n      isDrugLoading,\n      isAttentionLoading,\n      metaPathSummary,\n      selectedDisease,\n      drugPredictions,\n    } = this.props.globalState;\n\n    const svgWidth = Math.max(\n      width - 2 * this.PADDING - 2 * this.MARGIN,\n      this.getCountWidth() +\n      this.ICON_GAP * 5 +\n      this.NODE_WIDTH +\n      (this.EDGE_LENGTH + this.NODE_WIDTH) * 4\n    );\n\n    const matrixRowsCount = Object.values(metaPathSummary)\n      .map((d, idx) => {\n        return expand[idx] ? d.sum : 0;\n      })\n      .reduce((a, b) => a + b, 0),\n      matrixGroupsCount = Object.keys(metaPathSummary).length,\n      matrixHeight =\n        matrixRowsCount * (this.NODE_HEIGHT + this.VERTICAL_GAP) +\n        this.PADDING +\n        matrixGroupsCount * (this.HEAD_HEIGHT + this.GROUP_GAP);\n\n    const svgOuterHeight = height - 2 * this.PADDING - this.TITLE_HEIGHT,\n      svgHeight = Math.max(matrixHeight + this.HEAD_HEIGHT, svgOuterHeight);\n\n    const reminderText = (\n      <text\n        x={width / 2}\n        y={height / 2}\n        fill=\"gray\"\n        textAnchor=\"middle\"\n        fontSize={20}\n      >\n        {isAttentionLoading\n          ? ''\n          : typeof selectedDisease == 'string' &&\n            drugPredictions.filter((d) => d.selected).length > 0\n            ? 'Sorry, we find no meta path with current computational resources.'\n            : 'Please select a disease and at least one drug'}\n      </text>\n    );\n\n    const metaPaths = this.drawSummary();\n    const content = metaPathSummary.length === 0 ? reminderText : metaPaths;\n    return (\n      <>\n        <svg width={svgWidth} height={svgHeight}>\n          {content}\n          {/* overlap loading icon when it is loading */}\n          {isAttentionLoading ? (\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={svgWidth}\n                height={svgOuterHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${svgWidth / 2}, ${svgOuterHeight / 2})`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          ) : (\n            <></>\n          )}\n        </svg>\n\n        <Modal\n          title=\"Edit Explanation\"\n          visible={isModalVisible}\n          onOk={this.hideModal}\n          onCancel={this.hideModal}\n          okText=\"Confirm\"\n          width={width}\n          zIndex={1999}\n        >\n          <svg width={width}></svg>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(PathMatrix);\n","import React from 'react';\nimport { Tabs } from 'antd';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\n\nimport AttentionTree from './AttentionTree';\nimport Graph from './Graph';\nimport Scatter from 'components/CardContainer/Scatter';\n\nimport './index.css';\nimport PathMatrix from 'components/TabContainer/PathMatrix';\n\nconst { TabPane } = Tabs;\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  activeTab: string;\n}\n\nclass NodeLink extends React.Component<Props, State> {\n  titleHeight = 36;\n  margin = 10;\n  padding = 10;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      activeTab: 'metapath',\n    };\n  }\n  changeActiveTab(key: string) {\n    this.setState({ activeTab: key });\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const cardWidth = width - 2 * this.margin - 2 * this.padding,\n      cardHeight =\n        height - 2 * this.padding - this.titleHeight - 2 * this.margin;\n\n    const props = { ...this.props, height: cardHeight, width: cardWidth };\n\n    return (\n      <Tabs\n        size=\"small\"\n        activeKey={this.state.activeTab}\n        style={{\n          width: width - 2 * this.margin,\n          height: height - this.margin,\n          margin: this.margin,\n          marginBottom: 0,\n          backgroundColor: 'white',\n        }}\n        tabBarStyle={{\n          height: this.titleHeight,\n          padding: '0px 10px',\n          margin: '0px',\n        }}\n        onChange={this.changeActiveTab.bind(this)}\n      >\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"metapath\"\n          tab=\"Meta-Path\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <PathMatrix {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"attention\"\n          tab=\"Node Attention\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <AttentionTree {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"graph\" tab=\"Sub-Graph\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Graph {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"embedding\" tab=\"Disease Embeddings\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Scatter width={cardWidth} height={cardHeight} />\n          </div>\n        </TabPane>\n      </Tabs>\n    );\n  }\n}\n\nexport default StateConsumer(NodeLink);\n","import React from 'react';\nimport { StateConsumer } from 'stores';\nimport { IDispatch, IState } from 'types';\nimport {\n  ACTION_TYPES,\n  selectDisease,\n  selectDrug,\n  changeAppMode,\n  selectDrugPrimary,\n  selectDiseaseSecondary,\n} from 'stores/actions';\n\nimport './Sider.css';\n\nimport {\n  Col,\n  InputNumber,\n  Layout,\n  Row,\n  Select,\n  Skeleton,\n  Slider,\n  Tooltip,\n  Radio,\n} from 'antd';\nimport { QuestionCircleOutlined, CheckCircleOutlined } from '@ant-design/icons';\nimport {\n  getNodeColor,\n  sigmoid,\n  wheterRemoveDisease,\n  sentenceCapitalizer,\n  INIT_DISEASE,\n  INIT_DRUGS,\n} from 'helpers';\n\nconst { Sider } = Layout;\nconst { Option } = Select;\n\ninterface Props {\n  siderWidth: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\nclass DrugSider extends React.Component<Props> {\n  padding = 10;\n  listHeight = 450; // height of the open drug list\n  constructor(props: Props) {\n    super(props);\n    this.changeEdgeTHR = this.changeEdgeTHR.bind(this);\n    this.changeRevEdgeTHR = this.changeRevEdgeTHR.bind(this);\n    this.onChangeDisease = this.onChangeDisease.bind(this);\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n    this.onChangeAppMode = this.onChangeAppMode.bind(this);\n    this.onChangeDrugPrimary = this.onChangeDrugPrimary.bind(this);\n    this.onChangeDiseaseSecondary = this.onChangeDiseaseSecondary.bind(this);\n  }\n\n  onChangeAppMode(e: any) {\n    changeAppMode(e.target.value, this.props.dispatch);\n  }\n\n  onChangeDrugPrimary(selectedDrug: string) {\n    selectDrugPrimary(selectedDrug, this.props.dispatch);\n  }\n\n  onChangeDiseaseSecondary(selectedDiseases: string[]) {\n    // For now, we only support selecting one disease at a time in the secondary list for visualization\n    // But the UI might allow multiple. Let's assume the last selected one is the target.\n    // We reuse the selectDrug logic but inverted? No, we need to adapt selectDrug or create a new one.\n    // Actually, the existing selectDrug logic expects a drug ID.\n    // For Drug-to-Disease, we want to visualize the pair.\n    // Let's reuse selectDrug but we need to be careful about what 'selectedDrug' means in state.\n    // In Drug-to-Disease mode:\n    // selectedDrugPrimary is the source drug.\n    // We want to see attention for (selectedDrugPrimary, selectedDisease).\n\n    // Wait, the existing visualization expects `selectedDisease` and `drugPredictions` (with `selected` flag).\n    // If we want to reuse the visualization components without massive refactoring:\n    // We can map:\n    // Drug-to-Disease Mode ->\n    //   selectedDisease in State = The selected disease from the list (Secondary)\n    //   selectedDrug in State = The primary drug (Primary)\n\n    // But `selectedDisease` triggers `requestDrugPredictions`. We don't want that in this mode.\n    // We want `selectedDrugPrimary` to trigger `requestDiseasePredictions`.\n\n    // Let's look at `selectDrug` action:\n    // It calls `modifyAttentionPaths`.\n    // `modifyAttentionPaths` takes (selectedDrug, selectedDisease).\n\n    // So, when a disease is selected in the secondary list:\n    // We should call `modifyAttentionPaths(selectedDrugPrimary, selectedDisease)`.\n\n    const prevSelectedDiseases = this.props.globalState.diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const isAdd = selectedDiseases.length > prevSelectedDiseases.length;\n    const currentDisease = isAdd\n      ? selectedDiseases[selectedDiseases.length - 1]\n      : prevSelectedDiseases.filter((d) => !selectedDiseases.includes(d))[0];\n\n    // Trigger attention path update\n    if (this.props.globalState.selectedDrugPrimary && currentDisease) {\n      const { selectedDrugPrimary } = this.props.globalState;\n\n      // Find the disease prediction to get node_id for attention queries\n      const diseasePrediction = this.props.globalState.diseasePredictions.find(\n        d => d.id === currentDisease\n      );\n\n      // Use node_id if available, otherwise fall back to id\n      const diseaseNodeId = diseasePrediction?.node_id || currentDisease;\n\n      // selectDiseaseSecondary handles both the selection toggle and attention path update\n      selectDiseaseSecondary(\n        currentDisease,  // Pass the id for toggle (matches d.id in diseasePredictions)\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch,\n        diseaseNodeId  // Pass node_id for attention API\n      );\n    }\n  }\n\n  onChangeDrug(selectedDrugs: string[]) {\n    const prevSelectedDrugs = this.props.globalState.drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    const isAdd = selectedDrugs.length > prevSelectedDrugs.length;\n\n    const currentDrug = isAdd\n      ? selectedDrugs[selectedDrugs.length - 1]\n      : prevSelectedDrugs.filter((d) => !selectedDrugs.includes(d))[0];\n    selectDrug(\n      currentDrug,\n      this.props.globalState.selectedDisease,\n      isAdd,\n      this.props.dispatch\n    );\n  }\n  changeEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: value },\n      });\n    }\n  }\n\n  changeRevEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: Math.round(10 - 10 * value) / 10 },\n      });\n    }\n  }\n\n  onChangeDisease(selectedDisease: string) {\n    selectDisease(selectedDisease, this.props.dispatch);\n  }\n  render() {\n    let { siderWidth } = this.props;\n    let {\n      edgeThreshold,\n      nodeTypes,\n      diseaseOptions,\n      drugOptions,\n      drugPredictions,\n      diseasePredictions,\n      nodeNameDict,\n      selectedDisease,\n      selectedDrugPrimary,\n      appMode,\n    } = this.props.globalState;\n\n    // Default to disease-to-drug if undefined\n    const currentMode = appMode || 'disease-to-drug';\n\n    const defaultDiseaseText = 'Search to Select a disease';\n    const defaultDrugText = 'Select a drug from the prediction';\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const selectedDiseaseIds = diseasePredictions\n      ? diseasePredictions.filter((d) => d.selected).map((d) => d.id)\n      : [];\n\n    const untreatable_disease_icon = (\n      <Tooltip\n        // title=\"The knowledge graph contains no drug for treating this disease\"\n        title=\"Diseases with no known drug indications in the dataset\"\n      >\n        <QuestionCircleOutlined style={{ color: '#eb2f96' }} />\n      </Tooltip>\n    );\n\n    const known_drug_icon = (\n      <Tooltip\n        // title=\"the knowledge graph contains this drug indication\"\n        title=\"US FDA-approved drug indication\"\n      >\n        <CheckCircleOutlined style={{ color: '#52c41a' }} />\n      </Tooltip>\n    );\n\n    let sider = (\n      <Sider\n        width={siderWidth}\n        theme=\"light\"\n        style={{ padding: `${this.padding}px` }}\n      >\n        <div style={{ marginBottom: 10, textAlign: 'center' }}>\n          <Radio.Group value={currentMode} onChange={this.onChangeAppMode}>\n            <Radio.Button value=\"disease-to-drug\">Disease &rarr; Drug</Radio.Button>\n            <Radio.Button value=\"drug-to-disease\">Drug &rarr; Disease</Radio.Button>\n          </Radio.Group>\n        </div>\n\n        {currentMode === 'disease-to-drug' ? (\n          <>\n            Disease:\n            <Select\n              defaultValue={INIT_DISEASE}\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDisease}\n              showSearch\n              optionFilterProp=\"label\"\n              value={selectedDisease}\n            >\n              {diseaseOptions.length > 0 ? (\n                diseaseOptions\n                  .filter(\n                    (d) => {\n                      if (!nodeNameDict['disease'] || !nodeNameDict['disease'][d[0]]) return true;\n                      return !wheterRemoveDisease(nodeNameDict['disease'][d[0]]);\n                    }\n                  )\n                  .map((d) => {\n                    const [id, treatable] = d;\n                    const name = (nodeNameDict['disease'] && nodeNameDict['disease'][id]) || id;\n                    const cropName =\n                      name.length * 10 > siderWidth * 0.8\n                        ? name.slice(0, 40) + '...'\n                        : name;\n                    return (\n                      <Option value={id} label={name} key={`diseaseID_${d}`}>\n                        <span title={name}> {sentenceCapitalizer(cropName)} </span>\n                        {!treatable && untreatable_disease_icon}\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\">\n                  data is loading..\n                </Option>\n              )}\n            </Select>\n            <br />\n            Drug:\n            {drugPredictions.length === 0 ? (\n              // <span>Data is Loading.. </span>\n              <Skeleton />\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDrug}\n                defaultValue={INIT_DRUGS}\n                value={selectedDrugIds}\n                // menuItemSelectedIcon={<EyeOutlined />}\n                menuItemSelectedIcon={<></>}\n              >\n                {drugPredictions.map((d, idx) => {\n                  const { id: drug_id, score, known } = d;\n                  const name = (nodeNameDict['drug'] && nodeNameDict['drug'][drug_id]) || drug_id;\n                  const cropName =\n                    name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  return (\n                    <Option value={drug_id} key={`disease_${idx}`} label={name}>\n                      <div>\n                        <span>\n                          [{idx + 1}] <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span style={{ float: 'right' }}>\n                          score: {sigmoid(score).toFixed(3)}\n                          {/* rank: {idx + 1} */}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        ) : (\n          <>\n            Drug:\n            <Select\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDrugPrimary}\n              showSearch\n              optionFilterProp=\"label\"\n              placeholder=\"Click to select a drug\"\n              value={selectedDrugPrimary}\n              dropdownStyle={{ maxHeight: 400, overflow: 'auto' }}\n              listHeight={350}\n              virtual={false}\n            >\n              {drugOptions && drugOptions.length > 0 ? (\n                // Sort drugs alphabetically by name\n                [...drugOptions]\n                  .map((drug_id) => ({\n                    id: drug_id,\n                    name: nodeNameDict['drug'] ? nodeNameDict['drug'][drug_id] : drug_id\n                  }))\n                  .sort((a, b) => (a.name || a.id).localeCompare(b.name || b.id))\n                  .map(({ id: drug_id, name }, idx) => {\n                    const displayName = name || drug_id;\n                    return (\n                      <Option value={drug_id} label={displayName} key={`drugID_${drug_id}`}>\n                        <div style={{ padding: '4px 0' }}>\n                          <span style={{ fontWeight: 500 }}>[{idx + 1}]</span>{' '}\n                          <span title={displayName}>{displayName}</span>\n                        </div>\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\" disabled>\n                  Loading drugs... (Please wait)\n                </Option>\n              )}\n            </Select>\n            <br />\n            Disease Candidates:\n            {!diseasePredictions || diseasePredictions.length === 0 ? (\n              this.props.globalState.isDiseaseLoading ? <Skeleton /> : <div>Select a drug to see candidates</div>\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDiseaseSecondary}\n                value={selectedDiseaseIds}\n                menuItemSelectedIcon={<></>}\n              >\n                {diseasePredictions.map((d, idx) => {\n                  const { id: disease_id, score, known, name: predictionName } = d;\n                  const name = predictionName || (nodeNameDict['disease'] ? nodeNameDict['disease'][disease_id] : disease_id);\n                  const cropName =\n                    name && name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  return (\n                    <Option value={disease_id} key={`drug_${idx}`} label={name}>\n                      <div>\n                        <span>\n                          [{idx + 1}] <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span style={{ float: 'right' }}>\n                          score: {sigmoid(score).toFixed(3)}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        )}\n\n        <div className=\"dummy\" style={{ height: this.listHeight + 20 }} />\n        Minimum self-explaining edge score:\n        <Row gutter={20}>\n          <Col span={5}>\n            <InputNumber\n              value={edgeThreshold}\n              onChange={this.changeEdgeTHR}\n              style={{ width: '100%' }}\n              step={0.1}\n              min={0}\n              max={1}\n            />\n          </Col>\n          <Col span={16}>\n            <Slider\n              step={0.1}\n              value={1 - edgeThreshold}\n              min={0}\n              max={1}\n              onChange={this.changeRevEdgeTHR}\n              marks={{ 0: '1.0', 1: '0.0' }}\n              reverse={true}\n              tipFormatter={(value?: number) => {\n                return value && (1 - value).toFixed(1);\n              }}\n            />\n          </Col>\n        </Row>\n        <div className=\"nodeTypes\">\n          Node Types:\n          <br />\n          {nodeTypes.map((nodeType) => {\n            return (\n              <div key={nodeType} style={{ marginLeft: '5px' }}>\n                {/* <input type=\"checkbox\" style={{ margin: \"2px\" }} /> */}\n                <span\n                  style={{\n                    background: getNodeColor(nodeType),\n                    color: 'white',\n                    padding: '2px',\n                  }}\n                >\n                  {nodeType}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n        <br />\n        {/* <Button\n          icon={<SearchOutlined />}\n          type=\"primary\"\n          shape=\"round\"\n          onClick={() => this.startAnalysis()}\n        >\n          Show Attention Tree\n        </Button> */}\n        <br />\n      </Sider>\n    );\n\n    return sider;\n  }\n}\n\nexport default StateConsumer(DrugSider);\n","import React from 'react';\nimport NodeLink from 'components/TabContainer';\nimport DrugSider from 'components/Sider';\n\nimport { Layout, Modal } from 'antd';\nimport { InfoCircleOutlined, LinkOutlined } from '@ant-design/icons';\nimport './App.css';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\nimport { ACTION_TYPES, selectDisease, selectDrug, selectDrugPrimary, selectDiseaseSecondary, changeAppMode } from 'stores/actions';\nimport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestNodeNameDict,\n  requestDiseaseOptions,\n  requestDrugList,\n} from 'stores/DataService';\nimport { setNodeColor, LOADING_ICON, INIT_DRUG_PRIMARY, INIT_DISEASES, DEFAULT_APP_MODE } from 'helpers';\n\nconst { Header, Footer, Content } = Layout;\n\ninterface Props {\n  globalState: IState;\n  dispatch: IDispatch;\n}\ninterface State {\n  width: number;\n  height: number;\n  isModalVisible: boolean;\n}\n\nclass App extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      isModalVisible: false,\n    };\n\n    this.updateSize = this.updateSize.bind(this);\n  }\n\n  showModal = () => {\n    this.setState({ isModalVisible: true });\n  };\n\n  hideModal = () => {\n    this.setState({ isModalVisible: false });\n  };\n\n  updateSize() {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    });\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.updateSize);\n\n    requestNodeTypes()\n      .then((nodeTypes) => {\n        setNodeColor(nodeTypes);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Types,\n          payload: { nodeTypes },\n        });\n      })\n      .then(() => requestEdgeTypes())\n      .then((edgeTypes) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Edge_Types,\n          payload: { edgeTypes },\n        });\n      })\n      .then(() => requestNodeNameDict())\n      .then((nodeNameDict) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Name_Dict,\n          payload: { nodeNameDict },\n        });\n      })\n      .then(() => requestDiseaseOptions())\n      .then((diseaseOptions) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Disease_Options,\n          payload: { diseaseOptions },\n        });\n      })\n      .then(() => requestDrugList())\n      .then((drugList) => {\n        // Load available drugs for selection\n        const drugOptions = drugList.map(d => d.id);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions },\n        });\n      })\n      // Initialize in drug-to-disease mode with Inebilizumab\n      .then(() => {\n        changeAppMode(DEFAULT_APP_MODE, this.props.dispatch);\n      })\n      .then(() => selectDrugPrimary(INIT_DRUG_PRIMARY, this.props.dispatch))\n      .then(() => {\n        // Select first disease prediction\n        if (INIT_DISEASES.length > 0) {\n          selectDiseaseSecondary(INIT_DISEASES[0], INIT_DRUG_PRIMARY, true, this.props.dispatch);\n        }\n      })\n      .then(() => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Set_Loading_Status,\n          payload: { isInitializing: false },\n        });\n      });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateSize);\n  }\n\n  render() {\n    let siderWidth = 380,\n      footHeight = 20,\n      mainViewWidth = Math.max(0, window.innerWidth - siderWidth),\n      headerHeight = 64,\n      mainViewHeight = Math.max(0, window.innerHeight - headerHeight - footHeight);\n\n    const { isInitializing } = this.props.globalState;\n\n    let header = (\n      <Header className=\"header\" style={{ height: headerHeight }}>\n        <img\n          src=\"favicon.ico\"\n          style={{ height: headerHeight * 0.8, padding: '2px 10px' }}\n          alt=\"logo\"\n        />\n        <b style={{ fontSize: '30px' }}>Amgen Drugs and candidate Diseases Explorer</b>\n        <span\n          style={{ float: 'right', cursor: 'pointer' }}\n          onClick={this.showModal}\n        >\n          <InfoCircleOutlined\n            style={{ height: headerHeight, fontSize: '20px' }}\n          />\n          <span\n            style={{\n              paddingLeft: '5px',\n              fontSize: '18px',\n              height: headerHeight,\n            }}\n          >\n            About\n          </span>{' '}\n        </span>\n      </Header>\n    );\n\n    return (\n      <>\n        <Layout>\n          {header}\n\n          <Layout>\n            <DrugSider siderWidth={siderWidth} />\n            <Content className=\"main\" style={{ height: mainViewHeight }}>\n              <NodeLink width={mainViewWidth} height={mainViewHeight - footHeight} />\n              <Footer\n                style={{\n                  textAlign: 'center',\n                  color: 'gray',\n                  height: footHeight,\n                  padding: 0,\n                }}\n              >\n\n                <span style={{ color: 'gray' }}>\n                  {' '}\n                  <b onClick={this.showModal} style={{ cursor: 'help' }}>\n                    DISCLAIMER:\n                  </b>\n                  THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE{' '}\n                </span>\n              </Footer>\n            </Content>\n          </Layout>\n        </Layout>\n\n        {isInitializing && (\n          <svg\n            width={window.innerWidth}\n            height={window.innerHeight}\n            style={{ position: 'absolute', left: 0, top: 0 }}\n          >\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={window.innerWidth}\n                height={window.innerHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${window.innerWidth / 2}, ${window.innerHeight / 2\n                  })`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          </svg>\n        )}\n\n        <Modal\n          title=\"About Amgen Drugs and candidate Diseases Explorer\"\n          className=\"about-modal\"\n          visible={this.state.isModalVisible}\n          footer={null}\n          onCancel={this.hideModal}\n          zIndex={1099}\n          width={window.innerWidth * 0.5}\n        >\n          <h3>About</h3>\n          <p>\n            This Drug and Diseases Explorer provides a visual interface to interact with the predictions and explanations of an AI model that identify candidate diseases with limited treatment options and minimal molecular understanding for a given Drug.\n          </p>\n          <p>\n            AI model is a graph neural network pre-trained on a comprehensive knowledge graph of 17,080 clinically-recognized diseases and 7,957 therapeutic candidates. The model can process various therapeutic tasks in a unified formulation. Once trained, the model can perform zero-shot inference on new diseases without the need for additional parameters or fine-tuning on ground truth labels.\n          </p>\n\n          <h3>Medical Advice Disclaimer</h3>\n          <p>\n            DISCLAIMER: THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE\n            <br />\n            The information, including but not limited to, text, graphics, images and other material contained on this website are for informational purposes only. No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment. Always seek the advice of your physician or other qualified health care provider with any questions you may have regarding a medical condition or treatment and before undertaking a new health care regimen, and never disregard professional medical advice or delay in seeking it because of something you have read on this website.\n          </p>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'antd/dist/antd.css';\nimport { StateProvider } from 'stores';\n\nReactDOM.render(\n  <StateProvider>\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>\n  </StateProvider>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}