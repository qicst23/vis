(this.webpackJsonpdrug_mlvis=this.webpackJsonpdrug_mlvis||[]).push([[0],{163:function(e,t,n){},238:function(e,t,n){e.exports=n(270)},243:function(e,t,n){},267:function(e,t,n){},268:function(e,t,n){},270:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(32),o=n.n(i),l=(n(243),n(25)),s=n(26),c=n(31),d=n(29),u=n(28),p=n(10),h=n(273),g=n(36),m=n(84),f=n(30),y=n(15),b=n.n(y),v=n(24),E=n(165),x=n.n(E).a.create({baseURL:"".concat("./","/"),withCredentials:!1,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,PATCH,OPTIONS"}}),k=new(function(){function e(){Object(l.a)(this,e),this.cache=new Map,this.pendingRequests=new Map,this.preloadProgress={total:0,completed:0,inProgress:!1,currentDrug:""},this.listeners=new Set}return Object(s.a)(e,[{key:"get",value:function(e){var t=this.cache.get(e);return t?Date.now()-t.timestamp>864e5?(this.cache.delete(e),null):t.data:null}},{key:"set",value:function(e,t){this.cache.set(e,{data:t,timestamp:Date.now()}),this.notifyListeners()}},{key:"has",value:function(e){return null!==this.get(e)}},{key:"clear",value:function(){this.cache.clear(),this.pendingRequests.clear(),this.preloadProgress={total:0,completed:0,inProgress:!1,currentDrug:""},this.notifyListeners()}},{key:"getOrFetch",value:function(){var e=Object(v.a)(b.a.mark((function e(t,n){var a,r,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(a=this.get(t))){e.next=3;break}return e.abrupt("return",a);case 3:if(!this.pendingRequests.has(t)){e.next=5;break}return e.abrupt("return",this.pendingRequests.get(t));case 5:return r=n().then((function(e){return i.set(t,e),i.pendingRequests.delete(t),e})).catch((function(e){throw i.pendingRequests.delete(t),e})),this.pendingRequests.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getStats",value:function(){return{size:this.cache.size,preloadProgress:this.preloadProgress,keys:Array.from(this.cache.keys())}}},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),function(){return t.listeners.delete(e)}}},{key:"notifyListeners",value:function(){this.listeners.forEach((function(e){return e()}))}}]),e}()),w=k,S=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./txgnn_data/node_types.json",e.next=3,x.get("./txgnn_data/node_types.json");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./txgnn_data/edge_types.json",e.next=3,x.get("./txgnn_data/edge_types.json");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/node_name_dict",e.next=3,x.get("./api/node_name_dict");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(v.a)(b.a.mark((function e(t,n){var a,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="attention_pair:".concat(n,":").concat(t),!(r=w.get(a))){e.next=5;break}return console.log("[Cache HIT] attention_pair for ".concat(n,"-").concat(t)),e.abrupt("return",r);case 5:return console.log("[Cache MISS] fetching attention_pair for ".concat(n,"-").concat(t)),i="./api/attention_pair?disease=".concat(t,"&drug=").concat(n),e.next=9,x.get(i);case 9:return o=e.sent,w.set(a,o.data),e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=Object(v.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/diseases",e.next=3,x.get("./api/diseases");case 3:return t=e.sent,n=t.data,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(v.a)(b.a.mark((function e(t){var n,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="./api/drug_predictions?disease_id=".concat(t),e.next=3,x.get(n);case 3:return a=e.sent,r=a.data,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(v.a)(b.a.mark((function e(t){var n,a,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="disease_predictions:".concat(t),!(a=w.get(n))){e.next=5;break}return console.log("[Cache HIT] disease_predictions for ".concat(t)),e.abrupt("return",a);case 5:return console.log("[Cache MISS] fetching disease_predictions for ".concat(t)),r="./api/disease_predictions?drug_id=".concat(t,"&top_n=100"),e.next=9,x.get(r);case 9:return i=e.sent,o=i.data,w.set(n,o),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(v.a)(b.a.mark((function e(t){var n,a,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="embeddings:".concat(t||"default"),!(a=w.get(n))){e.next=5;break}return console.log("[Cache HIT] embeddings for ".concat(t||"default")),e.abrupt("return",a);case 5:return console.log("[Cache MISS] fetching embeddings for ".concat(t||"default")),r=t?"./api/disease_embeddings?drug_id=".concat(t):"./data/disease_tsne.json",e.next=9,x.get(r);case 9:return i=e.sent,w.set(n,i.data),e.abrupt("return",i.data);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"./api/drug_list",e.next=3,x.get("./api/drug_list");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(v.a)(b.a.mark((function e(t,n){var a,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="subgraph:".concat(t,":").concat(n),!(r=w.get(a))){e.next=5;break}return console.log("[Cache HIT] subgraph for ".concat(t,"-").concat(n)),e.abrupt("return",r);case 5:return console.log("[Cache MISS] fetching subgraph for ".concat(t,"-").concat(n)),i="./api/subgraph?drug_id=".concat(t,"&disease_id=").concat(n),e.next=9,x.get(i);case 9:return o=e.sent,w.set(a,o.data),e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(v.a)(b.a.mark((function e(t,n){var a,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="best_path:".concat(t,":").concat(n),!(r=w.get(a))){e.next=5;break}return console.log("[Cache HIT] best_path for ".concat(t,"-").concat(n)),e.abrupt("return",r);case 5:return console.log("[Cache MISS] fetching best_path for ".concat(t,"-").concat(n)),i="./api/best_path?drug_id=".concat(t,"&disease_id=").concat(n),e.next=9,x.get(i);case 9:return o=e.sent,w.set(a,o.data),e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=new Set,H=function(e){R.forEach((function(t){return t(e)}))},z=function(){var e=Object(v.a)(b.a.mark((function e(t){var n,a,r,i,o,l,s,c,d,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.preloadProgress.inProgress||k.preloadProgress.currentDrug!==t){e.next=3;break}return console.log("[Preload] Already preloading ".concat(t,", skipping...")),e.abrupt("return");case 3:return console.log("[Preload] Starting AGGRESSIVE preload for drug ".concat(t,"...")),n=Date.now(),k.preloadProgress={total:0,completed:0,inProgress:!0,currentDrug:t},e.prev=6,e.next=9,j(t);case 9:for(a=e.sent,r=a.predictions||[],console.log("[Preload] Got ".concat(r.length," disease predictions for ").concat(t)),i=C(t),o=r.slice(0,30),k.preloadProgress.total=2*o.length+1,10,l=[],s=0;s<o.length;s+=10)c=o.slice(s,s+10),d=c.flatMap((function(e){var n=e.node_id||e.id;return[P(n,t).then((function(){k.preloadProgress.completed++,H({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t})})).catch((function(e){console.warn("Failed to preload attention for ".concat(n,":"),e),k.preloadProgress.completed++})),A(t,n).then((function(){k.preloadProgress.completed++,H({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t})})).catch((function(e){console.warn("Failed to preload subgraph for ".concat(n,":"),e),k.preloadProgress.completed++}))]})),l.push.apply(l,Object(f.a)(d));return e.next=20,i;case 20:return k.preloadProgress.completed++,H({total:k.preloadProgress.total,completed:k.preloadProgress.completed,drugId:t}),e.next=24,Promise.all(l);case 24:u=Date.now()-n,console.log("[Preload] \u2713 Completed for drug ".concat(t," in ").concat(u,"ms - ").concat(k.getStats().size," items cached")),k.preloadProgress.inProgress=!1,H({total:k.preloadProgress.total,completed:k.preloadProgress.total,drugId:t}),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(6),console.error("[Preload] Error:",e.t0),k.preloadProgress.inProgress=!1;case 34:case"end":return e.stop()}}),e,null,[[6,30]])})));return function(t){return e.apply(this,arguments)}}(),M=function(e){return function(e){return R.add(e),function(){return R.delete(e)}}(e)},G="Load_Node_Types",W="Load_Edge_Types",L="Add_Attention_Paths",B="Del_Attention_Paths",F="Load_Node_Name_Dict",U="Load_Drug_Options",V="Load_Disease_Options",Y="Load_Disease_Predictions",q="Load_Drug_List",K="Set_Loading_Status",Z="Change_Edge_THR",J="Change_Drug",X="Change_Disease",$="Change_App_Mode",Q="Change_Selected_Drug_Primary",ee="Select_Path_Nodes",te="Toggle_Meta_Path_Hide",ne="Toggle_Disease_Selection",ae=function(e,t,n,a){t&&(le(e,t,n,a),se(e,a))},re=function(e,t){return t({type:K,payload:{isDiseaseLoading:!0}}),t({type:Q,payload:{selectedDrugPrimary:e}}),t({type:X,payload:{selectedDisease:void 0}}),j(e).then((function(n){var a=n.predictions.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{selected:!1})}));t({type:Y,payload:{diseasePredictions:a}}),console.log("[Preload] Starting background preload for ".concat(e,"...")),z(e).then((function(){console.log("[Preload] Background preload complete for ".concat(e))}))})).then((function(){t({type:K,payload:{isDiseaseLoading:!1}})}))},ie=function(e,t){t({type:$,payload:{appMode:e}}),"drug-to-disease"===e&&fetch("http://127.0.0.1:8002/api/drugs").then((function(e){return e.json()})).then((function(e){t({type:q,payload:{drugOptions:e}})}))},oe=function(e,t,n,a,r){var i=r||e;a({type:ne,payload:{diseaseId:e}}),a({type:X,payload:{selectedDisease:i}}),a({type:J,payload:{selectedDrug:t}}),le(t,i,n,a,e)},le=function(e,t,n,a,r){var i=r||e;void 0!==e&&void 0!==t&&void 0!==i&&(n?(a({type:K,payload:{isAttentionLoading:!0}}),P(t,e).then((function(e){a({type:L,payload:{attention:e.attention,selectedDrug:i,metaPathGroups:Object(m.a)({},i,ce(e.metapaths))}})})).then((function(){a({type:K,payload:{isAttentionLoading:!1}})}))):a({type:B,payload:{selectedDrug:i}}))},se=function(e,t){t({type:J,payload:{selectedDrug:e}})},ce=function(e){var t=[],n=[];return e.forEach((function(e){e.hide=!1;var a=e.nodes.map((function(e){return e.nodeType})).join("_"),r=n.indexOf(a);r>-1?t[r].paths.push(e):(n.push(a),t.push({nodeTypes:e.nodes.map((function(e){return e.nodeType})),paths:[e]}))})),t},de=function(e,t){return e.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{selected:t===e.id?!e.selected:e.selected})}))},ue=function(e,t,n,a){var r=e.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{count:Object(p.a)({},e.count)})})),i=String(n);return a&&t?t.forEach((function(e){var t=e.paths.length,n=r.find((function(t){return t.nodeTypes.join()===e.nodeTypes.join()}));n?(n.count[i]=t,n.sum+=t):r.push({nodeTypes:e.nodeTypes,count:Object(m.a)({},i,t),sum:t,hide:!1,idx:r.length})})):a||(r.forEach((function(e){i in e.count&&(e.sum-=e.count[i],delete e.count[i])})),r=r.filter((function(e){return e.sum>0}))),r},pe=function(e,t){return!e.filter((function(e){return e.selected})).map((function(e){return e.id})).includes(t)},he=function(e,t){switch(t.type){case U:return Object(p.a)(Object(p.a)({},e),{},{drugPredictions:t.payload.drugPredictions});case V:return Object(p.a)(Object(p.a)({},e),{},{diseaseOptions:t.payload.diseaseOptions});case G:return Object(p.a)(Object(p.a)({},e),{},{nodeTypes:t.payload.nodeTypes});case W:return Object(p.a)(Object(p.a)({},e),{},{edgeTypes:t.payload.edgeTypes});case X:return Object(p.a)(Object(p.a)({},e),{},{selectedDisease:t.payload.selectedDisease,attention:{},metaPathGroups:{},metaPathSummary:[]});case J:return Object(p.a)(Object(p.a)({},e),{},{drugPredictions:de(e.drugPredictions,t.payload.selectedDrug)});case F:return Object(p.a)(Object(p.a)({},e),{},{nodeNameDict:t.payload.nodeNameDict});case K:return Object(p.a)(Object(p.a)({},e),t.payload);case ee:return Object(p.a)(Object(p.a)({},e),{},{selectedPathNodes:t.payload.selectedPathNodes});case Z:return Object(p.a)(Object(p.a)({},e),{},{edgeThreshold:t.payload.edgeThreshold});case te:return Object(p.a)(Object(p.a)({},e),{},{metaPathSummary:t.payload.metaPathSummary});case L:return Object(p.a)(Object(p.a)({},e),{},{attention:Object(p.a)(Object(p.a)({},e.attention),t.payload.attention),metaPathGroups:Object(p.a)(Object(p.a)({},e.metaPathGroups),t.payload.metaPathGroups),metaPathSummary:ue(e.metaPathSummary,t.payload.metaPathGroups[t.payload.selectedDrug],t.payload.selectedDrug,!0)});case B:var n=JSON.parse(JSON.stringify(e.attention)),a=JSON.parse(JSON.stringify(e.metaPathGroups)),r=t.payload.selectedDrug,i=a[r];delete n["disease:".concat(r)],delete n["drug:".concat(r)],delete a[r];var o=ue(e.metaPathSummary,i,r,!1);return Object(p.a)(Object(p.a)({},e),{},{attention:n,metaPathGroups:a,metaPathSummary:o});case $:return Object(p.a)(Object(p.a)({},e),{},{appMode:t.payload.appMode});case Q:return Object(p.a)(Object(p.a)({},e),{},{selectedDrugPrimary:t.payload.selectedDrugPrimary,diseasePredictions:[],attention:{},metaPathGroups:{},metaPathSummary:[]});case Y:return Object(p.a)(Object(p.a)({},e),{},{diseasePredictions:t.payload.diseasePredictions});case ne:var l=t.payload.diseaseId,s=e.diseasePredictions.map((function(e){return e.id===l?Object(p.a)(Object(p.a)({},e),{},{selected:!e.selected}):e}));return Object(p.a)(Object(p.a)({},e),{},{diseasePredictions:s});case q:return Object(p.a)(Object(p.a)({},e),{},{drugOptions:t.payload.drugOptions});default:return e}},ge={diseaseOptions:[],drugPredictions:[],nodeTypes:[],edgeTypes:{},metaPathGroups:{},attention:{},selectedDisease:void 0,nodeNameDict:{},isInitializing:!0,isDrugLoading:!1,isAttentionLoading:!1,isDiseaseLoading:!1,edgeThreshold:0,metaPathSummary:[],selectedPathNodes:[],drugOptions:[],diseasePredictions:[],selectedDrugPrimary:void 0,appMode:"disease-to-drug"},me=Object(a.createContext)({});function fe(e){var t=r.a.useReducer(he,ge),n=Object(g.a)(t,2),a=n[0],i=n[1],o=r.a.useCallback(function(e,t){return function(n){return"function"===typeof n?n(e,t):e(n)}}(i,a),[]);return r.a.createElement(me.Provider,{value:{state:a,dispatch:o}},e.children)}function ye(e){return function(t){return r.a.createElement(me.Consumer,null,(function(n){return r.a.createElement(e,Object.assign({},t,{globalState:n.state,dispatch:n.dispatch}))}))}}var be=n(12),ve=n(178),Ee=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:800,r=e,i=document.createElement("canvas").getContext("2d");i.font="".concat(a," ").concat(t,"px Arial");var o=i.measureText(e).width;if(o>n)for(var l=1;l<e.length;l+=1){var s=e.substr(0,l-1).concat("..."),c=e.substr(0,l).concat("..."),d=i.measureText(s).width,u=i.measureText(c).width;if(u>n&&d<n){r=s;break}}return r},xe=function(e,t){var n=document.createElement("canvas").getContext("2d");return n.font="".concat(t,"px Arial"),n.measureText(e).width},ke=r.a.createElement("g",null,r.a.createElement("text",{textAnchor:"middle",x:"24"},"LOADING..."),r.a.createElement("rect",{x:"0",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0",dur:"0.6s",repeatCount:"indefinite"})),r.a.createElement("rect",{x:"20",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.2s",dur:"0.6s",repeatCount:"indefinite"})),r.a.createElement("rect",{x:"40",y:"50",width:"14",height:"30",fill:"#1890ff"},r.a.createElement("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.4s",dur:"0.6s",repeatCount:"indefinite"}))),we=["#4e79a7","#edc949","#e15759","#f28e2c","#76b7b2","#59a14f","#af7aa1","#ff9da7","#9c755f","#bab0ab"],Se={},_e=function(e){return void 0===Se[e]&&(Se[e]=we[Object.keys(Se).length]),Se[e]},De=function e(t,n){return t.children.length>0&&(t=Object(p.a)(Object(p.a)({},t),{},{children:t.children.filter((function(e){return e.score>=n})).map((function(t){return e(t,n)}))})),t},Pe=function(e){return 1/(1+Math.pow(Math.E,-e))},Oe=["mendelian disease","disease of cell nucleous","hip region disease","acute disease","vector borne disease","cancer","sex-linked disease","movement disorder"],Ie=["15783","7381","15896"],je=["DB12530"],Ce=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).nodeHeight=20,e.fontSize=14,e.labelLength=150,e.midGap=60,e}return Object(s.a)(n,[{key:"drawNodeAttentionHorizontal",value:function(e,t,n){var a=this,i=this.props.width,o=this.props.globalState,l=o.nodeNameDict,s=o.edgeTypes,c=o.selectedPathNodes,d=De(e,n),u=be.i(d),p=be.n().nodeSize([this.nodeHeight+2,t])(u),h=be.j().source((function(e){return{x:"drug"===p.data.nodeType?i/2-a.midGap/2-a.labelLength-e.source.y-a.labelLength/2:e.source.y+a.labelLength/2,y:e.source.x}})).target((function(e){return{x:"drug"===p.data.nodeType?i/2-a.midGap/2-a.labelLength-e.target.y+a.labelLength/2:e.target.y-a.labelLength/2,y:e.target.x}})).x((function(e){return e.x})).y((function(e){return e.y})),g=Math.max.apply(Math,Object(f.a)(p.links().map((function(e){return e.target.data.score})))),m=be.k().domain([0,g]).range([1,5]),y=p.links().map((function(e,t){var n=e.target.data.edgeInfo.replace("rev_","");return s[n]&&(n=s[n].edgeInfo||n),r.a.createElement(ve.a,{title:n,key:"".concat(e.source.data.nodeId,"=>").concat(e.target.data.nodeId,"_link").concat(t),destroyTooltipOnHide:!0},r.a.createElement("g",null,r.a.createElement("path",{d:h(e),className:"link ".concat(e.source.data.nodeId,"=>").concat(e.target.data.nodeId),fill:"none",stroke:"gray",strokeWidth:m(e.target.data.score),opacity:c.length>0?.5:1}),r.a.createElement("path",{d:h(e),className:"mask",fill:"none",stroke:"transparent",strokeWidth:"3"})))})),b=p.descendants().map((function(e){return e.x})),v=Math.min.apply(Math,Object(f.a)(b)),E=Math.max.apply(Math,Object(f.a)(b))-v+this.nodeHeight+4,x=p.descendants().map((function(e,t){var n=e.data,o=n.nodeId,s=n.nodeType,d=l[s][o];void 0===d&&(o=o.replace(/_/g,"")+".0",d=l[s][o]);var u=Ee(d,12,a.labelLength-25-xe("..(0.00)",14)),h=(null===u||void 0===u?void 0:u.includes(".."))?d:"";e.data.source&&(h=h?"".concat(h," (").concat(e.data.source,")"):"".concat(d," (").concat(e.data.source,")"));var g="";"disease"===s&&(g="M 483.55 227.55 H 462 c -50.68 0 -76.07 -61.27 -40.23 -97.11 L 437 115.19 A 28.44 28.44 0 0 0 396.8 75 L 381.56 90.22 c -35.84 35.83 -97.11 10.45 -97.11 -40.23 V 28.44 a 28.45 28.45 0 0 0 -56.9 0 V 50 c 0 50.68 -61.27 76.06 -97.11 40.23 L 115.2 75 A 28.44 28.44 0 0 0 75 115.19 l 15.25 15.25 c 35.84 35.84 10.45 97.11 -40.23 97.11 H 28.45 a 28.45 28.45 0 1 0 0 56.89 H 50 c 50.68 0 76.07 61.28 40.23 97.12 L 75 396.8 A 28.45 28.45 0 0 0 115.2 437 l 15.24 -15.25 c 35.84 -35.84 97.11 -10.45 97.11 40.23 v 21.54 a 28.45 28.45 0 0 0 56.9 0 V 462 c 0 -50.68 61.27 -76.07 97.11 -40.23 L 396.8 437 A 28.45 28.45 0 0 0 437 396.8 l -15.25 -15.24 c -35.84 -35.84 -10.45 -97.12 40.23 -97.12 h 21.54 a 28.45 28.45 0 1 0 0 -56.89 Z M 224 272 a 48 48 0 1 1 48 -48 A 48 48 0 0 1 224 272 Z m 80 56 a 24 24 0 1 1 24 -24 A 24 24 0 0 1 304 328 Z"),"drug"===s&&(g="M 555.3 300.1 L 424.2 112.8 C 401.9 81 366.4 64 330.4 64 c -22.6 0 -45.5 6.7 -65.5 20.7 c -19.7 13.8 -33.7 32.8 -41.5 53.8 C 220.5 79.2 172 32 112 32 C 50.1 32 0 82.1 0 144 v 224 c 0 61.9 50.1 112 112 112 s 112 -50.1 112 -112 V 218.9 c 3.3 8.6 7.3 17.1 12.8 25 L 368 431.2 c 22.2 31.8 57.7 48.8 93.8 48.8 c 22.7 0 45.5 -6.7 65.5 -20.7 c 51.7 -36.2 64.2 -107.5 28 -159.2 Z M 160 256 H 64 V 144 c 0 -26.5 21.5 -48 48 -48 s 48 21.5 48 48 v 112 Z m 194.8 44.9 l -65.6 -93.7 c -7.7 -11 -10.7 -24.4 -8.3 -37.6 c 2.3 -13.2 9.7 -24.8 20.7 -32.5 c 8.5 -6 18.5 -9.1 28.8 -9.1 c 16.5 0 31.9 8 41.3 21.5 l 65.6 93.7 l -82.5 57.7 Z");var m=0===c.length||c.map((function(e){return e.nodeType})).includes(s)&&c.map((function(e){return e.nodeId})).includes(o);return r.a.createElement(ve.a,{title:h,key:"node".concat(t,"_").concat(d),destroyTooltipOnHide:!0,mouseEnterDelay:.3},r.a.createElement("g",{className:"".concat(o," node"),transform:"translate(".concat("drug"===p.data.nodeType?i/2-a.midGap/2-a.labelLength-e.y:e.y,", ").concat(e.x,")"),cursor:"pointer"},r.a.createElement("rect",{width:a.labelLength,height:a.nodeHeight,fill:_e(s),x:-1*a.labelLength/2,y:-a.nodeHeight/2,opacity:m?1:.2}),r.a.createElement("path",{className:"virus_icon",d:g,transform:"translate(".concat(-1*a.labelLength/2+2,", ").concat(-a.nodeHeight/2,") scale(0.04)"),fill:"white"}),r.a.createElement("text",{fill:"white",fontSize:a.fontSize,transform:"translate(".concat(-1*a.labelLength/2+25,", ").concat((a.nodeHeight-a.fontSize)/2,")")},u),0===e.depth&&void 0===e.children&&r.a.createElement("text",{fill:"gray",fontSize:a.fontSize,transform:"translate(".concat("drug"===p.data.nodeType?-a.labelLength/2-10-xe("No Attention Data",a.fontSize):a.labelLength/2+10,", ").concat((a.nodeHeight-a.fontSize)/2,")")},"No Attention Data")))}));return{content:[r.a.createElement("g",{key:"links",className:"links"},y),r.a.createElement("g",{key:"nodes",className:"nodes"},x)],height:E}}},{key:"drawSubgraph",value:function(){var e=this,t=this.props.globalState,n=t.attention,a=t.edgeThreshold,i=this.props.width,o=(i-2*this.labelLength-this.midGap)/4,l=[0];return{content:Object.keys(n).map((function(t,s){var c=e.drawNodeAttentionHorizontal(n[t],o,a),d=c.height,u=c.content;return l.push(d),r.a.createElement("g",{className:t,key:t,transform:"translate(".concat((i+e.midGap)/2*s+e.labelLength/2,", ").concat(d/2+2*e.nodeHeight,")")},u)})),height:Math.max.apply(Math,l)}}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,a=e.globalState,i=a.isAttentionLoading,o=a.selectedDisease,l=a.drugPredictions,s=a.diseasePredictions,c=a.appMode,d=("drug-to-disease"===c?s:l).filter((function(e){return e.selected})),u=this.drawSubgraph(),p=u.content,h=u.height;return r.a.createElement("svg",{width:t,height:Math.max(h,n),className:"nodeLink"},d.length>0&&("drug-to-disease"===c||o)?p:r.a.createElement("text",{x:t/2,y:n/2,fill:"gray"},"Please select a disease and a drug first"),i?r.a.createElement("g",null,r.a.createElement("rect",{width:t,height:n,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(t/2,", ").concat(n/2,")"),textAnchor:"middle"},ke)):r.a.createElement("g",null))}}]),n}(r.a.Component),Te=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).padding=10,a.RADIUS=7,a.prevNodes=[],a.prevLinks=[],a.simulation=void 0,a.simulation=be.h().force("charge",be.g().strength(-60)).force("link",be.f().id((function(e){return e.id})).distance(35).strength(.6)).force("collision",be.e().radius(a.RADIUS+2)).force("center",be.d(e.width/2,e.height/2)).alphaDecay(.02).velocityDecay(.3),a}return Object(s.a)(n,[{key:"ticked",value:function(e,t){e.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")})),t.select("line.link").attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),t.select("line.mask").attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),t.select("text").attr("text-anchor","middle").attr("transform",(function(e){return"translate(".concat((e.target.x+e.source.x)/2,", ").concat((e.source.y+e.target.y)/2,")")}))}},{key:"dragstarted",value:function(e){be.b.active||this.simulation.alpha(.3).restart(),e.fx=e.x,e.fy=e.y}},{key:"dragged",value:function(e){e.fx=be.b.x,e.fy=be.b.y}},{key:"dragended",value:function(e){be.b.active||this.simulation.alpha(0),e.fx=be.b.x,e.fy=be.b.y}},{key:"isTargetNode",value:function(e){var t=this.props.globalState,n=t.drugPredictions,a=t.diseasePredictions,r=t.selectedDisease,i=t.selectedDrugPrimary,o=t.appMode,l=("drug-to-disease"===o?a:n).filter((function(e){return e.selected})).map((function(e){return e.id}));return"drug-to-disease"===o?l.includes(e.nodeId)||i===e.nodeId:l.includes(e.nodeId)||r===e.nodeId}},{key:"isHighlighted",value:function(e){var t=this.props.globalState.selectedPathNodes;return t.map((function(e){return e.nodeType})).includes(e.nodeType)&&t.map((function(e){return e.nodeId})).includes(e.nodeId)}},{key:"getNodeLinks",value:function(){var e=this,t=this.props.globalState,n=t.drugPredictions,a=t.diseasePredictions,r=t.attention,i=t.selectedDisease,o=t.selectedDrugPrimary,l=t.edgeTypes,s=t.appMode,c=this.props,d=c.width,u=c.height,h=("drug-to-disease"===s?a:n).filter((function(e){return e.selected})).map((function(e){return e.id})),g=[],m=[];Object.values(r).forEach((function(t){var n=be.i(t),a=[];n.descendants().forEach((function(t){var n={id:"".concat(t.data.nodeType,":").concat(t.data.nodeId),nodeId:t.data.nodeId,nodeType:t.data.nodeType},r=e.prevNodes.find((function(e){return e.id===n.id}));a.push(Object(p.a)(Object(p.a)({},n),r))})),g=g.concat(a);var r=n.links().map((function(e){var t,n=e.source.data,a=e.target.data,r=a.edgeInfo.replace("rev_","");return r=(null===(t=l[r])||void 0===t?void 0:t.edgeInfo)||r,{source:"".concat(n.nodeType,":").concat(n.nodeId),target:"".concat(a.nodeType,":").concat(a.nodeId),score:a.score,edgeInfo:r}}));m=m.concat(r)}));for(var f=0;f<g.length;f++){var y=g[f],b=h.indexOf(y.nodeId);"drug-to-disease"===s?y.nodeId===o?(y.fy=u/2,y.fx=.2*d):b>-1&&(y.fy=u/(h.length+1)*(b+1),y.fx=.8*d):y.nodeId===i?(y.fy=u/2,y.fx=.2*d):b>-1&&(y.fy=u/(h.length+1)*(b+1),y.fx=.8*d)}return this.prevNodes=g,this.prevLinks=m,{nodes:g,links:m}}},{key:"drawGraph",value:function(){var e=this,t=this.props.globalState.nodeNameDict,n=this.getNodeLinks(),a=n.nodes,r=n.links,i=this.props,o=i.width,l=i.height,s=be.k().range([2,6]).domain(be.c(r.map((function(e){return e.score})))),c=be.l("svg.graph").select("g.links").selectAll("g.link").data(r).join((function(e){return e.append("g").attr("class","link")})).on("mouseover",(function(){be.l(this).select("text.edgeLabel").transition().delay(500).attr("class","edgeLabel")})).on("mouseout",(function(){be.l(this).select("text.edgeLabel").transition().delay(500).attr("class","edgeLabel hidden")}));c.append("line").attr("x1",(function(e){return e.target.x})).attr("y1",(function(e){return e.target.y})).attr("x2",(function(e){return e.source.x})).attr("y2",(function(e){return e.source.y})).attr("class","link").attr("stroke","#aaa").attr("stroke-width",(function(e){return s(e.score)})).attr("id",(function(e){return e.id})),c.append("line").attr("x1",(function(e){return e.target.x})).attr("y1",(function(e){return e.target.y})).attr("x2",(function(e){return e.source.x})).attr("y2",(function(e){return e.source.y})).attr("class","mask").attr("stroke-width",4).attr("stroke","transparent"),c.append("text").attr("class","edgeLabel hidden").attr("transform",(function(e){return"translate(".concat((e.target.x+e.source.x)/2,", ").concat((e.source.y+e.target.y)/2,")")})).text((function(e){return e.edgeInfo}));var d=be.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").data(a,(function(e){return e.id})).join((function(t){return t.append("g").attr("class","nodeGroup").attr("transform",(function(e){return"translate(".concat(e.x||o/2,", ").concat(e.y||l/2,")")})).attr("cursor","pointer").call(be.a().on("start",e.dragstarted.bind(e)).on("drag",e.dragged.bind(e)).on("end",e.dragended.bind(e)))}),(function(e){return e.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")}))}),(function(e){return e.remove()}));d.append("circle").attr("r",this.RADIUS).attr("class","node").attr("id",(function(e){return e.id})).attr("fill",(function(e){return _e(e.nodeType)})).attr("stroke","white"),d.append("text").attr("class","nodeLabel").attr("transform","translate(".concat(-1*this.RADIUS,", ").concat(-2.5*this.RADIUS," )")).attr("font-size","13px").text((function(e){return t[e.nodeType][e.nodeId]})).classed("hidden",!0),d.filter((function(t){return e.isTargetNode(t)||e.isHighlighted(t)})).select("text.nodeLabel").classed("hidden",!1),d.on("click",(function(e){var t=be.l(this).select("text.nodeLabel"),n=t.classed("hidden");t.classed("hidden",!n)})),this.simulation.nodes(a),this.simulation.force("link").links(r),this.simulation.on("tick",(function(){return e.ticked(d,c)})),this.updateVisibility()}},{key:"updateNodeLabel",value:function(){var e=this;be.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").filter((function(t){return e.isTargetNode(t)||e.isHighlighted(t)})).select("text.nodeLabel").classed("hidden",!1)}},{key:"updateVisibility",value:function(){var e=this.props.globalState,t=e.attention,n=e.edgeThreshold;be.l("svg.graph").selectAll("g.link").style("opacity",(function(e){return e.score>n?1:0}));var a=[];Object.values(t).forEach((function(e){a=a.concat(function e(t){var n,a=[t.nodeId];t.children.length>0&&(a=(n=a).concat.apply(n,Object(f.a)(t.children.map((function(t){return e(t)})))));return a}(De(e,n)))})),be.l("svg.graph").select("g.nodes").selectAll("g.nodeGroup").select("circle").style("opacity",(function(e){return a.includes(e.nodeId)?1:0}))}},{key:"componentDidMount",value:function(){this.drawGraph()}},{key:"componentDidUpdate",value:function(e){var t=e.globalState,n=t.metaPathGroups,a=t.selectedPathNodes,r=t.edgeThreshold,i=t.attention,o=this.props.globalState,l=o.metaPathGroups,s=o.selectedPathNodes,c=o.edgeThreshold,d=o.attention,u=Object.keys(n).sort().join(","),p=Object.keys(l).sort().join(","),h=Object.keys(i).sort().join(","),g=Object.keys(d).sort().join(",");return u===p&&h===g||(this.drawGraph(),this.simulation.alpha(1).restart()),a.map((function(e){return e.nodeId})).join()!==s.map((function(e){return e.nodeId})).join()&&this.updateNodeLabel(),r!==c&&this.updateVisibility(),!1}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,r=this.props.globalState.isAttentionLoading,i=Object.keys(this.props.globalState.metaPathGroups),o=a.createElement("text",{transform:"translate(".concat(t/2,", ").concat(n/2,")"),fill:"gray",fontSize:20},"Please select a drug first");return a.createElement("svg",{className:"graph",width:t,height:n},a.createElement("g",{className:"links"}),a.createElement("g",{className:"nodes"}),a.createElement("text",{x:0,y:n-25,fill:"gray",fontSize:12},"Drag & Drop to move nodes."),a.createElement("text",{x:0,y:n-10,fill:"gray",fontSize:12},"Click on nodes to show/hide labels."),0===i.length?o:a.createElement(a.Fragment,null),r?a.createElement("g",{className:"loading"},a.createElement("rect",{className:"loading__background",width:t,height:n,fill:"white",opacity:.5}),a.createElement("g",{transform:"translate(".concat(t/2,", ").concat(n/2,")")},ke)):a.createElement(a.Fragment,null))}}]),n}(a.Component),Ae=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={subgraph:null,loading:!1,error:null,lastCacheKey:""},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadSubgraph()}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=e.globalState.selectedDrugPrimary,i=e.globalState.diseasePredictions,o=a.find((function(e){return e.selected})),l=i.find((function(e){return e.selected}));n===r&&(null===o||void 0===o?void 0:o.id)===(null===l||void 0===l?void 0:l.id)||this.loadSubgraph()}},{key:"loadSubgraph",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r,i,o,l,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=a.find((function(e){return e.selected})),n&&r){e.next=5;break}return this.setState({subgraph:null,loading:!1}),e.abrupt("return");case 5:if(i=r.node_id||r.id,(o="subgraph:".concat(n,":").concat(i))!==this.state.lastCacheKey||!this.state.subgraph){e.next=9;break}return e.abrupt("return");case 9:if(!(l=k.get(o))){e.next=14;break}return console.log("[V1AttentionTable] \u26a1 Global cache hit for ".concat(o)),this.setState({subgraph:l,loading:!1,lastCacheKey:o}),e.abrupt("return");case 14:return this.setState({loading:!0,error:null}),e.prev=15,e.next=18,A(n,i);case 18:s=e.sent,this.setState({subgraph:s,loading:!1,lastCacheKey:o}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(15),console.error("Failed to load subgraph:",e.t0),this.setState({loading:!1,error:"Failed to load attention data"});case 26:case"end":return e.stop()}}),e,this,[[15,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"formatType",value:function(e){return e?"gene/protein"===e?"Protein":e.replace(/_/g," ").replace(/\b\w/g,(function(e){return e.toUpperCase()})):"Unknown"}},{key:"renderAttentionBar",value:function(e){var t=Math.min(100*e,100),n=e>.7?"#28a745":e>.4?"#ffc107":"#dc3545";return a.createElement("div",{style:{width:"100%",height:"20px",backgroundColor:"#e9ecef",borderRadius:"10px",overflow:"hidden"}},a.createElement("div",{style:{width:"".concat(t,"%"),height:"100%",background:"linear-gradient(90deg, ".concat(n," 0%, ").concat(n,"88 100%)"),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"5px"}},a.createElement("span",{style:{fontSize:"11px",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.5)"}},e.toFixed(3))))}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.width,i=n.height,o=this.state,l=o.subgraph,s=o.loading,c=o.error,d=this.props.globalState,u=d.selectedDrugPrimary,p=d.diseasePredictions,h=d.nodeNameDict,m=p.find((function(e){return e.selected}));if(s)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("svg",{width:100,height:100},ke));if(!u||!m)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d",fontSize:"16px"}},"Please select a drug and disease to see attention scores");if(c)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545",fontSize:"16px"}},c);if(!l||!l.edges||0===l.edges.length)return a.createElement("div",{style:{width:r,height:i,padding:"20px"}},a.createElement("div",{style:{background:"#e7f3ff",borderLeft:"4px solid #3a7bd5",padding:"15px",borderRadius:"5px"}},"No attention data found for this drug-disease pair."));var f={};l.nodes.forEach((function(e){f[e.id]=e}));var y={};l.edges.forEach((function(e){var t=e.relation||"unknown";y[t]||(y[t]=[]),y[t].push(e)})),Object.values(y).forEach((function(e){e.sort((function(e,t){return t.attention-e.attention}))}));var b=(null===(e=h.drug)||void 0===e?void 0:e[u])||u,v=m.name||m.id;return a.createElement("div",{style:{width:r,height:i,overflow:"auto",padding:"10px"}},a.createElement("div",{style:{background:"#e7f3ff",borderLeft:"4px solid #3a7bd5",padding:"15px",marginBottom:"15px",borderRadius:"5px"}},a.createElement("strong",null,"Total Edges:")," ",l.edges.length," |"," ",a.createElement("strong",null,"Relation Types:")," ",Object.keys(y).length,a.createElement("br",null),a.createElement("small",null,"Showing attention scores for: ",a.createElement("strong",null,b)," \u2192 ",a.createElement("strong",null,v))),Object.entries(y).map((function(e){var n=Object(g.a)(e,2),r=n[0],i=n[1];return a.createElement("div",{key:r,style:{marginBottom:"20px"}},a.createElement("h4",{style:{color:"#3a7bd5",marginTop:"15px",marginBottom:"10px",fontSize:"14px",fontWeight:600}},r.replace(/_/g," \u2192 ")," (",i.length,")"),a.createElement("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"}},a.createElement("thead",null,a.createElement("tr",{style:{background:"#f8f9fa"}},a.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057"}},"Source"),a.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057"}},"Target"),a.createElement("th",{style:{padding:"10px",textAlign:"center",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"80px"}},"Layer 1"),a.createElement("th",{style:{padding:"10px",textAlign:"center",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"80px"}},"Layer 2"),a.createElement("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:600,color:"#495057",width:"150px"}},"Max Attention"))),a.createElement("tbody",null,i.slice(0,20).map((function(e,n){var r=f[e.source],i=f[e.target],o=Math.max(e.layer1_att||0,e.layer2_att||0);return a.createElement("tr",{key:n,style:{borderBottom:"1px solid #e9ecef"},onMouseEnter:function(e){e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseLeave:function(e){e.currentTarget.style.backgroundColor="transparent"}},a.createElement("td",{style:{padding:"10px"}},a.createElement("strong",null,(null===r||void 0===r?void 0:r.label)||e.source),a.createElement("br",null),a.createElement("small",{style:{color:"#6c757d"}},"(",t.formatType((null===r||void 0===r?void 0:r.type)||"unknown"),")")),a.createElement("td",{style:{padding:"10px"}},a.createElement("strong",null,(null===i||void 0===i?void 0:i.label)||e.target),a.createElement("br",null),a.createElement("small",{style:{color:"#6c757d"}},"(",t.formatType((null===i||void 0===i?void 0:i.type)||"unknown"),")")),a.createElement("td",{style:{padding:"10px",textAlign:"center"}},(e.layer1_att||0).toFixed(4)),a.createElement("td",{style:{padding:"10px",textAlign:"center"}},(e.layer2_att||0).toFixed(4)),a.createElement("td",{style:{padding:"10px"}},t.renderAttentionBar(o)))})))),i.length>20&&a.createElement("div",{style:{textAlign:"center",padding:"10px",color:"#6c757d",fontSize:"12px"}},"Showing top 20 of ",i.length," edges"))})))}}]),n}(a.Component),Ne={drug:"#3a7bd5",disease:"#dc3545","gene/protein":"#28a745",protein:"#28a745",pathway:"#fd7e14",biological_process:"#6f42c1",molecular_function:"#20c997",cellular_component:"#e83e8c",anatomy:"#17a2b8",effect_phenotype:"#ffc107",exposure:"#795548",unknown:"#6c757d"},Re=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).svgRef=a.createRef(),r.simulation=null,r.selectedDrugPrimary="",r.diseaseNodeId="",r.state={subgraph:null,loading:!1,error:null,lastCacheKey:""},r.dragstarted=r.dragstarted.bind(Object(c.a)(r)),r.dragged=r.dragged.bind(Object(c.a)(r)),r.dragended=r.dragended.bind(Object(c.a)(r)),r}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadSubgraph()}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=e.globalState.selectedDrugPrimary,i=e.globalState.diseasePredictions,o=a.find((function(e){return e.selected})),l=i.find((function(e){return e.selected}));n===r&&(null===o||void 0===o?void 0:o.id)===(null===l||void 0===l?void 0:l.id)||this.loadSubgraph()}},{key:"componentWillUnmount",value:function(){this.simulation&&this.simulation.stop()}},{key:"loadSubgraph",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r,i,o,l,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=a.find((function(e){return e.selected})),n&&r){e.next=5;break}return this.setState({subgraph:null,loading:!1}),e.abrupt("return");case 5:if(i=r.node_id||r.id,o="subgraph:".concat(n,":").concat(i),this.selectedDrugPrimary=n,this.diseaseNodeId=i,o!==this.state.lastCacheKey||!this.state.subgraph){e.next=11;break}return e.abrupt("return");case 11:if(!(l=k.get(o))){e.next=16;break}return console.log("[V1SubGraph] \u26a1 Global cache hit for ".concat(o)),this.setState({subgraph:l,loading:!1,lastCacheKey:o},(function(){c.drawGraph()})),e.abrupt("return");case 16:return this.setState({loading:!0,error:null}),e.prev=17,e.next=20,A(n,i);case 20:s=e.sent,this.setState({subgraph:s,loading:!1,lastCacheKey:o},(function(){c.drawGraph()})),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(17),console.error("Failed to load subgraph:",e.t0),this.setState({loading:!1,error:"Failed to load subgraph data"});case 28:case"end":return e.stop()}}),e,this,[[17,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNodeColor",value:function(e){return Ne[e]||Ne.unknown}},{key:"dragstarted",value:function(e){var t;be.b.active||null===(t=this.simulation)||void 0===t||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}},{key:"dragged",value:function(e){e.fx=be.b.x,e.fy=be.b.y}},{key:"dragended",value:function(e){var t;be.b.active||null===(t=this.simulation)||void 0===t||t.alphaTarget(0),e.fx=null,e.fy=null}},{key:"drawGraph",value:function(){var e=this,t=this.state.subgraph,n=this.props,a=n.width,r=n.height;if(t&&this.svgRef.current){var i=this.selectedDrugPrimary,o=this.diseaseNodeId,l=be.l(this.svgRef.current);l.selectAll("*").remove();var s=t.nodes.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{x:void 0,y:void 0})})),c=t.edges.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{source:e.source,target:e.target})})),d=l.append("g").attr("class","zoom-container"),u=be.o().scaleExtent([.1,4]).on("zoom",(function(){d.attr("transform",be.b.transform)}));l.call(u),this.simulation&&this.simulation.stop(),this.simulation=be.h(s).force("link",be.f(c).id((function(e){return e.id})).distance(120)).force("charge",be.g().strength(-250)).force("center",be.d(a/2,r/2)).force("collision",be.e().radius(40));var h=d.append("g").selectAll("line").data(c).enter().append("line").attr("stroke",(function(e){return e.on_path?"#ff5722":"#999"})).attr("stroke-opacity",(function(e){return e.on_path?1:.6})).attr("stroke-width",(function(e){return e.on_path?4:Math.max(2,8*(e.attention||.1))})).attr("stroke-dasharray",(function(e){return e.on_path?"8,4":"none"})),g=d.append("g").selectAll("circle").data(s).enter().append("circle").attr("r",(function(e){return e.id===i||e.id===o?25:e.on_path?18:15})).attr("fill",(function(t){return e.getNodeColor(t.type)})).attr("stroke",(function(e){return e.id===i||e.id===o?"#ffc107":e.on_path?"#ff5722":"white"})).attr("stroke-width",(function(e){return e.id===i||e.id===o?4:e.on_path?3:1.5})).attr("cursor","pointer").call(be.a().on("start",this.dragstarted).on("drag",this.dragged).on("end",this.dragended)),m=d.append("g").selectAll("text").data(s).enter().append("text").attr("font-size",(function(e){return e.id===i||e.id===o?"14px":"11px"})).attr("font-weight",(function(e){return e.id===i||e.id===o?"bold":"normal"})).attr("text-anchor","middle").attr("dy",(function(e){return e.id===i||e.id===o?-30:-20})).attr("pointer-events","none").text((function(e){var t=e.id===i||e.id===o?40:25;return e.label&&e.label.length>t?e.label.substring(0,t)+"...":e.label||e.id}));g.on("mouseover",(function(){be.l(this).attr("stroke","#ffc107").attr("stroke-width",3)})).on("mouseout",(function(e){be.l(this).attr("stroke",e.id===i||e.id===o?"#ffc107":"white").attr("stroke-width",e.id===i||e.id===o?3:1.5)})),g.append("title").text((function(e){return"".concat(e.label,"\nType: ").concat(e.type,"\nID: ").concat(e.id)})),this.simulation.on("tick",(function(){h.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),g.attr("cx",(function(e){return e.x||0})).attr("cy",(function(e){return e.y||0})),m.attr("x",(function(e){return e.x||0})).attr("y",(function(e){return e.y||0}))})),setTimeout((function(){var e,t=null===(e=d.node())||void 0===e?void 0:e.getBBox();if(t){var n=t.width,i=t.height,o=t.x+n/2,s=t.y+i/2,c=Math.min(.9,.9/Math.max(n/a,i/r)),p=[a/2-c*o,r/2-c*s];l.transition().duration(750).call(u.transform,be.p.translate(p[0],p[1]).scale(c))}}),500)}}},{key:"render",value:function(){var e,t=this.props,n=t.width,r=t.height,i=this.state,o=i.subgraph,l=i.loading,s=i.error,c=this.props.globalState,d=c.selectedDrugPrimary,u=c.diseasePredictions,p=c.nodeNameDict,h=u.find((function(e){return e.selected}));if(l)return a.createElement("div",{style:{width:n,height:r,display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("svg",{width:100,height:100},ke));if(!d||!h)return a.createElement("div",{style:{width:n,height:r,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d",fontSize:"16px"}},"Please select a drug and disease to see the knowledge subgraph");if(s)return a.createElement("div",{style:{width:n,height:r,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545",fontSize:"16px"}},s);var m=(null===(e=p.drug)||void 0===e?void 0:e[d])||d,f=h.name||h.id;return a.createElement("div",{style:{width:n,height:r,position:"relative"}},a.createElement("div",{style:{position:"absolute",top:10,left:10,background:"rgba(255,255,255,0.95)",padding:"10px 15px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"13px"}},a.createElement("div",{style:{fontWeight:"bold",color:"#3a7bd5",marginBottom:"5px"}},"Knowledge Sub-Graph"),a.createElement("div",null,a.createElement("strong",null,"Drug:")," ",m),a.createElement("div",null,a.createElement("strong",null,"Disease:")," ",f),o&&a.createElement("div",{style:{color:"#6c757d",marginTop:"5px"}},o.nodes.length," nodes, ",o.edges.length," edges")),a.createElement("div",{style:{position:"absolute",bottom:10,left:10,background:"rgba(255,255,255,0.95)",padding:"10px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"11px"}},a.createElement("div",{style:{fontWeight:"bold",marginBottom:"5px"}},"Node Types"),a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"}},Object.entries(Ne).slice(0,8).map((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return a.createElement("div",{key:n,style:{display:"flex",alignItems:"center",gap:"4px"}},a.createElement("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:r}}),a.createElement("span",null,n.replace("_"," ")))}))),a.createElement("div",{style:{fontWeight:"bold",marginTop:"10px",marginBottom:"5px"}},"Path Highlighting"),a.createElement("div",{style:{display:"flex",gap:"10px"}},a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},a.createElement("div",{style:{width:20,height:3,backgroundColor:"#ff5722",borderRadius:"2px"}}),a.createElement("span",null,"Shortest path")),a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},a.createElement("div",{style:{width:12,height:12,borderRadius:"50%",border:"3px solid #ff5722",backgroundColor:"transparent"}}),a.createElement("span",null,"Path node")))),a.createElement("div",{style:{position:"absolute",bottom:10,right:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,fontSize:"11px",color:"#6c757d"}},a.createElement("div",null,"\ud83d\uddb1\ufe0f Drag nodes to move"),a.createElement("div",null,"\ud83d\udd0d Scroll to zoom"),a.createElement("div",null,"\u270b Drag background to pan")),a.createElement("svg",{ref:this.svgRef,width:n,height:r,style:{background:"#f8f9fa",borderRadius:"8px",border:"2px solid #e9ecef"}}))}}]),n}(a.Component),He=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={loading:!1,error:null,pathData:null},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadBestPath()}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=e.globalState.selectedDrugPrimary,i=e.globalState.diseasePredictions,o=a.find((function(e){return e.selected})),l=i.find((function(e){return e.selected}));n===r&&(null===o||void 0===o?void 0:o.id)===(null===l||void 0===l?void 0:l.id)||this.loadBestPath()}},{key:"loadBestPath",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState,n=t.selectedDrugPrimary,a=t.diseasePredictions,r=a.find((function(e){return e.selected})),n&&r){e.next=5;break}return this.setState({pathData:null,loading:!1,error:null}),e.abrupt("return");case 5:return i=r.node_id||r.id,this.setState({loading:!0,error:null}),e.prev=7,e.next=10,N(n,i);case 10:o=e.sent,this.setState({pathData:o,loading:!1}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),console.error("Failed to load best path:",e.t0),this.setState({loading:!1,error:"Failed to load best path"});case 18:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderSinglePath",value:function(e,t){var n,r,i=this.props.globalState.nodeNameDict;return a.createElement("div",{key:"path-".concat(t),style:{marginBottom:16,padding:12,border:"1px solid #e9ecef",borderRadius:8,background:1===t?"#f8fff8":"#fff"}},a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:10,gap:12}},a.createElement("div",{style:{width:28,height:28,borderRadius:"50%",background:1===t?"#28a745":t<=3?"#3a7bd5":"#6c757d",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:14}},t),a.createElement("div",{style:{flex:1}},a.createElement("span",{style:{fontWeight:600}},"Path Score: "),a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,background:e.path_score>.7?"#d4edda":e.path_score>.5?"#fff3cd":"#f8d7da",color:e.path_score>.7?"#155724":e.path_score>.5?"#856404":"#721c24",fontWeight:600}},null!==(n=null===(r=e.path_score)||void 0===r?void 0:r.toFixed(4))&&void 0!==n?n:"N/A")),a.createElement("div",{style:{fontSize:12,color:"#6c757d"}},e.nodes.length," nodes, ",e.edges.length," edges")),a.createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:6}},e.nodes.map((function(t,n){var r,o,l,s,c,d,u,p=n===e.nodes.length-1,h=e.edges[n],g=t.nodeName||(null===i||void 0===i||null===(r=i[t.nodeType])||void 0===r?void 0:r[t.nodeId])||t.nodeId;return a.createElement(a.Fragment,{key:"node-".concat(n)},a.createElement("div",{style:{padding:"6px 10px",borderRadius:6,background:_e(t.nodeType),color:"white",minWidth:80,maxWidth:150,textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.15)"},title:"".concat(g," (").concat(t.nodeType,")")},a.createElement("div",{style:{fontWeight:600,fontSize:12,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},g.length>15?g.substring(0,15)+"...":g),a.createElement("div",{style:{fontSize:10,opacity:.85,textTransform:"capitalize"}},(null===(o=t.nodeType)||void 0===o?void 0:o.replace("_"," "))||"unknown")),!p&&h&&a.createElement("div",{style:{display:"flex",alignItems:"center",gap:4}},a.createElement("div",{style:{width:30,height:2,background:"linear-gradient(90deg, ".concat(_e(e.nodes[n].nodeType),", ").concat(_e((null===(l=e.nodes[n+1])||void 0===l?void 0:l.nodeType)||"unknown"),")")}}),a.createElement("div",{style:{padding:"2px 6px",borderRadius:4,background:"#f8f9fa",border:"1px solid #dee2e6",fontSize:10,color:"#495057",whiteSpace:"nowrap"},title:"".concat(h.edgeInfo,": ").concat(null===(s=h.score)||void 0===s?void 0:s.toFixed(4))},a.createElement("div",null,null===(c=h.edgeInfo)||void 0===c?void 0:c.replace("_"," ")),a.createElement("div",{style:{fontWeight:600,color:"#3a7bd5"}},null===(d=h.score)||void 0===d?void 0:d.toFixed(3))),a.createElement("div",{style:{width:30,height:2,background:"linear-gradient(90deg, ".concat(_e(e.nodes[n].nodeType),", ").concat(_e((null===(u=e.nodes[n+1])||void 0===u?void 0:u.nodeType)||"unknown"),")")}})))}))))}},{key:"renderAllPaths",value:function(){var e=this,t=this.state.pathData;if(!t)return a.createElement("div",{style:{padding:16,color:"#6c757d"}},"No path data available for this pair.");var n=t.paths||(t.path?[t.path]:[]);return 0===n.length?a.createElement("div",{style:{padding:16,color:"#6c757d"}},"No paths found for this drug-disease pair."):a.createElement("div",{style:{padding:16}},a.createElement("div",{style:{marginBottom:16,background:"#e7f3ff",borderLeft:"4px solid #3a7bd5",padding:"12px 14px",borderRadius:6}},a.createElement("div",{style:{fontWeight:700,fontSize:16,marginBottom:4}},"Top ",n.length," Most Important Path",n.length>1?"s":""),a.createElement("div",{style:{color:"#495057"}},a.createElement("strong",null,"Drug:")," ",t.drug_id," \u2192 ",a.createElement("strong",null,"Disease:")," ",t.disease_name," (",t.disease_node_id,")"),a.createElement("div",{style:{fontSize:12,color:"#6c757d",marginTop:4}},"Paths ranked by average edge attention score (embedding similarity)")),n.map((function(t,n){return e.renderSinglePath(t,n+1)})))}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,r=this.state,i=r.loading,o=r.error,l=this.props.globalState,s=l.selectedDrugPrimary,c=l.diseasePredictions.find((function(e){return e.selected}));return s&&c?i?a.createElement("div",{style:{width:t,height:n,display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("svg",{width:100,height:100},ke)):o?a.createElement("div",{style:{width:t,height:n,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545"}},o):a.createElement("div",{style:{width:t,height:n,overflow:"auto"}},this.renderAllPaths()):a.createElement("div",{style:{width:t,height:n,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d"}},"Please select a drug and disease to see the top paths.")}}]),n}(a.Component),ze=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={loading:!1,error:null,data:null,minHops:2,maxHops:5,diseaseFilter:"",sortBy:"combined_score",showGuide:!1},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadPaths()}},{key:"componentDidUpdate",value:function(e){this.props.globalState.selectedDrugPrimary!==e.globalState.selectedDrugPrimary&&this.loadPaths()}},{key:"loadPaths",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r,i,o,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState.selectedDrugPrimary){e.next=4;break}return this.setState({data:null,loading:!1}),e.abrupt("return");case 4:return n=this.state,a=n.minHops,r=n.maxHops,this.setState({loading:!0,error:null}),e.prev=6,i="/api/all_paths?drug_id=".concat(t,"&min_hops=").concat(a,"&max_hops=").concat(r,"&top_n=100"),e.next=10,fetch(i);case 10:if((o=e.sent).ok){e.next=13;break}throw new Error("Failed to fetch paths");case 13:return e.next=15,o.json();case 15:l=e.sent,this.setState({data:l,loading:!1}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),console.error("Failed to load paths:",e.t0),this.setState({loading:!1,error:"Failed to load comprehensive paths"});case 23:case"end":return e.stop()}}),e,this,[[6,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"getFilteredPaths",value:function(){var e=this.state,t=e.data,n=e.diseaseFilter,a=e.sortBy;if(!(null===t||void 0===t?void 0:t.paths))return[];var r=Object(f.a)(t.paths);if(n.trim()){var i=n.toLowerCase();r=r.filter((function(e){var t;return((null===(t=e.nodes[e.nodes.length-1])||void 0===t?void 0:t.name)||"").toLowerCase().includes(i)}))}return r.sort((function(e,t){return"combined_score"===a?(t.combined_score||0)-(e.combined_score||0):"avg_attention"===a?(t.avg_attention||0)-(e.avg_attention||0):e.hops-t.hops})),r}},{key:"renderPath",value:function(e,t){var n,r=e.nodes,i=(e.edges,e.attention_scores),o=e.avg_attention,l=e.combined_score,s=e.hops,c=function(e){return e>=.7?"#28a745":e>=.6?"#5cb85c":e>=.5?"#f0ad4e":"#d9534f"};return a.createElement("div",{key:"path-".concat(t),style:{marginBottom:12,padding:12,border:"1px solid #e0e0e0",borderRadius:8,background:t<=3?"#f8fff8":"#fff",boxShadow:1===t?"0 2px 8px rgba(40,167,69,0.2)":"none"}},a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:10,gap:12,flexWrap:"wrap"}},a.createElement("div",{style:{width:28,height:28,borderRadius:"50%",background:1===t?"#28a745":t<=3?"#3a7bd5":"#6c757d",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:13,flexShrink:0}},t),a.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"}},a.createElement("span",{style:{padding:"3px 8px",borderRadius:12,background:"#e7f3ff",color:"#2b5797",fontSize:11,fontWeight:600}},s," hops"),a.createElement("span",{style:{padding:"3px 8px",borderRadius:4,background:c(o),color:"white",fontSize:11,fontWeight:600},title:"Average embedding similarity along path"},"Attention: ",null===o||void 0===o?void 0:o.toFixed(3)),a.createElement("span",{style:{padding:"3px 8px",borderRadius:4,background:"#495057",color:"white",fontSize:11,fontWeight:600},title:"Combined score = attention \xd7 (1/\u221ahops)"},"Score: ",null===l||void 0===l?void 0:l.toFixed(4))),a.createElement("div",{style:{marginLeft:"auto",fontSize:11,color:"#6c757d"}},null===(n=r[r.length-1])||void 0===n?void 0:n.name)),a.createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:4,overflowX:"auto"}},r.map((function(e,t){var n,o=t===r.length-1,l=i[t];return a.createElement(a.Fragment,{key:"node-".concat(t)},a.createElement("div",{style:{padding:"5px 8px",borderRadius:6,background:_e(e.type),color:"white",minWidth:60,maxWidth:120,textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.12)"},title:"".concat(e.name," (").concat(e.type,")")},a.createElement("div",{style:{fontWeight:600,fontSize:11,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},e.name.length>12?e.name.substring(0,12)+"\u2026":e.name),a.createElement("div",{style:{fontSize:9,opacity:.85}},null===(n=e.type)||void 0===n?void 0:n.replace("_"," ").replace("/"," "))),!o&&a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement("div",{style:{width:20,height:2,background:l?c(l):"#ccc"}}),a.createElement("div",{style:{padding:"2px 4px",borderRadius:3,background:l?c(l):"#f0f0f0",color:l>=.5?"white":"#333",fontSize:9,fontWeight:600},title:"Attention: ".concat(null===l||void 0===l?void 0:l.toFixed(4))},null===l||void 0===l?void 0:l.toFixed(2)),a.createElement("div",{style:{width:20,height:2,background:l?c(l):"#ccc"}})))}))))}},{key:"renderFilters",value:function(){var e=this,t=this.state,n=t.minHops,r=t.maxHops,i=t.diseaseFilter,o=t.sortBy;return a.createElement("div",{style:{display:"flex",gap:16,marginBottom:16,padding:12,background:"#f8f9fa",borderRadius:8,flexWrap:"wrap",alignItems:"center"}},a.createElement("div",null,a.createElement("label",{style:{fontSize:12,fontWeight:600,marginRight:6}},"Min Hops:"),a.createElement("select",{value:n,onChange:function(t){return e.setState({minHops:parseInt(t.target.value)},(function(){return e.loadPaths()}))},style:{padding:"4px 8px",borderRadius:4,border:"1px solid #ccc"}},[2,3,4,5].map((function(e){return a.createElement("option",{key:e,value:e},e)})))),a.createElement("div",null,a.createElement("label",{style:{fontSize:12,fontWeight:600,marginRight:6}},"Max Hops:"),a.createElement("select",{value:r,onChange:function(t){return e.setState({maxHops:parseInt(t.target.value)},(function(){return e.loadPaths()}))},style:{padding:"4px 8px",borderRadius:4,border:"1px solid #ccc"}},[2,3,4,5].map((function(e){return a.createElement("option",{key:e,value:e},e)})))),a.createElement("div",null,a.createElement("label",{style:{fontSize:12,fontWeight:600,marginRight:6}},"Sort By:"),a.createElement("select",{value:o,onChange:function(t){return e.setState({sortBy:t.target.value})},style:{padding:"4px 8px",borderRadius:4,border:"1px solid #ccc"}},a.createElement("option",{value:"combined_score"},"Combined Score"),a.createElement("option",{value:"avg_attention"},"Attention Score"),a.createElement("option",{value:"hops"},"Path Length"))),a.createElement("div",{style:{flex:1,minWidth:200}},a.createElement("input",{type:"text",placeholder:"Filter by disease name...",value:i,onChange:function(t){return e.setState({diseaseFilter:t.target.value})},style:{width:"100%",padding:"6px 10px",borderRadius:4,border:"1px solid #ccc",fontSize:12}})))}},{key:"renderStatistics",value:function(){var e,t=this.state.data;if(!(null===t||void 0===t?void 0:t.statistics))return null;var n=t.statistics,r=n.mean_attention,i=(n.std_attention,n.min_attention),o=n.max_attention;return a.createElement("div",{style:{display:"flex",gap:16,marginBottom:16,flexWrap:"wrap"}},a.createElement("div",{style:{flex:1,minWidth:120,padding:12,background:"#e7f3ff",borderRadius:8,textAlign:"center"}},a.createElement("div",{style:{fontSize:20,fontWeight:700,color:"#2b5797"}},null===(e=t.total_available)||void 0===e?void 0:e.toLocaleString()),a.createElement("div",{style:{fontSize:11,color:"#495057"}},"Total Paths")),a.createElement("div",{style:{flex:1,minWidth:120,padding:12,background:"#d4edda",borderRadius:8,textAlign:"center"}},a.createElement("div",{style:{fontSize:20,fontWeight:700,color:"#155724"}},t.unique_diseases),a.createElement("div",{style:{fontSize:11,color:"#495057"}},"Unique Diseases")),a.createElement("div",{style:{flex:1,minWidth:120,padding:12,background:"#fff3cd",borderRadius:8,textAlign:"center"}},a.createElement("div",{style:{fontSize:20,fontWeight:700,color:"#856404"}},null===r||void 0===r?void 0:r.toFixed(3)),a.createElement("div",{style:{fontSize:11,color:"#495057"}},"Mean Attention")),a.createElement("div",{style:{flex:1,minWidth:120,padding:12,background:"#f8f9fa",borderRadius:8,textAlign:"center"}},a.createElement("div",{style:{fontSize:20,fontWeight:700,color:"#495057"}},null===i||void 0===i?void 0:i.toFixed(3)," - ",null===o||void 0===o?void 0:o.toFixed(3)),a.createElement("div",{style:{fontSize:11,color:"#495057"}},"Attention Range")))}},{key:"renderHopDistribution",value:function(){var e=this.state.data;if(!(null===e||void 0===e?void 0:e.paths_by_hops))return null;var t=Object.entries(e.paths_by_hops).sort((function(e,t){return parseInt(e[0])-parseInt(t[0])})),n=Math.max.apply(Math,Object(f.a)(t.map((function(e){return Object(g.a)(e,2)[1]}))));return a.createElement("div",{style:{marginBottom:16}},a.createElement("div",{style:{fontSize:12,fontWeight:600,marginBottom:8}},"Paths by Hop Count:"),a.createElement("div",{style:{display:"flex",gap:8,alignItems:"flex-end",height:60}},t.map((function(e){var t=Object(g.a)(e,2),r=t[0],i=t[1];return a.createElement("div",{key:r,style:{display:"flex",flexDirection:"column",alignItems:"center"}},a.createElement("div",{style:{width:40,height:Math.max(10,i/n*50),background:"hsl(".concat(210-30*parseInt(r),", 70%, 50%)"),borderRadius:"4px 4px 0 0"},title:"".concat(i," paths")}),a.createElement("div",{style:{fontSize:10,color:"#6c757d",marginTop:4}},r,"-hop"),a.createElement("div",{style:{fontSize:10,fontWeight:600}},i))}))))}},{key:"renderInterpretationGuide",value:function(){var e=this,t=this.state.showGuide;return a.createElement("div",{style:{marginBottom:16,border:"1px solid #dee2e6",borderRadius:8,overflow:"hidden"}},a.createElement("div",{onClick:function(){return e.setState({showGuide:!t})},style:{padding:"12px 16px",background:t?"#2b5797":"#f8f9fa",color:t?"white":"#495057",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",fontWeight:600,fontSize:14}},a.createElement("span",null,"\ud83d\udcd6 How to Interpret Paths (Click to ",t?"collapse":"expand",")"),a.createElement("span",{style:{fontSize:18}},t?"\u25bc":"\u25b6")),t&&a.createElement("div",{style:{padding:16,background:"#fff",fontSize:13,lineHeight:1.7}},a.createElement("div",{style:{marginBottom:20}},a.createElement("h4",{style:{margin:"0 0 8px 0",color:"#2b5797"}},"What Are Paths?"),a.createElement("p",{style:{margin:0,color:"#495057"}},"Each path shows a ",a.createElement("strong",null,"mechanistic explanation")," for why a drug might treat a disease. The path traces connections through the Knowledge Graph that explain the drug-disease relationship through intermediate biological entities.")),a.createElement("div",{style:{marginBottom:20}},a.createElement("h4",{style:{margin:"0 0 12px 0",color:"#2b5797"}},"Path Types & Interpretations"),a.createElement("div",{style:{background:"#e7f3ff",padding:12,borderRadius:6,marginBottom:12,borderLeft:"4px solid #2b5797"}},a.createElement("div",{style:{fontWeight:600,marginBottom:6}},"Type 1: Drug \u2192 Protein \u2192 Disease (Target-Based)"),a.createElement("div",{style:{fontFamily:"monospace",background:"#fff",padding:8,borderRadius:4,marginBottom:8}},"Inebilizumab \u2192 CD19 \u2192 Agammaglobulinemia"),a.createElement("div",{style:{color:"#495057"}},a.createElement("strong",null,"Meaning:")," Drug targets a protein implicated in the disease.",a.createElement("br",null),a.createElement("strong",null,"Example:")," Inebilizumab targets CD19, which when deficient causes agammaglobulinemia.")),a.createElement("div",{style:{background:"#d4edda",padding:12,borderRadius:6,marginBottom:12,borderLeft:"4px solid #28a745"}},a.createElement("div",{style:{fontWeight:600,marginBottom:6}},"Type 2: Drug \u2192 Drug \u2192 Disease (Drug Similarity)"),a.createElement("div",{style:{fontFamily:"monospace",background:"#fff",padding:8,borderRadius:4,marginBottom:8}},"Inebilizumab \u2192 Rituximab \u2192 Non-Hodgkin Lymphoma"),a.createElement("div",{style:{color:"#495057"}},a.createElement("strong",null,"Meaning:")," A similar drug treats this disease.",a.createElement("br",null),a.createElement("strong",null,"Example:")," Both are anti-B-cell antibodies. Rituximab (anti-CD20) treats lymphoma, so Inebilizumab (anti-CD19) might too.")),a.createElement("div",{style:{background:"#fff3cd",padding:12,borderRadius:6,marginBottom:12,borderLeft:"4px solid #ffc107"}},a.createElement("div",{style:{fontWeight:600,marginBottom:6}},"Type 3: Drug \u2192 Protein \u2192 Protein \u2192 Disease (Pathway-Based)"),a.createElement("div",{style:{fontFamily:"monospace",background:"#fff",padding:8,borderRadius:4,marginBottom:8}},"Inebilizumab \u2192 CD19 \u2192 PAX5 \u2192 B-cell Leukemia"),a.createElement("div",{style:{color:"#495057"}},a.createElement("strong",null,"Meaning:")," Drug effect propagates through protein network.",a.createElement("br",null),a.createElement("strong",null,"Example:")," CD19 interacts with PAX5 (B-cell transcription factor), which is involved in leukemia."))),a.createElement("div",{style:{marginBottom:20}},a.createElement("h4",{style:{margin:"0 0 12px 0",color:"#2b5797"}},"Understanding Attention Scores"),a.createElement("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12}},a.createElement("thead",null,a.createElement("tr",{style:{background:"#f8f9fa"}},a.createElement("th",{style:{padding:8,textAlign:"left",borderBottom:"2px solid #dee2e6"}},"Score"),a.createElement("th",{style:{padding:8,textAlign:"left",borderBottom:"2px solid #dee2e6"}},"Meaning"),a.createElement("th",{style:{padding:8,textAlign:"left",borderBottom:"2px solid #dee2e6"}},"Confidence"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},a.createElement("span",{style:{background:"#28a745",color:"white",padding:"2px 8px",borderRadius:4}},"0.70+")),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"Very strong relationship"),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"\u2b50\u2b50\u2b50\u2b50\u2b50 High")),a.createElement("tr",null,a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},a.createElement("span",{style:{background:"#5cb85c",color:"white",padding:"2px 8px",borderRadius:4}},"0.60-0.70")),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"Strong relationship"),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"\u2b50\u2b50\u2b50\u2b50 Good")),a.createElement("tr",null,a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},a.createElement("span",{style:{background:"#f0ad4e",color:"white",padding:"2px 8px",borderRadius:4}},"0.50-0.60")),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"Moderate relationship"),a.createElement("td",{style:{padding:8,borderBottom:"1px solid #dee2e6"}},"\u2b50\u2b50\u2b50 Medium")),a.createElement("tr",null,a.createElement("td",{style:{padding:8}},a.createElement("span",{style:{background:"#d9534f",color:"white",padding:"2px 8px",borderRadius:4}},"<0.50")),a.createElement("td",{style:{padding:8}},"Weak relationship"),a.createElement("td",{style:{padding:8}},"\u2b50\u2b50 Low"))))),a.createElement("div",{style:{marginBottom:16}},a.createElement("h4",{style:{margin:"0 0 12px 0",color:"#2b5797"}},"Visual Path Diagram"),a.createElement("div",{style:{background:"#1a1a2e",color:"#eee",padding:16,borderRadius:6,fontFamily:"monospace",fontSize:11,whiteSpace:"pre",overflow:"auto"}},'Drug Similarity Path:              Target-Based Path:\n                    \nInebilizumab \u2500\u25000.83\u2500\u2500> Rituximab    Inebilizumab \u2500\u25000.50\u2500\u2500> CD19\n                          \u2502                                 \u2502\n    "Similar antibody     \u2502              "Targets this      \u2502\n     targeting B cells"   \u2502               protein"          \u2502\n                          \u25bc                                 \u25bc\n             Non-Hodgkin Lymphoma            Agammaglobulinemia\n                          \n    "Rituximab treats     \u2502              "CD19 mutations    \u2502\n     this cancer"         \u2502               cause this"       \u2502\n                          \u25bc                                 \u25bc\n                          \n    PREDICTION: May also           PREDICTION: B-cell depletion\n    treat B-cell cancers           is mechanistically relevant')),a.createElement("div",{style:{background:"#f8f9fa",padding:12,borderRadius:6,borderLeft:"4px solid #17a2b8"}},a.createElement("div",{style:{fontWeight:600,marginBottom:8,color:"#17a2b8"}},"\ud83d\udca1 Key Takeaways"),a.createElement("ul",{style:{margin:0,paddingLeft:20,color:"#495057"}},a.createElement("li",null,a.createElement("strong",null,"Short paths (2-hop) with high attention")," \u2192 Best candidates for follow-up"),a.createElement("li",null,a.createElement("strong",null,"Protein-mediated paths")," \u2192 Most mechanistically explainable"),a.createElement("li",null,a.createElement("strong",null,"Drug-similarity paths")," \u2192 Class-effect predictions"),a.createElement("li",null,a.createElement("strong",null,"Multiple paths to same disease")," \u2192 Higher confidence prediction")))))}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.width,i=n.height,o=this.state,l=o.loading,s=o.error,c=o.data,d=this.props.globalState.selectedDrugPrimary;if(!d)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d"}},"Please select a drug to explore comprehensive paths.");if(l)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("svg",{width:100,height:100},ke));if(s)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc3545"}},s);var u=this.getFilteredPaths();return a.createElement("div",{style:{width:r,height:i,overflow:"auto",padding:16}},a.createElement("div",{style:{marginBottom:16,background:"linear-gradient(135deg, #3a7bd5 0%, #5c9bdb 100%)",padding:"14px 18px",borderRadius:8,color:"white"}},a.createElement("div",{style:{fontWeight:700,fontSize:18,marginBottom:4}},"\ud83d\udd2c Comprehensive Path Explorer"),a.createElement("div",{style:{fontSize:13,opacity:.9}},"Deep paths (2-5 hops) from ",a.createElement("strong",null,d)," to diseases, ranked by TxGNN embedding attention scores.")),this.renderInterpretationGuide(),this.renderStatistics(),this.renderHopDistribution(),this.renderFilters(),a.createElement("div",{style:{marginBottom:12,fontSize:13,color:"#495057"}},"Showing ",a.createElement("strong",null,u.length)," of ",(null===c||void 0===c||null===(e=c.total_available)||void 0===e?void 0:e.toLocaleString())||0," paths"),0===u.length?a.createElement("div",{style:{textAlign:"center",color:"#6c757d",padding:32}},"No paths match your filters."):u.slice(0,50).map((function(e,n){return t.renderPath(e,n+1)})),u.length>50&&a.createElement("div",{style:{textAlign:"center",color:"#6c757d",padding:16}},"Showing top 50 paths. Refine your filters to see more specific results."),a.createElement("div",{style:{marginTop:24,padding:12,background:"#f8f9fa",borderRadius:8,fontSize:11}},a.createElement("div",{style:{fontWeight:600,marginBottom:8}},"Score Explanation:"),a.createElement("div",{style:{color:"#495057",lineHeight:1.6}},a.createElement("div",null,a.createElement("strong",null,"Attention Score:")," Average cosine similarity of TxGNN embeddings along the path (0-1). Higher = nodes are more semantically related."),a.createElement("div",null,a.createElement("strong",null,"Combined Score:")," attention \xd7 (1/\u221ahops). Balances attention strength with path length."),a.createElement("div",{style:{marginTop:8}},a.createElement("span",{style:{display:"inline-block",width:40,height:14,background:"#28a745",borderRadius:2,marginRight:4,verticalAlign:"middle"}}),"\u22650.7 (High)",a.createElement("span",{style:{display:"inline-block",width:40,height:14,background:"#5cb85c",borderRadius:2,marginLeft:16,marginRight:4,verticalAlign:"middle"}}),"\u22650.6",a.createElement("span",{style:{display:"inline-block",width:40,height:14,background:"#f0ad4e",borderRadius:2,marginLeft:16,marginRight:4,verticalAlign:"middle"}}),"\u22650.5",a.createElement("span",{style:{display:"inline-block",width:40,height:14,background:"#d9534f",borderRadius:2,marginLeft:16,marginRight:4,verticalAlign:"middle"}}),"<0.5"))))}}]),n}(a.Component),Me=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={loading:!1,error:null,data:null,bcellData:null,minHops:2,maxHops:10,diseaseFilter:"",sortBy:"combined_score",showGuide:!1,viewMode:"global",selectedHop:4,selectedDisease:""},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadPaths()}},{key:"componentDidUpdate",value:function(e){this.props.globalState.selectedDrugPrimary!==e.globalState.selectedDrugPrimary&&this.loadPaths()}},{key:"loadPaths",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r,i,o,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState.selectedDrugPrimary){e.next=4;break}return this.setState({data:null,bcellData:null,loading:!1}),e.abrupt("return");case 4:return this.setState({loading:!0,error:null}),e.prev=5,e.next=8,Promise.all([fetch("/api/all_paths_10hop?drug_id=".concat(t)),fetch("/api/bcell_focused_paths?drug_id=".concat(t))]);case 8:if(n=e.sent,a=Object(g.a)(n,2),r=a[0],i=a[1],o=null,l=null,!r.ok){e.next=18;break}return e.next=17,r.json();case 17:o=e.sent;case 18:if(!i.ok){e.next=22;break}return e.next=21,i.json();case 21:l=e.sent;case 22:this.setState({data:o,bcellData:l,loading:!1}),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(5),console.error("Failed to load paths:",e.t0),this.setState({loading:!1,error:"Failed to load paths. Make sure the data is generated."});case 29:case"end":return e.stop()}}),e,this,[[5,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"getFilteredPaths",value:function(){var e=this.state,t=e.data,n=e.bcellData,a=e.minHops,r=e.maxHops,i=e.diseaseFilter,o=e.sortBy,l=e.viewMode,s=e.selectedHop,c=e.selectedDisease;if("bcell_focus"===l){if(!(null===n||void 0===n?void 0:n.global_top_paths))return[];var d=Object(f.a)(n.global_top_paths);if(i.trim()){var u=i.toLowerCase();d=d.filter((function(e){return(e.disease_name||"").toLowerCase().includes(u)}))}return d.sort((function(e,t){return"combined_score"===o?(t.combined_score||0)-(e.combined_score||0):"avg_attention"===o?(t.avg_attention||0)-(e.avg_attention||0):(e.hops||0)-(t.hops||0)})),d}if(!t)return[];var p=[];if(p=(p="global"===l?Object(f.a)(t.global_top_paths||[]):"by_hop"===l&&t.paths_by_hops?Object(f.a)(t.paths_by_hops[s.toString()]||[]):"by_disease"===l&&t.top_paths_per_disease&&c?Object(f.a)(t.top_paths_per_disease[c]||[]):Object(f.a)(t.global_top_paths||[])).filter((function(e){return e.hops>=a&&e.hops<=r})),i.trim()){var h=i.toLowerCase();p=p.filter((function(e){var t;return(e.disease_name||(null===(t=e.nodes[e.nodes.length-1])||void 0===t?void 0:t.name)||"").toLowerCase().includes(h)}))}return p.sort((function(e,t){return"combined_score"===o?(t.combined_score||0)-(e.combined_score||0):"avg_attention"===o?(t.avg_attention||0)-(e.avg_attention||0):e.hops-t.hops})),p}},{key:"getAttentionColor",value:function(e){return e>=.7?"#28a745":e>=.6?"#5cb85c":e>=.5?"#f0ad4e":"#d9534f"}},{key:"getNodeStyle",value:function(e,t,n){return"mechanism"===e||"connection"===n?{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"2px dashed #667eea",fontSize:8}:t||"drug1_target"!==n&&"drug2_target"!==n?{background:_e(e)}:{background:_e(e),border:"2px solid #ffd700",opacity:.9}}},{key:"renderPath",value:function(e,t){var n=this,r=e.nodes,i=e.attention_scores,o=e.avg_attention,l=e.combined_score,s=e.hops,c=e.path_type,d=e.mechanism,u=e.clinical_relevance,h=!!c,g=e.enriched_nodes||r,m=!!e.enriched_nodes;return a.createElement("div",{key:"path-".concat(t,"-").concat(e.disease_name),style:{marginBottom:12,padding:12,border:"1px solid #e0e0e0",borderRadius:8,background:t<=3?"linear-gradient(135deg, #f8fff8 0%, #f0f8f0 100%)":"#fff",boxShadow:1===t?"0 2px 8px rgba(40,167,69,0.15)":"none"}},a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:10,gap:8,flexWrap:"wrap"}},a.createElement("div",{style:{width:26,height:26,borderRadius:"50%",background:1===t?"#28a745":t<=3?"#3a7bd5":t<=10?"#6c757d":"#adb5bd",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:12,flexShrink:0}},t),a.createElement("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"}},a.createElement("span",{style:{padding:"2px 8px",borderRadius:12,background:s<=4?"#e7f3ff":s<=6?"#fff3cd":s<=8?"#ffeaa7":"#fdcb6e",color:s<=4?"#2b5797":s<=6?"#856404":"#5d4e37",fontSize:10,fontWeight:600}},s," hops"),h&&a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,background:"#28a745",color:"white",fontSize:9,fontWeight:600},title:null===c||void 0===c?void 0:c.replace(/_/g," ")},"\ud83e\uddec ",null===c||void 0===c?void 0:c.replace(/_/g," ").replace("B cell","B-cell")),m&&!h&&a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,background:"#667eea",color:"white",fontSize:9,fontWeight:600},title:"Path includes protein mechanism details"},"+ Mechanism"),a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,background:this.getAttentionColor(o),color:"white",fontSize:10,fontWeight:600},title:"Average embedding similarity"},"Att: ",null===o||void 0===o?void 0:o.toFixed(3)),a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,background:"#495057",color:"white",fontSize:10,fontWeight:600},title:"Combined score = attention \xd7 (1/\u221ahops)"},"Score: ",null===l||void 0===l?void 0:l.toFixed(4))),a.createElement("div",{style:{marginLeft:"auto",fontSize:11,fontWeight:600,color:"#155724",background:"#d4edda",padding:"2px 8px",borderRadius:4,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.disease_name},"\ud83c\udfaf ",e.disease_name)),a.createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:3,overflowX:"auto",paddingBottom:4}},g.map((function(e,t){var o,l,s,c,d=t===g.length-1,u=!1!==e.is_original,h=e.role,m=n.getNodeStyle(e.type,u,h);if(u&&i){var f=r.findIndex((function(t){return t.name===e.name&&t.type===e.type}));f>=0&&f<i.length&&(c=i[f])}return"mechanism"===e.type||"connection"===h?a.createElement(a.Fragment,{key:"node-".concat(t)},a.createElement("div",{style:{padding:"2px 6px",borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontSize:8,fontWeight:600,fontStyle:"italic",border:"1px dashed rgba(255,255,255,0.5)"},title:e.description||e.name},e.name),!d&&a.createElement("div",{style:{width:8,height:1,background:"#667eea"}})):a.createElement(a.Fragment,{key:"node-".concat(t)},a.createElement("div",{style:Object(p.a)(Object(p.a)({padding:"4px 6px",borderRadius:5},m),{},{color:"white",minWidth:u?50:40,maxWidth:u?100:80,textAlign:"center",boxShadow:u?"0 1px 2px rgba(0,0,0,0.1)":"0 0 4px rgba(255,215,0,0.5)"}),title:"".concat(e.name," (").concat(e.type,")").concat(e.id?"\nID: ".concat(e.id):"").concat(h?"\nRole: ".concat(h):"")},a.createElement("div",{style:{fontWeight:600,fontSize:u?10:9,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},e.name.length>(u?10:8)?e.name.substring(0,u?10:8)+"\u2026":e.name),a.createElement("div",{style:{fontSize:7,opacity:.8}},null===(o=e.type)||void 0===o?void 0:o.replace("_"," ").replace("/"," "),!u&&h&&a.createElement("span",{style:{color:"#ffd700"}}," \u2605"))),!d&&a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement("div",{style:{width:u?12:6,height:2,background:c?n.getAttentionColor(c):u?"#ccc":"#667eea"}}),u&&void 0!==c&&a.createElement(a.Fragment,null,a.createElement("div",{style:{padding:"1px 4px",borderRadius:3,background:n.getAttentionColor(c),color:c>=.5?"white":"#333",fontSize:8,fontWeight:600},title:"Attention: ".concat(null===(l=c)||void 0===l?void 0:l.toFixed(4))},null===(s=c)||void 0===s?void 0:s.toFixed(2)),a.createElement("div",{style:{width:12,height:2,background:n.getAttentionColor(c)}}))))}))),h&&d&&a.createElement("div",{style:{marginTop:8,padding:8,background:"#d4edda",borderRadius:4,borderLeft:"3px solid #28a745"}},a.createElement("div",{style:{fontSize:10,fontWeight:600,color:"#155724",marginBottom:4}},"\ud83d\udd2c Mechanism:"),a.createElement("div",{style:{fontSize:11,color:"#155724"}},d),u&&a.createElement("div",{style:{marginTop:4,fontSize:10,color:u.startsWith("VERY HIGH")?"#b8860b":u.startsWith("HIGH")?"#28a745":"#5a6268",fontWeight:600}},"\ud83d\udcca Clinical Relevance: ",u)))}},{key:"renderViewModeSelector",value:function(){var e=this,t=this.state,n=t.viewMode,r=t.data,i=t.selectedHop,o=t.selectedDisease,l=(null===r||void 0===r?void 0:r.top_paths_per_disease)?Object.keys(r.top_paths_per_disease).slice(0,100):[],s=(null===r||void 0===r?void 0:r.paths_by_hops)?Object.keys(r.paths_by_hops).map(Number).sort((function(e,t){return e-t})):[];return a.createElement("div",{style:{display:"flex",gap:12,marginBottom:16,padding:12,background:"#e7f3ff",borderRadius:8,flexWrap:"wrap",alignItems:"center"}},a.createElement("div",{style:{fontWeight:600,fontSize:12}},"View:"),a.createElement("button",{onClick:function(){return e.setState({viewMode:"global"})},style:{padding:"6px 12px",borderRadius:4,border:"global"===n?"2px solid #2b5797":"1px solid #ccc",background:"global"===n?"#2b5797":"#fff",color:"global"===n?"#fff":"#333",cursor:"pointer",fontWeight:600,fontSize:11}},"Global Top Paths"),a.createElement("button",{onClick:function(){return e.setState({viewMode:"by_hop"})},style:{padding:"6px 12px",borderRadius:4,border:"by_hop"===n?"2px solid #2b5797":"1px solid #ccc",background:"by_hop"===n?"#2b5797":"#fff",color:"by_hop"===n?"#fff":"#333",cursor:"pointer",fontWeight:600,fontSize:11}},"By Hop Count"),a.createElement("button",{onClick:function(){return e.setState({viewMode:"by_disease"})},style:{padding:"6px 12px",borderRadius:4,border:"by_disease"===n?"2px solid #2b5797":"1px solid #ccc",background:"by_disease"===n?"#2b5797":"#fff",color:"by_disease"===n?"#fff":"#333",cursor:"pointer",fontWeight:600,fontSize:11}},"By Disease"),a.createElement("button",{onClick:function(){return e.setState({viewMode:"bcell_focus"})},style:{padding:"6px 12px",borderRadius:4,border:"bcell_focus"===n?"2px solid #28a745":"1px solid #28a745",background:"bcell_focus"===n?"#28a745":"#d4edda",color:"bcell_focus"===n?"#fff":"#155724",cursor:"pointer",fontWeight:700,fontSize:11},title:"Focus on CD19/B-cell mechanism of action"},"\ud83e\uddec B-Cell/CD19 Focus"),"by_hop"===n&&s.length>0&&a.createElement("select",{value:i,onChange:function(t){return e.setState({selectedHop:parseInt(t.target.value)})},style:{padding:"6px 8px",borderRadius:4,border:"1px solid #ccc"}},s.map((function(e){var t,n;return a.createElement("option",{key:e,value:e},e,"-hop (",(null===r||void 0===r||null===(t=r.paths_by_hops)||void 0===t||null===(n=t[e.toString()])||void 0===n?void 0:n.length)||0," paths)")}))),"by_disease"===n&&l.length>0&&a.createElement("select",{value:o,onChange:function(t){return e.setState({selectedDisease:t.target.value})},style:{padding:"6px 8px",borderRadius:4,border:"1px solid #ccc",maxWidth:200}},a.createElement("option",{value:""},"Select a disease..."),l.map((function(e){return a.createElement("option",{key:e,value:e},e.length>30?e.substring(0,30)+"...":e)}))))}},{key:"renderFilters",value:function(){var e=this,t=this.state,n=t.minHops,r=t.maxHops,i=t.diseaseFilter,o=t.sortBy;return a.createElement("div",{style:{display:"flex",gap:12,marginBottom:16,padding:12,background:"#f8f9fa",borderRadius:8,flexWrap:"wrap",alignItems:"center"}},a.createElement("div",null,a.createElement("label",{style:{fontSize:11,fontWeight:600,marginRight:4}},"Min:"),a.createElement("select",{value:n,onChange:function(t){return e.setState({minHops:parseInt(t.target.value)})},style:{padding:"4px 6px",borderRadius:4,border:"1px solid #ccc",fontSize:11}},[2,3,4,5,6,7,8,9,10].map((function(e){return a.createElement("option",{key:e,value:e},e)})))),a.createElement("div",null,a.createElement("label",{style:{fontSize:11,fontWeight:600,marginRight:4}},"Max:"),a.createElement("select",{value:r,onChange:function(t){return e.setState({maxHops:parseInt(t.target.value)})},style:{padding:"4px 6px",borderRadius:4,border:"1px solid #ccc",fontSize:11}},[2,3,4,5,6,7,8,9,10].map((function(e){return a.createElement("option",{key:e,value:e},e)})))),a.createElement("div",null,a.createElement("label",{style:{fontSize:11,fontWeight:600,marginRight:4}},"Sort:"),a.createElement("select",{value:o,onChange:function(t){return e.setState({sortBy:t.target.value})},style:{padding:"4px 6px",borderRadius:4,border:"1px solid #ccc",fontSize:11}},a.createElement("option",{value:"combined_score"},"Combined Score"),a.createElement("option",{value:"avg_attention"},"Attention"),a.createElement("option",{value:"hops"},"Path Length"))),a.createElement("div",{style:{flex:1,minWidth:150}},a.createElement("input",{type:"text",placeholder:"Filter by disease...",value:i,onChange:function(t){return e.setState({diseaseFilter:t.target.value})},style:{width:"100%",padding:"5px 8px",borderRadius:4,border:"1px solid #ccc",fontSize:11}})))}},{key:"renderStatistics",value:function(){var e=this.state.data;if(!(null===e||void 0===e?void 0:e.statistics))return null;var t=e.statistics,n=t.total_paths,r=t.unique_diseases,i=t.mean_attention,o=t.paths_by_hop;return a.createElement("div",{style:{marginBottom:16}},a.createElement("div",{style:{display:"flex",gap:12,marginBottom:12,flexWrap:"wrap"}},a.createElement("div",{style:{flex:1,minWidth:100,padding:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:8,textAlign:"center",color:"white"}},a.createElement("div",{style:{fontSize:18,fontWeight:700}},null===n||void 0===n?void 0:n.toLocaleString()),a.createElement("div",{style:{fontSize:10}},"Total Paths")),a.createElement("div",{style:{flex:1,minWidth:100,padding:10,background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",borderRadius:8,textAlign:"center",color:"white"}},a.createElement("div",{style:{fontSize:18,fontWeight:700}},r),a.createElement("div",{style:{fontSize:10}},"Diseases")),a.createElement("div",{style:{flex:1,minWidth:100,padding:10,background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",borderRadius:8,textAlign:"center",color:"white"}},a.createElement("div",{style:{fontSize:18,fontWeight:700}},null===i||void 0===i?void 0:i.toFixed(3)),a.createElement("div",{style:{fontSize:10}},"Avg Attention")),a.createElement("div",{style:{flex:1,minWidth:100,padding:10,background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",borderRadius:8,textAlign:"center",color:"white"}},a.createElement("div",{style:{fontSize:18,fontWeight:700}},e.max_hops),a.createElement("div",{style:{fontSize:10}},"Max Hops"))),o&&a.createElement("div",{style:{background:"#f8f9fa",padding:12,borderRadius:8}},a.createElement("div",{style:{fontSize:11,fontWeight:600,marginBottom:8}},"Paths by Hop Count:"),a.createElement("div",{style:{display:"flex",gap:6,alignItems:"flex-end",height:50}},Object.entries(o).sort((function(e,t){return parseInt(e[0])-parseInt(t[0])})).map((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1],i=Math.max.apply(Math,Object(f.a)(Object.values(o))),l=Math.max(8,r/i*40),s=210-15*(parseInt(n)-2);return a.createElement("div",{key:n,style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1}},a.createElement("div",{style:{width:"100%",maxWidth:30,height:l,background:"hsl(".concat(s,", 65%, 50%)"),borderRadius:"3px 3px 0 0"},title:"".concat(r," paths")}),a.createElement("div",{style:{fontSize:9,color:"#6c757d",marginTop:2}},n),a.createElement("div",{style:{fontSize:8,fontWeight:600}},r))})))))}},{key:"renderInterpretationGuide",value:function(){var e=this,t=this.state.showGuide;return a.createElement("div",{style:{marginBottom:16,border:"1px solid #dee2e6",borderRadius:8,overflow:"hidden"}},a.createElement("div",{onClick:function(){return e.setState({showGuide:!t})},style:{padding:"10px 14px",background:t?"#2b5797":"#f8f9fa",color:t?"white":"#495057",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",fontWeight:600,fontSize:12}},a.createElement("span",null,"\ud83d\udcd6 10-Hop Path Interpretation Guide"),a.createElement("span",null,t?"\u25bc":"\u25b6")),t&&a.createElement("div",{style:{padding:14,background:"#fff",fontSize:12,lineHeight:1.6}},a.createElement("div",{style:{marginBottom:16}},a.createElement("h4",{style:{margin:"0 0 8px 0",color:"#2b5797",fontSize:13}},"Why 10-Hop Paths?"),a.createElement("p",{style:{margin:0,color:"#495057"}},"Longer paths (6-10 hops) reveal ",a.createElement("strong",null,"indirect biological mechanisms")," that connect drugs to diseases through complex networks of proteins, pathways, and biological processes. While shorter paths show direct connections, longer paths can uncover novel repurposing opportunities.")),a.createElement("div",{style:{marginBottom:16}},a.createElement("h4",{style:{margin:"0 0 8px 0",color:"#2b5797",fontSize:13}},"Path Types by Length"),a.createElement("div",{style:{display:"grid",gap:8}},a.createElement("div",{style:{background:"#e7f3ff",padding:8,borderRadius:4,borderLeft:"3px solid #2b5797"}},a.createElement("strong",null,"2-4 hops:")," Direct mechanisms (target-based, drug similarity)"),a.createElement("div",{style:{background:"#d4edda",padding:8,borderRadius:4,borderLeft:"3px solid #28a745"}},a.createElement("strong",null,"5-6 hops:")," Pathway-mediated effects (gene networks, biological processes)"),a.createElement("div",{style:{background:"#fff3cd",padding:8,borderRadius:4,borderLeft:"3px solid #ffc107"}},a.createElement("strong",null,"7-8 hops:")," Complex mechanisms (multi-pathway, tissue-specific)"),a.createElement("div",{style:{background:"#f8d7da",padding:8,borderRadius:4,borderLeft:"3px solid #dc3545"}},a.createElement("strong",null,"9-10 hops:")," Exploratory connections (potential novel mechanisms)"))),a.createElement("div",{style:{background:"#f8f9fa",padding:10,borderRadius:4,borderLeft:"3px solid #17a2b8"}},a.createElement("strong",null,"\ud83d\udca1 Key Insight:")," Higher attention scores on longer paths indicate that TxGNN found meaningful semantic similarity between distant nodes, suggesting biologically relevant connections worth investigating.")))}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.width,i=n.height,o=this.state,l=o.loading,s=o.error,c=o.data,d=this.props.globalState.selectedDrugPrimary;if(!d)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d"}},"Please select a drug to explore 10-hop paths.");if(l)return a.createElement("div",{style:{width:r,height:i,display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("svg",{width:100,height:100},ke));if(s)return a.createElement("div",{style:{width:r,height:i,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#dc3545",gap:12}},a.createElement("div",null,s),a.createElement("div",{style:{fontSize:12,color:"#6c757d"}},"Run: ",a.createElement("code",null,"python generate_deep_paths_10hop.py")," to generate 10-hop paths for Inebilizumab."));var u=this.getFilteredPaths();return a.createElement("div",{style:{width:r,height:i,overflow:"auto",padding:12}},a.createElement("div",{style:{marginBottom:14,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"12px 16px",borderRadius:8,color:"white"}},a.createElement("div",{style:{fontWeight:700,fontSize:16,marginBottom:4}},"\ud83d\udd2c 10-Hop Deep Path Explorer"),a.createElement("div",{style:{fontSize:12,opacity:.9}},"Comprehensive paths (2-10 hops) from ",a.createElement("strong",null,(null===c||void 0===c||null===(e=c.drug)||void 0===e?void 0:e.name)||d)," to diseases")),this.renderInterpretationGuide(),this.renderStatistics(),this.renderViewModeSelector(),this.renderFilters(),a.createElement("div",{style:{marginBottom:10,fontSize:12,color:"#495057"}},"Showing ",a.createElement("strong",null,Math.min(u.length,50))," of ",u.length," paths"),0===u.length?a.createElement("div",{style:{textAlign:"center",color:"#6c757d",padding:24}},"No paths match your filters."):u.slice(0,50).map((function(e,n){return t.renderPath(e,n+1)})),u.length>50&&a.createElement("div",{style:{textAlign:"center",color:"#6c757d",padding:12,fontSize:11}},"Showing top 50 paths. Use filters to see more specific results."))}}]),n}(a.Component),Ge=n(49),We=n(161),Le=n(164),Be=n(169),Fe=n.n(Be),Ue={cancer:"#e53935",neurological:"#8e24aa",cardiovascular:"#d81b60",autoimmune:"#f4511e",infectious:"#43a047",metabolic:"#1e88e5",respiratory:"#00acc1",gastrointestinal:"#fb8c00",genetic:"#5e35b1",other:"#90a4ae"},Ve=ye(function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).circleRadius=3,a.hoverTimeout=0,a.WAIT=500,a.state={embedding:{},tooltip:{visible:!1,info:"",position:[0,0]},showCategoryColors:!0,lastDrugId:""},a.onChangeDrug=a.onChangeDrug.bind(Object(c.a)(a)),a}return Object(s.a)(n,[{key:"getCoords",value:function(e){return Array.isArray(e)?e:e.coords}},{key:"getCategory",value:function(e){return Array.isArray(e)?"other":e.category||"other"}},{key:"getName",value:function(e){return Array.isArray(e)?"":e.name||""}},{key:"loadEmbedding",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.globalState.selectedDrugPrimary,!((n="embeddings:".concat(t||"default"))==="embeddings:".concat(this.state.lastDrugId)&&Object.keys(this.state.embedding).length>0)){e.next=4;break}return e.abrupt("return");case 4:if(!(a=k.get(n))){e.next=9;break}return console.log("[Scatter] \u26a1 Global cache hit for ".concat(n)),this.setState({embedding:a,lastDrugId:t||"default"}),e.abrupt("return");case 9:return e.next=11,C(t);case 11:r=e.sent,this.setState({embedding:r,lastDrugId:t||"default"});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.loadEmbedding()}},{key:"componentDidUpdate",value:function(e){this.props.globalState.selectedDrugPrimary!==e.globalState.selectedDrugPrimary&&this.loadEmbedding()}},{key:"addLasso",value:function(e,t){var n=this,a=this.props.globalState.drugPredictions.filter((function(e){return e.selected})).map((function(e){return e.id}));be.m("g.lasso").remove();var r=be.l("svg.scatter"),i=be.l("rect.lasso"),o=function(){var e,t=[],n=75,a=!0,r=!1,i=!0,o={start:function(){},draw:function(){},end:function(){}};function l(l){var s,c,d,u,p=l.append("g").attr("class","lasso"),h=p.append("path").attr("class","drawn"),g=p.append("path").attr("class","loop_close"),m=p.append("circle").attr("class","origin"),f=Le.a().on("start",(function(){u=[],s="",h.attr("d",null),g.attr("d",null),t.nodes().forEach((function(e){e.__lasso.possible=!1,e.__lasso.selected=!1,e.__lasso.hoverSelect=!1,e.__lasso.loopSelect=!1;var t=e.getBoundingClientRect();e.__lasso.lassoPoint=[Math.round(t.left+t.width/2),Math.round(t.top+t.height/2)]})),i&&t.on("mouseover.lasso",(function(){this.__lasso.hoverSelect=!0}));o.start()})).on("drag",(function(){var e,i;"touchmove"===Ge.c.sourceEvent.type?(e=Ge.c.sourceEvent.touches[0].clientX,i=Ge.c.sourceEvent.touches[0].clientY):(e=Ge.c.sourceEvent.clientX,i=Ge.c.sourceEvent.clientY);var l=We.a(this)[0],p=We.a(this)[1];""===s?(s=s+"M "+l+" "+p,c=[e,i],d=[l,p],m.attr("cx",l).attr("cy",p).attr("r",7).attr("display",null)):s=s+" L "+l+" "+p;u.push([e,i]);var f=Math.sqrt(Math.pow(e-c[0],2)+Math.pow(i-c[1],2)),y="M "+l+" "+p+" L "+d[0]+" "+d[1];h.attr("d",s),g.attr("d",y),(r=f<=n)&&a?g.attr("display",null):g.attr("display","none");t.nodes().forEach((function(e){e.__lasso.loopSelect=!!(r&&a&&e.__lasso.lassoPoint)&&Fe()(u,e.__lasso.lassoPoint)<1,e.__lasso.possible=e.__lasso.hoverSelect||e.__lasso.loopSelect})),o.draw()})).on("end",(function(){t.on("mouseover.lasso",null),t.nodes().forEach((function(e){e.__lasso.selected=e.__lasso.possible,e.__lasso.possible=!1})),h.attr("d",null),g.attr("d",null),m.attr("display","none"),o.end()}));e.call(f)}return l.items=function(e){if(!arguments.length)return t;var n=(t=e).nodes();return n.forEach((function(e){e.__lasso={possible:!1,selected:!1}})),l},l.possibleItems=function(){return t.filter((function(){return this.__lasso.possible}))},l.selectedItems=function(){return t.filter((function(){return this.__lasso.selected}))},l.notPossibleItems=function(){return t.filter((function(){return!this.__lasso.possible}))},l.notSelectedItems=function(){return t.filter((function(){return!this.__lasso.selected}))},l.closePathDistance=function(e){return arguments.length?(n=e,l):n},l.closePathSelect=function(e){return arguments.length?(a=!0===e,l):a},l.isPathClosed=function(e){return arguments.length?(r=!0===e,l):r},l.hoverSelect=function(e){return arguments.length?(i=!0===e,l):i},l.on=function(e,t){if(!arguments.length)return o;if(1===arguments.length)return o[e];var n=["start","draw","end"];return n.indexOf(e)>-1&&(o[e]=t),l},l.targetArea=function(t){return arguments.length?(e=t,l):e},l}();o.items(r.selectAll("circle.highlighted")),o.targetArea(i).on("start",(function(){})).on("draw",(function(){})).on("end",(function(){o.selectedItems()._groups[0].forEach((function(e){var t=e.attributes.id.value;a.includes(t)||ae(t,n.props.globalState.selectedDisease,!0,n.props.dispatch)}))})),r.call(o)}},{key:"drawScatter",value:function(){var e=this,t=this.props.globalState,n=t.diseasePredictions,a=(t.appMode,this.props),i=a.width,o=a.height,l=this.state,s=l.embedding,c=l.showCategoryColors,d=Object.values(s).map((function(t){return e.getCoords(t)})),u=be.c(d.map((function(e){return e[0]}))),p=be.c(d.map((function(e){return e[1]}))),h=be.k().domain(u).range([this.circleRadius,i-this.circleRadius]),m=be.k().domain(p).range([this.circleRadius,o-this.circleRadius]),f=n.map((function(e){return e.node_id||e.id})),y=n.filter((function(e){return e.selected})).map((function(e){return e.node_id||e.id})),b=function(e){return f.indexOf(e)>-1?f.indexOf(e):f.length};return Object.keys(s).sort((function(e,t){return-b(e)+b(t)})).map((function(t){var n,a=s[t],i=e.getCoords(a),o=Object(g.a)(i,2),l=o[0],d=o[1],u=e.getCategory(a),p=e.getName(a),b=f.indexOf(t)>-1,v=y.includes(t);return n=v?"black":b?c&&Ue[u]||"#1890ff":c&&Ue[u]||"lightGray",r.a.createElement("circle",{cx:h(l),cy:m(d),key:t,className:b?"highlighted disease":"disease",id:t,fill:n,opacity:v?1:b?.85:.5,stroke:v?"#fff":"rgba(255,255,255,0.5)",strokeWidth:v?2:1,r:v?2*e.circleRadius:b?1.3*e.circleRadius:e.circleRadius,onDoubleClick:function(){b&&e.onChangeDisease(t)},onClick:function(){return e.showTooltip(t,[h(l),m(d)],u,p)}})}))}},{key:"onChangeDisease",value:function(e){var t=this.props.globalState,n=t.appMode,a=t.selectedDrugPrimary,r=t.diseasePredictions;if("drug-to-disease"===n&&a){var i=r.find((function(t){return(t.node_id||t.id)===e}));if(!i)return void console.warn("Disease prediction not found for node_id: ".concat(e));var o=i.id,l=i.node_id||i.id,s=function(e,t){return!e.filter((function(e){return e.selected})).map((function(e){return e.node_id||e.id})).includes(t)}(r,o);oe(o,a,s,this.props.dispatch,l)}}},{key:"onChangeDrug",value:function(e){if("drug-to-disease"===this.props.globalState.appMode)re(e,this.props.dispatch);else{var t=pe(this.props.globalState.drugPredictions,e);ae(e,this.props.globalState.selectedDisease,t,this.props.dispatch)}}},{key:"showTooltip",value:function(e,t,n,a){var r=this,i=this.props.globalState.nodeNameDict;this.hoverTimeout=window.setTimeout((function(){var o,l=a||(null===(o=i.disease)||void 0===o?void 0:o[e])||e,s=n?" [".concat(n,"]"):"";r.setState({tooltip:{visible:!0,info:"".concat(l).concat(s),position:t}})}),this.WAIT)}},{key:"hideTooltip",value:function(){window.clearTimeout(this.hoverTimeout),this.setState({tooltip:{visible:!1,info:"",position:[0,0]}})}},{key:"render",value:function(){var e=this,t=this.props.globalState,n=t.isDrugLoading,a=t.isInitializing,i=this.props,o=i.width,l=i.height,s=this.state,c=s.tooltip,d=s.showCategoryColors;return r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("svg",{width:o,height:l,className:"scatter"},r.a.createElement("rect",{className:"lasso area",width:o,height:l,opacity:0}),r.a.createElement("g",{className:"scatter"},this.state.embedding?this.drawScatter():r.a.createElement("g",{transform:"translate(".concat(o/2,", ").concat(l/2,")"),textAnchor:"middle"},ke),n&&!a?r.a.createElement("g",{transform:"translate(".concat(o/2,", ").concat(l/2,")"),textAnchor:"middle"},ke):r.a.createElement("g",null))," ",r.a.createElement("text",{x:0,y:l-25,fontSize:12,fill:"gray"},"Click to reveal the disease name."),r.a.createElement("text",{x:0,y:l-10,fontSize:12,fill:"gray"},"Double click to select the disease.")),r.a.createElement("div",{style:{position:"absolute",top:5,right:5,background:"rgba(255,255,255,0.95)",padding:"8px",borderRadius:"6px",boxShadow:"0 1px 4px rgba(0,0,0,0.15)",fontSize:"10px",maxWidth:"140px"}},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"}},r.a.createElement("span",{style:{fontWeight:"bold",fontSize:"11px"}},"Categories"),r.a.createElement("button",{onClick:function(){return e.setState({showCategoryColors:!d})},style:{padding:"2px 6px",fontSize:"9px",border:"1px solid #ccc",borderRadius:"3px",background:d?"#e3f2fd":"#fff",cursor:"pointer"}},d?"ON":"OFF")),d&&r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"}},Object.entries(Ue).slice(0,9).map((function(e){var t=Object(g.a)(e,2),n=t[0],a=t[1];return r.a.createElement("div",{key:n,style:{display:"flex",alignItems:"center",gap:"3px",width:"48%"}},r.a.createElement("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:a}}),r.a.createElement("span",{style:{textTransform:"capitalize",fontSize:"9px"}},n.substring(0,8)))})))),r.a.createElement("div",{className:"tooltip tooltip-".concat(c.visible?"show":"hide"),style:{left:c.position[0]+this.circleRadius,top:c.position[1]+this.circleRadius}},c.info))}}]),n}(r.a.Component)),Ye=(n(163),n(274)),qe=ye(function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).TITLE_HEIGHT=36,a.MARGIN=10,a.PADDING=10,a.EDGE_LENGTH=120,a.NODE_WIDTH=130,a.NODE_HEIGHT=25,a.VERTICAL_GAP=2,a.GROUP_GAP=6,a.COUNT_GAP=5,a.RADIUS=a.NODE_HEIGHT/2,a.HEAD_HEIGHT=70,a.ICON_GAP=20,a.offsetY=0,a.state={expand:a.props.globalState.metaPathSummary.map((function(e){return!1})),isModalVisible:!1},a.showModal=a.showModal.bind(Object(c.a)(a)),a.hideModal=a.hideModal.bind(Object(c.a)(a)),a.filterMetaPathGroups=a.filterMetaPathGroups.bind(Object(c.a)(a)),a}return Object(s.a)(n,[{key:"toggleExpand",value:function(e,t){var n=this.state.expand;n[e]=void 0===t?!n[e]:t,this.setState({expand:n})}},{key:"isPathSelected",value:function(e){var t=this.props.globalState.selectedPathNodes;return t.map((function(e){return e.nodeId})).join()===e.map((function(e){return e.nodeId})).join()&&t.map((function(e){return e.nodeType})).join()===e.map((function(e){return e.nodeType})).join()}},{key:"togglePathNodes",value:function(e,t){t?this.props.dispatch({type:ee,payload:{selectedPathNodes:[]}}):this.props.dispatch({type:ee,payload:{selectedPathNodes:e}})}},{key:"getMetaIconGroup",value:function(e,t){return r.a.createElement("g",{className:"feedback",cursor:"pointer",style:{fill:"#777"},transform:"translate(5, 0)"},r.a.createElement("g",{className:"yes",transform:"translate(".concat(0*this.ICON_GAP,", 0)"),onClick:function(){return e(!t)}},r.a.createElement("rect",{width:this.ICON_GAP,height:this.ICON_GAP,fill:"white"}),r.a.createElement("path",{d:t?"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z":"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",transform:"scale(0.03)"})))}},{key:"getIconGroup",value:function(e){return r.a.createElement("g",{className:"feedback",cursor:"pointer",style:{fill:"#777"}})}},{key:"drawHeader",value:function(){var e=this,t=this.props.globalState,n=t.drugPredictions,a=t.diseasePredictions,i=t.nodeNameDict,o=t.appMode,l="drug-to-disease"===o?a:n,s="drug-to-disease"===o?"disease":"drug";return l.filter((function(e){return e.selected})).map((function(e){return e.name||i[s][e.id]||e.id})).map((function(t,n){return r.a.createElement("text",{key:t,className:t,fill:"gray",cursor:"pointer",transform:"translate(\n            ".concat(n*(2*e.RADIUS+e.COUNT_GAP)+e.RADIUS,", \n            ").concat(e.HEAD_HEIGHT,") \n            rotate(-45)"),onClick:function(){n<l.length&&e.onChangeDrug(l[n].id)}},t)}))}},{key:"getCountWidth",value:function(){var e=this.props.globalState,t=e.drugPredictions,n=e.diseasePredictions;return("drug-to-disease"===e.appMode?n:t).filter((function(e){return e.selected})).length*(2*this.RADIUS+this.COUNT_GAP)+this.COUNT_GAP}},{key:"drawSummary",value:function(){var e=this,t=this.EDGE_LENGTH,n=this.NODE_WIDTH,a=this.NODE_HEIGHT,i=this.VERTICAL_GAP,o=this.props.globalState,l=o.metaPathSummary,s=o.drugPredictions,c=o.diseasePredictions,d=o.appMode,u=o.nodeNameDict,p="drug-to-disease"===d?c:s,h=this.getCountWidth(),g=this.filterMetaPathGroups(),m=Math.max.apply(Math,Object(f.a)(l.map((function(e){return Object.values(e.count)})).flat())),y=be.k().range([this.RADIUS/3,this.RADIUS]).domain([0,m]);this.offsetY=0;var b=Object(f.a)(l).sort((function(e,t){return(e.hide?1:0)-(t.hide?1:0)})).map((function(o){var s=o.nodeTypes.map((function(i,o){var l="translate(".concat((t+n)*o,", ",0,")");return r.a.createElement("g",{key:"node_".concat(o),transform:l},r.a.createElement("rect",{width:n,height:a,fill:"white",strokeWidth:"3",stroke:_e(i),rx:e.NODE_HEIGHT/2}),r.a.createElement("text",{textAnchor:"middle",y:a/2+6,x:n/2,fill:"black"},i))})),c=Object(f.a)(Array(s.length-1)).map((function(e,i){var o="translate(".concat(n+(t+n)*i,", ").concat(+a/2,")");return r.a.createElement("g",{key:"edge_".concat(i),transform:o},r.a.createElement("line",{stroke:"lightgray",strokeWidth:2,x1:0,y1:0,x2:t,y2:0}))})),d=e.offsetY;e.offsetY+=a+i;var m=[],b=0,v=e.state.expand[o.idx],E=void 0,x=0;Object.keys(g).forEach((function(t){var n,l,s=(null===(n=g[t].filter((function(e){return e.nodeTypes.join("")===o.nodeTypes.join("")}))[0])||void 0===n?void 0:n.paths)||[],c=p.filter((function(e){return e.selected})).map((function(e){return e.id})).indexOf(t),d=p.find((function(e){return e.id===t})),h=(null===d||void 0===d?void 0:d.name)||(null===(l=u.disease)||void 0===l?void 0:l[t])||t,f=h.length>25?h.slice(0,22)+"...":h,y=e.drawChildrenPaths(s,c,E),k=y.children,w=y.numOfChildren;E=s[s.length-1];var S=(a+i)*w,_=w>0?r.a.createElement("g",{transform:"translate(0, ".concat(b,")")},r.a.createElement("text",{x:e.PADDING,y:e.NODE_HEIGHT/2+5,fill:"#333",fontSize:11,fontWeight:"bold"},"[",x+1,"] ",f)):null;w>0&&(x++,m.push(r.a.createElement("g",{key:"drugRank: ".concat(c),className:"drugRank_".concat(c),transform:"translate(0, ".concat(b,")")},_,r.a.createElement("g",{transform:"translate(0, ".concat(e.NODE_HEIGHT+5,")")},k))),b+=S+e.NODE_HEIGHT+5,v&&(e.offsetY+=S+e.NODE_HEIGHT+5)),e.offsetY+=e.GROUP_GAP}));return r.a.createElement("g",{key:"prototype_".concat(o.idx),transform:"translate(".concat(0,", ",d,")"),opacity:o.hide?.4:1},r.a.createElement("g",{className:"metaCount"},e.drawMetaCount(o,y)),r.a.createElement("g",{className:"icon"},r.a.createElement("path",{d:v?"M 6.414 9 h 11.172 a 1 1 0 0 1 0.707 1.707 l -5.586 5.586 a 1 1 0 0 1 -1.414 0 l -5.586 -5.586 A 1 1 0 0 1 6.414 9 Z":"M 9 17.879 V 6.707 A 1 1 0 0 1 10.707 6 l 5.586 5.586 a 1 1 0 0 1 0 1.414 l -5.586 5.586 A 1 1 0 0 1 9 17.879 Z",transform:"translate(".concat(h,", 0)"),fill:"gray",onClick:function(){o.hide||e.toggleExpand(o.idx,void 0)},cursor:"pointer"})),r.a.createElement("g",{className:"prototype",transform:"translate(".concat(h+e.ICON_GAP,", 0)")},s,c,r.a.createElement("g",{className:"iconGroup",transform:"translate(".concat(n*s.length+t*c.length,", 0)")},e.getMetaIconGroup((function(t){!function(e,t,n,a){e[t].hide=n,a({type:te,payload:{metaPathSummary:e}})}(l,o.idx,t,e.props.dispatch),t&&e.toggleExpand(o.idx,!1)}),o.hide))),r.a.createElement("g",{className:"metapaths"},v?m:r.a.createElement("g",null)))})),v=this.drawHeader();return r.a.createElement("g",null,r.a.createElement("g",{className:"header",transform:"translate(".concat(this.PADDING,", ").concat(this.PADDING,")")},v),r.a.createElement("g",{className:"rows",transform:"translate(".concat(0,", ",this.PADDING+this.HEAD_HEIGHT,")")},b))}},{key:"onChangeDrug",value:function(e){var t=this.props.globalState,n=t.appMode,a=t.drugPredictions,r=t.diseasePredictions,i=t.selectedDisease,o=t.selectedDrugPrimary;if("drug-to-disease"===n){var l=pe(r,e);o&&oe(e,o,l,this.props.dispatch)}else{var s=pe(a,e);ae(e,i,s,this.props.dispatch)}}},{key:"componentDidUpdate",value:function(e){var t=this.props.globalState,n=t.appMode,a=t.drugPredictions,r=t.diseasePredictions,i=t.selectedDisease,o=t.metaPathSummary,l="drug-to-disease"===e.globalState.appMode?e.globalState.diseasePredictions:e.globalState.drugPredictions,s="drug-to-disease"===n?r:a;if(e.globalState.selectedDisease!==i)this.setState({expand:o.map((function(e){return!1}))});else if(l.filter((function(e){return e.selected})).length!==s.filter((function(e){return e.selected})).length){var c=o.map((function(e){return!1}));this.setState({expand:c})}}},{key:"drawMetaCount",value:function(e,t){var n=this,a=this.props.globalState,i=a.drugPredictions,o=a.diseasePredictions,l=a.isAttentionLoading,s=a.metaPathGroups,c=a.edgeThreshold,d=a.appMode,u=(e.count,e.nodeTypes),p=("drug-to-disease"===d?o:i).filter((function(e){return e.selected})).map((function(e,t){var a,i=e.id,o=null===(a=s[i])||void 0===a?void 0:a.find((function(e){return e.nodeTypes.join(",")===u.join(",")})),d=o?o.paths.filter((function(e){return e.edges.every((function(e){return e.score>=c}))})).length:l?"...":0,p=r.a.createElement("text",{textAnchor:"middle",transform:"translate(".concat(n.RADIUS,", ").concat(n.RADIUS/2,")"),fontSize:15,fill:"gray"},d);return r.a.createElement("g",{key:t,className:"count",transform:"translate(".concat(t*(2*n.RADIUS+n.COUNT_GAP),", ").concat(n.NODE_HEIGHT/2,")"),cursor:"pointer",onClick:function(){return n.onChangeDrug(i)}},p)}));return r.a.createElement("g",{className:"metaCount",transform:"translate(".concat(this.PADDING,", 0)")},p)}},{key:"drawChildrenPaths",value:function(e,t,n){var a=this,i=this.props.globalState,o=i.nodeNameDict,l=i.edgeTypes,s=i.edgeThreshold,c=this.getCountWidth(),d=e.filter((function(e){return e.edges.every((function(e){return e.score>=s}))})),u=d.map((function(e,n){var i=e.edges.map((function(e){return e.score})).filter((function(e){return e>0})),s=i.length>0?(i.reduce((function(e,t){return e+t}),0)/i.length).toFixed(2):(n+1).toString(),d=e.nodes.map((function(e,t){var n,i=e.nodeId,l=e.nodeType,s=(null===(n=o[l])||void 0===n?void 0:n[i])||i,c=Ee(s,14,a.NODE_WIDTH-10)||i||"unknown",d="translate(".concat(40+(a.EDGE_LENGTH+a.NODE_WIDTH)*t,", ",0,")");return r.a.createElement(ve.a,{key:"node_".concat(t),title:(c.includes("."),s+(e.source?" (".concat(e.source,")"):""))},r.a.createElement("g",{transform:d,className:"node_".concat(i),style:{cursor:"pointer"},onClick:function(){return"drug"===l&&window.open("https://go.drugbank.com/drugs/".concat(i),"windowName","popup,right=10,top=10,width=320,height=600")}},r.a.createElement("rect",{width:a.NODE_WIDTH,height:a.NODE_HEIGHT,fill:_e(l)}),r.a.createElement("text",{textAnchor:"middle",y:a.NODE_HEIGHT/2+6,x:a.NODE_WIDTH/2,fill:"white"},c)))})),u=r.a.createElement("g",{key:"weight",transform:"translate(0, ".concat(a.NODE_HEIGHT/2+5,")")},r.a.createElement("text",{textAnchor:"end",x:35,fill:"#666",fontSize:12,fontWeight:"bold"},s)),p=e.edges.map((function(e,t){var n,i="translate(".concat(40+a.NODE_WIDTH+(a.EDGE_LENGTH+a.NODE_WIDTH)*t,", ").concat(+a.NODE_HEIGHT/2,")"),o=e.edgeInfo.replace("rev_","");o=(null===(n=l[o])||void 0===n?void 0:n.edgeInfo)||o;var s=Ee(o,14,a.EDGE_LENGTH);return r.a.createElement(ve.a,{title:s===o?"":o,destroyTooltipOnHide:!0},r.a.createElement("g",{key:"edge_".concat(t),transform:i,style:{cursor:"pointer"}},r.a.createElement("line",{stroke:"gray",strokeWidth:1+2*e.score,x1:0,y1:a.NODE_HEIGHT/4,x2:a.EDGE_LENGTH,y2:a.NODE_HEIGHT/4}),r.a.createElement("text",{x:a.EDGE_LENGTH/2,y:0,textAnchor:"middle",fill:"gray"},s)))}));return r.a.createElement("g",{key:n,transform:"translate(0, ".concat((a.NODE_HEIGHT+a.VERTICAL_GAP)*(1+n),")")},r.a.createElement("circle",{cx:t*(2*a.RADIUS+a.COUNT_GAP)+a.RADIUS+a.PADDING,cy:a.NODE_HEIGHT/2,fill:"gray",r:a.RADIUS/4}),r.a.createElement("g",{transform:"translate(".concat(c+a.ICON_GAP,", 0)")},u,d,p,r.a.createElement("g",{className:"iconGroup",transform:"translate(".concat(40+a.NODE_WIDTH*d.length+a.EDGE_LENGTH*p.length,", 0)")},a.getIconGroup(e.nodes))))}));return{children:u,numOfChildren:d.length}}},{key:"showModal",value:function(){this.setState({isModalVisible:!0})}},{key:"hideModal",value:function(){this.setState({isModalVisible:!1})}},{key:"filterMetaPathGroups",value:function(){var e=this.props.globalState,t=e.metaPathGroups,n=e.edgeThreshold,a={};return Object.keys(t).forEach((function(e){a[e]=t[e].map((function(e){var t=e.paths.filter((function(e){return e.edges.every((function(e){return e.score>n}))}));return Object(p.a)(Object(p.a)({},e),{},{metaPaths:t})}))})),Object.keys(a).forEach((function(e){a[e]=a[e].filter((function(e){return e.paths.length>0}))})),a}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,a=this.state,i=a.isModalVisible,o=a.expand,l=this.props.globalState,s=(l.isDrugLoading,l.isAttentionLoading),c=l.metaPathSummary,d=l.selectedDisease,u=l.drugPredictions,p=Math.max(t-2*this.PADDING-2*this.MARGIN,this.getCountWidth()+5*this.ICON_GAP+this.NODE_WIDTH+4*(this.EDGE_LENGTH+this.NODE_WIDTH)),h=Object.values(c).map((function(e,t){return o[t]?e.sum:0})).reduce((function(e,t){return e+t}),0),g=Object.keys(c).length,m=h*(this.NODE_HEIGHT+this.VERTICAL_GAP)+this.PADDING+g*(this.HEAD_HEIGHT+this.GROUP_GAP),f=n-2*this.PADDING-this.TITLE_HEIGHT,y=Math.max(m+this.HEAD_HEIGHT,f),b=r.a.createElement("text",{x:t/2,y:n/2,fill:"gray",textAnchor:"middle",fontSize:20},s?"":"string"==typeof d&&u.filter((function(e){return e.selected})).length>0?"Sorry, we find no meta path with current computational resources.":"Please select a disease and at least one drug"),v=this.drawSummary(),E=0===c.length?b:v;return r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{width:p,height:y},E,s?r.a.createElement("g",{className:"loading"},r.a.createElement("rect",{className:"loading__background",width:p,height:f,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(p/2,", ").concat(f/2,")")},ke)):r.a.createElement(r.a.Fragment,null)),r.a.createElement(Ye.a,{title:"Edit Explanation",visible:i,onOk:this.hideModal,onCancel:this.hideModal,okText:"Confirm",width:t,zIndex:1999},r.a.createElement("svg",{width:t})))}}]),n}(r.a.Component)),Ke=h.a.TabPane,Ze=ye(function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).titleHeight=36,a.margin=10,a.padding=10,a.state={activeTab:"metapath"},a}return Object(s.a)(n,[{key:"changeActiveTab",value:function(e){this.setState({activeTab:e})}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,a=t-2*this.margin-2*this.padding,i=n-2*this.padding-this.titleHeight-2*this.margin,o=Object(p.a)(Object(p.a)({},this.props),{},{height:i,width:a});return r.a.createElement(h.a,{size:"small",activeKey:this.state.activeTab,destroyInactiveTabPane:!1,style:{width:t-2*this.margin,height:n-this.margin,margin:this.margin,marginBottom:0,backgroundColor:"white"},tabBarStyle:{height:this.titleHeight,padding:"0px 10px",margin:"0px"},onChange:this.changeActiveTab.bind(this)},r.a.createElement(Ke,{style:{padding:this.padding},key:"metapath",tab:"Meta-Path"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(qe,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"attention",tab:"Node Attention"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(Ce,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"graph",tab:"Sub-Graph"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(Te,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"bestpath",tab:"Top Paths"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(He,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"allpaths",tab:"All Paths (2-5 hop)"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflow:"hidden"}},r.a.createElement(ze,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"allpaths10hop",tab:"All Paths (10 hop)"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflow:"hidden"}},r.a.createElement(Me,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"v1attention",tab:"Node_Attention"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(Ae,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"v1subgraph",tab:"Sub_Graph"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflow:"hidden"}},r.a.createElement(Re,o))),r.a.createElement(Ke,{style:{padding:this.padding},key:"embedding",tab:"Disease Embeddings"},r.a.createElement("div",{className:"nodelink",style:{width:a,height:i,overflowY:"scroll"}},r.a.createElement(Ve,{width:a,height:i}))))}}]),n}(r.a.Component)),Je=(n(267),n(278)),Xe=n(277),$e=n(281),Qe=n(280),et=n(279),tt=n(282),nt=n(283),at=n(276),rt=n(275),it=n(284),ot=n(132),lt=n(285),st=n(75),ct=Je.a.Sider,dt=Xe.a.Option,ut=ye(function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).padding=10,a.listHeight=450,a.unsubscribePreload=null,a.state={preloadProgress:{total:0,completed:0,drugId:""},cacheSize:0},a.changeEdgeTHR=a.changeEdgeTHR.bind(Object(c.a)(a)),a.changeRevEdgeTHR=a.changeRevEdgeTHR.bind(Object(c.a)(a)),a.onChangeDisease=a.onChangeDisease.bind(Object(c.a)(a)),a.onChangeDrug=a.onChangeDrug.bind(Object(c.a)(a)),a.onChangeAppMode=a.onChangeAppMode.bind(Object(c.a)(a)),a.onChangeDrugPrimary=a.onChangeDrugPrimary.bind(Object(c.a)(a)),a.onChangeDiseaseSecondary=a.onChangeDiseaseSecondary.bind(Object(c.a)(a)),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribePreload=M((function(t){e.setState({preloadProgress:t,cacheSize:k.getStats().size})}))}},{key:"componentWillUnmount",value:function(){this.unsubscribePreload&&this.unsubscribePreload()}},{key:"onChangeAppMode",value:function(e){ie(e.target.value,this.props.dispatch)}},{key:"onChangeDrugPrimary",value:function(e){re(e,this.props.dispatch)}},{key:"onChangeDiseaseSecondary",value:function(e){var t=this.props.globalState.diseasePredictions.filter((function(e){return e.selected})).map((function(e){return e.id})),n=e.length>t.length,a=n?e[e.length-1]:t.filter((function(t){return!e.includes(t)}))[0];if(this.props.globalState.selectedDrugPrimary&&a){var r=this.props.globalState.selectedDrugPrimary,i=this.props.globalState.diseasePredictions.find((function(e){return e.id===a})),o=(null===i||void 0===i?void 0:i.node_id)||a;oe(a,r,n,this.props.dispatch,o)}}},{key:"onChangeDrug",value:function(e){var t=this.props.globalState.drugPredictions.filter((function(e){return e.selected})).map((function(e){return e.id})),n=e.length>t.length,a=n?e[e.length-1]:t.filter((function(t){return!e.includes(t)}))[0];ae(a,this.props.globalState.selectedDisease,n,this.props.dispatch)}},{key:"changeEdgeTHR",value:function(e){"number"==typeof e&&this.props.dispatch({type:Z,payload:{edgeThreshold:e}})}},{key:"changeRevEdgeTHR",value:function(e){"number"==typeof e&&this.props.dispatch({type:Z,payload:{edgeThreshold:Math.round(10-10*e)/10}})}},{key:"onChangeDisease",value:function(e){!function(e,t){t({type:K,payload:{isDrugLoading:!0}}),t({type:X,payload:{selectedDisease:e}}),t({type:J,payload:{selectedDrug:void 0}}),I(e).then((function(e){var n=e.predictions.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{selected:!1})}));t({type:U,payload:{drugPredictions:n}})})).then((function(){t({type:K,payload:{isDrugLoading:!1}})}))}(e,this.props.dispatch)}},{key:"render",value:function(){var e=this.props.siderWidth,t=this.props.globalState,n=t.edgeThreshold,a=t.nodeTypes,i=t.diseaseOptions,o=t.drugOptions,l=t.drugPredictions,s=t.diseasePredictions,c=t.nodeNameDict,d=t.selectedDisease,u=t.selectedDrugPrimary,p=t.appMode||"disease-to-drug",h=l.filter((function(e){return e.selected})).map((function(e){return e.id})),m=s?s.filter((function(e){return e.selected})).map((function(e){return e.id})):[],y=r.a.createElement(ve.a,{title:"Diseases with no known drug indications in the dataset"},r.a.createElement(it.a,{style:{color:"#eb2f96"}})),b=r.a.createElement(ve.a,{title:"US FDA-approved drug indication"},r.a.createElement(ot.a,{style:{color:"#52c41a"}}));return r.a.createElement(ct,{width:e,theme:"light",style:{padding:"".concat(this.padding,"px")}},r.a.createElement("div",{style:{marginBottom:10,textAlign:"center"}},r.a.createElement($e.a.Group,{value:p,onChange:this.onChangeAppMode},r.a.createElement($e.a.Button,{value:"disease-to-drug"},"Disease \u2192 Drug"),r.a.createElement($e.a.Button,{value:"drug-to-disease"},"Drug \u2192 Disease"))),"disease-to-drug"===p?r.a.createElement(r.a.Fragment,null,"Disease:",r.a.createElement(Xe.a,{defaultValue:"15783",style:{width:e-2*this.padding},onChange:this.onChangeDisease,showSearch:!0,optionFilterProp:"label",value:d},i.length>0?i.filter((function(e){return!c.disease||!c.disease[e[0]]||!((t=c.disease[e[0]])&&Oe.includes(t.toLowerCase()));var t})).map((function(t){var n,a=Object(g.a)(t,2),i=a[0],o=a[1],l=c.disease&&c.disease[i]||i,s=10*l.length>.8*e?l.slice(0,40)+"...":l;return r.a.createElement(dt,{value:i,label:l,key:"diseaseID_".concat(t)},r.a.createElement("span",{title:l}," ",(n=s).charAt(0).toUpperCase()+n.slice(1)," "),!o&&y)})):r.a.createElement(dt,{value:"loading",label:"loading",key:"loading"},"data is loading..")),r.a.createElement("br",null),"Drug:",0===l.length?r.a.createElement(Qe.a,null):r.a.createElement(Xe.a,{mode:"multiple",style:{width:e-2*this.padding},open:!0,showSearch:!0,optionFilterProp:"label",listHeight:this.listHeight,onChange:this.onChangeDrug,defaultValue:je,value:h,menuItemSelectedIcon:r.a.createElement(r.a.Fragment,null)},l.map((function(t,n){var a=t.id,i=t.score,o=t.known,l=c.drug&&c.drug[a]||a,s=10*l.length>.5*e?l.slice(0,20)+"...":l;return r.a.createElement(dt,{value:a,key:"disease_".concat(n),label:l},r.a.createElement("div",null,r.a.createElement("span",null,"[",n+1,"] ",r.a.createElement("span",{title:l},s)," ",o&&b),r.a.createElement("span",{style:{float:"right"}},"score: ",Pe(i).toFixed(3))))})))):r.a.createElement(r.a.Fragment,null,"Drug:",r.a.createElement(Xe.a,{style:{width:e-2*this.padding},onChange:this.onChangeDrugPrimary,showSearch:!0,optionFilterProp:"label",placeholder:"Click to select a drug",value:u,dropdownStyle:{maxHeight:400,overflow:"auto"},listHeight:350,virtual:!1},o&&o.length>0?Object(f.a)(o).map((function(e){return{id:e,name:c.drug?c.drug[e]:e}})).sort((function(e,t){return(e.name||e.id).localeCompare(t.name||t.id)})).map((function(e,t){var n=e.id,a=e.name||n;return r.a.createElement(dt,{value:n,label:a,key:"drugID_".concat(n)},r.a.createElement("div",{style:{padding:"4px 0"}},r.a.createElement("span",{style:{fontWeight:500}},"[",t+1,"]")," ",r.a.createElement("span",{title:a},a)))})):r.a.createElement(dt,{value:"loading",label:"loading",key:"loading",disabled:!0},"Loading drugs... (Please wait)")),r.a.createElement("br",null),"Disease Candidates:",s&&0!==s.length?r.a.createElement(Xe.a,{mode:"multiple",style:{width:e-2*this.padding},open:!0,showSearch:!0,optionFilterProp:"label",listHeight:this.listHeight,onChange:this.onChangeDiseaseSecondary,value:m,menuItemSelectedIcon:r.a.createElement(r.a.Fragment,null)},s.map((function(t,n){var a=t.id,i=t.score,o=t.known,l=t.name,s=t.percentile,d=t.z_score,u=t.rank,p=l||(c.disease?c.disease[a]:a),h=p&&10*p.length>.5*e?p.slice(0,20)+"...":p,g=s?(100-s).toFixed(2):null,m=u||n+1,f="Raw score: ".concat((null===i||void 0===i?void 0:i.toFixed(6))||"N/A").concat(d?", Z-score: ".concat(d.toFixed(2)):"");return r.a.createElement(dt,{value:a,key:"disease_".concat(n),label:p},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}},r.a.createElement("span",{style:{color:"#666",marginRight:4}},"#",m),r.a.createElement("span",{title:p},h)," ",o&&b),r.a.createElement("span",{style:{fontSize:"11px",color:"#1890ff",marginLeft:8},title:f},g?"Top ".concat(g,"%"):"".concat(Pe(i).toFixed(3)))))}))):this.props.globalState.isDiseaseLoading?r.a.createElement(Qe.a,null):r.a.createElement("div",null,"Select a drug to see candidates")),r.a.createElement("div",{className:"dummy",style:{height:this.listHeight+20}}),this.state.preloadProgress.total>0&&r.a.createElement("div",{style:{marginBottom:15,padding:"8px 12px",background:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"#f6ffed":"#e6f7ff",borderRadius:6,border:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"1px solid #b7eb8f":"1px solid #91d5ff"}},r.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:4}},this.state.preloadProgress.completed>=this.state.preloadProgress.total?r.a.createElement(r.a.Fragment,null,r.a.createElement(lt.a,{style:{color:"#52c41a",marginRight:6}}),r.a.createElement("span",{style:{fontSize:12,color:"#52c41a",fontWeight:500}},"\u26a1 Data Cached - Instant Response")):r.a.createElement(r.a.Fragment,null,r.a.createElement(st.a,{style:{color:"#1890ff",marginRight:6}}),r.a.createElement("span",{style:{fontSize:12,color:"#1890ff"}},"Caching data for fast interactions..."))),r.a.createElement(et.a,{percent:Math.round(this.state.preloadProgress.completed/this.state.preloadProgress.total*100),size:"small",status:this.state.preloadProgress.completed>=this.state.preloadProgress.total?"success":"active",showInfo:!1}),r.a.createElement("div",{style:{fontSize:10,color:"#888",marginTop:2}},this.state.cacheSize," items cached")),"Minimum self-explaining edge score:",r.a.createElement(tt.a,{gutter:20},r.a.createElement(nt.a,{span:5},r.a.createElement(at.a,{value:n,onChange:this.changeEdgeTHR,style:{width:"100%"},step:.1,min:0,max:1})),r.a.createElement(nt.a,{span:16},r.a.createElement(rt.a,{step:.1,value:1-n,min:0,max:1,onChange:this.changeRevEdgeTHR,marks:{0:"1.0",1:"0.0"},reverse:!0,tipFormatter:function(e){return e&&(1-e).toFixed(1)}}))),r.a.createElement("div",{className:"nodeTypes"},"Node Types:",r.a.createElement("br",null),a.map((function(e){return r.a.createElement("div",{key:e,style:{marginLeft:"5px"}},r.a.createElement("span",{style:{background:_e(e),color:"white",padding:"2px"}},e))}))),r.a.createElement("br",null),r.a.createElement("br",null))}}]),n}(r.a.Component)),pt=n(133),ht=(n(268),Je.a.Header),gt=Je.a.Footer,mt=Je.a.Content,ft=ye(function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).showModal=function(){a.setState({isModalVisible:!0})},a.hideModal=function(){a.setState({isModalVisible:!1})},a.state={width:window.innerWidth,height:window.innerHeight,isModalVisible:!1},a.updateSize=a.updateSize.bind(Object(c.a)(a)),a}return Object(s.a)(n,[{key:"updateSize",value:function(){this.setState({width:window.innerWidth,height:window.innerHeight})}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.updateSize),S().then((function(t){!function(e){Se={},e.forEach((function(e,t){t>we.length-1&&(t%=we.length-1),Se[e]=we[t]}))}(t),e.props.dispatch({type:G,payload:{nodeTypes:t}})})).then((function(){return _()})).then((function(t){e.props.dispatch({type:W,payload:{edgeTypes:t}})})).then((function(){return D()})).then((function(t){e.props.dispatch({type:F,payload:{nodeNameDict:t}})})).then((function(){return O()})).then((function(t){e.props.dispatch({type:V,payload:{diseaseOptions:t}})})).then((function(){return T()})).then((function(t){var n=t.map((function(e){return e.id}));e.props.dispatch({type:q,payload:{drugOptions:n}})})).then((function(){ie("drug-to-disease",e.props.dispatch)})).then((function(){return re("DB12530",e.props.dispatch)})).then((function(){Ie.length>0&&oe(Ie[0],"DB12530",!0,e.props.dispatch)})).then((function(){e.props.dispatch({type:K,payload:{isInitializing:!1}})}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize)}},{key:"render",value:function(){var e=Math.max(0,window.innerWidth-380),t=Math.max(0,window.innerHeight-64-20),n=this.props.globalState.isInitializing,a=r.a.createElement(ht,{className:"header",style:{height:64}},r.a.createElement("img",{src:"favicon.ico",style:{height:51.2,padding:"2px 10px"},alt:"logo"}),r.a.createElement("b",{style:{fontSize:"30px"}},"Amgen Drugs and candidate Diseases Explorer"),r.a.createElement("span",{style:{float:"right",cursor:"pointer"},onClick:this.showModal},r.a.createElement(pt.a,{style:{height:64,fontSize:"20px"}}),r.a.createElement("span",{style:{paddingLeft:"5px",fontSize:"18px",height:64}},"About")," "));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Je.a,null,a,r.a.createElement(Je.a,null,r.a.createElement(ut,{siderWidth:380}),r.a.createElement(mt,{className:"main",style:{height:t}},r.a.createElement(Ze,{width:e,height:t-20}),r.a.createElement(gt,{style:{textAlign:"center",color:"gray",height:20,padding:0}})))),n&&r.a.createElement("svg",{width:window.innerWidth,height:window.innerHeight,style:{position:"absolute",left:0,top:0}},r.a.createElement("g",{className:"loading"},r.a.createElement("rect",{className:"loading__background",width:window.innerWidth,height:window.innerHeight,fill:"white",opacity:.5}),r.a.createElement("g",{transform:"translate(".concat(window.innerWidth/2,", ").concat(window.innerHeight/2,")")},ke))),r.a.createElement(Ye.a,{title:"About Amgen Drugs and candidate Diseases Explorer",className:"about-modal",visible:this.state.isModalVisible,footer:null,onCancel:this.hideModal,zIndex:1099,width:.5*window.innerWidth},r.a.createElement("h3",null,"About"),r.a.createElement("p",null,"This Drug and Diseases Explorer provides a visual interface to interact with the predictions and explanations of an AI model that identify candidate diseases with limited treatment options and minimal molecular understanding for a given Drug."),r.a.createElement("p",null,"AI model is a graph neural network pre-trained on a comprehensive knowledge graph of 17,080 clinically-recognized diseases and 7,957 therapeutic candidates. The model can process various therapeutic tasks in a unified formulation. Once trained, the model can perform zero-shot inference on new diseases without the need for additional parameters or fine-tuning on ground truth labels."),r.a.createElement("h3",null,"Medical Advice Disclaimer"),r.a.createElement("p",null,"DISCLAIMER: THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE",r.a.createElement("br",null),"The information, including but not limited to, text, graphics, images and other material contained on this website are for informational purposes only. No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment. Always seek the advice of your physician or other qualified health care provider with any questions you may have regarding a medical condition or treatment and before undertaking a new health care regimen, and never disregard professional medical advice or delay in seeking it because of something you have read on this website.")))}}]),n}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(269);o.a.render(r.a.createElement(fe,null,r.a.createElement(r.a.StrictMode,null,r.a.createElement(ft,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[238,1,2]]]);
//# sourceMappingURL=main.143956b1.chunk.js.map