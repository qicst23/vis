{"version":3,"sources":["stores/DataService.ts","Const.ts","stores/actions.ts","stores/reducer.ts","stores/index.tsx","helpers/text.ts","helpers/icon.tsx","helpers/color.ts","helpers/index.ts","components/TabContainer/AttentionTree.tsx","components/TabContainer/Graph.tsx","components/TabContainer/V1AttentionTable.tsx","components/TabContainer/V1SubGraph.tsx","components/CardContainer/Scatter.tsx","components/CardContainer/lasso.js","components/TabContainer/PathMatrix.tsx","components/TabContainer/index.tsx","components/Sider/index.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["axiosInstance","axios","create","baseURL","withCredentials","headers","globalCache","cache","Map","pendingRequests","preloadProgress","total","completed","inProgress","currentDrug","listeners","Set","key","entry","this","get","Date","now","timestamp","delete","data","set","notifyListeners","clear","fetcher","cached","has","promise","then","catch","error","size","keys","Array","from","listener","add","forEach","dataCache","requestNodeTypes","a","response","requestEdgeTypes","requestNodeNameDict","requestAttentionPair","diseaseID","drugID","cacheKey","console","log","url","requestDiseaseOptions","diseaseOptions","requestDrugPredictions","predictions","requestDiseasePredictions","requestEmbedding","drugId","requestDrugList","requestSubgraph","diseaseId","preloadCallbacks","notifyPreloadProgress","progress","cb","preloadDataForDrug","startTime","diseases","length","embeddingPromise","topDiseases","slice","allPromises","i","batch","batchPromises","flatMap","disease","diseaseNodeId","node_id","id","e","warn","push","Promise","all","elapsed","getStats","onPreloadProgress","callback","subscribeToPreload","ACTION_TYPES","selectDrug","selectedDrug","selectedDisease","isAdd","dispatch","modifyAttentionPaths","changeDrug","selectDrugPrimary","type","payload","isDiseaseLoading","selectedDrugPrimary","undefined","res","diseasePredictions","map","d","selected","changeAppMode","mode","appMode","fetch","json","drugs","drugOptions","selectDiseaseSecondary","nodeIdForAttention","groupKey","isAttentionLoading","attention","metaPathGroups","groupMetaPaths","metapaths","paths","groups","groupDict","path","hide","nodeTypeString","nodes","nodeType","join","groupIdx","indexOf","nodeTypes","toggleDrugSelection","drugPredictions","updateMetaPathSummary","oldSummary","currentMetaPaths","entityId","newSummary","count","keyId","String","metaPath","sharedMeta","find","sum","idx","filter","isAddDrug","includes","rootReducer","state","action","edgeTypes","metaPathSummary","nodeNameDict","selectedPathNodes","edgeThreshold","JSON","parse","stringify","keyToDelete","pathsToDelete","updatedSummary","updatedDiseasePredictions","initialState","isInitializing","isDrugLoading","GlobalStore","createContext","StateProvider","props","React","useReducer","dispatchBase","useCallback","asyncer","Provider","value","children","StateConsumer","Component","Consumer","context","globalState","cropText","text","fontSize","maxWidth","fontWeight","returnText","document","createElement","getContext","font","width","measureText","prevText","substr","concat","currText","prevWidth","currWidth","getTextWidth","LOADING_ICON","textAnchor","x","y","height","fill","attributeType","attributeName","values","begin","dur","repeatCount","COLORS","colorDict","getNodeColor","Object","pruneEdge","node","threshold","score","sigmoid","t","Math","pow","E","removeDiseaseList","INIT_DISEASES","INIT_DRUGS","AttentionTree","nodeHeight","labelLength","midGap","nodeAttention","stepGap","nodeAttentionFiltered","rootNode","d3","root","nodeSize","d3Tree","linkGene","source","target","maxScore","max","links","link","widthScale","domain","range","edgeInfo","replace","title","nodeId","destroyTooltipOnHide","className","stroke","strokeWidth","opacity","allY","descendants","minY","min","nodeFullName","nodeShortName","tooltipTitle","icon_path","isHighlighted","mouseEnterDelay","transform","cursor","depth","content","heights","nodeKey","drawNodeAttentionHorizontal","selectedItems","drawSubgraph","graphHeight","ModelNodeForce","padding","RADIUS","prevNodes","prevLinks","simulation","force","strength","distance","radius","alphaDecay","velocityDecay","svgNodes","svgLinks","attr","select","active","alpha","restart","fx","fy","selectedIds","desNodes","prevNode","desLinks","sourceData","targetData","selectedIdx","getNodeLinks","selectAll","enter","append","on","transition","delay","call","dragstarted","bind","dragged","dragended","update","exit","remove","classed","isTargetNode","textlabel","isHidden","ticked","updateVisibility","style","visibleNodes","flatTree","drawGraph","prevProps","prevGroups","prevThreshold","prevAttention","currGroups","currNodes","currThreshold","currAttention","prevGroupKeys","sort","currGroupKeys","prevAttentionKeys","currAttentionKeys","updateNodeLabel","selectedDrugs","reminderText","V1AttentionTable","subgraph","loading","lastCacheKey","loadSubgraph","prevDrug","prevDiseases","prevSelectedDisease","setState","l","toUpperCase","percentage","color","backgroundColor","borderRadius","overflow","background","display","alignItems","justifyContent","paddingRight","textShadow","toFixed","edges","borderLeft","nodeMap","edgesByRelation","edge","relation","b","drugName","diseaseName","name","marginBottom","entries","marginTop","borderCollapse","textAlign","borderBottom","sourceNode","targetNode","maxAtt","layer1_att","layer2_att","onMouseEnter","currentTarget","onMouseLeave","label","formatType","renderAttentionBar","NODE_COLORS","drug","protein","pathway","biological_process","molecular_function","cellular_component","anatomy","effect_phenotype","exposure","unknown","V1SubGraph","svgRef","stop","alphaTarget","current","svg","n","container","zoom","scaleExtent","on_path","maxLen","substring","setTimeout","bounds","getBBox","dx","dy","scale","translate","duration","position","top","left","boxShadow","zIndex","bottom","flexWrap","gap","border","right","ref","CATEGORY_COLORS","cancer","neurological","cardiovascular","autoimmune","infectious","metabolic","respiratory","gastrointestinal","genetic","other","circleRadius","hoverTimeout","WAIT","embedding","tooltip","visible","info","showCategoryColors","lastDrugId","onChangeDrug","isArray","coords","category","loadEmbedding","selectedDrugIds","lasso_area","mylasso","targetArea","items","closePathDistance","closePathSelect","isPathClosed","hoverSelect","start","draw","end","lasso","_this","tpath","origin","torigin","drawnCoords","g","dyn_path","close_path","origin_node","dragAction","drag","__lasso","possible","loopSelect","box","getBoundingClientRect","lassoPoint","round","selection","sourceEvent","touches","clientX","clientY","tx","ty","sqrt","close_draw_path","classifyPoint","_","arguments","possibleItems","notPossibleItems","notSelectedItems","types","_groups","attributes","allCoords","getCoords","xDomain","yDomain","xScale","yScale","diseaseIds","selectedDiseaseIds","getSortIndex","fillColor","embData","getCategory","getName","isSelected","cx","cy","r","onDoubleClick","onChangeDisease","onClick","showTooltip","selectedDiseaseNodeId","diseasePrediction","isAddDisease","window","categoryLabel","clearTimeout","drawScatter","textTransform","prop","TITLE_HEIGHT","MARGIN","PADDING","EDGE_LENGTH","NODE_WIDTH","NODE_HEIGHT","VERTICAL_GAP","GROUP_GAP","COUNT_GAP","HEAD_HEIGHT","ICON_GAP","offsetY","expand","isModalVisible","showModal","hideModal","filterMetaPathGroups","flag","doesExist","toggleHideFunc","isHide","nameType","item","COUNT_WIDTH","getCountWidth","maxCount","flat","rScale","allRows","summary","nodeIdx","rx","edgeIdx","x1","y1","x2","y2","currentY","differentChildren","childrenOffsetY","showChildren","lastMetaPath","diseaseIndex","metaPaths","drugRank","prediction","shortDiseaseName","drawChildrenPaths","numOfChildren","childrenHeight","diseaseLabel","drawMetaCount","toggleExpand","getMetaIconGroup","toggleMetaPathHide","header","drawHeader","selectedId","prevPredictions","currPredictions","expandStatus","vis","predictionId","num","every","prevPath","filteredMetaPaths","childIdx","edgeScores","s","pathWeight","reduce","toString","nodeName","shortNodeName","open","weightLabel","edgeName","edgeShortName","getIconGroup","filteredMetaGroups","k","metaPathGroup","svgWidth","matrixRowsCount","matrixGroupsCount","matrixHeight","svgOuterHeight","svgHeight","drawSummary","onOk","onCancel","okText","TabPane","Tabs","titleHeight","margin","activeTab","cardWidth","cardHeight","activeKey","destroyInactiveTabPane","tabBarStyle","onChange","changeActiveTab","tab","overflowY","Sider","Layout","Option","Select","listHeight","unsubscribePreload","cacheSize","changeEdgeTHR","changeRevEdgeTHR","onChangeAppMode","onChangeDrugPrimary","onChangeDiseaseSecondary","selectedDiseases","prevSelectedDiseases","currentDisease","prevSelectedDrugs","selectDisease","siderWidth","currentMode","untreatable_disease_icon","QuestionCircleOutlined","known_drug_icon","CheckCircleOutlined","theme","Group","Button","defaultValue","showSearch","optionFilterProp","toLowerCase","str","treatable","cropName","charAt","menuItemSelectedIcon","drug_id","known","float","placeholder","dropdownStyle","maxHeight","virtual","localeCompare","displayName","disabled","disease_id","predictionName","percentile","z_score","rank","topPercent","displayRank","tooltipInfo","flex","textOverflow","marginRight","marginLeft","ThunderboltOutlined","LoadingOutlined","percent","status","showInfo","gutter","span","step","marks","0","1","reverse","tipFormatter","Header","Footer","Content","innerWidth","innerHeight","updateSize","addEventListener","setNodeColor","drugList","removeEventListener","mainViewWidth","mainViewHeight","src","headerHeight","alt","InfoCircleOutlined","paddingLeft","footer","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.38ef9303.chunk.js","sourcesContent":["import axios from 'axios';\nimport { IAttentionTree, IEdgeTypes, IPath, IState } from 'types';\nimport { SERVER_URL } from 'Const';\n\nconst axiosInstance = axios.create({\n  baseURL: `${SERVER_URL}/`,\n  // timeout: 1000,\n  withCredentials: false,\n  headers: {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'GET,PUT,POST,DELETE,PATCH,OPTIONS',\n  },\n});\n\n// ============================================\n// GLOBAL CENTRALIZED CACHE FOR INSTANT RESPONSE\n// ============================================\n// This cache is shared across ALL components for instant data access\n\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n}\n\nconst CACHE_TTL = 24 * 60 * 60 * 1000; // 24 hour cache lifetime (extended for demo)\n\nclass GlobalDataCache {\n  private cache: Map<string, CacheEntry<any>> = new Map();\n  private pendingRequests: Map<string, Promise<any>> = new Map();\n  \n  // Track preload progress\n  public preloadProgress = {\n    total: 0,\n    completed: 0,\n    inProgress: false,\n    currentDrug: '',\n  };\n  \n  // Listeners for cache updates\n  private listeners: Set<() => void> = new Set();\n  \n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n    \n    // Check if cache is still valid\n    if (Date.now() - entry.timestamp > CACHE_TTL) {\n      this.cache.delete(key);\n      return null;\n    }\n    \n    return entry.data as T;\n  }\n  \n  set<T>(key: string, data: T): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n    this.notifyListeners();\n  }\n  \n  has(key: string): boolean {\n    return this.get(key) !== null;\n  }\n  \n  clear(): void {\n    this.cache.clear();\n    this.pendingRequests.clear();\n    this.preloadProgress = { total: 0, completed: 0, inProgress: false, currentDrug: '' };\n    this.notifyListeners();\n  }\n  \n  // Deduplicate concurrent requests for same key\n  async getOrFetch<T>(key: string, fetcher: () => Promise<T>): Promise<T> {\n    // Return from cache if available\n    const cached = this.get<T>(key);\n    if (cached !== null) {\n      return cached;\n    }\n    \n    // If request already in flight, wait for it\n    if (this.pendingRequests.has(key)) {\n      return this.pendingRequests.get(key)!;\n    }\n    \n    // Create new request\n    const promise = fetcher().then((data) => {\n      this.set(key, data);\n      this.pendingRequests.delete(key);\n      return data;\n    }).catch((error) => {\n      this.pendingRequests.delete(key);\n      throw error;\n    });\n    \n    this.pendingRequests.set(key, promise);\n    return promise;\n  }\n  \n  // Get cache statistics\n  getStats() {\n    return {\n      size: this.cache.size,\n      preloadProgress: this.preloadProgress,\n      keys: Array.from(this.cache.keys()),\n    };\n  }\n  \n  // Subscribe to cache updates\n  subscribe(listener: () => void) {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n  \n  private notifyListeners() {\n    this.listeners.forEach(listener => listener());\n  }\n}\n\n// Global singleton cache instance - shared across ALL components\nconst globalCache = new GlobalDataCache();\n\n// Legacy compatibility\nconst dataCache = globalCache;\n\nconst requestNodeTypes = async (): Promise<string[]> => {\n  const url = './txgnn_data/node_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestEdgeTypes = async (): Promise<IEdgeTypes> => {\n  const url = './txgnn_data/edge_types.json';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestNodeNameDict = async () => {\n  const url = './api/node_name_dict';\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttention = async (diseaseID: string, drugID: string) => {\n  const url = `./api/attention?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  return response.data;\n};\n\nconst requestAttentionPair = async (\n  diseaseID: string,\n  drugID: string\n): Promise<{ attention: { [k: string]: IAttentionTree }; metapaths: IPath[] }> => {\n  // Check cache first\n  const cacheKey = `attention_pair:${drugID}:${diseaseID}`;\n  const cached = dataCache.get<{ attention: { [k: string]: IAttentionTree }; metapaths: IPath[] }>(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] attention_pair for ${drugID}-${diseaseID}`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] fetching attention_pair for ${drugID}-${diseaseID}`);\n  const url = `./api/attention_pair?disease=${diseaseID}&drug=${drugID}`;\n  let response = await axiosInstance.get(url);\n  \n  // Store in cache\n  dataCache.set(cacheKey, response.data);\n  return response.data;\n};\n\nconst requestDiseaseOptions = async () => {\n  // // // the ranking is too costy\n  const url = './api/diseases';\n  const response = await axiosInstance.get(url);\n  const diseaseOptions: IState['diseaseOptions'] = response.data;\n\n  // const urlRanking = './txgnn_data/disease_ranking.json';\n  // let rank = await axiosInstance.get(urlRanking);\n  // const ranking = rank.data;\n\n  // diseaseOptions.sort((a, b) => ranking.indexOf(a[0]) - ranking.indexOf(b[0]));\n  // const urlRanking = './txgnn_data/disease_options.json'; // ranking is too costy, use pre-processed data\n  // let res = await axiosInstance.get(urlRanking);\n\n  return diseaseOptions;\n};\n\nconst requestDrugPredictions = async (diseaseID: string) => {\n  const url = `./api/drug_predictions?disease_id=${diseaseID}`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  return predictions;\n};\n\nconst requestDiseasePredictions = async (drugID: string) => {\n  // Check cache first\n  const cacheKey = `disease_predictions:${drugID}`;\n  const cached = dataCache.get(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] disease_predictions for ${drugID}`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] fetching disease_predictions for ${drugID}`);\n  const url = `./api/disease_predictions?drug_id=${drugID}&top_n=30`;\n  const response = await axiosInstance.get(url);\n  const predictions = response.data;\n  \n  // Store in cache\n  dataCache.set(cacheKey, predictions);\n  return predictions;\n};\n\nconst requestEmbedding = async (drugId?: string) => {\n  // Check cache first\n  const cacheKey = `embeddings:${drugId || 'default'}`;\n  const cached = dataCache.get(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] embeddings for ${drugId || 'default'}`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] fetching embeddings for ${drugId || 'default'}`);\n  // Request drug-specific disease embeddings from API\n  const url = drugId \n    ? `./api/disease_embeddings?drug_id=${drugId}`\n    : './data/disease_tsne.json';\n  const response = await axiosInstance.get(url);\n  \n  // Store in cache\n  dataCache.set(cacheKey, response.data);\n  return response.data;\n};\n\nconst requestDrugList = async (): Promise<{id: string, name: string}[]> => {\n  // Get list of available drugs from API\n  const url = './api/drug_list';\n  const response = await axiosInstance.get(url);\n  return response.data;\n};\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface SubgraphEdge {\n  source: string;\n  target: string;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\nconst requestSubgraph = async (drugId: string, diseaseId: string): Promise<Subgraph> => {\n  // Check cache first\n  const cacheKey = `subgraph:${drugId}:${diseaseId}`;\n  const cached = dataCache.get<Subgraph>(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] subgraph for ${drugId}-${diseaseId}`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] fetching subgraph for ${drugId}-${diseaseId}`);\n  // Get subgraph for a drug-disease pair from API\n  const url = `./api/subgraph?drug_id=${drugId}&disease_id=${diseaseId}`;\n  const response = await axiosInstance.get(url);\n  \n  // Store in cache\n  dataCache.set(cacheKey, response.data);\n  return response.data;\n};\n\n// ============================================\n// AGGRESSIVE PRELOAD FOR INSTANT DEMO RESPONSE\n// ============================================\n\n// Preload status callbacks\ntype PreloadCallback = (progress: { total: number; completed: number; drugId: string }) => void;\nconst preloadCallbacks: Set<PreloadCallback> = new Set();\n\nconst subscribeToPreload = (callback: PreloadCallback) => {\n  preloadCallbacks.add(callback);\n  return () => preloadCallbacks.delete(callback);\n};\n\nconst notifyPreloadProgress = (progress: { total: number; completed: number; drugId: string }) => {\n  preloadCallbacks.forEach(cb => cb(progress));\n};\n\nconst preloadDataForDrug = async (drugId: string): Promise<void> => {\n  // Skip if already preloading this drug\n  if (globalCache.preloadProgress.inProgress && globalCache.preloadProgress.currentDrug === drugId) {\n    console.log(`[Preload] Already preloading ${drugId}, skipping...`);\n    return;\n  }\n  \n  console.log(`[Preload] Starting AGGRESSIVE preload for drug ${drugId}...`);\n  const startTime = Date.now();\n  \n  globalCache.preloadProgress = {\n    total: 0,\n    completed: 0,\n    inProgress: true,\n    currentDrug: drugId,\n  };\n  \n  try {\n    // 1. First fetch disease predictions (needed to know which diseases to preload)\n    const predictions = await requestDiseasePredictions(drugId);\n    const diseases = predictions.predictions || [];\n    console.log(`[Preload] Got ${diseases.length} disease predictions for ${drugId}`);\n    \n    // 2. Preload embeddings immediately (single request)\n    const embeddingPromise = requestEmbedding(drugId);\n    \n    // 3. Calculate total items to preload\n    const topDiseases = diseases.slice(0, 30); // Preload top 30 diseases\n    // Each disease = 1 attention pair + 1 subgraph = 2 items, plus 1 embedding\n    globalCache.preloadProgress.total = topDiseases.length * 2 + 1;\n    \n    // 4. Preload ALL attention pairs and subgraphs in PARALLEL (larger batches for speed)\n    const batchSize = 10; // Larger batches for faster preload\n    \n    const allPromises: Promise<void>[] = [];\n    \n    for (let i = 0; i < topDiseases.length; i += batchSize) {\n      const batch = topDiseases.slice(i, i + batchSize);\n      const batchPromises = batch.flatMap((disease: any) => {\n        const diseaseNodeId = disease.node_id || disease.id;\n        return [\n          requestAttentionPair(diseaseNodeId, drugId)\n            .then(() => {\n              globalCache.preloadProgress.completed++;\n              notifyPreloadProgress({\n                total: globalCache.preloadProgress.total,\n                completed: globalCache.preloadProgress.completed,\n                drugId,\n              });\n            })\n            .catch(e => {\n              console.warn(`Failed to preload attention for ${diseaseNodeId}:`, e);\n              globalCache.preloadProgress.completed++;\n            }),\n          requestSubgraph(drugId, diseaseNodeId)\n            .then(() => {\n              globalCache.preloadProgress.completed++;\n              notifyPreloadProgress({\n                total: globalCache.preloadProgress.total,\n                completed: globalCache.preloadProgress.completed,\n                drugId,\n              });\n            })\n            .catch(e => {\n              console.warn(`Failed to preload subgraph for ${diseaseNodeId}:`, e);\n              globalCache.preloadProgress.completed++;\n            }),\n        ];\n      });\n      allPromises.push(...batchPromises);\n    }\n    \n    // Wait for embedding\n    await embeddingPromise;\n    globalCache.preloadProgress.completed++;\n    notifyPreloadProgress({\n      total: globalCache.preloadProgress.total,\n      completed: globalCache.preloadProgress.completed,\n      drugId,\n    });\n    \n    // Wait for all other preloads to complete\n    await Promise.all(allPromises);\n    \n    const elapsed = Date.now() - startTime;\n    console.log(`[Preload]  Completed for drug ${drugId} in ${elapsed}ms - ${globalCache.getStats().size} items cached`);\n    \n    globalCache.preloadProgress.inProgress = false;\n    notifyPreloadProgress({\n      total: globalCache.preloadProgress.total,\n      completed: globalCache.preloadProgress.total,\n      drugId,\n    });\n    \n  } catch (error) {\n    console.error('[Preload] Error:', error);\n    globalCache.preloadProgress.inProgress = false;\n  }\n};\n\n// Clear all cached data\nconst clearCache = () => {\n  globalCache.clear();\n  console.log('[Cache] Cleared all cached data');\n};\n\n// Check if data is preloaded for current drug\nconst isDataPreloaded = (drugId?: string) => {\n  if (!drugId) return !globalCache.preloadProgress.inProgress && globalCache.preloadProgress.completed > 0;\n  return !globalCache.preloadProgress.inProgress && globalCache.preloadProgress.currentDrug === drugId;\n};\n\n// Get cache statistics for debugging\nconst getCacheStats = () => globalCache.getStats();\n\n// Subscribe to preload progress updates\nconst onPreloadProgress = (callback: PreloadCallback) => subscribeToPreload(callback);\n\nexport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestAttention,\n  requestNodeNameDict,\n  requestDrugPredictions,\n  requestDiseaseOptions,\n  requestEmbedding,\n  requestAttentionPair,\n  requestDiseasePredictions,\n  requestDrugList,\n  requestSubgraph,\n  preloadDataForDrug,\n  clearCache,\n  isDataPreloaded,\n  getCacheStats,\n  onPreloadProgress,\n  globalCache,\n};\n","const STATIC_URL =\n  process.env.NODE_ENV === 'development'\n    ? `http://localhost:${process.env.REACT_APP_PORT}`\n    : './';\n\nconst SERVER_URL =\n  process.env.NODE_ENV === 'development' ? `http://localhost:8002` : './';\n\nexport { STATIC_URL, SERVER_URL };\n","import {\n  DrugPrediction,\n  IDispatch,\n  IPath,\n  IMetaPath,\n  IMetaPathSummary,\n} from 'types';\nimport {\n  requestAttentionPair,\n  requestDrugPredictions,\n  requestDiseasePredictions,\n  preloadDataForDrug,\n} from 'stores/DataService';\n\nexport const ACTION_TYPES = {\n  Load_Node_Types: 'Load_Node_Types',\n  Load_Edge_Types: 'Load_Edge_Types',\n  Load_Meta_Paths: 'Load_Meta_Paths',\n  Add_Attention_Paths: 'Add_Attention_Paths',\n  Del_Attention_Paths: 'Del_Attention_Paths',\n  Load_Node_Name_Dict: 'Load_Node_Name_Dict',\n  Load_Drug_Options: 'Load_Drug_Options',\n  Load_Disease_Options: 'Load_Disease_Options',\n  Load_Disease_Predictions: 'Load_Disease_Predictions',\n  Load_Drug_List: 'Load_Drug_List',\n\n  Set_Loading_Status: 'Set_Loading_Status',\n\n  Change_Edge_THR: 'Change_Edge_THR',\n  Change_Drug: 'Change_Drug',\n  Change_Disease: 'Change_Disease',\n  Change_App_Mode: 'Change_App_Mode',\n  Change_Selected_Drug_Primary: 'Change_Selected_Drug_Primary',\n  Select_Path_Noes: 'Select_Path_Nodes',\n\n  Toggle_Meta_Path_Hide: 'Toggle_Meta_Path_Hide',\n  Toggle_Disease_Selection: 'Toggle_Disease_Selection',\n};\n\nexport const selectDrug = (\n  selectedDrug: string,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch\n) => {\n  if (selectedDisease) {\n    modifyAttentionPaths(selectedDrug, selectedDisease, isAdd, dispatch);\n    changeDrug(selectedDrug, dispatch);\n  }\n};\n\nexport const selectDisease = (selectedDisease: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDrugLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: undefined },\n  });\n\n  return requestDrugPredictions(selectedDisease)\n    .then((res) => {\n      const predictions = res.predictions;\n      const drugPredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Drug_Options,\n        payload: { drugPredictions },\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDrugLoading: false },\n      });\n    });\n};\n\nexport const selectDrugPrimary = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Set_Loading_Status,\n    payload: { isDiseaseLoading: true },\n  });\n\n  dispatch({\n    type: ACTION_TYPES.Change_Selected_Drug_Primary,\n    payload: { selectedDrugPrimary: selectedDrug },\n  });\n\n  // Clear previous selections\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: undefined },\n  });\n\n  // Fetch disease predictions\n  return requestDiseasePredictions(selectedDrug)\n    .then((res) => {\n      const predictions = res.predictions;\n      const diseasePredictions = predictions.map((d: DrugPrediction) => {\n        return { ...d, selected: false };\n      });\n      dispatch({\n        type: ACTION_TYPES.Load_Disease_Predictions,\n        payload: { diseasePredictions },\n      });\n      \n      // Start preloading attention data in background for faster interactions\n      // This runs asynchronously and doesn't block the UI\n      console.log(`[Preload] Starting background preload for ${selectedDrug}...`);\n      preloadDataForDrug(selectedDrug).then(() => {\n        console.log(`[Preload] Background preload complete for ${selectedDrug}`);\n      });\n    })\n    .then(() => {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isDiseaseLoading: false },\n      });\n    });\n};\n\nexport const changeAppMode = (mode: 'disease-to-drug' | 'drug-to-disease', dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_App_Mode,\n    payload: { appMode: mode },\n  });\n\n  // Load drug list if switching to drug-to-disease and list is empty\n  if (mode === 'drug-to-disease') {\n    fetch(`http://127.0.0.1:8002/api/drugs`)\n      .then((response) => response.json())\n      .then((drugs) => {\n        dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions: drugs },\n        });\n      });\n  }\n};\n\nexport const selectDiseaseSecondary = (\n  selectedDisease: string,  // disease_id for selection toggle\n  selectedDrugPrimary: string,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  diseaseNodeId?: string  // Optional: node_id for attention API (defaults to selectedDisease)\n) => {\n  const nodeIdForAttention = diseaseNodeId || selectedDisease;\n  \n  // Toggle disease selection state (uses disease_id)\n  dispatch({\n    type: ACTION_TYPES.Toggle_Disease_Selection,\n    payload: { diseaseId: selectedDisease },\n  });\n\n  // Update selected disease in state\n  dispatch({\n    type: ACTION_TYPES.Change_Disease,\n    payload: { selectedDisease: nodeIdForAttention },\n  });\n\n  // Ensure primary drug is set as selectedDrug for attention paths\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug: selectedDrugPrimary },\n  });\n\n  // Use node_id for attention API, disease_id as the groupKey\n  modifyAttentionPaths(selectedDrugPrimary, nodeIdForAttention, isAdd, dispatch, selectedDisease);\n};\n\nconst modifyAttentionPaths = (\n  selectedDrug: string | undefined,\n  selectedDisease: string | undefined,\n  isAdd: boolean,\n  dispatch: IDispatch,\n  key?: string // Optional key to use for metaPathGroups (defaults to selectedDrug)\n) => {\n  const groupKey = key || selectedDrug;\n  if (selectedDrug !== undefined && selectedDisease !== undefined && groupKey !== undefined) {\n    if (isAdd) {\n      dispatch({\n        type: ACTION_TYPES.Set_Loading_Status,\n        payload: { isAttentionLoading: true },\n      });\n\n      requestAttentionPair(selectedDisease, selectedDrug)\n        .then((res) => {\n          dispatch({\n            type: ACTION_TYPES.Add_Attention_Paths,\n            payload: {\n              attention: res.attention,\n              selectedDrug: groupKey, // Use groupKey as the identifier for adding/removing\n              metaPathGroups: { [groupKey]: groupMetaPaths(res.metapaths) },\n            },\n          });\n        })\n        .then(() => {\n          dispatch({\n            type: ACTION_TYPES.Set_Loading_Status,\n            payload: { isAttentionLoading: false },\n          });\n        });\n    } else {\n      dispatch({\n        type: ACTION_TYPES.Del_Attention_Paths,\n        payload: {\n          selectedDrug: groupKey,\n        },\n      });\n    }\n  }\n};\n\nconst changeDrug = (selectedDrug: string, dispatch: IDispatch) => {\n  dispatch({\n    type: ACTION_TYPES.Change_Drug,\n    payload: { selectedDrug },\n  });\n};\n\nconst groupMetaPaths = (paths: IPath[]): IMetaPath[] => {\n  let groups: IMetaPath[] = [];\n  let groupDict: string[] = [];\n  paths.forEach((path) => {\n    path.hide = false; // initi, show all metapaths\n    const nodeTypeString = path.nodes.map((d) => d.nodeType).join('_');\n    const groupIdx = groupDict.indexOf(nodeTypeString);\n    if (groupIdx > -1) {\n      groups[groupIdx].paths.push(path);\n    } else {\n      groupDict.push(nodeTypeString);\n      groups.push({\n        nodeTypes: path.nodes.map((d) => d.nodeType),\n        paths: [path],\n      });\n    }\n  });\n  return groups;\n};\n\nexport const toggleMetaPathHide = (\n  metaPathSummary: IMetaPathSummary[],\n  idx: number,\n  hide: boolean,\n  dispatch: IDispatch\n) => {\n  metaPathSummary[idx]['hide'] = hide;\n  dispatch({\n    type: ACTION_TYPES.Toggle_Meta_Path_Hide,\n    payload: { metaPathSummary },\n  });\n};\n","import { IState, IAction, IMetaPathSummary, IMetaPath } from 'types';\nimport { ACTION_TYPES } from 'stores/actions';\n\nconst rootReducer = (state: IState, action: IAction): IState => {\n  switch (action.type) {\n    case ACTION_TYPES.Load_Drug_Options:\n      return {\n        ...state,\n        drugPredictions: action.payload.drugPredictions,\n      };\n\n    case ACTION_TYPES.Load_Disease_Options:\n      return { ...state, diseaseOptions: action.payload.diseaseOptions };\n\n    case ACTION_TYPES.Load_Node_Types:\n      return { ...state, nodeTypes: action.payload.nodeTypes };\n\n    case ACTION_TYPES.Load_Edge_Types:\n      return { ...state, edgeTypes: action.payload.edgeTypes };\n\n    case ACTION_TYPES.Change_Disease:\n      return {\n        ...state,\n        selectedDisease: action.payload.selectedDisease,\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Change_Drug:\n      return {\n        ...state,\n        drugPredictions: toggleDrugSelection(\n          state.drugPredictions,\n          action.payload.selectedDrug\n        ),\n      };\n\n    case ACTION_TYPES.Load_Node_Name_Dict:\n      return { ...state, nodeNameDict: action.payload.nodeNameDict };\n\n    case ACTION_TYPES.Set_Loading_Status:\n      return { ...state, ...action.payload };\n\n    case ACTION_TYPES.Select_Path_Noes:\n      return { ...state, selectedPathNodes: action.payload.selectedPathNodes };\n\n    case ACTION_TYPES.Change_Edge_THR: {\n      return { ...state, edgeThreshold: action.payload.edgeThreshold };\n    }\n\n    case ACTION_TYPES.Toggle_Meta_Path_Hide: {\n      return { ...state, metaPathSummary: action.payload.metaPathSummary };\n    }\n\n    case ACTION_TYPES.Add_Attention_Paths: {\n      return {\n        ...state,\n        attention: { ...state.attention, ...action.payload.attention },\n        metaPathGroups: {\n          ...state.metaPathGroups,\n          ...action.payload.metaPathGroups,\n        },\n        metaPathSummary: updateMetaPathSummary(\n          state.metaPathSummary,\n          action.payload.metaPathGroups[action.payload.selectedDrug],\n          action.payload.selectedDrug,\n          true // whether add new drug\n        ),\n      };\n    }\n\n    case ACTION_TYPES.Del_Attention_Paths: {\n      // deep copy\n      let attention = JSON.parse(JSON.stringify(state.attention)),\n        metaPathGroups = JSON.parse(JSON.stringify(state.metaPathGroups));\n\n      const keyToDelete = action.payload.selectedDrug;\n      \n      // Save the paths before deleting (needed for updateMetaPathSummary)\n      const pathsToDelete = metaPathGroups[keyToDelete];\n      \n      // In drug-to-disease mode, the key is a disease ID\n      // Delete both possible attention keys (disease:X and drug:X)\n      delete attention[`disease:${keyToDelete}`];\n      delete attention[`drug:${keyToDelete}`];\n      delete metaPathGroups[keyToDelete];\n      \n      // Update metapath summary with the saved paths\n      const updatedSummary = updateMetaPathSummary(\n        state.metaPathSummary,\n        pathsToDelete,  // Use saved paths, not undefined\n        keyToDelete,\n        false // whether add new drug\n      );\n      \n      return {\n        ...state,\n        attention,\n        metaPathGroups,\n        metaPathSummary: updatedSummary,\n      };\n    }\n\n    case ACTION_TYPES.Change_App_Mode:\n      return { ...state, appMode: action.payload.appMode };\n\n    case ACTION_TYPES.Change_Selected_Drug_Primary:\n      return {\n        ...state,\n        selectedDrugPrimary: action.payload.selectedDrugPrimary,\n        diseasePredictions: [], // Clear previous predictions\n        attention: {},\n        metaPathGroups: {},\n        metaPathSummary: [],\n      };\n\n    case ACTION_TYPES.Load_Disease_Predictions:\n      return { ...state, diseasePredictions: action.payload.diseasePredictions };\n\n    case ACTION_TYPES.Toggle_Disease_Selection: {\n      const diseaseId = action.payload.diseaseId;\n      const updatedDiseasePredictions = state.diseasePredictions.map((d) => {\n        // Match by d.id (the disease_id used in the Select component)\n        if (d.id === diseaseId) {\n          return { ...d, selected: !d.selected };\n        }\n        return d;\n      });\n      return { ...state, diseasePredictions: updatedDiseasePredictions };\n    }\n\n    case ACTION_TYPES.Load_Drug_List:\n      return { ...state, drugOptions: action.payload.drugOptions };\n\n    default:\n      return state;\n  }\n};\n\nconst toggleDrugSelection = (\n  drugPredictions: IState['drugPredictions'],\n  selectedDrug: string\n) => {\n  return drugPredictions.map((d) => {\n    return {\n      ...d,\n      selected: selectedDrug === d.id ? !d.selected : d.selected,\n    };\n  });\n};\n\nconst updateMetaPathSummary = (\n  oldSummary: IMetaPathSummary[],\n  currentMetaPaths: IMetaPath[] | undefined,\n  entityId: string | number,  // Can be drug ID or disease ID (string or number)\n  isAdd: boolean\n) => {\n  let newSummary = oldSummary.map((d) => ({ ...d, count: { ...d.count } })); // Deep copy counts too\n  const keyId = String(entityId);  // Normalize to string for consistent key lookup\n\n  // if add new entity\n  if (isAdd && currentMetaPaths) {\n    currentMetaPaths.forEach((metaPath) => {\n      let count = metaPath.paths.length;\n      let sharedMeta = newSummary.find(\n        (d) => d.nodeTypes.join() === metaPath.nodeTypes.join()\n      );\n      if (sharedMeta) {\n        // if shared meta path exists\n        sharedMeta.count[keyId] = count;\n        sharedMeta.sum += count;\n      } else {\n        // if shared meta path does not exist\n        newSummary.push({\n          nodeTypes: metaPath.nodeTypes,\n          count: { [keyId]: count },\n          sum: count,\n          hide: false,\n          idx: newSummary.length,\n        });\n      }\n    });\n  } else if (!isAdd) {\n    // if delete existing entity\n    newSummary.forEach((metaPath) => {\n      if (keyId in metaPath.count) {\n        metaPath.sum -= metaPath.count[keyId];\n        delete metaPath.count[keyId];\n      }\n    });\n\n    newSummary = newSummary.filter((d) => d.sum > 0);\n  }\n\n  return newSummary;\n};\n\nexport const isAddDrug = (\n  drugPredictions: IState['drugPredictions'],\n  drugID: string\n) => {\n  return !drugPredictions\n    .filter((d) => d.selected)\n    .map((d) => d.id)\n    .includes(drugID);\n};\n\nexport const isAddDisease = (\n  diseasePredictions: IState['diseasePredictions'],\n  diseaseID: string\n) => {\n  return !diseasePredictions\n    .filter((d) => d.selected)\n    .map((d) => d.node_id || d.id)\n    .includes(diseaseID);\n};\n\nexport default rootReducer;\n","import React, { createContext } from 'react';\nimport rootReducer from './reducer';\nimport { IState } from 'types';\n\nconst initialState: IState = {\n  diseaseOptions: [],\n  drugPredictions: [],\n  nodeTypes: [],\n  edgeTypes: {},\n  metaPathGroups: {},\n  attention: {},\n  selectedDisease: undefined,\n  nodeNameDict: {},\n  isInitializing: true,\n  isDrugLoading: false,\n  isAttentionLoading: false,\n  isDiseaseLoading: false,\n  edgeThreshold: 0,\n  metaPathSummary: [],\n  selectedPathNodes: [],\n  drugOptions: [],\n  diseasePredictions: [],\n  selectedDrugPrimary: undefined,\n  appMode: 'disease-to-drug',\n};\n\ninterface IStateContext {\n  state: IState;\n  dispatch: ({ type }: { type: string }) => void;\n}\n\nconst GlobalStore = createContext({} as IStateContext);\n\n// An wrapping function to handle thunks (dispatched actions which are wrapped in a function, needed for async callbacks)\nconst asyncer = (dispatch: any, state: IState) => (action: any) =>\n  typeof action === 'function' ? action(dispatch, state) : dispatch(action);\n\n// The StateProvider component to provide the global state to all child components\nexport function StateProvider(props: any) {\n  const [state, dispatchBase] = React.useReducer(rootReducer, initialState);\n\n  const dispatch = React.useCallback(asyncer(dispatchBase, state), []);\n\n  return (\n    <GlobalStore.Provider value={{ state, dispatch }}>\n      {props.children}\n    </GlobalStore.Provider>\n  );\n}\n\nexport function StateConsumer(Component: any) {\n  return function WrapperComponent(props: any) {\n    return (\n      <GlobalStore.Consumer>\n        {(context) => (\n          <Component\n            {...props}\n            globalState={context.state}\n            dispatch={context.dispatch}\n          />\n        )}\n      </GlobalStore.Consumer>\n    );\n  };\n}\n","const cropText = (\n  text: string,\n  fontSize: number,\n  maxWidth: number,\n  fontWeight: number = 800\n): string => {\n  let returnText = text;\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontWeight} ${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  if (width > maxWidth) {\n    for (let i = 1; i < text.length; i += 1) {\n      const prevText = text.substr(0, i - 1).concat('...');\n      const currText = text.substr(0, i).concat('...');\n      const prevWidth = context.measureText(prevText).width;\n      const currWidth = context.measureText(currText).width;\n      if (currWidth > maxWidth && prevWidth < maxWidth) {\n        returnText = prevText;\n        break;\n      }\n    }\n  }\n  return returnText;\n};\n\nconst getTextWidth = (text: string, fontSize: number): number => {\n  const context = document\n    .createElement('canvas')\n    .getContext('2d') as CanvasRenderingContext2D;\n  context.font = `${fontSize}px Arial`;\n  const width = context.measureText(text).width;\n  return width;\n};\n\nexport { cropText, getTextWidth };\n","import React from 'react';\n\nconst VIRUS_ICON =\n  'M 483.55 227.55 H 462 c -50.68 0 -76.07 -61.27 -40.23 -97.11 L 437 115.19 A 28.44 28.44 0 0 0 396.8 75 L 381.56 90.22 c -35.84 35.83 -97.11 10.45 -97.11 -40.23 V 28.44 a 28.45 28.45 0 0 0 -56.9 0 V 50 c 0 50.68 -61.27 76.06 -97.11 40.23 L 115.2 75 A 28.44 28.44 0 0 0 75 115.19 l 15.25 15.25 c 35.84 35.84 10.45 97.11 -40.23 97.11 H 28.45 a 28.45 28.45 0 1 0 0 56.89 H 50 c 50.68 0 76.07 61.28 40.23 97.12 L 75 396.8 A 28.45 28.45 0 0 0 115.2 437 l 15.24 -15.25 c 35.84 -35.84 97.11 -10.45 97.11 40.23 v 21.54 a 28.45 28.45 0 0 0 56.9 0 V 462 c 0 -50.68 61.27 -76.07 97.11 -40.23 L 396.8 437 A 28.45 28.45 0 0 0 437 396.8 l -15.25 -15.24 c -35.84 -35.84 -10.45 -97.12 40.23 -97.12 h 21.54 a 28.45 28.45 0 1 0 0 -56.89 Z M 224 272 a 48 48 0 1 1 48 -48 A 48 48 0 0 1 224 272 Z m 80 56 a 24 24 0 1 1 24 -24 A 24 24 0 0 1 304 328 Z';\n\nconst YES_ICON =\n    'M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z',\n  NO_ICON =\n    'M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z';\n\nconst DRUG_ICON =\n  'M 555.3 300.1 L 424.2 112.8 C 401.9 81 366.4 64 330.4 64 c -22.6 0 -45.5 6.7 -65.5 20.7 c -19.7 13.8 -33.7 32.8 -41.5 53.8 C 220.5 79.2 172 32 112 32 C 50.1 32 0 82.1 0 144 v 224 c 0 61.9 50.1 112 112 112 s 112 -50.1 112 -112 V 218.9 c 3.3 8.6 7.3 17.1 12.8 25 L 368 431.2 c 22.2 31.8 57.7 48.8 93.8 48.8 c 22.7 0 45.5 -6.7 65.5 -20.7 c 51.7 -36.2 64.2 -107.5 28 -159.2 Z M 160 256 H 64 V 144 c 0 -26.5 21.5 -48 48 -48 s 48 21.5 48 48 v 112 Z m 194.8 44.9 l -65.6 -93.7 c -7.7 -11 -10.7 -24.4 -8.3 -37.6 c 2.3 -13.2 9.7 -24.8 20.7 -32.5 c 8.5 -6 18.5 -9.1 28.8 -9.1 c 16.5 0 31.9 8 41.3 21.5 l 65.6 93.7 l -82.5 57.7 Z';\n\nconst EDIT_ICON =\n  'M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z';\n\nconst SEARCH_ICON =\n  'M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z';\n\nconst LOADING_ICON = (\n  <g>\n    <text textAnchor=\"middle\" x=\"24\">\n      LOADING...\n    </text>\n    <rect x=\"0\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"20\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.2s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n    <rect x=\"40\" y=\"50\" width=\"14\" height=\"30\" fill=\"#1890ff\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"translate\"\n        values=\"0 0; 0 20; 0 0\"\n        begin=\"0.4s\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\"\n      />\n    </rect>\n  </g>\n);\n\nexport {\n  VIRUS_ICON,\n  YES_ICON,\n  NO_ICON,\n  DRUG_ICON,\n  EDIT_ICON,\n  LOADING_ICON,\n  SEARCH_ICON,\n};\n","const COLORS = [\n  '#4e79a7', // \"anatomy\",\n  '#edc949', // \"biological_process\",\n  '#e15759', // \"cellular_component\",\n  '#f28e2c', // \"disease\",\n  '#76b7b2', // \"drug\",\n  '#59a14f', // \"effect/phenotype\",\n  '#af7aa1', // \"exposure\",\n  '#ff9da7', // \"gene/protein\",\n  '#9c755f', // \"molecular_function\",\n  '#bab0ab', // \"pathway\"\n];\nlet colorDict: { [node: string]: string } = {};\n\nconst setNodeColor = (nodeTypes: string[]) => {\n  colorDict = {};\n  nodeTypes.forEach((nodeType, idx) => {\n    if (idx > COLORS.length - 1) {\n      idx = idx % (COLORS.length - 1);\n    }\n    colorDict[nodeType] = COLORS[idx];\n  });\n};\n\nconst getNodeColor = (nodeType: string) => {\n  if (colorDict[nodeType] === undefined) {\n    colorDict[nodeType] = COLORS[Object.keys(colorDict).length];\n  }\n\n  return colorDict[nodeType];\n};\n\nconst HIGHLIGHT_COLOR = '#1890ff';\nconst SELECTED_COLOR = 'black';\n\nexport { setNodeColor, getNodeColor, HIGHLIGHT_COLOR, SELECTED_COLOR };\n","import { IAttentionTree } from 'types';\nexport { cropText, getTextWidth } from './text';\nexport * from './icon';\n\nexport {\n  setNodeColor,\n  getNodeColor,\n  HIGHLIGHT_COLOR,\n  SELECTED_COLOR,\n} from './color';\n\nexport const pruneEdge = (\n  node: IAttentionTree,\n  threshold: number\n): IAttentionTree => {\n  if (node.children.length > 0) {\n    node = {\n      ...node,\n      children: node.children\n        .filter((d) => d.score >= threshold)\n        .map((node) => pruneEdge(node, threshold)),\n    };\n  }\n  return node;\n};\n\nexport const flatTree = (node: IAttentionTree): string[] => {\n  let res = [node.nodeId];\n  if (node.children.length > 0) {\n    res = res.concat(...node.children.map((d) => flatTree(d)));\n  }\n  return res;\n};\n\nexport const sigmoid = (t: number) => {\n  return 1 / (1 + Math.pow(Math.E, -t));\n};\n\nexport const removeDiseaseList = [\n  'mendelian disease',\n  'disease of cell nucleous',\n  'hip region disease',\n  'acute disease',\n  'vector borne disease',\n  'cancer',\n  'sex-linked disease',\n  'movement disorder',\n];\n\nexport const wheterRemoveDisease = (disease: string): boolean => {\n  if (!disease) return false;\n  return removeDiseaseList.includes(disease.toLowerCase());\n};\n\nexport const sentenceCapitalizer = (str: string) => {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n};\n\n// For drug-to-disease mode: use Inebilizumab (DB12530) as the primary drug\nexport const INIT_DRUG_PRIMARY = 'DB12530';  // Inebilizumab\n// Top disease predictions for this drug\nexport const INIT_DISEASES = ['15783', '7381', '15896'];  // Top predicted diseases\n\n// For backwards compatibility (disease-to-drug mode)\nexport const INIT_DISEASE = '15783';  // congenital anomaly of hepatic vein - first disease in our predictions\nexport const INIT_DRUGS = ['DB12530'];  // Inebilizumab\n\n// Default mode - start with drug-to-disease\nexport const DEFAULT_APP_MODE = 'drug-to-disease' as const;\n\n","import React from 'react';\nimport { IState, IAttentionTree } from 'types';\nimport * as d3 from 'd3';\nimport { Tooltip } from 'antd';\nimport { getNodeColor, pruneEdge } from 'helpers';\nimport {\n  cropText,\n  VIRUS_ICON,\n  DRUG_ICON,\n  getTextWidth,\n  LOADING_ICON,\n} from 'helpers';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n}\n\nexport default class AttentionTree extends React.Component<Props, {}> {\n  nodeHeight = 20;\n  fontSize = 14;\n  labelLength = 150;\n  midGap = 60; // the gaph between two trees\n  drawNodeAttentionHorizontal(\n    nodeAttention: IAttentionTree,\n    stepGap: number,\n    edgeThreshold: number\n  ) {\n    const { width } = this.props;\n    const {\n      nodeNameDict,\n      edgeTypes,\n      selectedPathNodes,\n    } = this.props.globalState;\n\n    let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n\n    const rootNode = d3.hierarchy(nodeAttentionFiltered);\n    const d3Tree = d3\n      .tree<IAttentionTree>()\n      .nodeSize([this.nodeHeight + 2, stepGap]);\n\n    const root = d3Tree(rootNode);\n\n    const linkGene = d3\n      .linkHorizontal<any, d3.HierarchyPointLink<IAttentionTree>, any>()\n      // modify the source and target x, y to make space for node\n      .source((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.source.y -\n            this.labelLength / 2\n            : d.source.y + this.labelLength / 2;\n        const newY = d.source.x;\n\n        return { x: newX, y: newY };\n      })\n      .target((d) => {\n        const newX =\n          root.data.nodeType === 'drug'\n            ? width / 2 -\n            this.midGap / 2 -\n            this.labelLength -\n            d.target.y +\n            this.labelLength / 2\n            : d.target.y - this.labelLength / 2;\n        const newY = d.target.x;\n\n        return { x: newX, y: newY };\n      })\n      .x((d) => d.x)\n      .y((d) => d.y);\n\n    const maxScore = Math.max(\n      ...root.links().map((link) => link.target.data.score)\n    );\n\n    let widthScale = d3.scaleLinear().domain([0, maxScore]).range([1, 5]);\n\n    const links = root.links().map((link, i) => {\n      let edgeInfo = link.target.data.edgeInfo.replace('rev_', '');\n      if (edgeTypes[edgeInfo]) {\n        edgeInfo = edgeTypes[edgeInfo]['edgeInfo'] || edgeInfo;\n      }\n      return (\n        <Tooltip\n          title={edgeInfo}\n          key={`${link.source.data.nodeId}=>${link.target.data.nodeId}_link${i}`}\n          destroyTooltipOnHide\n        >\n          <g>\n            <path\n              d={linkGene(link)!}\n              className={`link ${link.source.data.nodeId}=>${link.target.data.nodeId}`}\n              fill=\"none\"\n              stroke=\"gray\"\n              strokeWidth={widthScale(link.target.data.score)}\n              opacity={selectedPathNodes.length > 0 ? 0.5 : 1}\n            />\n            <path\n              d={linkGene(link)!}\n              className=\"mask\"\n              fill=\"none\"\n              stroke=\"transparent\"\n              strokeWidth=\"3\"\n            />\n          </g>\n        </Tooltip>\n      );\n    });\n\n    const allY = root.descendants().map((node) => node.x);\n    const minY = Math.min(...allY);\n    const maxY = Math.max(...allY);\n\n    const height = maxY - minY + this.nodeHeight + 4; // default seperation in d3 tree is 2\n\n    const nodes = root.descendants().map((node, i) => {\n      let { nodeId, nodeType } = node.data;\n      let nodeFullName = nodeNameDict[nodeType][nodeId];\n      if (nodeFullName === undefined) {\n        nodeId = nodeId.replace(/_/g, '') + '.0'; // the id of a merged node is xxx_xxx_xxxx\n        nodeFullName = nodeNameDict[nodeType][nodeId];\n      }\n      let nodeShortName = cropText(\n        nodeFullName,\n        12,\n        this.labelLength - 25 - getTextWidth('..(0.00)', 14)\n      );\n      let tooltipTitle = nodeShortName?.includes('..') ? nodeFullName : '';\n      if (node.data.source) {\n        tooltipTitle = tooltipTitle ? `${tooltipTitle} (${node.data.source})` : `${nodeFullName} (${node.data.source})`;\n      }\n      let icon_path = '';\n      if (nodeType === 'disease') icon_path = VIRUS_ICON;\n      if (nodeType === 'drug') icon_path = DRUG_ICON;\n\n      const isHighlighted =\n        selectedPathNodes.length === 0 ||\n        (selectedPathNodes.map((d) => d.nodeType).includes(nodeType) &&\n          selectedPathNodes.map((d) => d.nodeId).includes(nodeId));\n\n      return (\n        <Tooltip\n          title={tooltipTitle}\n          key={`node${i}_${nodeFullName}`}\n          destroyTooltipOnHide\n          mouseEnterDelay={0.3}\n        >\n          <g\n            className={`${nodeId} node`}\n            transform={`translate(${root.data.nodeType === 'drug'\n              ? width / 2 - this.midGap / 2 - this.labelLength - node.y\n              : node.y\n              }, ${node.x})`}\n            cursor=\"pointer\"\n          >\n            <rect\n              width={this.labelLength}\n              height={this.nodeHeight}\n              fill={getNodeColor(nodeType)}\n              x={(-1 * this.labelLength) / 2}\n              y={-this.nodeHeight / 2}\n              opacity={isHighlighted ? 1 : 0.2}\n            />\n            <path\n              className=\"virus_icon\"\n              d={icon_path}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 2}, ${-this.nodeHeight / 2\n                }) scale(0.04)`}\n              fill=\"white\"\n            />\n            <text\n              fill=\"white\"\n              fontSize={this.fontSize}\n              transform={`translate(${(-1 * this.labelLength) / 2 + 25}, ${(this.nodeHeight - this.fontSize) / 2\n                })`}\n            >\n              {/* {`${nodeShortName}\n                  ${node.depth > 0 ? ':' + node.data.score.toFixed(2) : ''}`} */}\n              {nodeShortName}\n            </text>\n            {node.depth === 0 && node.children === undefined && (\n              <text\n                fill=\"gray\"\n                fontSize={this.fontSize}\n                transform={`translate(${root.data.nodeType === 'drug'\n                  ? -this.labelLength / 2 - 10 - getTextWidth('No Attention Data', this.fontSize)\n                  : this.labelLength / 2 + 10\n                  }, ${(this.nodeHeight - this.fontSize) / 2})`}\n              >\n                No Attention Data\n              </text>\n            )}\n          </g>\n        </Tooltip>\n      );\n    });\n\n    return {\n      content: [\n        <g key=\"links\" className=\"links\">\n          {links}\n        </g>,\n        <g key=\"nodes\" className=\"nodes\">\n          {nodes}\n        </g>,\n      ],\n      height: height,\n    };\n  }\n  drawSubgraph() {\n    let { attention, edgeThreshold } = this.props.globalState;\n    let { width } = this.props;\n\n    let stepGap = (width - 2 * this.labelLength - this.midGap) / 4;\n    let heights = [0];\n    const content = Object.keys(attention).map((nodeKey: string, idx) => {\n      const { height, content } = this.drawNodeAttentionHorizontal(\n        attention[nodeKey],\n        stepGap,\n        edgeThreshold\n      );\n      heights.push(height);\n      return (\n        <g\n          className={nodeKey}\n          key={nodeKey}\n          transform={`translate(${((width + this.midGap) / 2) * idx + this.labelLength / 2\n            }, ${height / 2 + 2 * this.nodeHeight})`}\n        >\n          {content}\n        </g>\n      );\n    });\n    return { content, height: Math.max(...heights) };\n  }\n  render() {\n    const { width, height, globalState } = this.props;\n    const {\n      isAttentionLoading,\n      selectedDisease,\n      drugPredictions,\n      diseasePredictions,\n      appMode,\n    } = globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedItems = predictions.filter((d) => d.selected);\n\n    const { content, height: graphHeight } = this.drawSubgraph();\n    return (\n      <svg\n        width={width}\n        height={Math.max(graphHeight, height)}\n        className=\"nodeLink\"\n      >\n        {selectedItems.length > 0 && (appMode === 'drug-to-disease' ? true : selectedDisease) ? (\n          content\n        ) : (\n          <text x={width / 2} y={height / 2} fill=\"gray\">\n            Please select a disease and a drug first\n          </text>\n        )}\n        {isAttentionLoading ? (\n          <g>\n            <rect width={width} height={height} fill=\"white\" opacity={0.5} />\n            <g\n              transform={`translate(${width / 2}, ${height / 2})`}\n              textAnchor=\"middle\"\n            >\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <g />\n        )}\n      </svg>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as d3 from 'd3';\nimport { IAttentionTree, IState } from 'types';\nimport { flatTree, getNodeColor, pruneEdge, LOADING_ICON } from 'helpers';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n}\n\ninterface State { }\n\ninterface INode extends d3.SimulationNodeDatum {\n  id: string; // `${node_type}:${node_id}`\n  nodeId: string; //\n  nodeType: string; //\n  fx?: number;\n  fy?: number;\n}\n\ninterface ILink {\n  source: string;\n  target: string;\n  score: number;\n  edgeInfo: string;\n}\n\nexport default class ModelNodeForce extends React.Component<Props, State> {\n  public padding = 10;\n  RADIUS = 7;  // Smaller node radius for more compact view\n  prevNodes: INode[] = [];\n  prevLinks: ILink[] = [];\n  simulation: d3.Simulation<INode, ILink>;\n\n  constructor(props: Props) {\n    super(props);\n    \n    // Initialize simulation with animation\n    this.simulation = d3\n      .forceSimulation<INode, ILink>()\n      .force('charge', d3.forceManyBody<INode>().strength(-60))\n      .force(\n        'link',\n        d3\n          .forceLink<INode, ILink>()\n          .id((d) => d.id)\n          .distance(35)\n          .strength(0.6)\n      )\n      .force('collision', d3.forceCollide().radius(this.RADIUS + 2))\n      .force('center', d3.forceCenter(props.width / 2, props.height / 2))\n      .alphaDecay(0.02)  // Slower decay for smoother animation\n      .velocityDecay(0.3);  // Add some friction\n  }\n\n  ticked(\n    svgNodes: d3.Selection<\n      SVGGElement | d3.BaseType,\n      INode,\n      d3.BaseType,\n      unknown\n    >,\n    svgLinks: any\n  ) {\n    svgNodes.attr('transform', (d) => `translate(${d.x}, ${d.y})`);\n\n    svgLinks\n      .select('line.link')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('line.mask')\n      .attr('x1', (d: any) => d.source.x)\n      .attr('y1', (d: any) => d.source.y)\n      .attr('x2', (d: any) => d.target.x)\n      .attr('y2', (d: any) => d.target.y);\n\n    svgLinks\n      .select('text')\n      .attr('text-anchor', 'middle')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      );\n  }\n\n  dragstarted(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0.3).restart();\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  dragged(d: INode) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  dragended(d: INode) {\n    if (!d3.event.active) this.simulation.alpha(0);\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  isTargetNode(d: INode) {\n    const { drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    if (appMode === 'drug-to-disease') {\n      // In this mode, selectedIds are diseases (targets), and selectedDrugPrimary is source.\n      return selectedIds.includes(d.nodeId) || selectedDrugPrimary === d.nodeId;\n    }\n    return selectedIds.includes(d.nodeId) || selectedDisease === d.nodeId;\n  }\n\n  isHighlighted(d: INode) {\n    const { selectedPathNodes } = this.props.globalState;\n    return (\n      selectedPathNodes.map((i) => i.nodeType).includes(d.nodeType) &&\n      selectedPathNodes.map((i) => i.nodeId).includes(d.nodeId)\n    );\n  }\n\n  getNodeLinks() {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      attention,\n      // edgeThreshold,\n      selectedDisease,\n      selectedDrugPrimary,\n      edgeTypes,\n      appMode,\n    } = this.props.globalState;\n    const { width, height } = this.props;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const selectedIds = predictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    let nodes: INode[] = [],\n      links: ILink[] = [];\n\n    Object.values(attention).forEach((nodeAttention: IAttentionTree) => {\n      // let nodeAttentionFiltered = pruneEdge(nodeAttention, edgeThreshold);\n      const rootNode = d3.hierarchy(nodeAttention);\n      let desNodes: INode[] = [];\n      rootNode.descendants().forEach((d) => {\n        const node = {\n          id: `${d.data.nodeType}:${d.data.nodeId}`,\n          nodeId: d.data.nodeId,\n          nodeType: d.data.nodeType,\n        };\n        const prevNode = this.prevNodes.find((d) => d.id === node.id);\n        desNodes.push({ ...node, ...prevNode });\n      });\n      nodes = nodes.concat(desNodes);\n      const desLinks = rootNode.links().map((d) => {\n        const sourceData = d.source.data,\n          targetData = d.target.data;\n        let edgeInfo = targetData.edgeInfo.replace('rev_', '');\n        edgeInfo = edgeTypes[edgeInfo]?.edgeInfo || edgeInfo;\n        return {\n          source: `${sourceData.nodeType}:${sourceData.nodeId}`,\n          target: `${targetData.nodeType}:${targetData.nodeId}`,\n          score: targetData.score,\n          edgeInfo,\n        };\n      });\n      links = links.concat(desLinks);\n    });\n\n    // // show the virus host proteins\n    // let nodes:INode[] =  viralTargets.map(d => { return { id: d.toString() } }),\n    //     links:ILink[] = targetLinks.map(edge => { return { source: edge[0].toString(), target: edge[1].toString() } })\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n      const selectedIdx = selectedIds.indexOf(node.nodeId);\n\n      if (appMode === 'drug-to-disease') {\n        if (node.nodeId === selectedDrugPrimary) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      } else {\n        if (node.nodeId === selectedDisease) {\n          node.fy = height / 2;\n          node.fx = width * 0.2;\n        } else if (selectedIdx > -1) {\n          node.fy = (height / (selectedIds.length + 1)) * (selectedIdx + 1);\n          node.fx = width * 0.8;\n        }\n      }\n    }\n\n    this.prevNodes = nodes;\n    this.prevLinks = links;\n\n    return { nodes, links };\n  }\n\n  drawGraph() {\n    const { nodeNameDict } = this.props.globalState;\n    const { nodes, links } = this.getNodeLinks();\n    const { width, height } = this.props;\n\n    const widthScale = d3\n      .scaleLinear()\n      .range([2, 6])  // Increased line widths for better visibility\n      .domain(d3.extent(links.map((d) => d.score)) as [number, number]);\n\n    let svgLinks: any = d3\n      .select('svg.graph')\n      .select('g.links')\n      .selectAll('g.link')\n      .data(links)\n      .join((enter) => enter.append('g').attr('class', 'link'))\n      .on('mouseover', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel');\n      })\n      .on('mouseout', function () {\n        d3.select(this)\n          .select('text.edgeLabel')\n          .transition()\n          .delay(500)\n          .attr('class', 'edgeLabel hidden');\n      });\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'link')\n      .attr('stroke', '#aaa')\n      .attr('stroke-width', (d: any) => widthScale(d.score))\n      .attr('id', (d: any) => d.id);\n\n    svgLinks\n      .append('line')\n      .attr('x1', (d: any) => d.target.x)\n      .attr('y1', (d: any) => d.target.y)\n      .attr('x2', (d: any) => d.source.x)\n      .attr('y2', (d: any) => d.source.y)\n      .attr('class', 'mask')\n      .attr('stroke-width', 4)\n      .attr('stroke', 'transparent');\n\n    svgLinks\n      .append('text')\n      .attr('class', 'edgeLabel hidden')\n      .attr(\n        'transform',\n        (d: any) =>\n          `translate(${(d.target.x + d.source.x) / 2}, ${(d.source.y + d.target.y) / 2\n          })`\n      )\n      .text((d: any) => d.edgeInfo);\n\n    let svgNodes = d3\n      .select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .data(nodes, (d: any) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'nodeGroup')\n            .attr('transform', (d) => {\n              return `translate(${d.x || width / 2}, ${d.y || height / 2})`;\n            }) // ensure d.x is not undefined when first entering\n            .attr('cursor', 'pointer')\n            .call(\n              d3\n                .drag<SVGGElement, INode>()\n                .on('start', this.dragstarted.bind(this))\n                .on('drag', this.dragged.bind(this))\n                .on('end', this.dragended.bind(this))\n            ),\n\n        (update) =>\n          update.attr('transform', (d) => `translate(${d.x}, ${d.y})`),\n\n        (exit) => exit.remove()\n      );\n\n    svgNodes\n      .append('circle')\n      // .filter(d=>!drugTargets.includes(d.id))\n      .attr('r', this.RADIUS)\n      // .attr(\"r\", 5)\n      .attr('class', 'node')\n      .attr('id', (d) => d.id)\n      .attr('fill', (d: INode) => getNodeColor(d.nodeType))\n      .attr('stroke', 'white');\n\n    // add label to all nodes\n    svgNodes\n      .append('text')\n      .attr('class', 'nodeLabel')\n      .attr('transform', `translate(${-1 * this.RADIUS}, ${-2.5 * this.RADIUS} )`)\n      .attr('font-size', '13px')  // Slightly larger font\n      .text((d) => nodeNameDict[d.nodeType][d.nodeId])\n      .classed('hidden', true);\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n\n    // toggle node visibility through click\n    svgNodes.on('click', function (d) {\n      const textlabel = d3.select(this).select('text.nodeLabel');\n      const isHidden = textlabel.classed('hidden');\n      textlabel.classed('hidden', !isHidden);\n    });\n\n    this.simulation.nodes(nodes);\n    this.simulation.force<d3.ForceLink<INode, ILink>>('link')!.links(links);\n    this.simulation.on('tick', () => this.ticked(svgNodes, svgLinks));\n\n    this.updateVisibility();\n  }\n\n  updateNodeLabel() {\n    let svgNodes: d3.Selection<\n      SVGGElement,\n      INode,\n      d3.BaseType,\n      any\n    > = d3.select('svg.graph').select('g.nodes').selectAll('g.nodeGroup');\n\n    svgNodes\n      .filter((d) => this.isTargetNode(d) || this.isHighlighted(d))\n      .select('text.nodeLabel')\n      .classed('hidden', false);\n  }\n\n  updateVisibility() {\n    // update visibility of nodes and edges based on threshold\n    const { attention, edgeThreshold } = this.props.globalState;\n\n    d3.select('svg.graph')\n      .selectAll('g.link')\n      .style('opacity', (d: any) => (d.score > edgeThreshold ? 1 : 0));\n\n    var visibleNodes: string[] = [];\n    Object.values(attention).forEach((d) => {\n      visibleNodes = visibleNodes.concat(flatTree(pruneEdge(d, edgeThreshold)));\n    });\n\n    d3.select('svg.graph')\n      .select('g.nodes')\n      .selectAll('g.nodeGroup')\n      .select('circle')\n      .style('opacity', (d: any) => {\n        return visibleNodes.includes(d.nodeId) ? 1 : 0;\n      });\n  }\n\n  componentDidMount() {\n    this.drawGraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const {\n      metaPathGroups: prevGroups,\n      selectedPathNodes: prevNodes,\n      edgeThreshold: prevThreshold,\n      attention: prevAttention,\n    } = prevProps.globalState;\n    const {\n      metaPathGroups: currGroups,\n      selectedPathNodes: currNodes,\n      edgeThreshold: currThreshold,\n      attention: currAttention,\n    } = this.props.globalState;\n    \n    // Redraw and restart animation when data changes\n    const prevGroupKeys = Object.keys(prevGroups).sort().join(',');\n    const currGroupKeys = Object.keys(currGroups).sort().join(',');\n    const prevAttentionKeys = Object.keys(prevAttention).sort().join(',');\n    const currAttentionKeys = Object.keys(currAttention).sort().join(',');\n    \n    if (prevGroupKeys !== currGroupKeys || prevAttentionKeys !== currAttentionKeys) {\n      this.drawGraph();\n      // Restart simulation with high alpha for smooth animation\n      this.simulation.alpha(1).restart();\n    }\n    \n    if (\n      prevNodes.map((d) => d.nodeId).join() !==\n      currNodes.map((d) => d.nodeId).join()\n    ) {\n      this.updateNodeLabel();\n    }\n\n    if (prevThreshold !== currThreshold) {\n      this.updateVisibility();\n    }\n    return false;\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { isAttentionLoading } = this.props.globalState;\n\n    const selectedDrugs = Object.keys(this.props.globalState.metaPathGroups);\n    const reminderText = (\n      <text\n        transform={`translate(${width / 2}, ${height / 2})`}\n        fill=\"gray\"\n        fontSize={20}\n      >\n        Please select a drug first\n      </text>\n    );\n\n    return (\n      <svg className=\"graph\" width={width} height={height}>\n        <g className=\"links\" />\n        <g className=\"nodes\" />\n        <text x={0} y={height - 25} fill=\"gray\" fontSize={12}>\n          Drag & Drop to move nodes.\n        </text>\n        <text x={0} y={height - 10} fill=\"gray\" fontSize={12}>\n          Click on nodes to show/hide labels.\n        </text>\n        {selectedDrugs.length === 0 ? reminderText : <></>}\n        {isAttentionLoading ? (\n          <g className=\"loading\">\n            <rect\n              className=\"loading__background\"\n              width={width}\n              height={height}\n              fill=\"white\"\n              opacity={0.5}\n            />\n            <g transform={`translate(${width / 2}, ${height / 2})`}>\n              {LOADING_ICON}\n            </g>\n          </g>\n        ) : (\n          <></>\n        )}\n      </svg>\n    );\n  }\n}\n","import * as React from 'react';\nimport { IState, IDispatch } from 'types';\nimport { LOADING_ICON, getNodeColor } from 'helpers';\nimport { requestSubgraph, globalCache } from 'stores/DataService';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface SubgraphEdge {\n  source: string;\n  target: string;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n}\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\ninterface State {\n  subgraph: Subgraph | null;\n  loading: boolean;\n  error: string | null;\n  // Cache key to avoid re-fetching same data\n  lastCacheKey: string;\n}\n\nexport default class V1AttentionTable extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subgraph: null,\n      loading: false,\n      error: null,\n      lastCacheKey: '',\n    };\n  }\n\n  componentDidMount() {\n    this.loadSubgraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const prevDrug = prevProps.globalState.selectedDrugPrimary;\n    const prevDiseases = prevProps.globalState.diseasePredictions;\n\n    // Get currently selected disease\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n    const prevSelectedDisease = prevDiseases.find((d) => d.selected);\n\n    if (\n      selectedDrugPrimary !== prevDrug ||\n      selectedDisease?.id !== prevSelectedDisease?.id\n    ) {\n      this.loadSubgraph();\n    }\n  }\n\n  async loadSubgraph() {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      this.setState({ subgraph: null, loading: false });\n      return;\n    }\n\n    // Get disease node ID\n    const diseaseNodeId = selectedDisease.node_id || selectedDisease.id;\n    const cacheKey = `subgraph:${selectedDrugPrimary}:${diseaseNodeId}`;\n    \n    // Skip if we already have this data loaded in component state\n    if (cacheKey === this.state.lastCacheKey && this.state.subgraph) {\n      return;\n    }\n    \n    // Check global cache first (instant - from preload)\n    const cached = globalCache.get<Subgraph>(cacheKey);\n    if (cached) {\n      console.log(`[V1AttentionTable]  Global cache hit for ${cacheKey}`);\n      this.setState({ \n        subgraph: cached, \n        loading: false,\n        lastCacheKey: cacheKey,\n      });\n      return;\n    }\n\n    // Only show loading if not already preloaded\n    this.setState({ loading: true, error: null });\n\n    try {\n      const subgraph = await requestSubgraph(selectedDrugPrimary, diseaseNodeId);\n      this.setState({ subgraph, loading: false, lastCacheKey: cacheKey });\n    } catch (error) {\n      console.error('Failed to load subgraph:', error);\n      this.setState({ loading: false, error: 'Failed to load attention data' });\n    }\n  }\n\n  formatType(type: string): string {\n    if (!type) return 'Unknown';\n    if (type === 'gene/protein') return 'Protein';\n    return type\n      .replace(/_/g, ' ')\n      .replace(/\\b\\w/g, (l) => l.toUpperCase());\n  }\n\n  renderAttentionBar(score: number): React.ReactNode {\n    const percentage = Math.min(score * 100, 100);\n    const color =\n      score > 0.7\n        ? '#28a745'\n        : score > 0.4\n        ? '#ffc107'\n        : '#dc3545';\n\n    return (\n      <div\n        style={{\n          width: '100%',\n          height: '20px',\n          backgroundColor: '#e9ecef',\n          borderRadius: '10px',\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          style={{\n            width: `${percentage}%`,\n            height: '100%',\n            background: `linear-gradient(90deg, ${color} 0%, ${color}88 100%)`,\n            borderRadius: '10px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'flex-end',\n            paddingRight: '5px',\n          }}\n        >\n          <span\n            style={{\n              fontSize: '11px',\n              fontWeight: 'bold',\n              color: 'white',\n              textShadow: '1px 1px 2px rgba(0,0,0,0.5)',\n            }}\n          >\n            {score.toFixed(3)}\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { subgraph, loading, error } = this.state;\n    const { selectedDrugPrimary, diseasePredictions, nodeNameDict } = this.props.globalState;\n\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (loading) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <svg width={100} height={100}>\n            {LOADING_ICON}\n          </svg>\n        </div>\n      );\n    }\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#6c757d',\n            fontSize: '16px',\n          }}\n        >\n          Please select a drug and disease to see attention scores\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#dc3545',\n            fontSize: '16px',\n          }}\n        >\n          {error}\n        </div>\n      );\n    }\n\n    if (!subgraph || !subgraph.edges || subgraph.edges.length === 0) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            padding: '20px',\n          }}\n        >\n          <div\n            style={{\n              background: '#e7f3ff',\n              borderLeft: '4px solid #3a7bd5',\n              padding: '15px',\n              borderRadius: '5px',\n            }}\n          >\n            No attention data found for this drug-disease pair.\n          </div>\n        </div>\n      );\n    }\n\n    // Create node lookup map\n    const nodeMap: { [key: string]: SubgraphNode } = {};\n    subgraph.nodes.forEach((node) => {\n      nodeMap[node.id] = node;\n    });\n\n    // Group edges by relation\n    const edgesByRelation: { [key: string]: SubgraphEdge[] } = {};\n    subgraph.edges.forEach((edge) => {\n      const relation = edge.relation || 'unknown';\n      if (!edgesByRelation[relation]) {\n        edgesByRelation[relation] = [];\n      }\n      edgesByRelation[relation].push(edge);\n    });\n\n    // Sort edges within each group by attention score\n    Object.values(edgesByRelation).forEach((edges) => {\n      edges.sort((a, b) => b.attention - a.attention);\n    });\n\n    const drugName = nodeNameDict['drug']?.[selectedDrugPrimary] || selectedDrugPrimary;\n    const diseaseName = selectedDisease.name || selectedDisease.id;\n\n    return (\n      <div style={{ width, height, overflow: 'auto', padding: '10px' }}>\n        {/* Info Box */}\n        <div\n          style={{\n            background: '#e7f3ff',\n            borderLeft: '4px solid #3a7bd5',\n            padding: '15px',\n            marginBottom: '15px',\n            borderRadius: '5px',\n          }}\n        >\n          <strong>Total Edges:</strong> {subgraph.edges.length} |{' '}\n          <strong>Relation Types:</strong> {Object.keys(edgesByRelation).length}\n          <br />\n          <small>\n            Showing attention scores for: <strong>{drugName}</strong>  <strong>{diseaseName}</strong>\n          </small>\n        </div>\n\n        {/* Tables by Relation */}\n        {Object.entries(edgesByRelation).map(([relation, edges]) => (\n          <div key={relation} style={{ marginBottom: '20px' }}>\n            <h4\n              style={{\n                color: '#3a7bd5',\n                marginTop: '15px',\n                marginBottom: '10px',\n                fontSize: '14px',\n                fontWeight: 600,\n              }}\n            >\n              {relation.replace(/_/g, '  ')} ({edges.length})\n            </h4>\n            <table\n              style={{\n                width: '100%',\n                borderCollapse: 'collapse',\n                fontSize: '13px',\n              }}\n            >\n              <thead>\n                <tr style={{ background: '#f8f9fa' }}>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                    }}\n                  >\n                    Source\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                    }}\n                  >\n                    Target\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'center',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '80px',\n                    }}\n                  >\n                    Layer 1\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'center',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '80px',\n                    }}\n                  >\n                    Layer 2\n                  </th>\n                  <th\n                    style={{\n                      padding: '10px',\n                      textAlign: 'left',\n                      borderBottom: '2px solid #dee2e6',\n                      fontWeight: 600,\n                      color: '#495057',\n                      width: '150px',\n                    }}\n                  >\n                    Max Attention\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {edges.slice(0, 20).map((edge, idx) => {\n                  const sourceNode = nodeMap[edge.source];\n                  const targetNode = nodeMap[edge.target];\n                  const maxAtt = Math.max(edge.layer1_att || 0, edge.layer2_att || 0);\n\n                  return (\n                    <tr\n                      key={idx}\n                      style={{\n                        borderBottom: '1px solid #e9ecef',\n                      }}\n                      onMouseEnter={(e) => {\n                        (e.currentTarget as HTMLElement).style.backgroundColor = '#f8f9fa';\n                      }}\n                      onMouseLeave={(e) => {\n                        (e.currentTarget as HTMLElement).style.backgroundColor = 'transparent';\n                      }}\n                    >\n                      <td style={{ padding: '10px' }}>\n                        <strong>{sourceNode?.label || edge.source}</strong>\n                        <br />\n                        <small style={{ color: '#6c757d' }}>\n                          ({this.formatType(sourceNode?.type || 'unknown')})\n                        </small>\n                      </td>\n                      <td style={{ padding: '10px' }}>\n                        <strong>{targetNode?.label || edge.target}</strong>\n                        <br />\n                        <small style={{ color: '#6c757d' }}>\n                          ({this.formatType(targetNode?.type || 'unknown')})\n                        </small>\n                      </td>\n                      <td\n                        style={{\n                          padding: '10px',\n                          textAlign: 'center',\n                        }}\n                      >\n                        {(edge.layer1_att || 0).toFixed(4)}\n                      </td>\n                      <td\n                        style={{\n                          padding: '10px',\n                          textAlign: 'center',\n                        }}\n                      >\n                        {(edge.layer2_att || 0).toFixed(4)}\n                      </td>\n                      <td style={{ padding: '10px' }}>\n                        {this.renderAttentionBar(maxAtt)}\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n            {edges.length > 20 && (\n              <div\n                style={{\n                  textAlign: 'center',\n                  padding: '10px',\n                  color: '#6c757d',\n                  fontSize: '12px',\n                }}\n              >\n                Showing top 20 of {edges.length} edges\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n\n","import * as React from 'react';\nimport * as d3 from 'd3';\nimport { IState, IDispatch } from 'types';\nimport { LOADING_ICON } from 'helpers';\nimport { requestSubgraph, globalCache } from 'stores/DataService';\n\ninterface Props {\n  height: number;\n  width: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface SubgraphEdge {\n  source: string | SimNode;\n  target: string | SimNode;\n  relation: string;\n  layer1_att: number;\n  layer2_att: number;\n  attention: number;\n  on_path?: boolean;  // For path highlighting\n}\n\ninterface SubgraphNode {\n  id: string;\n  label: string;\n  type: string;\n  on_path?: boolean;  // For path highlighting\n  category?: string;  // Disease category\n}\n\ninterface SimNode extends d3.SimulationNodeDatum {\n  id: string;\n  label: string;\n  type: string;\n  on_path?: boolean;\n  category?: string;\n}\n\ninterface Subgraph {\n  nodes: SubgraphNode[];\n  edges: SubgraphEdge[];\n}\n\ninterface State {\n  subgraph: Subgraph | null;\n  loading: boolean;\n  error: string | null;\n  // Cache key to avoid re-fetching same data\n  lastCacheKey: string;\n}\n\n// Node colors matching V1 dashboard\nconst NODE_COLORS: { [key: string]: string } = {\n  drug: '#3a7bd5',\n  disease: '#dc3545',\n  'gene/protein': '#28a745',\n  protein: '#28a745',\n  pathway: '#fd7e14',\n  biological_process: '#6f42c1',\n  molecular_function: '#20c997',\n  cellular_component: '#e83e8c',\n  anatomy: '#17a2b8',\n  effect_phenotype: '#ffc107',\n  exposure: '#795548',\n  unknown: '#6c757d',\n};\n\nexport default class V1SubGraph extends React.Component<Props, State> {\n  svgRef = React.createRef<SVGSVGElement>();\n  simulation: d3.Simulation<SimNode, SubgraphEdge> | null = null;\n  selectedDrugPrimary: string = '';\n  diseaseNodeId: string = '';\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subgraph: null,\n      loading: false,\n      error: null,\n      lastCacheKey: '',\n    };\n    this.dragstarted = this.dragstarted.bind(this);\n    this.dragged = this.dragged.bind(this);\n    this.dragended = this.dragended.bind(this);\n  }\n\n  componentDidMount() {\n    this.loadSubgraph();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const prevDrug = prevProps.globalState.selectedDrugPrimary;\n    const prevDiseases = prevProps.globalState.diseasePredictions;\n\n    // Get currently selected disease\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n    const prevSelectedDisease = prevDiseases.find((d) => d.selected);\n\n    if (\n      selectedDrugPrimary !== prevDrug ||\n      selectedDisease?.id !== prevSelectedDisease?.id\n    ) {\n      this.loadSubgraph();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.simulation) {\n      this.simulation.stop();\n    }\n  }\n\n  async loadSubgraph() {\n    const { selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      this.setState({ subgraph: null, loading: false });\n      return;\n    }\n\n    const diseaseNodeId = selectedDisease.node_id || selectedDisease.id;\n    const cacheKey = `subgraph:${selectedDrugPrimary}:${diseaseNodeId}`;\n    \n    this.selectedDrugPrimary = selectedDrugPrimary;\n    this.diseaseNodeId = diseaseNodeId;\n    \n    // Skip if we already have this data loaded\n    if (cacheKey === this.state.lastCacheKey && this.state.subgraph) {\n      return;\n    }\n    \n    // Check global cache first (instant - from preload)\n    const cached = globalCache.get<Subgraph>(cacheKey);\n    if (cached) {\n      console.log(`[V1SubGraph]  Global cache hit for ${cacheKey}`);\n      this.setState({ \n        subgraph: cached, \n        loading: false,\n        lastCacheKey: cacheKey,\n      }, () => {\n        this.drawGraph();\n      });\n      return;\n    }\n\n    this.setState({ loading: true, error: null });\n\n    try {\n      const subgraph = await requestSubgraph(selectedDrugPrimary, diseaseNodeId);\n      this.setState({ subgraph, loading: false, lastCacheKey: cacheKey }, () => {\n        this.drawGraph();\n      });\n    } catch (error) {\n      console.error('Failed to load subgraph:', error);\n      this.setState({ loading: false, error: 'Failed to load subgraph data' });\n    }\n  }\n\n  getNodeColor(type: string): string {\n    return NODE_COLORS[type] || NODE_COLORS['unknown'];\n  }\n\n  dragstarted(d: SimNode) {\n    if (!d3.event.active) this.simulation?.alphaTarget(0.3).restart();\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  dragged(d: SimNode) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  dragended(d: SimNode) {\n    if (!d3.event.active) this.simulation?.alphaTarget(0);\n    d.fx = null;\n    d.fy = null;\n  }\n\n  drawGraph() {\n    const { subgraph } = this.state;\n    const { width, height } = this.props;\n\n    if (!subgraph || !this.svgRef.current) return;\n\n    const selectedDrugPrimary = this.selectedDrugPrimary;\n    const diseaseNodeId = this.diseaseNodeId;\n\n    // Clear previous content\n    const svg = d3.select(this.svgRef.current);\n    svg.selectAll('*').remove();\n\n    // Create deep copies of nodes and edges for D3 simulation\n    const nodes: SimNode[] = subgraph.nodes.map((n) => ({\n      ...n,\n      x: undefined,\n      y: undefined,\n    }));\n    const edges: SubgraphEdge[] = subgraph.edges.map((e) => ({\n      ...e,\n      source: e.source,\n      target: e.target,\n    }));\n\n    // Create container for zoom\n    const container = svg.append('g').attr('class', 'zoom-container');\n\n    // Create zoom behavior (D3 v5 style)\n    const zoom = d3.zoom<SVGSVGElement, unknown>()\n      .scaleExtent([0.1, 4])\n      .on('zoom', () => {\n        container.attr('transform', d3.event.transform);\n      });\n\n    svg.call(zoom as any);\n\n    // Create simulation\n    if (this.simulation) {\n      this.simulation.stop();\n    }\n\n    this.simulation = d3\n      .forceSimulation<SimNode, SubgraphEdge>(nodes)\n      .force(\n        'link',\n        d3\n          .forceLink<SimNode, SubgraphEdge>(edges)\n          .id((d) => d.id)\n          .distance(120)\n      )\n      .force('charge', d3.forceManyBody().strength(-250))\n      .force('center', d3.forceCenter(width / 2, height / 2))\n      .force('collision', d3.forceCollide().radius(40));\n\n    // Draw links - highlight path edges\n    const link = container\n      .append('g')\n      .selectAll('line')\n      .data(edges)\n      .enter()\n      .append('line')\n      .attr('stroke', (d: any) => d.on_path ? '#ff5722' : '#999')  // Orange for path edges\n      .attr('stroke-opacity', (d: any) => d.on_path ? 1.0 : 0.6)\n      .attr('stroke-width', (d: any) => d.on_path ? 4 : Math.max(2, (d.attention || 0.1) * 8))\n      .attr('stroke-dasharray', (d: any) => d.on_path ? '8,4' : 'none');\n\n    // Draw nodes - highlight path nodes\n    const node = container\n      .append('g')\n      .selectAll('circle')\n      .data(nodes)\n      .enter()\n      .append('circle')\n      .attr('r', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 25;\n        }\n        if (d.on_path) {\n          return 18;  // Slightly larger for path nodes\n        }\n        return 15;\n      })\n      .attr('fill', (d) => this.getNodeColor(d.type))\n      .attr('stroke', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return '#ffc107';  // Gold for selected\n        }\n        if (d.on_path) {\n          return '#ff5722';  // Orange for path nodes\n        }\n        return 'white';\n      })\n      .attr('stroke-width', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 4;\n        }\n        if (d.on_path) {\n          return 3;\n        }\n        return 1.5;\n      })\n      .attr('cursor', 'pointer')\n      .call(\n        d3.drag<SVGCircleElement, SimNode>()\n          .on('start', this.dragstarted)\n          .on('drag', this.dragged)\n          .on('end', this.dragended) as any\n      );\n\n    // Add node labels\n    const label = container\n      .append('g')\n      .selectAll('text')\n      .data(nodes)\n      .enter()\n      .append('text')\n      .attr('font-size', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return '14px';\n        }\n        return '11px';\n      })\n      .attr('font-weight', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return 'bold';\n        }\n        return 'normal';\n      })\n      .attr('text-anchor', 'middle')\n      .attr('dy', (d) => {\n        if (d.id === selectedDrugPrimary || d.id === diseaseNodeId) {\n          return -30;\n        }\n        return -20;\n      })\n      .attr('pointer-events', 'none')\n      .text((d) => {\n        const maxLen = d.id === selectedDrugPrimary || d.id === diseaseNodeId ? 40 : 25;\n        return d.label && d.label.length > maxLen\n          ? d.label.substring(0, maxLen) + '...'\n          : d.label || d.id;\n      });\n\n    // Hover effects (D3 v5 style)\n    node\n      .on('mouseover', function() {\n        d3.select(this).attr('stroke', '#ffc107').attr('stroke-width', 3);\n      })\n      .on('mouseout', function(d: SimNode) {\n        d3.select(this)\n          .attr('stroke', d.id === selectedDrugPrimary || d.id === diseaseNodeId ? '#ffc107' : 'white')\n          .attr('stroke-width', d.id === selectedDrugPrimary || d.id === diseaseNodeId ? 3 : 1.5);\n      });\n\n    // Tooltip\n    node.append('title').text((d) => `${d.label}\\nType: ${d.type}\\nID: ${d.id}`);\n\n    // Update positions on tick\n    this.simulation.on('tick', () => {\n      link\n        .attr('x1', (d: any) => d.source.x)\n        .attr('y1', (d: any) => d.source.y)\n        .attr('x2', (d: any) => d.target.x)\n        .attr('y2', (d: any) => d.target.y);\n\n      node.attr('cx', (d) => d.x || 0).attr('cy', (d) => d.y || 0);\n\n      label.attr('x', (d) => d.x || 0).attr('y', (d) => d.y || 0);\n    });\n\n    // Initial zoom to fit\n    setTimeout(() => {\n      const bounds = (container.node() as SVGGElement)?.getBBox();\n      if (bounds) {\n        const dx = bounds.width;\n        const dy = bounds.height;\n        const x = bounds.x + dx / 2;\n        const y = bounds.y + dy / 2;\n        const scale = Math.min(0.9, 0.9 / Math.max(dx / width, dy / height));\n        const translate = [width / 2 - scale * x, height / 2 - scale * y];\n\n        svg.transition()\n          .duration(750)\n          .call(\n            zoom.transform as any,\n            d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)\n          );\n      }\n    }, 500);\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const { subgraph, loading, error } = this.state;\n    const { selectedDrugPrimary, diseasePredictions, nodeNameDict } = this.props.globalState;\n\n    const selectedDisease = diseasePredictions.find((d) => d.selected);\n\n    if (loading) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <svg width={100} height={100}>\n            {LOADING_ICON}\n          </svg>\n        </div>\n      );\n    }\n\n    if (!selectedDrugPrimary || !selectedDisease) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#6c757d',\n            fontSize: '16px',\n          }}\n        >\n          Please select a drug and disease to see the knowledge subgraph\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div\n          style={{\n            width,\n            height,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#dc3545',\n            fontSize: '16px',\n          }}\n        >\n          {error}\n        </div>\n      );\n    }\n\n    const drugName = nodeNameDict['drug']?.[selectedDrugPrimary] || selectedDrugPrimary;\n    const diseaseName = selectedDisease.name || selectedDisease.id;\n\n    return (\n      <div style={{ width, height, position: 'relative' }}>\n        {/* Info overlay */}\n        <div\n          style={{\n            position: 'absolute',\n            top: 10,\n            left: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '10px 15px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '13px',\n          }}\n        >\n          <div style={{ fontWeight: 'bold', color: '#3a7bd5', marginBottom: '5px' }}>\n            Knowledge Sub-Graph\n          </div>\n          <div>\n            <strong>Drug:</strong> {drugName}\n          </div>\n          <div>\n            <strong>Disease:</strong> {diseaseName}\n          </div>\n          {subgraph && (\n            <div style={{ color: '#6c757d', marginTop: '5px' }}>\n              {subgraph.nodes.length} nodes, {subgraph.edges.length} edges\n            </div>\n          )}\n        </div>\n\n        {/* Legend */}\n        <div\n          style={{\n            position: 'absolute',\n            bottom: 10,\n            left: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '10px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '11px',\n          }}\n        >\n          <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>Node Types</div>\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\n            {Object.entries(NODE_COLORS).slice(0, 8).map(([type, color]) => (\n              <div key={type} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n                <div\n                  style={{\n                    width: 12,\n                    height: 12,\n                    borderRadius: '50%',\n                    backgroundColor: color,\n                  }}\n                />\n                <span>{type.replace('_', ' ')}</span>\n              </div>\n            ))}\n          </div>\n          <div style={{ fontWeight: 'bold', marginTop: '10px', marginBottom: '5px' }}>Path Highlighting</div>\n          <div style={{ display: 'flex', gap: '10px' }}>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n              <div style={{ width: 20, height: 3, backgroundColor: '#ff5722', borderRadius: '2px' }} />\n              <span>Shortest path</span>\n            </div>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n              <div style={{ width: 12, height: 12, borderRadius: '50%', border: '3px solid #ff5722', backgroundColor: 'transparent' }} />\n              <span>Path node</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div\n          style={{\n            position: 'absolute',\n            bottom: 10,\n            right: 10,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '8px 12px',\n            borderRadius: '8px',\n            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n            zIndex: 10,\n            fontSize: '11px',\n            color: '#6c757d',\n          }}\n        >\n          <div> Drag nodes to move</div>\n          <div> Scroll to zoom</div>\n          <div> Drag background to pan</div>\n        </div>\n\n        {/* SVG container */}\n        <svg\n          ref={this.svgRef}\n          width={width}\n          height={height}\n          style={{\n            background: '#f8f9fa',\n            borderRadius: '8px',\n            border: '2px solid #e9ecef',\n          }}\n        />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { requestEmbedding, globalCache } from 'stores/DataService';\nimport { IState, IDispatch } from 'types';\nimport { StateConsumer } from 'stores';\nimport * as d3 from 'd3';\nimport { HIGHLIGHT_COLOR, SELECTED_COLOR } from 'helpers/color';\nimport { LOADING_ICON } from 'helpers';\nimport { selectDrug, selectDrugPrimary, selectDiseaseSecondary } from 'stores/actions';\nimport { isAddDrug, isAddDisease } from 'stores/reducer';\nimport lasso from './lasso.js';\n\n// Disease category colors\nconst CATEGORY_COLORS: { [key: string]: string } = {\n  cancer: '#e53935',          // Red\n  neurological: '#8e24aa',    // Purple\n  cardiovascular: '#d81b60',  // Pink\n  autoimmune: '#f4511e',      // Deep Orange\n  infectious: '#43a047',      // Green\n  metabolic: '#1e88e5',       // Blue\n  respiratory: '#00acc1',     // Cyan\n  gastrointestinal: '#fb8c00', // Orange\n  genetic: '#5e35b1',         // Deep Purple\n  other: '#90a4ae',           // Gray\n};\n\ninterface EmbeddingData {\n  coords: [number, number];\n  category: string;\n  name: string;\n  predicted: boolean;\n}\n\ninterface State {\n  embedding: { [key: string]: [number, number] | EmbeddingData };\n  tooltip: {\n    visible: boolean;\n    info: string;\n    position: [number, number];\n  };\n  showCategoryColors: boolean;\n  // Cache key to avoid re-fetching same data\n  lastDrugId: string;\n}\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\nclass Scatter extends React.Component<Props, State> {\n  circleRadius = 3;\n  hoverTimeout: number = 0;\n  WAIT = 500;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      embedding: {},\n      tooltip: { visible: false, info: '', position: [0, 0] },\n      showCategoryColors: true,  // Enable category coloring by default\n      lastDrugId: '',\n    };\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n  }\n  \n  // Helper to get coordinates from embedding data (supports both old and new format)\n  getCoords(data: [number, number] | EmbeddingData): [number, number] {\n    if (Array.isArray(data)) {\n      return data;\n    }\n    return data.coords;\n  }\n  \n  // Helper to get category from embedding data\n  getCategory(data: [number, number] | EmbeddingData): string {\n    if (Array.isArray(data)) {\n      return 'other';\n    }\n    return data.category || 'other';\n  }\n  \n  // Helper to get name from embedding data\n  getName(data: [number, number] | EmbeddingData): string {\n    if (Array.isArray(data)) {\n      return '';\n    }\n    return data.name || '';\n  }\n  async loadEmbedding() {\n    const { selectedDrugPrimary } = this.props.globalState;\n    const cacheKey = `embeddings:${selectedDrugPrimary || 'default'}`;\n    \n    // Skip if we already have this data loaded\n    if (cacheKey === `embeddings:${this.state.lastDrugId}` && Object.keys(this.state.embedding).length > 0) {\n      return;\n    }\n    \n    // Check global cache first (instant - from preload)\n    const cached = globalCache.get<{ [key: string]: [number, number] | EmbeddingData }>(cacheKey);\n    if (cached) {\n      console.log(`[Scatter]  Global cache hit for ${cacheKey}`);\n      this.setState({ \n        embedding: cached,\n        lastDrugId: selectedDrugPrimary || 'default',\n      });\n      return;\n    }\n    \n    const embedding = await requestEmbedding(selectedDrugPrimary);\n    this.setState({ embedding, lastDrugId: selectedDrugPrimary || 'default' });\n  }\n  componentDidMount() {\n    this.loadEmbedding();\n  }\n  componentDidUpdate(prevProps: Props) {\n    // Reload embeddings when the primary drug changes\n    const { selectedDrugPrimary } = this.props.globalState;\n    const prevDrugPrimary = prevProps.globalState.selectedDrugPrimary;\n    \n    if (selectedDrugPrimary !== prevDrugPrimary) {\n      this.loadEmbedding();\n    }\n  }\n\n  addLasso(width: number, height: number) {\n    const { drugPredictions } = this.props.globalState;\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    // lasso draw\n    d3.selectAll('g.lasso').remove();\n    var svg = d3.select('svg.scatter');\n\n    var lasso_area = d3.select('rect.lasso');\n\n    // Lasso functions to execute while lassoing\n    var lasso_start = () => {\n      // (mylasso.items() as any).attr('r', 5); // reset size\n      // .attr('fill', 'white')\n    };\n\n    var lasso_draw = () => {\n      // Style the possible dots\n      // mylasso\n      // .possibleItems()\n      // .classed(\"possible\", true)\n    };\n\n    var lasso_end = () => {\n      // mylasso.selectedItems()\n      //     .attr('fill', colors[this.selected.length])\n      //     .attr('r', '7')\n      //     .classed(`group_${this.selected.length}`, true)\n      // mylasso\n      // .items()\n      // .classed(\"possible\", false)\n\n      (mylasso.selectedItems() as any)._groups[0].forEach((d: any) => {\n        const drugID = d.attributes.id.value;\n        if (!selectedDrugIds.includes(drugID)) {\n          selectDrug(\n            drugID,\n            this.props.globalState.selectedDisease,\n            true,\n            this.props.dispatch\n          );\n        }\n      });\n    };\n\n    var mylasso = lasso();\n    mylasso.items(svg.selectAll('circle.highlighted'));\n    mylasso\n      .targetArea(lasso_area) // area where the lasso can be started\n      .on('start', lasso_start) // lasso start function\n      .on('draw', lasso_draw) // lasso draw function\n      .on('end', lasso_end); // lasso end function\n\n    svg.call(mylasso);\n  }\n  drawScatter() {\n    const { diseasePredictions, appMode } = this.props.globalState;\n    const { width, height } = this.props;\n\n    // this.addLasso(width, height);\n\n    const { embedding, showCategoryColors } = this.state;\n    \n    // Extract coordinates for domain calculation\n    const allCoords = Object.values(embedding).map((d) => this.getCoords(d));\n    const xDomain = d3.extent(allCoords.map((d) => d[0])) as [number, number];\n    const yDomain = d3.extent(allCoords.map((d) => d[1])) as [number, number];\n\n    const xScale = d3\n      .scaleLinear()\n      .domain(xDomain)\n      .range([this.circleRadius, width - this.circleRadius]);\n    const yScale = d3\n      .scaleLinear()\n      .domain(yDomain)\n      .range([this.circleRadius, height - this.circleRadius]);\n\n    // Use disease predictions in drug-to-disease mode\n    const diseaseIds = diseasePredictions.map((d) => d.node_id || d.id);\n    const selectedDiseaseIds = diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.node_id || d.id);\n\n    const getSortIndex = (diseaseId: string) =>\n      diseaseIds.indexOf(diseaseId) > -1 ? diseaseIds.indexOf(diseaseId) : diseaseIds.length;\n\n    const nodes = Object.keys(embedding)\n      .sort((a, b) => -getSortIndex(a) + getSortIndex(b))\n      .map((diseaseId) => {\n        const embData = embedding[diseaseId];\n        const [x, y] = this.getCoords(embData);\n        const category = this.getCategory(embData);\n        const diseaseName = this.getName(embData);\n        \n        const diseaseRank = diseaseIds.indexOf(diseaseId);\n        const isHighlighted = diseaseRank > -1; // predicted diseases\n        const isSelected = selectedDiseaseIds.includes(diseaseId);\n        \n        // Determine fill color based on selection, highlighting, and category\n        let fillColor: string;\n        if (isSelected) {\n          fillColor = SELECTED_COLOR;\n        } else if (isHighlighted) {\n          fillColor = showCategoryColors \n            ? (CATEGORY_COLORS[category] || HIGHLIGHT_COLOR)\n            : HIGHLIGHT_COLOR;\n        } else {\n          fillColor = showCategoryColors \n            ? (CATEGORY_COLORS[category] || 'lightGray')\n            : 'lightGray';\n        }\n\n        return (\n          <circle\n            cx={xScale(x)}\n            cy={yScale(y)}\n            key={diseaseId}\n            className={isHighlighted ? 'highlighted disease' : 'disease'}\n            id={diseaseId}\n            fill={fillColor}\n            opacity={isSelected ? 1 : isHighlighted ? 0.85 : 0.5}\n            stroke={isSelected ? '#fff' : 'rgba(255,255,255,0.5)'}\n            strokeWidth={isSelected ? 2 : 1}\n            r={\n              isSelected\n                ? this.circleRadius * 2\n                : isHighlighted\n                  ? this.circleRadius * 1.3\n                  : this.circleRadius\n            }\n            onDoubleClick={() => {\n              if (isHighlighted) this.onChangeDisease(diseaseId);\n            }}\n            onClick={() => this.showTooltip(diseaseId, [xScale(x), yScale(y)], category, diseaseName)}\n          />\n        );\n      });\n    return nodes;\n  }\n  onChangeDisease(selectedDiseaseNodeId: string) {\n    const { appMode, selectedDrugPrimary, diseasePredictions } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease' && selectedDrugPrimary) {\n      // Find the disease prediction by node_id to get the correct disease_id\n      const diseasePrediction = diseasePredictions.find(\n        (d) => (d.node_id || d.id) === selectedDiseaseNodeId\n      );\n      \n      if (!diseasePrediction) {\n        console.warn(`Disease prediction not found for node_id: ${selectedDiseaseNodeId}`);\n        return;\n      }\n      \n      // Use disease_id (d.id) for selection toggle, node_id for attention API\n      const diseaseId = diseasePrediction.id;\n      const diseaseNodeId = diseasePrediction.node_id || diseasePrediction.id;\n      \n      // In Drug-to-Disease mode, clicking a disease selects/deselects it\n      const isAdd = isAddDisease(diseasePredictions, diseaseId);\n      selectDiseaseSecondary(\n        diseaseId,           // disease_id for selection toggle\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch,\n        diseaseNodeId        // node_id for attention API\n      );\n    }\n  }\n  onChangeDrug(selectedDrug: string) {\n    const { appMode } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      selectDrugPrimary(selectedDrug, this.props.dispatch);\n    } else {\n      const isAdd = isAddDrug(\n        this.props.globalState.drugPredictions,\n        selectedDrug\n      );\n      selectDrug(\n        selectedDrug,\n        this.props.globalState.selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n  showTooltip(diseaseId: string, position: [number, number], category?: string, name?: string) {\n    const { nodeNameDict } = this.props.globalState;\n    this.hoverTimeout = window.setTimeout(() => {\n      const diseaseName = name || nodeNameDict['disease']?.[diseaseId] || diseaseId;\n      const categoryLabel = category ? ` [${category}]` : '';\n      this.setState({\n        tooltip: {\n          visible: true,\n          info: `${diseaseName}${categoryLabel}`,\n          position,\n        },\n      });\n    }, this.WAIT);\n  }\n  hideTooltip() {\n    window.clearTimeout(this.hoverTimeout);\n    this.setState({\n      tooltip: {\n        visible: false,\n        info: ``,\n        position: [0, 0],\n      },\n    });\n  }\n  render() {\n    const { isDrugLoading, isInitializing } = this.props.globalState;\n    const { width, height } = this.props;\n    const { tooltip, showCategoryColors } = this.state;\n\n    return (\n      <div style={{ position: 'relative' }}>\n        <svg width={width} height={height} className=\"scatter\">\n          <rect\n            className=\"lasso area\"\n            width={width}\n            height={height}\n            opacity={0}\n          />\n          <g className=\"scatter\">\n            {this.state.embedding ? (\n              this.drawScatter()\n            ) : (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            )}\n            {/* overlap a loading icon when loading */}\n            {isDrugLoading && !isInitializing ? (\n              <g\n                transform={`translate(${width / 2}, ${height / 2})`}\n                textAnchor=\"middle\"\n              >\n                {LOADING_ICON}\n              </g>\n            ) : (\n              <g />\n            )}\n          </g>{' '}\n          <text x={0} y={height - 25} fontSize={12} fill=\"gray\">\n            Click to reveal the disease name.\n          </text>\n          <text x={0} y={height - 10} fontSize={12} fill=\"gray\">\n            Double click to select the disease.\n          </text>\n        </svg>\n        \n        {/* Category Legend */}\n        <div\n          style={{\n            position: 'absolute',\n            top: 5,\n            right: 5,\n            background: 'rgba(255,255,255,0.95)',\n            padding: '8px',\n            borderRadius: '6px',\n            boxShadow: '0 1px 4px rgba(0,0,0,0.15)',\n            fontSize: '10px',\n            maxWidth: '140px',\n          }}\n        >\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>\n            <span style={{ fontWeight: 'bold', fontSize: '11px' }}>Categories</span>\n            <button\n              onClick={() => this.setState({ showCategoryColors: !showCategoryColors })}\n              style={{\n                padding: '2px 6px',\n                fontSize: '9px',\n                border: '1px solid #ccc',\n                borderRadius: '3px',\n                background: showCategoryColors ? '#e3f2fd' : '#fff',\n                cursor: 'pointer',\n              }}\n            >\n              {showCategoryColors ? 'ON' : 'OFF'}\n            </button>\n          </div>\n          {showCategoryColors && (\n            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n              {Object.entries(CATEGORY_COLORS).slice(0, 9).map(([category, color]) => (\n                <div key={category} style={{ display: 'flex', alignItems: 'center', gap: '3px', width: '48%' }}>\n                  <div\n                    style={{\n                      width: 8,\n                      height: 8,\n                      borderRadius: '50%',\n                      backgroundColor: color,\n                    }}\n                  />\n                  <span style={{ textTransform: 'capitalize', fontSize: '9px' }}>\n                    {category.substring(0, 8)}\n                  </span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n        \n        <div\n          className={`tooltip tooltip-${tooltip.visible ? 'show' : 'hide'}`}\n          style={{\n            left: tooltip.position[0] + this.circleRadius,\n            top: tooltip.position[1] + this.circleRadius,\n          }}\n        >\n          {tooltip.info}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default StateConsumer(Scatter);\n","import * as selection from 'd3-selection';\nimport * as drag from 'd3-drag';\nimport classifyPoint from 'robust-point-in-polygon';\n\nexport default function () {\n  var items = [],\n    closePathDistance = 75,\n    closePathSelect = true,\n    isPathClosed = false,\n    hoverSelect = true,\n    targetArea,\n    on = { start: function () {}, draw: function () {}, end: function () {} };\n\n  // Function to execute on call\n  function lasso(_this) {\n    // add a new group for the lasso\n    var g = _this.append('g').attr('class', 'lasso');\n\n    // add the drawn path for the lasso\n    var dyn_path = g.append('path').attr('class', 'drawn');\n\n    // add a closed path\n    var close_path = g.append('path').attr('class', 'loop_close');\n\n    // add an origin node\n    var origin_node = g.append('circle').attr('class', 'origin');\n\n    // The transformed lasso path for rendering\n    var tpath;\n\n    // The lasso origin for calculations\n    var origin;\n\n    // The transformed lasso origin for rendering\n    var torigin;\n\n    // Store off coordinates drawn\n    var drawnCoords;\n\n    // Apply drag behaviors\n    var dragAction = drag\n      .drag()\n      .on('start', dragstart)\n      .on('drag', dragmove)\n      .on('end', dragend);\n\n    // Call drag\n    targetArea.call(dragAction);\n\n    function dragstart() {\n      // Init coordinates\n      drawnCoords = [];\n\n      // Initialize paths\n      tpath = '';\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n\n      // Set every item to have a false selection and reset their center point and counters\n      items.nodes().forEach(function (e) {\n        e.__lasso.possible = false;\n        e.__lasso.selected = false;\n        e.__lasso.hoverSelect = false;\n        e.__lasso.loopSelect = false;\n\n        var box = e.getBoundingClientRect();\n        e.__lasso.lassoPoint = [\n          Math.round(box.left + box.width / 2),\n          Math.round(box.top + box.height / 2),\n        ];\n      });\n\n      // if hover is on, add hover function\n      if (hoverSelect) {\n        items.on('mouseover.lasso', function () {\n          // if hovered, change lasso selection attribute to true\n          this.__lasso.hoverSelect = true;\n        });\n      }\n\n      // Run user defined start function\n      on.start();\n    }\n\n    function dragmove() {\n      // Get mouse position within body, used for calculations\n      var x, y;\n      if (selection.event.sourceEvent.type === 'touchmove') {\n        x = selection.event.sourceEvent.touches[0].clientX;\n        y = selection.event.sourceEvent.touches[0].clientY;\n      } else {\n        x = selection.event.sourceEvent.clientX;\n        y = selection.event.sourceEvent.clientY;\n      }\n\n      // Get mouse position within drawing area, used for rendering\n      var tx = selection.mouse(this)[0];\n      var ty = selection.mouse(this)[1];\n\n      // Initialize the path or add the latest point to it\n      if (tpath === '') {\n        tpath = tpath + 'M ' + tx + ' ' + ty;\n        origin = [x, y];\n        torigin = [tx, ty];\n        // Draw origin node\n        origin_node\n          .attr('cx', tx)\n          .attr('cy', ty)\n          .attr('r', 7)\n          .attr('display', null);\n      } else {\n        tpath = tpath + ' L ' + tx + ' ' + ty;\n      }\n\n      drawnCoords.push([x, y]);\n\n      // Calculate the current distance from the lasso origin\n      var distance = Math.sqrt(\n        Math.pow(x - origin[0], 2) + Math.pow(y - origin[1], 2)\n      );\n\n      // Set the closed path line\n      var close_draw_path =\n        'M ' + tx + ' ' + ty + ' L ' + torigin[0] + ' ' + torigin[1];\n\n      // Draw the lines\n      dyn_path.attr('d', tpath);\n\n      close_path.attr('d', close_draw_path);\n\n      // Check if the path is closed\n      isPathClosed = distance <= closePathDistance ? true : false;\n\n      // If within the closed path distance parameter, show the closed path. otherwise, hide it\n      if (isPathClosed && closePathSelect) {\n        close_path.attr('display', null);\n      } else {\n        close_path.attr('display', 'none');\n      }\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.loopSelect =\n          isPathClosed && closePathSelect && n.__lasso.lassoPoint\n            ? classifyPoint(drawnCoords, n.__lasso.lassoPoint) < 1\n            : false;\n        n.__lasso.possible = n.__lasso.hoverSelect || n.__lasso.loopSelect;\n      });\n\n      on.draw();\n    }\n\n    function dragend() {\n      // Remove mouseover tagging function\n      items.on('mouseover.lasso', null);\n\n      items.nodes().forEach(function (n) {\n        n.__lasso.selected = n.__lasso.possible;\n        n.__lasso.possible = false;\n      });\n\n      // Clear lasso\n      dyn_path.attr('d', null);\n      close_path.attr('d', null);\n      origin_node.attr('display', 'none');\n\n      // Run user defined end function\n      on.end();\n    }\n  }\n\n  // Set or get list of items for lasso to select\n  lasso.items = function (_) {\n    if (!arguments.length) return items;\n    items = _;\n    var nodes = items.nodes();\n    nodes.forEach(function (n) {\n      n.__lasso = {\n        possible: false,\n        selected: false,\n      };\n    });\n    return lasso;\n  };\n\n  // Return possible items\n  lasso.possibleItems = function () {\n    return items.filter(function () {\n      return this.__lasso.possible;\n    });\n  };\n\n  // Return selected items\n  lasso.selectedItems = function () {\n    return items.filter(function () {\n      return this.__lasso.selected;\n    });\n  };\n\n  // Return not possible items\n  lasso.notPossibleItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.possible;\n    });\n  };\n\n  // Return not selected items\n  lasso.notSelectedItems = function () {\n    return items.filter(function () {\n      return !this.__lasso.selected;\n    });\n  };\n\n  // Distance required before path auto closes loop\n  lasso.closePathDistance = function (_) {\n    if (!arguments.length) return closePathDistance;\n    closePathDistance = _;\n    return lasso;\n  };\n\n  // Option to loop select or not\n  lasso.closePathSelect = function (_) {\n    if (!arguments.length) return closePathSelect;\n    closePathSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Not sure what this is for\n  lasso.isPathClosed = function (_) {\n    if (!arguments.length) return isPathClosed;\n    isPathClosed = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Option to select on hover or not\n  lasso.hoverSelect = function (_) {\n    if (!arguments.length) return hoverSelect;\n    hoverSelect = _ === true ? true : false;\n    return lasso;\n  };\n\n  // Events\n  lasso.on = function (type, _) {\n    if (!arguments.length) return on;\n    if (arguments.length === 1) return on[type];\n    var types = ['start', 'draw', 'end'];\n    if (types.indexOf(type) > -1) {\n      on[type] = _;\n    }\n    return lasso;\n  };\n\n  // Area where lasso can be triggered from\n  lasso.targetArea = function (_) {\n    if (!arguments.length) return targetArea;\n    targetArea = _;\n    return lasso;\n  };\n\n  return lasso;\n}\n","import { Tooltip, Modal } from 'antd';\nimport { cropText, YES_ICON, NO_ICON, LOADING_ICON } from 'helpers';\nimport { getNodeColor } from 'helpers/color';\nimport { ACTION_TYPES, selectDrug, selectDiseaseSecondary, toggleMetaPathHide } from 'stores/actions';\nimport { isAddDrug } from 'stores/reducer';\nimport React from 'react';\n\nimport { StateConsumer } from 'stores';\nimport { IPath, IMetaPathSummary, IState, IDispatch } from 'types';\nimport * as d3 from 'd3';\n\nimport './index.css';\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  expand: boolean[];\n  isModalVisible: boolean;\n}\n\nclass PathMatrix extends React.Component<Props, State> {\n  TITLE_HEIGHT = 36;\n  MARGIN = 10;\n  PADDING = 10;\n  EDGE_LENGTH = 120;\n  NODE_WIDTH = 130;\n  NODE_HEIGHT = 25;\n  VERTICAL_GAP = 2; // vertical gap between path\n  GROUP_GAP = 6; // vertical gap between path groups\n  COUNT_GAP = 5; // horizontal gap between count circles\n  RADIUS = this.NODE_HEIGHT / 2; // max radius of the count circle\n  HEAD_HEIGHT = 70; // height of the header ()\n  ICON_GAP = 20; // width of the expand triangle icon\n  offsetY = 0; // record the height of the expanded meta paths\n\n  constructor(prop: Props) {\n    super(prop);\n    this.state = {\n      expand: this.props.globalState.metaPathSummary.map((d) => false),\n      isModalVisible: false,\n    };\n\n    this.showModal = this.showModal.bind(this);\n    this.hideModal = this.hideModal.bind(this);\n    this.filterMetaPathGroups = this.filterMetaPathGroups.bind(this);\n  }\n  toggleExpand(idx: number, flag: undefined | boolean) {\n    let { expand } = this.state;\n    if (flag === undefined) {\n      expand[idx] = !expand[idx];\n    } else {\n      expand[idx] = flag;\n    }\n    this.setState({ expand });\n  }\n\n  isPathSelected(nodes: IPath['nodes']) {\n    const { selectedPathNodes } = this.props.globalState;\n    const doesExist =\n      selectedPathNodes.map((d) => d.nodeId).join() ===\n      nodes.map((d) => d.nodeId).join() &&\n      selectedPathNodes.map((d) => d.nodeType).join() ===\n      nodes.map((d) => d.nodeType).join();\n    return doesExist;\n  }\n\n  togglePathNodes(nodes: IPath['nodes'], doesExist: boolean) {\n    if (doesExist) {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: [] },\n      });\n    } else {\n      this.props.dispatch({\n        type: ACTION_TYPES.Select_Path_Noes,\n        payload: { selectedPathNodes: nodes },\n      });\n    }\n  }\n  getMetaIconGroup(toggleHideFunc: (hide: boolean) => void, isHide: boolean) {\n    return (\n      <g\n        className=\"feedback\"\n        cursor=\"pointer\"\n        style={{ fill: '#777' }}\n        transform={`translate(5, 0)`}\n      >\n        <g\n          className=\"yes\"\n          transform={`translate(${0 * this.ICON_GAP}, 0)`}\n          onClick={() => toggleHideFunc(!isHide)}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={isHide ? YES_ICON : NO_ICON} transform={`scale(0.03)`} />\n        </g>\n      </g>\n    );\n  }\n  getIconGroup(nodes: IPath['nodes']) {\n    return (\n      <g className=\"feedback\" cursor=\"pointer\" style={{ fill: '#777' }}>\n        {/* <g\n          className=\"search\"\n          transform={`translate(0, 0)`}\n          fill={doesExist ? 'red' : 'inherit'}\n          onClick={() => this.togglePathNodes(nodes, doesExist)}\n        >\n          <rect\n            width={this.ICON_GAP}\n            height={this.ICON_GAP}\n            fill=\"white\"\n            stroke=\"white\"\n          />\n          <path d={SEARCH_ICON} transform={`scale(0.018)`} />\n        </g> */}\n        {/* <g className=\"yes\" transform={`translate(${this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={YES_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g className=\"no\" transform={`translate(${2 * this.ICON_GAP}, 0)`}>\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={NO_ICON} transform={`scale(0.03)`} />\n        </g>\n        <g\n          className=\"edit\"\n          transform={`translate(${3 * this.ICON_GAP}, 0)`}\n          onClick={this.showModal}\n        >\n          <rect width={this.ICON_GAP} height={this.ICON_GAP} fill=\"white\" />\n          <path d={EDIT_ICON} transform={`scale(0.03)`} />\n        </g> */}\n      </g>\n    );\n  }\n  drawHeader() {\n    const { drugPredictions, diseasePredictions, nodeNameDict, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const nameType = appMode === 'drug-to-disease' ? 'disease' : 'drug';\n\n    const headerNames = predictions\n      .filter((d) => d.selected)\n      .map((item) => item.name || nodeNameDict[nameType][item.id] || item.id);\n    // headerNames.push('SUM');\n\n    const header = headerNames.map((name, idx) => {\n      // const isSelected =\n      //   idx > drugPredictions.length - 1\n      //     ? false\n      //     : drugPredictions[idx].selected;\n      return (\n        <text\n          key={name}\n          className={name}\n          fill={'gray'}\n          cursor=\"pointer\"\n          transform={`translate(\n            ${idx * (this.RADIUS * 2 + this.COUNT_GAP) + this.RADIUS}, \n            ${this.HEAD_HEIGHT}) \n            rotate(-45)`}\n          onClick={() => {\n            if (idx < predictions.length)\n              this.onChangeDrug(predictions[idx].id);\n          }}\n        >\n          {name}\n        </text>\n      );\n    });\n    return header;\n  }\n  getCountWidth() {\n    const { drugPredictions, diseasePredictions, appMode } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n    const width =\n      predictions.filter((d) => d.selected).length *\n      (this.RADIUS * 2 + this.COUNT_GAP) +\n      this.COUNT_GAP;\n    return width;\n  }\n  drawSummary() {\n    let { EDGE_LENGTH, NODE_WIDTH, NODE_HEIGHT, VERTICAL_GAP } = this;\n\n    let { metaPathSummary, drugPredictions, diseasePredictions, appMode, nodeNameDict } = this.props.globalState;\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const COUNT_WIDTH = this.getCountWidth();\n\n    let metaPathGroups = this.filterMetaPathGroups();\n    const triangleRight =\n      'M 9 17.879 V 6.707 A 1 1 0 0 1 10.707 6 l 5.586 5.586 a 1 1 0 0 1 0 1.414 l -5.586 5.586 A 1 1 0 0 1 9 17.879 Z',\n      triangelBottom =\n        'M 6.414 9 h 11.172 a 1 1 0 0 1 0.707 1.707 l -5.586 5.586 a 1 1 0 0 1 -1.414 0 l -5.586 -5.586 A 1 1 0 0 1 6.414 9 Z';\n\n    const maxCount = Math.max(\n      ...metaPathSummary.map((d) => Object.values(d.count)).flat()\n    );\n    const rScale = d3\n      .scaleLinear()\n      .range([this.RADIUS / 3, this.RADIUS])\n      .domain([0, maxCount]);\n\n    this.offsetY = 0;\n    const allRows = [...metaPathSummary]\n      .sort((a, b) => (a.hide ? 1 : 0) - (b.hide ? 1 : 0))\n      .map((summary) => {\n        let nodes = summary.nodeTypes.map((node, nodeIdx) => {\n          let translate = `translate(${(EDGE_LENGTH + NODE_WIDTH) * nodeIdx\n            }, ${0})`;\n          return (\n            <g key={`node_${nodeIdx}`} transform={translate}>\n              <rect\n                width={NODE_WIDTH}\n                height={NODE_HEIGHT}\n                fill=\"white\"\n                strokeWidth=\"3\"\n                stroke={getNodeColor(node)}\n                rx={this.NODE_HEIGHT / 2}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={NODE_HEIGHT / 2 + 6}\n                x={NODE_WIDTH / 2}\n                fill=\"black\"\n              >\n                {node}\n              </text>\n            </g>\n          );\n        });\n        let edges = [...Array(nodes.length - 1)].map((_, edgeIdx) => {\n          let translate = `translate(${NODE_WIDTH + (EDGE_LENGTH + NODE_WIDTH) * edgeIdx\n            }, ${+NODE_HEIGHT / 2})`;\n          return (\n            <g key={`edge_${edgeIdx}`} transform={translate}>\n              <line\n                stroke=\"lightgray\"\n                // strokeWidth={1+Math.random() * 8}\n                strokeWidth={2}\n                x1={0}\n                y1={0}\n                x2={EDGE_LENGTH}\n                y2={0}\n              />\n            </g>\n          );\n        });\n        let currentY = this.offsetY;\n        this.offsetY += NODE_HEIGHT + VERTICAL_GAP;\n\n        let differentChildren: JSX.Element[] = [];\n        let childrenOffsetY = 0;\n        const showChildren = this.state.expand[summary.idx];\n\n        let lastMetaPath: IPath | undefined = undefined;\n        let diseaseIndex = 0;\n        Object.keys(metaPathGroups).forEach((drugId) => {\n          const metaPathGroup = metaPathGroups[drugId];\n          const metaPaths =\n            metaPathGroup.filter(\n              (d) => d.nodeTypes.join('') === summary.nodeTypes.join('')\n            )[0]?.paths || [];\n\n          const drugRank = predictions\n            .filter((d) => d.selected)\n            .map((d) => d.id)\n            .indexOf(drugId);\n          \n          // Get disease name for label\n          const prediction = predictions.find((d) => d.id === drugId);\n          const diseaseName = prediction?.name || nodeNameDict['disease']?.[drugId] || drugId;\n          const shortDiseaseName = diseaseName.length > 25 ? diseaseName.slice(0, 22) + '...' : diseaseName;\n          \n          const { children, numOfChildren } = this.drawChildrenPaths(\n            metaPaths,\n            drugRank,\n            lastMetaPath\n          );\n          lastMetaPath = metaPaths[metaPaths.length - 1];\n          const childrenHeight = (NODE_HEIGHT + VERTICAL_GAP) * numOfChildren;\n          \n          // Add disease number label before paths\n          const diseaseLabel = numOfChildren > 0 ? (\n            <g transform={`translate(0, ${childrenOffsetY})`}>\n              <text \n                x={this.PADDING} \n                y={this.NODE_HEIGHT / 2 + 5} \n                fill=\"#333\" \n                fontSize={11}\n                fontWeight=\"bold\"\n              >\n                [{diseaseIndex + 1}] {shortDiseaseName}\n              </text>\n            </g>\n          ) : null;\n          \n          if (numOfChildren > 0) {\n            diseaseIndex++;\n            differentChildren.push(\n              <g\n                key={`drugRank: ${drugRank}`}\n                className={`drugRank_${drugRank}`}\n                transform={`translate(0, ${childrenOffsetY})`}\n              >\n                {diseaseLabel}\n                <g transform={`translate(0, ${this.NODE_HEIGHT + 5})`}>\n                  {children}\n                </g>\n              </g>\n            );\n            \n            childrenOffsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            if (showChildren) {\n              this.offsetY += childrenHeight + this.NODE_HEIGHT + 5;\n            }\n          }\n\n          this.offsetY += this.GROUP_GAP;\n        });\n\n        const toggleHideFunc = (hide: boolean) => {\n          toggleMetaPathHide(\n            metaPathSummary,\n            summary.idx,\n            hide,\n            this.props.dispatch\n          );\n          if (hide) {\n            this.toggleExpand(summary.idx, false);\n          }\n        };\n\n        return (\n          <g\n            key={`prototype_${summary.idx}`}\n            transform={`translate(${0}, ${currentY})`}\n            opacity={summary.hide ? 0.4 : 1}\n          >\n            <g className=\"metaCount\">{this.drawMetaCount(summary, rScale)}</g>\n            <g className=\"icon\">\n              <path\n                d={showChildren ? triangelBottom : triangleRight}\n                transform={`translate(${COUNT_WIDTH}, 0)`}\n                fill=\"gray\"\n                onClick={() => {\n                  if (!summary.hide) this.toggleExpand(summary.idx, undefined);\n                }}\n                cursor=\"pointer\"\n              />\n            </g>\n            <g\n              className=\"prototype\"\n              transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}\n            >\n              {nodes}\n              {edges}\n              <g\n                className=\"iconGroup\"\n                transform={`translate(${NODE_WIDTH * nodes.length + EDGE_LENGTH * edges.length\n                  }, 0)`}\n              >\n                {this.getMetaIconGroup(toggleHideFunc, summary.hide)}\n              </g>\n            </g>\n            <g className=\"metapaths\">\n              {showChildren ? differentChildren : <g />}\n            </g>\n          </g>\n        );\n      });\n    const header = this.drawHeader();\n    const content = (\n      <g>\n        <g\n          className=\"header\"\n          transform={`translate(${this.PADDING}, ${this.PADDING})`}\n        >\n          {header}\n        </g>\n        <g\n          className=\"rows\"\n          transform={`translate(${0}, ${this.PADDING + this.HEAD_HEIGHT})`}\n        >\n          {allRows}\n        </g>\n      </g>\n    );\n    return content;\n  }\n\n  onChangeDrug(selectedId: string) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, selectedDrugPrimary } = this.props.globalState;\n\n    if (appMode === 'drug-to-disease') {\n      const isAdd = isAddDrug(diseasePredictions, selectedId);\n\n      if (selectedDrugPrimary) {\n        selectDiseaseSecondary(\n          selectedId,\n          selectedDrugPrimary,\n          isAdd,\n          this.props.dispatch\n        );\n      }\n    } else {\n      const isAdd = isAddDrug(\n        drugPredictions,\n        selectedId\n      );\n      selectDrug(\n        selectedId,\n        selectedDisease,\n        isAdd,\n        this.props.dispatch\n      );\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { appMode, drugPredictions, diseasePredictions, selectedDisease, metaPathSummary } = this.props.globalState;\n    const prevPredictions = prevProps.globalState.appMode === 'drug-to-disease' ? prevProps.globalState.diseasePredictions : prevProps.globalState.drugPredictions;\n    const currPredictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    if (\n      // when disease changed, collapse all meta paths\n      prevProps.globalState.selectedDisease !==\n      selectedDisease\n    ) {\n      this.setState({\n        expand: metaPathSummary.map((d) => false),\n      });\n    } else if (\n      prevPredictions.filter((d) => d.selected).length !==\n      currPredictions.filter((d) => d.selected).length\n    ) {\n      // update expended metapaths when selected drug changes\n      const expandStatus = metaPathSummary.map((d) => false); // collapse all metapaths by default\n      this.setState({ expand: expandStatus });\n    }\n  }\n\n  drawMetaCount(\n    summary: IMetaPathSummary,\n    rScale: d3.ScaleLinear<number, number>\n  ) {\n    const {\n      drugPredictions,\n      diseasePredictions,\n      isAttentionLoading,\n      metaPathGroups,\n      edgeThreshold,\n      appMode,\n    } = this.props.globalState;\n    const { count, nodeTypes } = summary;\n\n    const predictions = appMode === 'drug-to-disease' ? diseasePredictions : drugPredictions;\n\n    const vis = predictions\n      .filter((d) => d.selected)\n      .map((prediction, idx) => {\n        const { id: predictionId } = prediction;\n        // const num = count[predictionId]\n        //   ? count[predictionId]\n        //   : isAttentionLoading\n        //   ? '...'\n        //   : 0;\n\n        const metaPath = metaPathGroups[predictionId]?.find(\n          (d) => d.nodeTypes.join(',') === nodeTypes.join(',')\n        );\n        const num = metaPath\n          ? metaPath.paths.filter((path) =>\n            path.edges.every((e) => e.score >= edgeThreshold)\n          ).length\n          : isAttentionLoading\n            ? '...'\n            : 0;\n\n        const content = (\n          <text\n            textAnchor=\"middle\"\n            transform={`translate(${this.RADIUS}, ${this.RADIUS / 2})`}\n            fontSize={15}\n            fill={'gray'}\n          >\n            {num}\n          </text>\n        );\n        return (\n          <g\n            key={idx}\n            className=\"count\"\n            transform={`translate(${idx * (2 * this.RADIUS + this.COUNT_GAP)\n              }, ${this.NODE_HEIGHT / 2})`}\n            cursor=\"pointer\"\n            onClick={() => this.onChangeDrug(predictionId)}\n          >\n            {content}\n          </g>\n        );\n      });\n    return (\n      <g className=\"metaCount\" transform={`translate(${this.PADDING}, 0)`}>\n        {vis}\n        {/* <g\n          className=\"sum\"\n          transform={`translate(${\n            count.length * (2 * this.RADIUS + this.COUNT_GAP)\n          }, 0)`}\n        >\n          <text\n            x={this.RADIUS}\n            y={this.NODE_HEIGHT / 2 + 6}\n            textAnchor=\"middle\"\n          >\n            {' '}\n            {`${sum}`}{' '}\n          </text>\n        </g> */}\n      </g>\n    );\n  }\n\n  drawChildrenPaths(\n    metaPaths: IPath[],\n    drugRank: number,\n    prevPath: IPath | undefined,\n    showFullPaths: boolean = true  // Always show full paths, don't abbreviate\n  ) {\n    const { nodeNameDict, edgeTypes, edgeThreshold } = this.props.globalState;\n    const COUNT_WIDTH = this.getCountWidth();\n    const filteredMetaPaths = metaPaths.filter((metaPath) =>\n      metaPath.edges.every((e) => e.score >= edgeThreshold)\n    );\n    const children = filteredMetaPaths.map((metaPath, childIdx) => {\n      // Calculate path weight from edge scores - use max score if available\n      const edgeScores = metaPath.edges.map(e => e.score).filter(s => s > 0);\n      const pathWeight = edgeScores.length > 0 \n        ? (edgeScores.reduce((sum, s) => sum + s, 0) / edgeScores.length).toFixed(2)\n        : (childIdx + 1).toString();  // Use path index if no scores\n      \n      const nodes = metaPath.nodes.map((node, nodeIdx) => {\n        const { nodeId, nodeType } = node;\n        const nodeName = nodeNameDict[nodeType]?.[nodeId] || nodeId;\n\n        // Always show full node names - don't use '' abbreviation\n        let shortNodeName = cropText(nodeName, 14, this.NODE_WIDTH - 10) || nodeId || 'unknown';\n\n        // Add offset for the weight label on the left\n        let translate = `translate(${40 + (this.EDGE_LENGTH + this.NODE_WIDTH) * nodeIdx\n          }, ${0})`;\n\n        return (\n          <Tooltip\n            key={`node_${nodeIdx}`}\n            title={(shortNodeName.includes('.') ? nodeName : nodeName) + (node.source ? ` (${node.source})` : '')}\n          >\n            <g\n              transform={translate}\n              className={`node_${nodeId}`}\n              style={{ cursor: 'pointer' }}\n              onClick={() =>\n                nodeType === 'drug' &&\n                window.open(\n                  `https://go.drugbank.com/drugs/${nodeId}`,\n                  'windowName',\n                  'popup,right=10,top=10,width=320,height=600'\n                )\n              }\n            >\n              <rect\n                width={this.NODE_WIDTH}\n                height={this.NODE_HEIGHT}\n                fill={getNodeColor(nodeType)}\n              />\n              <text\n                textAnchor=\"middle\"\n                y={this.NODE_HEIGHT / 2 + 6}\n                x={this.NODE_WIDTH / 2}\n                fill=\"white\"\n              >\n                {shortNodeName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      \n      // Add path weight/count on the left side\n      const weightLabel = (\n        <g key=\"weight\" transform={`translate(0, ${this.NODE_HEIGHT / 2 + 5})`}>\n          <text\n            textAnchor=\"end\"\n            x={35}\n            fill=\"#666\"\n            fontSize={12}\n            fontWeight=\"bold\"\n          >\n            {pathWeight}\n          </text>\n        </g>\n      );\n      \n      const edges = metaPath.edges.map((edge, edgeIdx) => {\n        // Add offset for the weight label\n        const translate = `translate(${40 + this.NODE_WIDTH + (this.EDGE_LENGTH + this.NODE_WIDTH) * edgeIdx\n          }, ${+this.NODE_HEIGHT / 2})`;\n\n        let edgeName = edge.edgeInfo.replace('rev_', '');\n        edgeName = edgeTypes[edgeName]?.edgeInfo || edgeName;\n        const edgeShortName = cropText(edgeName, 14, this.EDGE_LENGTH);\n        return (\n          <Tooltip\n            title={edgeShortName === edgeName ? '' : edgeName}\n            destroyTooltipOnHide\n          >\n            <g\n              key={`edge_${edgeIdx}`}\n              transform={translate}\n              style={{ cursor: 'pointer' }}\n            >\n              <line\n                stroke=\"gray\"\n                strokeWidth={1 + edge.score * 2}\n                x1={0}\n                y1={this.NODE_HEIGHT / 4}\n                x2={this.EDGE_LENGTH}\n                y2={this.NODE_HEIGHT / 4}\n              />\n              <text\n                x={this.EDGE_LENGTH / 2}\n                y={0}\n                textAnchor=\"middle\"\n                fill=\"gray\"\n              >\n                {edgeShortName}\n              </text>\n            </g>\n          </Tooltip>\n        );\n      });\n      return (\n        <g\n          key={childIdx}\n          transform={`translate(0, ${(this.NODE_HEIGHT + this.VERTICAL_GAP) * (1 + childIdx)\n            })`}\n        >\n          <circle\n            cx={\n              drugRank * (2 * this.RADIUS + this.COUNT_GAP) +\n              this.RADIUS +\n              this.PADDING\n            }\n            cy={this.NODE_HEIGHT / 2}\n            fill=\"gray\"\n            r={this.RADIUS / 4}\n          />\n          <g transform={`translate(${COUNT_WIDTH + this.ICON_GAP}, 0)`}>\n            {weightLabel}\n            {nodes}\n            {edges}\n            <g\n              className=\"iconGroup\"\n              transform={`translate(${40 + this.NODE_WIDTH * nodes.length + this.EDGE_LENGTH * edges.length\n                }, 0)`}\n            >\n              {this.getIconGroup(metaPath.nodes)}\n            </g>\n          </g>\n        </g>\n      );\n    });\n    return { children, numOfChildren: filteredMetaPaths.length };\n  }\n  showModal() {\n    this.setState({ isModalVisible: true });\n  }\n  hideModal() {\n    this.setState({ isModalVisible: false });\n  }\n  filterMetaPathGroups() {\n    let { metaPathGroups, edgeThreshold } = this.props.globalState;\n    let filteredMetaGroups: IState['metaPathGroups'] = {};\n    Object.keys(metaPathGroups).forEach((k) => {\n      filteredMetaGroups[k] = metaPathGroups[k].map((metaPathGroup) => {\n        const metaPaths = metaPathGroup.paths.filter((path) =>\n          path.edges.every((e) => e.score > edgeThreshold)\n        );\n        return { ...metaPathGroup, metaPaths };\n      });\n    });\n\n    Object.keys(filteredMetaGroups).forEach((k) => {\n      filteredMetaGroups[k] = filteredMetaGroups[k].filter(\n        (metaPathGroup) => metaPathGroup.paths.length > 0\n      );\n    });\n\n    return filteredMetaGroups;\n  }\n  render() {\n    const { width, height } = this.props,\n      { isModalVisible, expand } = this.state;\n    const {\n      isDrugLoading,\n      isAttentionLoading,\n      metaPathSummary,\n      selectedDisease,\n      drugPredictions,\n    } = this.props.globalState;\n\n    const svgWidth = Math.max(\n      width - 2 * this.PADDING - 2 * this.MARGIN,\n      this.getCountWidth() +\n      this.ICON_GAP * 5 +\n      this.NODE_WIDTH +\n      (this.EDGE_LENGTH + this.NODE_WIDTH) * 4\n    );\n\n    const matrixRowsCount = Object.values(metaPathSummary)\n      .map((d, idx) => {\n        return expand[idx] ? d.sum : 0;\n      })\n      .reduce((a, b) => a + b, 0),\n      matrixGroupsCount = Object.keys(metaPathSummary).length,\n      matrixHeight =\n        matrixRowsCount * (this.NODE_HEIGHT + this.VERTICAL_GAP) +\n        this.PADDING +\n        matrixGroupsCount * (this.HEAD_HEIGHT + this.GROUP_GAP);\n\n    const svgOuterHeight = height - 2 * this.PADDING - this.TITLE_HEIGHT,\n      svgHeight = Math.max(matrixHeight + this.HEAD_HEIGHT, svgOuterHeight);\n\n    const reminderText = (\n      <text\n        x={width / 2}\n        y={height / 2}\n        fill=\"gray\"\n        textAnchor=\"middle\"\n        fontSize={20}\n      >\n        {isAttentionLoading\n          ? ''\n          : typeof selectedDisease == 'string' &&\n            drugPredictions.filter((d) => d.selected).length > 0\n            ? 'Sorry, we find no meta path with current computational resources.'\n            : 'Please select a disease and at least one drug'}\n      </text>\n    );\n\n    const metaPaths = this.drawSummary();\n    const content = metaPathSummary.length === 0 ? reminderText : metaPaths;\n    return (\n      <>\n        <svg width={svgWidth} height={svgHeight}>\n          {content}\n          {/* overlap loading icon when it is loading */}\n          {isAttentionLoading ? (\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={svgWidth}\n                height={svgOuterHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${svgWidth / 2}, ${svgOuterHeight / 2})`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          ) : (\n            <></>\n          )}\n        </svg>\n\n        <Modal\n          title=\"Edit Explanation\"\n          visible={isModalVisible}\n          onOk={this.hideModal}\n          onCancel={this.hideModal}\n          okText=\"Confirm\"\n          width={width}\n          zIndex={1999}\n        >\n          <svg width={width}></svg>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(PathMatrix);\n","import React from 'react';\nimport { Tabs } from 'antd';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\n\nimport AttentionTree from './AttentionTree';\nimport Graph from './Graph';\nimport V1AttentionTable from './V1AttentionTable';\nimport V1SubGraph from './V1SubGraph';\nimport Scatter from 'components/CardContainer/Scatter';\n\nimport './index.css';\nimport PathMatrix from 'components/TabContainer/PathMatrix';\n\nconst { TabPane } = Tabs;\n\ninterface Props {\n  width: number;\n  height: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  activeTab: string;\n}\n\nclass NodeLink extends React.Component<Props, State> {\n  titleHeight = 36;\n  margin = 10;\n  padding = 10;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      activeTab: 'metapath',\n    };\n  }\n  changeActiveTab(key: string) {\n    this.setState({ activeTab: key });\n  }\n\n  render() {\n    const { width, height } = this.props;\n    const cardWidth = width - 2 * this.margin - 2 * this.padding,\n      cardHeight =\n        height - 2 * this.padding - this.titleHeight - 2 * this.margin;\n\n    const props = { ...this.props, height: cardHeight, width: cardWidth };\n\n    return (\n      <Tabs\n        size=\"small\"\n        activeKey={this.state.activeTab}\n        destroyInactiveTabPane={false}\n        style={{\n          width: width - 2 * this.margin,\n          height: height - this.margin,\n          margin: this.margin,\n          marginBottom: 0,\n          backgroundColor: 'white',\n        }}\n        tabBarStyle={{\n          height: this.titleHeight,\n          padding: '0px 10px',\n          margin: '0px',\n        }}\n        onChange={this.changeActiveTab.bind(this)}\n      >\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"metapath\"\n          tab=\"Meta-Path\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <PathMatrix {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane\n          style={{ padding: this.padding }}\n          key=\"attention\"\n          tab=\"Node Attention\"\n        >\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <AttentionTree {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"graph\" tab=\"Sub-Graph\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Graph {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"v1attention\" tab=\"Node_Attention\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <V1AttentionTable {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"v1subgraph\" tab=\"Sub_Graph\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflow: 'hidden',\n            }}\n          >\n            <V1SubGraph {...props} />\n          </div>\n        </TabPane>\n\n        <TabPane style={{ padding: this.padding }} key=\"embedding\" tab=\"Disease Embeddings\">\n          <div\n            className=\"nodelink\"\n            style={{\n              width: cardWidth,\n              height: cardHeight,\n              overflowY: 'scroll',\n            }}\n          >\n            <Scatter width={cardWidth} height={cardHeight} />\n          </div>\n        </TabPane>\n      </Tabs>\n    );\n  }\n}\n\nexport default StateConsumer(NodeLink);\n","import React from 'react';\nimport { StateConsumer } from 'stores';\nimport { IDispatch, IState } from 'types';\nimport {\n  ACTION_TYPES,\n  selectDisease,\n  selectDrug,\n  changeAppMode,\n  selectDrugPrimary,\n  selectDiseaseSecondary,\n} from 'stores/actions';\nimport { onPreloadProgress, getCacheStats } from 'stores/DataService';\n\nimport './Sider.css';\n\nimport {\n  Col,\n  InputNumber,\n  Layout,\n  Row,\n  Select,\n  Skeleton,\n  Slider,\n  Tooltip,\n  Radio,\n  Progress,\n} from 'antd';\nimport { QuestionCircleOutlined, CheckCircleOutlined, ThunderboltOutlined, LoadingOutlined } from '@ant-design/icons';\nimport {\n  getNodeColor,\n  sigmoid,\n  wheterRemoveDisease,\n  sentenceCapitalizer,\n  INIT_DISEASE,\n  INIT_DRUGS,\n} from 'helpers';\n\nconst { Sider } = Layout;\nconst { Option } = Select;\n\ninterface Props {\n  siderWidth: number;\n  globalState: IState;\n  dispatch: IDispatch;\n}\n\ninterface State {\n  preloadProgress: {\n    total: number;\n    completed: number;\n    drugId: string;\n  };\n  cacheSize: number;\n}\n\nclass DrugSider extends React.Component<Props, State> {\n  padding = 10;\n  listHeight = 450; // height of the open drug list\n  private unsubscribePreload: (() => void) | null = null;\n  \n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      preloadProgress: { total: 0, completed: 0, drugId: '' },\n      cacheSize: 0,\n    };\n    this.changeEdgeTHR = this.changeEdgeTHR.bind(this);\n    this.changeRevEdgeTHR = this.changeRevEdgeTHR.bind(this);\n    this.onChangeDisease = this.onChangeDisease.bind(this);\n    this.onChangeDrug = this.onChangeDrug.bind(this);\n    this.onChangeAppMode = this.onChangeAppMode.bind(this);\n    this.onChangeDrugPrimary = this.onChangeDrugPrimary.bind(this);\n    this.onChangeDiseaseSecondary = this.onChangeDiseaseSecondary.bind(this);\n  }\n\n  componentDidMount() {\n    // Subscribe to preload progress updates\n    this.unsubscribePreload = onPreloadProgress((progress) => {\n      this.setState({ \n        preloadProgress: progress,\n        cacheSize: getCacheStats().size,\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.unsubscribePreload) {\n      this.unsubscribePreload();\n    }\n  }\n\n  onChangeAppMode(e: any) {\n    changeAppMode(e.target.value, this.props.dispatch);\n  }\n\n  onChangeDrugPrimary(selectedDrug: string) {\n    selectDrugPrimary(selectedDrug, this.props.dispatch);\n  }\n\n  onChangeDiseaseSecondary(selectedDiseases: string[]) {\n    // For now, we only support selecting one disease at a time in the secondary list for visualization\n    // But the UI might allow multiple. Let's assume the last selected one is the target.\n    // We reuse the selectDrug logic but inverted? No, we need to adapt selectDrug or create a new one.\n    // Actually, the existing selectDrug logic expects a drug ID.\n    // For Drug-to-Disease, we want to visualize the pair.\n    // Let's reuse selectDrug but we need to be careful about what 'selectedDrug' means in state.\n    // In Drug-to-Disease mode:\n    // selectedDrugPrimary is the source drug.\n    // We want to see attention for (selectedDrugPrimary, selectedDisease).\n\n    // Wait, the existing visualization expects `selectedDisease` and `drugPredictions` (with `selected` flag).\n    // If we want to reuse the visualization components without massive refactoring:\n    // We can map:\n    // Drug-to-Disease Mode ->\n    //   selectedDisease in State = The selected disease from the list (Secondary)\n    //   selectedDrug in State = The primary drug (Primary)\n\n    // But `selectedDisease` triggers `requestDrugPredictions`. We don't want that in this mode.\n    // We want `selectedDrugPrimary` to trigger `requestDiseasePredictions`.\n\n    // Let's look at `selectDrug` action:\n    // It calls `modifyAttentionPaths`.\n    // `modifyAttentionPaths` takes (selectedDrug, selectedDisease).\n\n    // So, when a disease is selected in the secondary list:\n    // We should call `modifyAttentionPaths(selectedDrugPrimary, selectedDisease)`.\n\n    const prevSelectedDiseases = this.props.globalState.diseasePredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const isAdd = selectedDiseases.length > prevSelectedDiseases.length;\n    const currentDisease = isAdd\n      ? selectedDiseases[selectedDiseases.length - 1]\n      : prevSelectedDiseases.filter((d) => !selectedDiseases.includes(d))[0];\n\n    // Trigger attention path update\n    if (this.props.globalState.selectedDrugPrimary && currentDisease) {\n      const { selectedDrugPrimary } = this.props.globalState;\n\n      // Find the disease prediction to get node_id for attention queries\n      const diseasePrediction = this.props.globalState.diseasePredictions.find(\n        d => d.id === currentDisease\n      );\n\n      // Use node_id if available, otherwise fall back to id\n      const diseaseNodeId = diseasePrediction?.node_id || currentDisease;\n\n      // selectDiseaseSecondary handles both the selection toggle and attention path update\n      selectDiseaseSecondary(\n        currentDisease,  // Pass the id for toggle (matches d.id in diseasePredictions)\n        selectedDrugPrimary,\n        isAdd,\n        this.props.dispatch,\n        diseaseNodeId  // Pass node_id for attention API\n      );\n    }\n  }\n\n  onChangeDrug(selectedDrugs: string[]) {\n    const prevSelectedDrugs = this.props.globalState.drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n    const isAdd = selectedDrugs.length > prevSelectedDrugs.length;\n\n    const currentDrug = isAdd\n      ? selectedDrugs[selectedDrugs.length - 1]\n      : prevSelectedDrugs.filter((d) => !selectedDrugs.includes(d))[0];\n    selectDrug(\n      currentDrug,\n      this.props.globalState.selectedDisease,\n      isAdd,\n      this.props.dispatch\n    );\n  }\n  changeEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: value },\n      });\n    }\n  }\n\n  changeRevEdgeTHR(value: number | undefined | string) {\n    if (typeof value == 'number') {\n      this.props.dispatch({\n        type: ACTION_TYPES.Change_Edge_THR,\n        payload: { edgeThreshold: Math.round(10 - 10 * value) / 10 },\n      });\n    }\n  }\n\n  onChangeDisease(selectedDisease: string) {\n    selectDisease(selectedDisease, this.props.dispatch);\n  }\n  render() {\n    let { siderWidth } = this.props;\n    let {\n      edgeThreshold,\n      nodeTypes,\n      diseaseOptions,\n      drugOptions,\n      drugPredictions,\n      diseasePredictions,\n      nodeNameDict,\n      selectedDisease,\n      selectedDrugPrimary,\n      appMode,\n    } = this.props.globalState;\n\n    // Default to disease-to-drug if undefined\n    const currentMode = appMode || 'disease-to-drug';\n\n    const defaultDiseaseText = 'Search to Select a disease';\n    const defaultDrugText = 'Select a drug from the prediction';\n    const selectedDrugIds = drugPredictions\n      .filter((d) => d.selected)\n      .map((d) => d.id);\n\n    const selectedDiseaseIds = diseasePredictions\n      ? diseasePredictions.filter((d) => d.selected).map((d) => d.id)\n      : [];\n\n    const untreatable_disease_icon = (\n      <Tooltip\n        // title=\"The knowledge graph contains no drug for treating this disease\"\n        title=\"Diseases with no known drug indications in the dataset\"\n      >\n        <QuestionCircleOutlined style={{ color: '#eb2f96' }} />\n      </Tooltip>\n    );\n\n    const known_drug_icon = (\n      <Tooltip\n        // title=\"the knowledge graph contains this drug indication\"\n        title=\"US FDA-approved drug indication\"\n      >\n        <CheckCircleOutlined style={{ color: '#52c41a' }} />\n      </Tooltip>\n    );\n\n    let sider = (\n      <Sider\n        width={siderWidth}\n        theme=\"light\"\n        style={{ padding: `${this.padding}px` }}\n      >\n        <div style={{ marginBottom: 10, textAlign: 'center' }}>\n          <Radio.Group value={currentMode} onChange={this.onChangeAppMode}>\n            <Radio.Button value=\"disease-to-drug\">Disease &rarr; Drug</Radio.Button>\n            <Radio.Button value=\"drug-to-disease\">Drug &rarr; Disease</Radio.Button>\n          </Radio.Group>\n        </div>\n\n        {currentMode === 'disease-to-drug' ? (\n          <>\n            Disease:\n            <Select\n              defaultValue={INIT_DISEASE}\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDisease}\n              showSearch\n              optionFilterProp=\"label\"\n              value={selectedDisease}\n            >\n              {diseaseOptions.length > 0 ? (\n                diseaseOptions\n                  .filter(\n                    (d) => {\n                      if (!nodeNameDict['disease'] || !nodeNameDict['disease'][d[0]]) return true;\n                      return !wheterRemoveDisease(nodeNameDict['disease'][d[0]]);\n                    }\n                  )\n                  .map((d) => {\n                    const [id, treatable] = d;\n                    const name = (nodeNameDict['disease'] && nodeNameDict['disease'][id]) || id;\n                    const cropName =\n                      name.length * 10 > siderWidth * 0.8\n                        ? name.slice(0, 40) + '...'\n                        : name;\n                    return (\n                      <Option value={id} label={name} key={`diseaseID_${d}`}>\n                        <span title={name}> {sentenceCapitalizer(cropName)} </span>\n                        {!treatable && untreatable_disease_icon}\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\">\n                  data is loading..\n                </Option>\n              )}\n            </Select>\n            <br />\n            Drug:\n            {drugPredictions.length === 0 ? (\n              // <span>Data is Loading.. </span>\n              <Skeleton />\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDrug}\n                defaultValue={INIT_DRUGS}\n                value={selectedDrugIds}\n                // menuItemSelectedIcon={<EyeOutlined />}\n                menuItemSelectedIcon={<></>}\n              >\n                {drugPredictions.map((d, idx) => {\n                  const { id: drug_id, score, known } = d;\n                  const name = (nodeNameDict['drug'] && nodeNameDict['drug'][drug_id]) || drug_id;\n                  const cropName =\n                    name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  return (\n                    <Option value={drug_id} key={`disease_${idx}`} label={name}>\n                      <div>\n                        <span>\n                          [{idx + 1}] <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span style={{ float: 'right' }}>\n                          score: {sigmoid(score).toFixed(3)}\n                          {/* rank: {idx + 1} */}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        ) : (\n          <>\n            Drug:\n            <Select\n              style={{ width: siderWidth - 2 * this.padding }}\n              onChange={this.onChangeDrugPrimary}\n              showSearch\n              optionFilterProp=\"label\"\n              placeholder=\"Click to select a drug\"\n              value={selectedDrugPrimary}\n              dropdownStyle={{ maxHeight: 400, overflow: 'auto' }}\n              listHeight={350}\n              virtual={false}\n            >\n              {drugOptions && drugOptions.length > 0 ? (\n                // Sort drugs alphabetically by name\n                [...drugOptions]\n                  .map((drug_id) => ({\n                    id: drug_id,\n                    name: nodeNameDict['drug'] ? nodeNameDict['drug'][drug_id] : drug_id\n                  }))\n                  .sort((a, b) => (a.name || a.id).localeCompare(b.name || b.id))\n                  .map(({ id: drug_id, name }, idx) => {\n                    const displayName = name || drug_id;\n                    return (\n                      <Option value={drug_id} label={displayName} key={`drugID_${drug_id}`}>\n                        <div style={{ padding: '4px 0' }}>\n                          <span style={{ fontWeight: 500 }}>[{idx + 1}]</span>{' '}\n                          <span title={displayName}>{displayName}</span>\n                        </div>\n                      </Option>\n                    );\n                  })\n              ) : (\n                <Option value=\"loading\" label=\"loading\" key=\"loading\" disabled>\n                  Loading drugs... (Please wait)\n                </Option>\n              )}\n            </Select>\n            <br />\n            Disease Candidates:\n            {!diseasePredictions || diseasePredictions.length === 0 ? (\n              this.props.globalState.isDiseaseLoading ? <Skeleton /> : <div>Select a drug to see candidates</div>\n            ) : (\n              <Select\n                mode=\"multiple\"\n                style={{ width: siderWidth - 2 * this.padding }}\n                open\n                showSearch\n                optionFilterProp=\"label\"\n                listHeight={this.listHeight}\n                onChange={this.onChangeDiseaseSecondary}\n                value={selectedDiseaseIds}\n                menuItemSelectedIcon={<></>}\n              >\n                {diseasePredictions.map((d: any, idx) => {\n                  const { id: disease_id, score, known, name: predictionName, percentile, z_score, rank } = d;\n                  const name = predictionName || (nodeNameDict['disease'] ? nodeNameDict['disease'][disease_id] : disease_id);\n                  const cropName =\n                    name && name.length * 10 > siderWidth * 0.5\n                      ? name.slice(0, 20) + '...'\n                      : name;\n                  \n                  // Format display info - prefer percentile/rank over raw score\n                  const topPercent = percentile ? (100 - percentile).toFixed(2) : null;\n                  const displayRank = rank || (idx + 1);\n                  const tooltipInfo = `Raw score: ${score?.toFixed(6) || 'N/A'}${z_score ? `, Z-score: ${z_score.toFixed(2)}` : ''}`;\n                  \n                  return (\n                    <Option value={disease_id} key={`disease_${idx}`} label={name}>\n                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                        <span style={{ flex: 1, overflow: 'hidden', textOverflow: 'ellipsis' }}>\n                          <span style={{ color: '#666', marginRight: 4 }}>#{displayRank}</span>\n                          <span title={name}>{cropName}</span>{' '}\n                          {known && known_drug_icon}\n                        </span>\n                        <span \n                          style={{ fontSize: '11px', color: '#1890ff', marginLeft: 8 }}\n                          title={tooltipInfo}\n                        >\n                          {topPercent ? `Top ${topPercent}%` : `${sigmoid(score).toFixed(3)}`}\n                        </span>\n                      </div>\n                    </Option>\n                  );\n                })}\n              </Select>\n            )}\n          </>\n        )}\n\n        <div className=\"dummy\" style={{ height: this.listHeight + 20 }} />\n        \n        {/* Preload Progress Indicator */}\n        {this.state.preloadProgress.total > 0 && (\n          <div style={{\n            marginBottom: 15,\n            padding: '8px 12px',\n            background: this.state.preloadProgress.completed >= this.state.preloadProgress.total \n              ? '#f6ffed' \n              : '#e6f7ff',\n            borderRadius: 6,\n            border: this.state.preloadProgress.completed >= this.state.preloadProgress.total\n              ? '1px solid #b7eb8f'\n              : '1px solid #91d5ff',\n          }}>\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 4 }}>\n              {this.state.preloadProgress.completed >= this.state.preloadProgress.total ? (\n                <>\n                  <ThunderboltOutlined style={{ color: '#52c41a', marginRight: 6 }} />\n                  <span style={{ fontSize: 12, color: '#52c41a', fontWeight: 500 }}>\n                     Data Cached - Instant Response\n                  </span>\n                </>\n              ) : (\n                <>\n                  <LoadingOutlined style={{ color: '#1890ff', marginRight: 6 }} />\n                  <span style={{ fontSize: 12, color: '#1890ff' }}>\n                    Caching data for fast interactions...\n                  </span>\n                </>\n              )}\n            </div>\n            <Progress \n              percent={Math.round((this.state.preloadProgress.completed / this.state.preloadProgress.total) * 100)}\n              size=\"small\"\n              status={this.state.preloadProgress.completed >= this.state.preloadProgress.total ? 'success' : 'active'}\n              showInfo={false}\n            />\n            <div style={{ fontSize: 10, color: '#888', marginTop: 2 }}>\n              {this.state.cacheSize} items cached\n            </div>\n          </div>\n        )}\n        \n        Minimum self-explaining edge score:\n        <Row gutter={20}>\n          <Col span={5}>\n            <InputNumber\n              value={edgeThreshold}\n              onChange={this.changeEdgeTHR}\n              style={{ width: '100%' }}\n              step={0.1}\n              min={0}\n              max={1}\n            />\n          </Col>\n          <Col span={16}>\n            <Slider\n              step={0.1}\n              value={1 - edgeThreshold}\n              min={0}\n              max={1}\n              onChange={this.changeRevEdgeTHR}\n              marks={{ 0: '1.0', 1: '0.0' }}\n              reverse={true}\n              tipFormatter={(value?: number) => {\n                return value && (1 - value).toFixed(1);\n              }}\n            />\n          </Col>\n        </Row>\n        <div className=\"nodeTypes\">\n          Node Types:\n          <br />\n          {nodeTypes.map((nodeType) => {\n            return (\n              <div key={nodeType} style={{ marginLeft: '5px' }}>\n                {/* <input type=\"checkbox\" style={{ margin: \"2px\" }} /> */}\n                <span\n                  style={{\n                    background: getNodeColor(nodeType),\n                    color: 'white',\n                    padding: '2px',\n                  }}\n                >\n                  {nodeType}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n        <br />\n        {/* <Button\n          icon={<SearchOutlined />}\n          type=\"primary\"\n          shape=\"round\"\n          onClick={() => this.startAnalysis()}\n        >\n          Show Attention Tree\n        </Button> */}\n        <br />\n      </Sider>\n    );\n\n    return sider;\n  }\n}\n\nexport default StateConsumer(DrugSider);\n","import React from 'react';\nimport NodeLink from 'components/TabContainer';\nimport DrugSider from 'components/Sider';\n\nimport { Layout, Modal } from 'antd';\nimport { InfoCircleOutlined, LinkOutlined } from '@ant-design/icons';\nimport './App.css';\nimport { StateConsumer } from 'stores';\nimport { IState, IDispatch } from 'types';\nimport { ACTION_TYPES, selectDisease, selectDrug, selectDrugPrimary, selectDiseaseSecondary, changeAppMode } from 'stores/actions';\nimport {\n  requestNodeTypes,\n  requestEdgeTypes,\n  requestNodeNameDict,\n  requestDiseaseOptions,\n  requestDrugList,\n} from 'stores/DataService';\nimport { setNodeColor, LOADING_ICON, INIT_DRUG_PRIMARY, INIT_DISEASES, DEFAULT_APP_MODE } from 'helpers';\n\nconst { Header, Footer, Content } = Layout;\n\ninterface Props {\n  globalState: IState;\n  dispatch: IDispatch;\n}\ninterface State {\n  width: number;\n  height: number;\n  isModalVisible: boolean;\n}\n\nclass App extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      isModalVisible: false,\n    };\n\n    this.updateSize = this.updateSize.bind(this);\n  }\n\n  showModal = () => {\n    this.setState({ isModalVisible: true });\n  };\n\n  hideModal = () => {\n    this.setState({ isModalVisible: false });\n  };\n\n  updateSize() {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    });\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.updateSize);\n\n    requestNodeTypes()\n      .then((nodeTypes) => {\n        setNodeColor(nodeTypes);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Types,\n          payload: { nodeTypes },\n        });\n      })\n      .then(() => requestEdgeTypes())\n      .then((edgeTypes) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Edge_Types,\n          payload: { edgeTypes },\n        });\n      })\n      .then(() => requestNodeNameDict())\n      .then((nodeNameDict) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Node_Name_Dict,\n          payload: { nodeNameDict },\n        });\n      })\n      .then(() => requestDiseaseOptions())\n      .then((diseaseOptions) => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Disease_Options,\n          payload: { diseaseOptions },\n        });\n      })\n      .then(() => requestDrugList())\n      .then((drugList) => {\n        // Load available drugs for selection\n        const drugOptions = drugList.map(d => d.id);\n        this.props.dispatch({\n          type: ACTION_TYPES.Load_Drug_List,\n          payload: { drugOptions },\n        });\n      })\n      // Initialize in drug-to-disease mode with Inebilizumab\n      .then(() => {\n        changeAppMode(DEFAULT_APP_MODE, this.props.dispatch);\n      })\n      .then(() => selectDrugPrimary(INIT_DRUG_PRIMARY, this.props.dispatch))\n      .then(() => {\n        // Select first disease prediction\n        if (INIT_DISEASES.length > 0) {\n          selectDiseaseSecondary(INIT_DISEASES[0], INIT_DRUG_PRIMARY, true, this.props.dispatch);\n        }\n      })\n      .then(() => {\n        this.props.dispatch({\n          type: ACTION_TYPES.Set_Loading_Status,\n          payload: { isInitializing: false },\n        });\n      });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateSize);\n  }\n\n  render() {\n    let siderWidth = 380,\n      footHeight = 20,\n      mainViewWidth = Math.max(0, window.innerWidth - siderWidth),\n      headerHeight = 64,\n      mainViewHeight = Math.max(0, window.innerHeight - headerHeight - footHeight);\n\n    const { isInitializing } = this.props.globalState;\n\n    let header = (\n      <Header className=\"header\" style={{ height: headerHeight }}>\n        <img\n          src=\"favicon.ico\"\n          style={{ height: headerHeight * 0.8, padding: '2px 10px' }}\n          alt=\"logo\"\n        />\n        <b style={{ fontSize: '30px' }}>Amgen Drugs and candidate Diseases Explorer</b>\n        <span\n          style={{ float: 'right', cursor: 'pointer' }}\n          onClick={this.showModal}\n        >\n          <InfoCircleOutlined\n            style={{ height: headerHeight, fontSize: '20px' }}\n          />\n          <span\n            style={{\n              paddingLeft: '5px',\n              fontSize: '18px',\n              height: headerHeight,\n            }}\n          >\n            About\n          </span>{' '}\n        </span>\n      </Header>\n    );\n\n    return (\n      <>\n        <Layout>\n          {header}\n\n          <Layout>\n            <DrugSider siderWidth={siderWidth} />\n            <Content className=\"main\" style={{ height: mainViewHeight }}>\n              <NodeLink width={mainViewWidth} height={mainViewHeight - footHeight} />\n              <Footer\n                style={{\n                  textAlign: 'center',\n                  color: 'gray',\n                  height: footHeight,\n                  padding: 0,\n                }}\n              >\n\n              </Footer>\n            </Content>\n          </Layout>\n        </Layout>\n\n        {isInitializing && (\n          <svg\n            width={window.innerWidth}\n            height={window.innerHeight}\n            style={{ position: 'absolute', left: 0, top: 0 }}\n          >\n            <g className=\"loading\">\n              <rect\n                className=\"loading__background\"\n                width={window.innerWidth}\n                height={window.innerHeight}\n                fill=\"white\"\n                opacity={0.5}\n              />\n              <g\n                transform={`translate(${window.innerWidth / 2}, ${window.innerHeight / 2\n                  })`}\n              >\n                {LOADING_ICON}\n              </g>\n            </g>\n          </svg>\n        )}\n\n        <Modal\n          title=\"About Amgen Drugs and candidate Diseases Explorer\"\n          className=\"about-modal\"\n          visible={this.state.isModalVisible}\n          footer={null}\n          onCancel={this.hideModal}\n          zIndex={1099}\n          width={window.innerWidth * 0.5}\n        >\n          <h3>About</h3>\n          <p>\n            This Drug and Diseases Explorer provides a visual interface to interact with the predictions and explanations of an AI model that identify candidate diseases with limited treatment options and minimal molecular understanding for a given Drug.\n          </p>\n          <p>\n            AI model is a graph neural network pre-trained on a comprehensive knowledge graph of 17,080 clinically-recognized diseases and 7,957 therapeutic candidates. The model can process various therapeutic tasks in a unified formulation. Once trained, the model can perform zero-shot inference on new diseases without the need for additional parameters or fine-tuning on ground truth labels.\n          </p>\n\n          <h3>Medical Advice Disclaimer</h3>\n          <p>\n            DISCLAIMER: THIS WEBSITE DOES NOT PROVIDE MEDICAL ADVICE\n            <br />\n            The information, including but not limited to, text, graphics, images and other material contained on this website are for informational purposes only. No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment. Always seek the advice of your physician or other qualified health care provider with any questions you may have regarding a medical condition or treatment and before undertaking a new health care regimen, and never disregard professional medical advice or delay in seeking it because of something you have read on this website.\n          </p>\n        </Modal>\n      </>\n    );\n  }\n}\n\nexport default StateConsumer(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'antd/dist/antd.css';\nimport { StateProvider } from 'stores';\n\nReactDOM.render(\n  <StateProvider>\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>\n  </StateProvider>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}